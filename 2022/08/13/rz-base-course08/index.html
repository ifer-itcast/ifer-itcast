<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.ico">
  <link rel="mask-icon" href="/images/favicon.ico" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"mac"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="✔ 目标。">
<meta property="og:type" content="article">
<meta property="og:title" content="08_人资后台">
<meta property="og:url" content="http://example.com/2022/08/13/rz-base-course08/index.html">
<meta property="og:site_name" content="危险">
<meta property="og:description" content="✔ 目标。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/resource/images/image-20200901151025021.png">
<meta property="og:image" content="http://example.com/resource/images/image-20200901151151286.png">
<meta property="og:image" content="http://example.com/resource/images/image-20210131125420085.png">
<meta property="og:image" content="http://example.com/resource/images/image-20210131122251352.png">
<meta property="og:image" content="http://example.com/resource/images/image-20210131123805109.png">
<meta property="og:image" content="http://example.com/resource/images/image-20210131125436012.png">
<meta property="og:image" content="http://example.com/resource/images/image-20210131125826228.png">
<meta property="og:image" content="http://example.com/resource/images/image-20200901160508382.png">
<meta property="og:image" content="http://example.com/resource/images/image-20210201112608478.png">
<meta property="og:image" content="http://example.com/resource/images/image-20210201112628807.png">
<meta property="og:image" content="http://example.com/resource/images/image-20210201112705582.png">
<meta property="og:image" content="http://example.com/resource/images/image-20210201161732323.png">
<meta property="og:image" content="http://example.com/resource/images/image-20210201171518294.png">
<meta property="og:image" content="http://example.com/resource/images/image-20210201123751691.png">
<meta property="og:image" content="http://example.com/resource/images/image-20210201130159025.png">
<meta property="og:image" content="http://example.com/resource/images/image-20210201130943535.png">
<meta property="og:image" content="http://example.com/resource/images/image-20200730002842243-1612148541264.png">
<meta property="og:image" content="http://example.com/resource/images/image-20210201182944794.png">
<meta property="og:image" content="http://example.com/resource/images/image-20200815184407204-1612157824216.png">
<meta property="og:image" content="http://example.com/resource/images/image-20210202231257679.png">
<meta property="og:image" content="http://example.com/resource/images/image-20210201134941017.png">
<meta property="og:image" content="http://example.com/resource/images/image-20210202233945914.png">
<meta property="og:image" content="http://example.com/resource/images/image-20210203004115592.png">
<meta property="og:image" content="http://example.com/resource/images/image-20210203164002358.png">
<meta property="og:image" content="http://example.com/resource/images/image-20210203003829488.png">
<meta property="og:image" content="http://example.com/resource/images/image-20210203005054757.png">
<meta property="og:image" content="http://example.com/resource/images/image-20210203005328509.png">
<meta property="og:image" content="http://example.com/resource/images/image-20210331075901421.png">
<meta property="article:published_time" content="2022-08-13T14:08:14.000Z">
<meta property="article:modified_time" content="2022-08-30T15:39:33.504Z">
<meta property="article:author" content="Ifer">
<meta property="article:tag" content="React,Redux,Mobx,Saga,Dva,Umi,AntD,TS">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/resource/images/image-20200901151025021.png">

<link rel="canonical" href="http://example.com/2022/08/13/rz-base-course08/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>08_人资后台 | 危险</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">危险</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">为之则易，不为则难</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/08/13/rz-base-course08/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/49337922.png">
      <meta itemprop="name" content="Ifer">
      <meta itemprop="description" content="React 全家桶 <span style='position:relative;top:-2px;'>✍</span>">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="危险">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          08_人资后台
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-08-13 22:08:14" itemprop="dateCreated datePublished" datetime="2022-08-13T22:08:14+08:00">2022-08-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-08-30 23:39:33" itemprop="dateModified" datetime="2022-08-30T23:39:33+08:00">2022-08-30</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>✔ 目标。</p>
<span id="more"></span>

<h1 id="权限设计和管理"><a href="#权限设计和管理" class="headerlink" title="权限设计和管理"></a>权限设计和管理</h1><h2 id="RBAC-的权限设计思想"><a href="#RBAC-的权限设计思想" class="headerlink" title="RBAC 的权限设计思想"></a>RBAC 的<code>权限设计</code>思想</h2><p>采用方案: RBAC 的权限模型，RBAC(Role-Based Access control) ，也就是基于角色的权限分配解决方案</p>
<p>其权限模式如下:</p>
<img src="/resource/images/image-20200901151025021.png"/>

<p>三个关键点: 员工, 角色, 权限</p>
<ol>
<li>给员工分配角色</li>
<li>给角色分配权限</li>
</ol>
<p>以你自己为例, 你进入一家公司, 入职, 人事将你录入系统 =&gt; 分配你的角色 (前端开发工程师)</p>
<p>同角色有着相同的权限, 操作角色权限的同时, 所有该角色的用户对应权限, 就会同步更新</p>
<h2 id="给员工分配角色"><a href="#给员工分配角色" class="headerlink" title="给员工分配角色"></a>给员工分配角色</h2><p>**<code>目标</code>**在员工管理页面，分配角色</p>
<img src="/resource/images/image-20200901151151286.png"/>

<p>用户和角色是**<code>1对多</code>**的关系，即一个用户可以拥有多个角色，比如公司的董事长可以拥有总经理和系统管理员一样的角色</p>
<h3 id="新建分配角色弹框"><a href="#新建分配角色弹框" class="headerlink" title="新建分配角色弹框"></a>新建分配角色弹框</h3><img src="/resource/images/image-20210131125420085.png"/>

<p>首先，新建分配角色窗体 <strong><code>employees/components/assign-role.vue</code></strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;el-dialog class=&quot;assign-role&quot; title=&quot;分配角色&quot; :visible=&quot;showRoleDialog&quot;&gt;</span><br><span class="line">        &lt;!-- 这里准备复选框 --&gt;</span><br><span class="line">        ...</span><br><span class="line"></span><br><span class="line">        &lt;template #footer&gt;</span><br><span class="line">            &lt;el-button type=&quot;primary&quot; size=&quot;small&quot;&gt;确定&lt;/el-button&gt;</span><br><span class="line">            &lt;el-button size=&quot;small&quot;&gt;取消&lt;/el-button&gt;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">    &lt;/el-dialog&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">    props: &#123;</span><br><span class="line">        showRoleDialog: &#123;</span><br><span class="line">            type: Boolean,</span><br><span class="line">            default: false,</span><br><span class="line">        &#125;,</span><br><span class="line">        // 用户的id 用来查询当前用户的角色信息</span><br><span class="line">        userId: &#123;</span><br><span class="line">            type: String,</span><br><span class="line">            default: null,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h3 id="弹层的显示和关闭"><a href="#弹层的显示和关闭" class="headerlink" title="弹层的显示和关闭"></a>弹层的显示和关闭</h3><p>点击角色按钮显示弹层</p>
<img src="/resource/images/image-20210131122251352.png"/>

<p>注册组件</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> AssignRole <span class="keyword">from</span> <span class="string">&#x27;./components/assign-role&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">components</span>: &#123;</span><br><span class="line">  AddEmployee,</span><br><span class="line">  AssignRole</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">assign-role</span> <span class="attr">:show-role-dialog.sync</span>=<span class="string">&quot;showRoleDialog&quot;</span> <span class="attr">:user-id</span>=<span class="string">&quot;userId&quot;</span> /&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>点击角色按钮, 记录 id, 显示弹层</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-button type=<span class="string">&quot;text&quot;</span> size=<span class="string">&quot;small&quot;</span> @click=<span class="string">&quot;editRole(row.id)&quot;</span>&gt;角色&lt;/el-button&gt;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">editRole</span>(<span class="params">id</span>)</span> &#123;</span><br><span class="line">  <span class="built_in">this</span>.userId = id</span><br><span class="line">  <span class="built_in">this</span>.showRoleDialog = <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>弹层的关闭</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="xml"><span class="tag">&lt;<span class="name">el-dialog</span> <span class="attr">class</span>=<span class="string">&quot;assign-role&quot;</span> <span class="attr">title</span>=<span class="string">&quot;分配角色&quot;</span> <span class="attr">:visible</span>=<span class="string">&quot;showRoleDialog&quot;</span> @<span class="attr">close</span>=<span class="string">&quot;closeDialog&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="comment">&lt;!-- el-checkbox-group选中的是 当前用户所拥有的角色  需要绑定 当前用户拥有的角色--&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">el-checkbox-group</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="comment">&lt;!-- 选项 --&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">el-checkbox-group</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">template</span> #<span class="attr">footer</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;text-align: right&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span>&gt;</span>确定<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">el-button</span> @<span class="attr">click</span>=<span class="string">&quot;closeDialog&quot;</span>&gt;</span>取消<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">el-dialog</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span></span><br><span class="line"><span class="javascript"><span class="xml"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="javascript"><span class="xml">  <span class="attr">props</span>: &#123;</span></span></span><br><span class="line"><span class="javascript"><span class="xml">    <span class="attr">showRoleDialog</span>: &#123;</span></span></span><br><span class="line"><span class="javascript"><span class="xml">      <span class="attr">type</span>: <span class="built_in">Boolean</span>,</span></span></span><br><span class="line"><span class="javascript"><span class="xml">      <span class="attr">default</span>: <span class="literal">false</span></span></span></span><br><span class="line"><span class="javascript"><span class="xml">    &#125;,</span></span></span><br><span class="line"><span class="javascript"><span class="xml">    <span class="comment">// 用户的id 用来查询当前用户的角色信息</span></span></span></span><br><span class="line"><span class="javascript"><span class="xml">    <span class="attr">userId</span>: &#123;</span></span></span><br><span class="line"><span class="javascript"><span class="xml">      <span class="attr">type</span>: <span class="built_in">String</span>,</span></span></span><br><span class="line"><span class="javascript"><span class="xml">      <span class="attr">default</span>: <span class="literal">null</span></span></span></span><br><span class="line"><span class="javascript"><span class="xml">    &#125;</span></span></span><br><span class="line"><span class="javascript"><span class="xml">  &#125;,</span></span></span><br><span class="line"><span class="javascript"><span class="xml">  <span class="attr">methods</span>: &#123;</span></span></span><br><span class="line"><span class="javascript"><span class="xml">    <span class="function"><span class="title">closeDialog</span>(<span class="params"></span>)</span> &#123;</span></span></span><br><span class="line"><span class="javascript"><span class="xml">      <span class="built_in">this</span>.$emit(<span class="string">&#x27;update:showRoleDialog&#x27;</span>, <span class="literal">false</span>)</span></span></span><br><span class="line"><span class="javascript"><span class="xml">    &#125;</span></span></span><br><span class="line"><span class="javascript"><span class="xml">  &#125;</span></span></span><br><span class="line"><span class="javascript"><span class="xml">&#125;</span></span></span><br><span class="line"><span class="javascript"><span class="xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<img src="/resource/images/image-20210131123805109.png"/>

<h3 id="获取角色列表"><a href="#获取角色列表" class="headerlink" title="获取角色列表"></a>获取角色列表</h3><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-checkbox-group v-model=<span class="string">&#x27;roleIds&#x27;</span>&gt;</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">el-checkbox</span> <span class="attr">label</span>=<span class="string">&#x27;110&#x27;</span>&gt;</span>管理员<span class="tag">&lt;/<span class="name">el-checkbox</span>&gt;</span></span></span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">el-checkbox</span> <span class="attr">label</span>=<span class="string">&#x27;113&#x27;</span>&gt;</span>开发者<span class="tag">&lt;/<span class="name">el-checkbox</span>&gt;</span></span></span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">el-checkbox</span> <span class="attr">label</span>=<span class="string">&#x27;115&#x27;</span>&gt;</span>人事<span class="tag">&lt;/<span class="name">el-checkbox</span>&gt;</span></span></span><br><span class="line">&lt;/el-checkbox-group&gt;</span><br></pre></td></tr></table></figure>

<p><strong>发送请求获取角色列表</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; reqGetRoleList &#125; <span class="keyword">from</span> <span class="string">&#x27;@/api/setting&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="attr">props</span>: &#123;</span><br><span class="line">        <span class="attr">showRoleDialog</span>: &#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="built_in">Boolean</span>,</span><br><span class="line">            <span class="attr">default</span>: <span class="literal">false</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">// 用户的id 用来查询当前用户的角色信息</span></span><br><span class="line">        <span class="attr">userId</span>: &#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="built_in">String</span>,</span><br><span class="line">            <span class="attr">default</span>: <span class="literal">null</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="attr">list</span>: [],</span><br><span class="line">            <span class="attr">roleIds</span>: [],</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="title">created</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.getRoleList()</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">methods</span>: &#123;</span><br><span class="line">        <span class="function"><span class="title">closeDialog</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.$emit(<span class="string">&#x27;update:showRoleDialog&#x27;</span>, <span class="literal">false</span>)</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="keyword">async</span> <span class="function"><span class="title">getRoleList</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> &#123; data &#125; = <span class="keyword">await</span> reqGetRoleList(<span class="number">1</span>, <span class="number">100</span>)</span><br><span class="line">            <span class="built_in">this</span>.list = data.rows</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>渲染数据</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-checkbox-group v-model=<span class="string">&quot;roleIds&quot;</span>&gt;</span><br><span class="line">  <span class="xml"><span class="tag">&lt;<span class="name">el-checkbox</span> <span class="attr">v-for</span>=<span class="string">&quot;item in list&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;item.id&quot;</span> <span class="attr">:label</span>=<span class="string">&quot;item.id&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">    &#123;&#123; item.name &#125;&#125;</span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">el-checkbox</span>&gt;</span></span></span><br><span class="line">&lt;/el-checkbox-group&gt;</span><br></pre></td></tr></table></figure>

<p>微调样式</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;style lang=<span class="string">&quot;scss&quot;</span> scoped&gt;</span><br><span class="line">.assign-role &#123;</span><br><span class="line">  ::v-deep &#123;</span><br><span class="line">    .el-checkbox &#123;</span><br><span class="line">      font-size: 30px;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<img src="/resource/images/image-20210131125436012.png"/>

<h3 id="获取用户的当前角色"><a href="#获取用户的当前角色" class="headerlink" title="获取用户的当前角色"></a>获取用户的当前角色</h3><p><strong>获取用户的当前角色, 进行回显</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; reqGetUserDetailById &#125; <span class="keyword">from</span> <span class="string">&#x27;@/api/employees&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="title">getUserDetailById</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; data &#125; = <span class="keyword">await</span> reqGetUserDetailById(<span class="built_in">this</span>.userId)</span><br><span class="line">  <span class="built_in">this</span>.roleIds = data.roleIds</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>created 中直接发请求会有问题, 一进入页面, 弹框还没点就发请求了, 而此时还没有 userId</p>
<p>可以换到弹框显示发请求, 给弹框注册 open 事件</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-dialog <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;assign-role&quot;</span> title=<span class="string">&quot;分配角色&quot;</span> :visible=<span class="string">&quot;showRoleDialog&quot;</span> @open=<span class="string">&quot;dialogOpen&quot;</span> @close=<span class="string">&quot;closeDialog&quot;</span>&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">methods: &#123;</span><br><span class="line">  <span class="function"><span class="title">dialogOpen</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.getRoleList()</span><br><span class="line">    <span class="built_in">this</span>.getUserDetailById()</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img src="/resource/images/image-20210131125826228.png"/>

<h3 id="给员工分配角色-1"><a href="#给员工分配角色-1" class="headerlink" title="给员工分配角色"></a>给员工分配角色</h3><p><strong>分配角色接口</strong> <strong><code>api/employees.js</code></strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** *</span></span><br><span class="line"><span class="comment"> * 给员工分配角色</span></span><br><span class="line"><span class="comment"> * ***/</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">reqAssignRoles</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> request(&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="string">&#x27;/sys/user/assignRoles&#x27;</span>,</span><br><span class="line">        data,</span><br><span class="line">        <span class="attr">method</span>: <span class="string">&#x27;put&#x27;</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>确定保存</strong> <strong><code>assign-role</code></strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-button type=<span class="string">&quot;primary&quot;</span> @click=<span class="string">&quot;clickSubmit&quot;</span>&gt;确定&lt;/el-button&gt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="title">clickSubmit</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">  <span class="keyword">await</span> reqAssignRoles(&#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="built_in">this</span>.userId,</span><br><span class="line">    <span class="attr">roleIds</span>: <span class="built_in">this</span>.roleIds</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="built_in">this</span>.closeDialog()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="添加-loading-效果"><a href="#添加-loading-效果" class="headerlink" title="添加 loading 效果"></a>添加 loading 效果</h3><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-checkbox-group v-model=<span class="string">&quot;roleIds&quot;</span> v-loading=<span class="string">&quot;loading&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">dialogOpen</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">  <span class="built_in">this</span>.loading = <span class="literal">true</span></span><br><span class="line">  <span class="built_in">Promise</span>.all([<span class="built_in">this</span>.getRoleList(), <span class="built_in">this</span>.getUserDetailById()]).then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.loading = <span class="literal">false</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p><strong>提交代码</strong></p>
<p><strong><code>本节任务</code></strong> 分配员工权限</p>
<h2 id="权限点管理页面开发"><a href="#权限点管理页面开发" class="headerlink" title="权限点管理页面开发"></a>权限点管理页面开发</h2><p>**<code>目标</code>**： 完成权限点页面的开发和管理 =&gt; 为了后面做准备</p>
<ol>
<li>便于分配权限, 只有有权限了才能分配</li>
<li>只有分配好了权限, 有对应的权限规则, 才能控制路由(模块访问权), 才能控制按钮的显示(操作权)</li>
</ol>
<h3 id="新建权限点管理页面"><a href="#新建权限点管理页面" class="headerlink" title="新建权限点管理页面"></a>新建权限点管理页面</h3><blockquote>
<p>人已经有了角色，只要给角色分配权限, 人就有了权限</p>
<p>那么权限是什么</p>
</blockquote>
<p>在企业服务中，权限一般分割为 <strong>页面访问权限</strong>，<strong>按钮操作权限</strong>，<strong>API 访问权限</strong></p>
<blockquote>
<p>API 权限多见于在后端进行拦截，所以我们需要做**<code>页面访问</code><strong>和</strong><code>按钮操作授权</code>**</p>
</blockquote>
<p>由此，我们可以根据业务需求, 设计权限管理页面</p>
<img src="/resource/images/image-20200901160508382.png"/>

<p>一定先有模块访问权, 才进一步区分操作权, 所以这里的结构也是树形结构</p>
<img src="/resource/images/image-20210201112608478.png"/>

<p><strong>完成权限页面结构</strong> <strong><code>src/views/permission/index.vue</code></strong></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;permission-container&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;app-container&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="comment">&lt;!-- 表格 --&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">el-card</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;text-align: right; margin-bottom: 20px&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> <span class="attr">size</span>=<span class="string">&quot;small&quot;</span>&gt;</span>添加权限<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">el-table</span> <span class="attr">border</span>&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">label</span>=<span class="string">&quot;名称&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">label</span>=<span class="string">&quot;标识&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">label</span>=<span class="string">&quot;描述&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">label</span>=<span class="string">&quot;操作&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="xml">              <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">size</span>=<span class="string">&quot;small&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span>&gt;</span>添加权限点<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span></span><br><span class="line"><span class="xml">              <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">size</span>=<span class="string">&quot;small&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span>&gt;</span>查看<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span></span><br><span class="line"><span class="xml">              <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">size</span>=<span class="string">&quot;small&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;/<span class="name">el-table-column</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">el-table</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">el-card</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span></span><br><span class="line"><span class="javascript"><span class="xml"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="javascript"><span class="xml">  <span class="attr">name</span>: <span class="string">&#x27;Permission&#x27;</span></span></span></span><br><span class="line"><span class="javascript"><span class="xml">&#125;</span></span></span><br><span class="line"><span class="javascript"><span class="xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p><strong>封装权限管理的增删改查请求</strong> <strong><code>src/api/permisson.js</code></strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取权限</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">reqGetPermissionList</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> request(&#123;</span><br><span class="line">        <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span>,</span><br><span class="line">        <span class="attr">url</span>: <span class="string">&#x27;/sys/permission&#x27;</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 新增权限</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">reqAddPermission</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> request(&#123;</span><br><span class="line">        <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">        <span class="attr">url</span>: <span class="string">&#x27;/sys/permission&#x27;</span>,</span><br><span class="line">        data,</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 更新权限</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">reqUpdatePermission</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> request(&#123;</span><br><span class="line">        <span class="attr">method</span>: <span class="string">&#x27;put&#x27;</span>,</span><br><span class="line">        <span class="attr">url</span>: <span class="string">`/sys/permission/<span class="subst">$&#123;data.id&#125;</span>`</span>,</span><br><span class="line">        data,</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 删除权限</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">reqDelPermission</span>(<span class="params">id</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> request(&#123;</span><br><span class="line">        <span class="attr">method</span>: <span class="string">&#x27;delete&#x27;</span>,</span><br><span class="line">        <span class="attr">url</span>: <span class="string">`/sys/permission/<span class="subst">$&#123;id&#125;</span>`</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 获取权限详情</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">reqGetPermissionDetail</span>(<span class="params">id</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> request(&#123;</span><br><span class="line">        <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span>,</span><br><span class="line">        <span class="attr">url</span>: <span class="string">`/sys/permission/<span class="subst">$&#123;id&#125;</span>`</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="基本请求-展示数据"><a href="#基本请求-展示数据" class="headerlink" title="基本请求 - 展示数据"></a>基本请求 - 展示数据</h3><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;permission-container&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;app-container&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="comment">&lt;!-- 表格 --&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">el-card</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;text-align: right; margin-bottom: 20px&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> <span class="attr">size</span>=<span class="string">&quot;small&quot;</span>&gt;</span>添加权限<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">el-table</span> <span class="attr">border</span> <span class="attr">:data</span>=<span class="string">&quot;list&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">label</span>=<span class="string">&quot;名称&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;name&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">label</span>=<span class="string">&quot;标识&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;code&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">label</span>=<span class="string">&quot;描述&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;description&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">label</span>=<span class="string">&quot;操作&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="xml">              <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">size</span>=<span class="string">&quot;small&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span>&gt;</span>添加权限点<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span></span><br><span class="line"><span class="xml">              <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">size</span>=<span class="string">&quot;small&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span>&gt;</span>查看<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span></span><br><span class="line"><span class="xml">              <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">size</span>=<span class="string">&quot;small&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;/<span class="name">el-table-column</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">el-table</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">el-card</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span></span><br><span class="line"><span class="javascript"><span class="xml"><span class="keyword">import</span> &#123; reqGetPermissionList &#125; <span class="keyword">from</span> <span class="string">&#x27;@/api/permission&#x27;</span></span></span></span><br><span class="line"><span class="javascript"><span class="xml"></span></span></span><br><span class="line"><span class="javascript"><span class="xml"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="javascript"><span class="xml">  <span class="attr">name</span>: <span class="string">&#x27;Permission&#x27;</span>,</span></span></span><br><span class="line"><span class="javascript"><span class="xml">  <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span></span></span><br><span class="line"><span class="javascript"><span class="xml">    <span class="keyword">return</span> &#123;</span></span></span><br><span class="line"><span class="javascript"><span class="xml">      <span class="attr">list</span>: []</span></span></span><br><span class="line"><span class="javascript"><span class="xml">    &#125;</span></span></span><br><span class="line"><span class="javascript"><span class="xml">  &#125;,</span></span></span><br><span class="line"><span class="javascript"><span class="xml">  <span class="function"><span class="title">created</span>(<span class="params"></span>)</span> &#123;</span></span></span><br><span class="line"><span class="javascript"><span class="xml">    <span class="built_in">this</span>.getPermissionList()</span></span></span><br><span class="line"><span class="javascript"><span class="xml">  &#125;,</span></span></span><br><span class="line"><span class="javascript"><span class="xml">  <span class="attr">methods</span>: &#123;</span></span></span><br><span class="line"><span class="javascript"><span class="xml">    <span class="keyword">async</span> <span class="function"><span class="title">getPermissionList</span>(<span class="params"></span>)</span> &#123;</span></span></span><br><span class="line"><span class="javascript"><span class="xml">      <span class="keyword">const</span> &#123; data &#125; = <span class="keyword">await</span> reqGetPermissionList()</span></span></span><br><span class="line"><span class="javascript"><span class="xml">      <span class="built_in">this</span>.list = data</span></span></span><br><span class="line"><span class="javascript"><span class="xml">    &#125;</span></span></span><br><span class="line"><span class="javascript"><span class="xml">  &#125;</span></span></span><br><span class="line"><span class="javascript"><span class="xml">&#125;</span></span></span><br><span class="line"><span class="javascript"><span class="xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>但是这里的数据, 拿到的是列表式的数据, 但是希望渲染的是树形结构的, 所以需要处理</p>
<img src="/resource/images/image-20210201112628807.png"/>

<h3 id="获取权限数据并转化树形"><a href="#获取权限数据并转化树形" class="headerlink" title="获取权限数据并转化树形"></a>获取权限数据并转化树形</h3><p>这里，我们通过树形操作方法，将列表转化成层级数据</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; reqGetPermissionList &#125; <span class="keyword">from</span> <span class="string">&#x27;@/api/permission&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; tranListToTreeData &#125; <span class="keyword">from</span> <span class="string">&#x27;@/utils&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;Permission&#x27;</span>,</span><br><span class="line">    <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="attr">list</span>: [],</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="title">created</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.getPermissionList()</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">methods</span>: &#123;</span><br><span class="line">        <span class="keyword">async</span> <span class="function"><span class="title">getPermissionList</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> &#123; data &#125; = <span class="keyword">await</span> reqGetPermissionList()</span><br><span class="line">            <span class="built_in">this</span>.list = tranListToTreeData(data, <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="built_in">this</span>.list)</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>给 table 表格添加 row-key 属性</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-table border:data=<span class="string">&#x27;list&#x27;</span> row-key=<span class="string">&#x27;id&#x27;</span>&gt;</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">label</span>=<span class="string">&#x27;名称&#x27;</span> <span class="attr">prop</span>=<span class="string">&#x27;name&#x27;</span> /&gt;</span></span></span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">label</span>=<span class="string">&#x27;标识&#x27;</span> <span class="attr">prop</span>=<span class="string">&#x27;code&#x27;</span> /&gt;</span></span></span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">label</span>=<span class="string">&#x27;描述&#x27;</span> <span class="attr">prop</span>=<span class="string">&#x27;description&#x27;</span> /&gt;</span></span></span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">label</span>=<span class="string">&#x27;操作&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">size</span>=<span class="string">&#x27;small&#x27;</span> <span class="attr">type</span>=<span class="string">&#x27;text&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                添加权限点</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">size</span>=<span class="string">&#x27;small&#x27;</span> <span class="attr">type</span>=<span class="string">&#x27;text&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                查看</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">size</span>=<span class="string">&#x27;small&#x27;</span> <span class="attr">type</span>=<span class="string">&#x27;text&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                删除</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">el-table-column</span>&gt;</span></span></span><br><span class="line">&lt;/el-table&gt;</span><br></pre></td></tr></table></figure>

<p>需要注意的是，当 type 为 1 时为访问权限， type 为 2 时为功能权限, 功能权限就不显示添加子权限了</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;permission-container&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;app-container&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="comment">&lt;!-- 表格 --&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">el-card</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;text-align: right; margin-bottom: 20px&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> <span class="attr">size</span>=<span class="string">&quot;small&quot;</span>&gt;</span>添加权限<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">el-table</span> <span class="attr">border</span> <span class="attr">:data</span>=<span class="string">&quot;list&quot;</span> <span class="attr">row-key</span>=<span class="string">&quot;id&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">label</span>=<span class="string">&quot;名称&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;name&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">label</span>=<span class="string">&quot;标识&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;code&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">label</span>=<span class="string">&quot;描述&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;description&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">label</span>=<span class="string">&quot;操作&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">template</span> #<span class="attr">default</span>=<span class="string">&quot;&#123; row &#125;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">              <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">v-if</span>=<span class="string">&quot;row.type === 1&quot;</span> <span class="attr">size</span>=<span class="string">&quot;small&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span>&gt;</span>添加权限点<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span></span><br><span class="line"><span class="xml">              <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">size</span>=<span class="string">&quot;small&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span>&gt;</span>查看<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span></span><br><span class="line"><span class="xml">              <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">size</span>=<span class="string">&quot;small&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;/<span class="name">el-table-column</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">el-table</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">el-card</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>

<img src="/resource/images/image-20210201112705582.png"/>

<h3 id="准备新增的弹层"><a href="#准备新增的弹层" class="headerlink" title="准备新增的弹层"></a>准备新增的弹层</h3><img src="/resource/images/image-20210201161732323.png"/>

<p>弹层结构:</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 新增编辑的弹层 --&gt;</span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">el-dialog</span> <span class="attr">:visible</span>=<span class="string">&quot;showDialog&quot;</span> <span class="attr">title</span>=<span class="string">&quot;弹层标题&quot;</span> @<span class="attr">close</span>=<span class="string">&quot;showDialog = false&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="comment">&lt;!-- 表单内容 --&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">el-form</span> <span class="attr">label-width</span>=<span class="string">&quot;100px&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;权限名称&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">el-input</span> /&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;权限标识&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">el-input</span> /&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;权限描述&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">el-input</span> /&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;权限启用&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">      switch</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">el-form</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">template</span> #<span class="attr">footer</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;text-align: right;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">el-button</span> @<span class="attr">click</span>=<span class="string">&quot;showDialog = false&quot;</span>&gt;</span>取消<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span>&gt;</span>确定<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">el-dialog</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<h3 id="绑定数据"><a href="#绑定数据" class="headerlink" title="绑定数据"></a>绑定数据</h3><p>基于文档准备数据</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">list</span>: [],</span><br><span class="line">    <span class="attr">showDialog</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">formData</span>: &#123;</span><br><span class="line">      <span class="attr">enVisible</span>: <span class="string">&#x27;0&#x27;</span>, <span class="comment">// 启用禁用, 0禁用, 1启用</span></span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;&#x27;</span>, <span class="comment">// 名称</span></span><br><span class="line">      <span class="attr">code</span>: <span class="string">&#x27;&#x27;</span>, <span class="comment">// 权限标识</span></span><br><span class="line">      <span class="attr">description</span>: <span class="string">&#x27;&#x27;</span>, <span class="comment">// 描述</span></span><br><span class="line">      <span class="attr">type</span>: <span class="string">&#x27;&#x27;</span>, <span class="comment">// 类型标记了一级(页面访问权) 二级(按钮操作权)</span></span><br><span class="line">      <span class="attr">pid</span>: <span class="string">&#x27;&#x27;</span> <span class="comment">// 添加到哪个节点下</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>表单绑定</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 新增编辑的弹层 --&gt;</span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">el-dialog</span> <span class="attr">:visible</span>=<span class="string">&quot;showDialog&quot;</span> <span class="attr">title</span>=<span class="string">&quot;弹层标题&quot;</span> @<span class="attr">close</span>=<span class="string">&quot;showDialog = false&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="comment">&lt;!-- 表单内容 --&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">el-form</span> <span class="attr">label-width</span>=<span class="string">&quot;100px&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;权限名称&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">v-model</span>=<span class="string">&quot;formData.name&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;权限标识&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">v-model</span>=<span class="string">&quot;formData.code&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;权限描述&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">v-model</span>=<span class="string">&quot;formData.description&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;权限启用&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">el-switch</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">        <span class="attr">v-model</span>=<span class="string">&quot;formData.enVisible&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">        <span class="attr">active-text</span>=<span class="string">&quot;启用&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">        <span class="attr">active-value</span>=<span class="string">&quot;1&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">        <span class="attr">inactive-text</span>=<span class="string">&quot;不启用&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">        <span class="attr">inactive-value</span>=<span class="string">&quot;0&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">      /&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">el-form</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">template</span> #<span class="attr">footer</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;text-align: right;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">el-button</span> @<span class="attr">click</span>=<span class="string">&quot;showDialog = false&quot;</span>&gt;</span>取消<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span>&gt;</span>确定<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">el-dialog</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<h3 id="新增功能"><a href="#新增功能" class="headerlink" title="新增功能"></a>新增功能</h3><p>新增有两个新增:</p>
<ol>
<li>点击上面的添加权限, 添加是一级, 是一级访问权</li>
</ol>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-button type=<span class="string">&quot;primary&quot;</span> size=<span class="string">&quot;small&quot;</span> @click=<span class="string">&quot;clickAdd(1, &#x27;0&#x27;)&quot;</span>&gt;添加权限&lt;/el-button&gt;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>点击下面的添加权限点, 添加的是二级, 是二级操作权(这里 row.id 作为将来的 pid)</li>
</ol>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-button v-<span class="keyword">if</span>=<span class="string">&quot;row.type === 1&quot;</span> size=<span class="string">&quot;small&quot;</span> type=<span class="string">&quot;text&quot;</span> @click=<span class="string">&quot;clickAdd(2, row.id)&quot;</span>&gt;添加权限点&lt;/el-button&gt;</span><br></pre></td></tr></table></figure>

<p>提供事件处理函数</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">clickAdd</span>(<span class="params">type, pid</span>)</span> &#123;</span><br><span class="line">  <span class="built_in">this</span>.showDialog = <span class="literal">true</span></span><br><span class="line">  <span class="built_in">this</span>.formData.type = type</span><br><span class="line">  <span class="built_in">this</span>.formData.pid = pid</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="title">clickSubmit</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">this</span>.formData.name === <span class="string">&#x27;&#x27;</span> || <span class="built_in">this</span>.formData.code === <span class="string">&#x27;&#x27;</span>) &#123;</span><br><span class="line">    <span class="built_in">this</span>.$message.error(<span class="string">&#x27;权限名称和权限标识不能为空&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">await</span> reqAddPermission(<span class="built_in">this</span>.formData)</span><br><span class="line">  <span class="built_in">this</span>.$message.success(<span class="string">&#x27;操作成功&#x27;</span>)</span><br><span class="line">  <span class="built_in">this</span>.getPermissionList()</span><br><span class="line">  <span class="built_in">this</span>.showDialog = <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="删除功能"><a href="#删除功能" class="headerlink" title="删除功能"></a>删除功能</h3><p>1 注册点击事件</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-button size=<span class="string">&quot;small&quot;</span> type=<span class="string">&quot;text&quot;</span> @click=<span class="string">&quot;clickDel(row.id)&quot;</span>&gt;删除&lt;/el-button&gt;</span><br></pre></td></tr></table></figure>

<p>2 点击时发送删除请求</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="title">clickDel</span>(<span class="params">id</span>)</span> &#123;</span><br><span class="line">  <span class="built_in">this</span>.$confirm(<span class="string">&#x27;确定要删除该权限吗?&#x27;</span>, <span class="string">&#x27;温馨提示&#x27;</span>).then(<span class="keyword">async</span>() =&gt; &#123;</span><br><span class="line">    <span class="keyword">await</span> reqDelPermission(id)</span><br><span class="line">    <span class="built_in">this</span>.getPermissionList()</span><br><span class="line">    <span class="built_in">this</span>.$message.success(<span class="string">&#x27;删除成功&#x27;</span>)</span><br><span class="line">  &#125;).catch(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;取消&#x27;</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="查看修改功能"><a href="#查看修改功能" class="headerlink" title="查看修改功能"></a>查看修改功能</h3><img src="/resource/images/image-20210201171518294.png"/>

<p>1 注册点击事件</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-button size=<span class="string">&quot;small&quot;</span> type=<span class="string">&quot;text&quot;</span> @click=<span class="string">&quot;clickShowEdit(row.id)&quot;</span>&gt;查看&lt;/el-button&gt;</span><br></pre></td></tr></table></figure>

<p>2 查看时回显</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="title">clickShowEdit</span>(<span class="params">id</span>)</span> &#123;</span><br><span class="line">  <span class="comment">// 获取数据回显</span></span><br><span class="line">  <span class="keyword">const</span> &#123; data &#125; = <span class="keyword">await</span> reqGetPermissionDetail(id)</span><br><span class="line">  <span class="built_in">this</span>.formData = data</span><br><span class="line">  <span class="built_in">this</span>.showDialog = <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3 计算属性控制标题</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">computed: &#123;</span><br><span class="line">  <span class="function"><span class="title">showTitle</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.formData.id) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&#x27;添加权限&#x27;</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&#x27;查看编辑&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">el-dialog</span> <span class="attr">:visible</span>=<span class="string">&quot;showDialog&quot;</span> <span class="attr">:title</span>=<span class="string">&quot;showTitle&quot;</span> @<span class="attr">close</span>=<span class="string">&quot;closeDialog&quot;</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>4 提交修改, 通过判断 formData 中有没有 id (新增是没有 id 的)</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="title">clickSubmit</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">this</span>.formData.name === <span class="string">&#x27;&#x27;</span> || <span class="built_in">this</span>.formData.code === <span class="string">&#x27;&#x27;</span>) &#123;</span><br><span class="line">    <span class="built_in">this</span>.$message.error(<span class="string">&#x27;权限名称和权限标识不能为空&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">this</span>.formData.id) &#123;</span><br><span class="line">    <span class="comment">// 编辑操作</span></span><br><span class="line">    <span class="keyword">await</span> reqUpdatePermission(<span class="built_in">this</span>.formData)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// 添加操作</span></span><br><span class="line">    <span class="keyword">await</span> reqAddPermission(<span class="built_in">this</span>.formData)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">this</span>.$message.success(<span class="string">&#x27;操作成功&#x27;</span>)</span><br><span class="line">  <span class="built_in">this</span>.getPermissionList()</span><br><span class="line">  <span class="built_in">this</span>.showDialog = <span class="literal">false</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>5 关闭时重置数据</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">closeDialog</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">  <span class="built_in">this</span>.showDialog = <span class="literal">false</span></span><br><span class="line">  <span class="built_in">this</span>.formData = &#123;</span><br><span class="line">    <span class="attr">enVisible</span>: <span class="string">&#x27;0&#x27;</span>, <span class="comment">// 开启</span></span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;&#x27;</span>, <span class="comment">// 名称</span></span><br><span class="line">    <span class="attr">code</span>: <span class="string">&#x27;&#x27;</span>, <span class="comment">// 权限标识</span></span><br><span class="line">    <span class="attr">description</span>: <span class="string">&#x27;&#x27;</span>, <span class="comment">// 描述</span></span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;&#x27;</span>, <span class="comment">// 类型</span></span><br><span class="line">    <span class="attr">pid</span>: <span class="string">&#x27;&#x27;</span> <span class="comment">// 添加到哪个节点下</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>提交代码</strong></p>
<p><strong><code>本节任务</code></strong>: 权限点管理页面开发</p>
<h2 id="给角色分配权限"><a href="#给角色分配权限" class="headerlink" title="给角色分配权限"></a>给角色分配权限</h2><p>**<code>目标</code>**： 完成给角色分配权限的业务</p>
<img src="/resource/images/image-20210201123751691.png"/>

<img src="/resource/images/image-20210201130159025.png"/>

<h3 id="新建分配权限弹出层"><a href="#新建分配权限弹出层" class="headerlink" title="新建分配权限弹出层"></a>新建分配权限弹出层</h3><p><code>setting/index.vue</code> 准备弹层</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 分配权限的弹层 --&gt;</span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">el-dialog</span> <span class="attr">title</span>=<span class="string">&quot;分配权限&quot;</span> <span class="attr">:visible</span>=<span class="string">&quot;showAssignDialog&quot;</span> @<span class="attr">close</span>=<span class="string">&quot;closeAssignDialog&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">  内容部分</span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">template</span> #<span class="attr">footer</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;text-align: right;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">el-button</span> @<span class="attr">click</span>=<span class="string">&quot;closeAssignDialog&quot;</span>&gt;</span>取消<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span>&gt;</span>确定<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">el-dialog</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>注册事件</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-button size=<span class="string">&quot;small&quot;</span> type=<span class="string">&quot;success&quot;</span> @click=<span class="string">&quot;clickShowAssignDialog(row.id)&quot;</span>&gt;分配权限&lt;/el-button&gt;</span><br></pre></td></tr></table></figure>

<p>提供数据方法</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">showAssignDialog: <span class="literal">false</span>, <span class="comment">// 控制弹层的显示隐藏</span></span><br><span class="line"><span class="attr">roleId</span>: <span class="string">&#x27;&#x27;</span> <span class="comment">// 记录正在操作的角色</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">closeAssignDialog</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">  <span class="built_in">this</span>.showAssignDialog = <span class="literal">false</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="function"><span class="title">clickShowAssignDialog</span>(<span class="params">id</span>)</span> &#123;</span><br><span class="line">  <span class="built_in">this</span>.roleId = id</span><br><span class="line">  <span class="built_in">this</span>.showAssignDialog = <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="获取权限数据"><a href="#获取权限数据" class="headerlink" title="获取权限数据"></a>获取权限数据</h3><p>这里要进行权限分配, 先要请求拿到权限数据</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">permissionData: [] <span class="comment">// 存储权限数据</span></span><br></pre></td></tr></table></figure>

<p>弹层显示, 发送请求, 给弹层注册 open 事件</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-dialog</span><br><span class="line">  title=<span class="string">&quot;分配权限&quot;</span></span><br><span class="line">  :visible=<span class="string">&quot;showAssignDialog&quot;</span></span><br><span class="line">  @close=<span class="string">&quot;closeAssignDialog&quot;</span></span><br><span class="line">  @open=<span class="string">&quot;openAssignDialog&quot;</span></span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>

<p>拿到数据处理成功树形结构</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="title">openAssignDialog</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">  <span class="comment">// 发送请求, 获取权限列表</span></span><br><span class="line">  <span class="keyword">const</span> &#123; data &#125; = <span class="keyword">await</span> reqGetPermissionList()</span><br><span class="line">  <span class="built_in">this</span>.permissionData = tranListToTreeData(data, <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">this</span>.permissionData)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="结合树形控件显示"><a href="#结合树形控件显示" class="headerlink" title="结合树形控件显示"></a>结合树形控件显示</h3><p>基本展示</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-tree</span><br><span class="line">  :data=<span class="string">&quot;permissionData&quot;</span></span><br><span class="line">  :props=<span class="string">&quot;&#123; label: &#x27;name&#x27; &#125;&quot;</span></span><br><span class="line">  :<span class="keyword">default</span>-expand-all=<span class="string">&quot;true&quot;</span></span><br><span class="line">  :show-checkbox=<span class="string">&quot;true&quot;</span></span><br><span class="line">  :check-strictly=<span class="string">&quot;true&quot;</span></span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure>

<p>show-checkbox 显示选择框</p>
<p>default-expand-all 默认展开</p>
<p>check-strictly 设置 true, 可以关闭父子关联</p>
<img src="/resource/images/image-20210201130943535.png"/>

<h3 id="回显默认的权限"><a href="#回显默认的权限" class="headerlink" title="回显默认的权限"></a>回显默认的权限</h3><p>树形结构认知: 回显数据, 需要有一些树形结构的认知</p>
<ol>
<li>node-key 唯一标识</li>
<li>this.$refs.tree.setCheckedKeys([ ]) =&gt; 传入选中的 node-key 数组</li>
</ol>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-tree</span><br><span class="line">  ref=<span class="string">&quot;tree&quot;</span></span><br><span class="line">  v-loading=<span class="string">&quot;treeLoading&quot;</span></span><br><span class="line">  :data=<span class="string">&quot;permissionData&quot;</span></span><br><span class="line">  :props=<span class="string">&quot;&#123; label: &#x27;name&#x27; &#125;&quot;</span></span><br><span class="line">  :<span class="keyword">default</span>-expand-all=<span class="string">&quot;true&quot;</span></span><br><span class="line">  :show-checkbox=<span class="string">&quot;true&quot;</span></span><br><span class="line">  :check-strictly=<span class="string">&quot;true&quot;</span></span><br><span class="line">  node-key=<span class="string">&quot;id&quot;</span></span><br><span class="line">/&gt;</span><br><span class="line"></span><br><span class="line">treeLoading: [] <span class="comment">// 存储已选中的权限id列表</span></span><br></pre></td></tr></table></figure>

<p>发送请求, 获取已选中的权限 id 列表, 进行回显</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="title">openAssignDialog</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">  <span class="built_in">this</span>.treeLoading = <span class="literal">true</span></span><br><span class="line">  <span class="comment">// 发送请求, 获取权限列表</span></span><br><span class="line">  <span class="keyword">const</span> &#123; <span class="attr">data</span>: permissionData &#125; = <span class="keyword">await</span> reqGetPermissionList()</span><br><span class="line">  <span class="built_in">this</span>.permissionData = tranListToTreeData(permissionData, <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">  <span class="comment">// 发送请求, 获取已有权限</span></span><br><span class="line">  <span class="keyword">const</span> &#123; <span class="attr">data</span>: roleDetail &#125; = <span class="keyword">await</span> reqGetRoleDetail(<span class="built_in">this</span>.roleId)</span><br><span class="line">  <span class="built_in">this</span>.$refs.tree.setCheckedKeys(roleDetail.permIds)</span><br><span class="line"></span><br><span class="line">  <span class="built_in">this</span>.treeLoading = <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="给角色分配权限-1"><a href="#给角色分配权限-1" class="headerlink" title="给角色分配权限"></a>给角色分配权限</h3><p><strong>封装分配权限的 api</strong> <strong><code>src/api/setting.js</code></strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 给角色分配权限</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">reqAssignPerm</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> request(&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="string">&#x27;/sys/role/assignPrem&#x27;</span>,</span><br><span class="line">        <span class="attr">method</span>: <span class="string">&#x27;put&#x27;</span>,</span><br><span class="line">        data,</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>分配权限</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 分配权限</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="title">clickAssign</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">  <span class="keyword">await</span> reqAssignPerm(&#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="built_in">this</span>.roleId,</span><br><span class="line">    <span class="attr">permIds</span>: <span class="built_in">this</span>.$refs.tree.getCheckedKeys()</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="built_in">this</span>.$message.success(<span class="string">&#x27;分配成功&#x27;</span>)</span><br><span class="line">  <span class="built_in">this</span>.showAssignDialog = <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>提交代码</strong></p>
<p><strong><code>本节任务</code></strong> 给角色分配权限</p>
<p>权限控制的方向:</p>
<ol>
<li><p>页面访问权 (筛选路由, 总的动态路由很多, 但是给你的只有一部分)</p>
<p> 动态路由: 根据用户的权限 (个人信息里面 menus 的数组, 权限标识), 来控制是否开放的路由</p>
</li>
<li><p>按钮操作权</p>
<p> 根据用户的权限(个人信息里面的 points 数组, 权限标识), 来控制是否展示按钮(是否禁用按钮)</p>
</li>
</ol>
<h2 id="前端权限-页面访问权-路由"><a href="#前端权限-页面访问权-路由" class="headerlink" title="前端权限 - 页面访问权(路由)"></a>前端权限 - 页面访问权(路由)</h2><p>**<code>目标</code>**： 在当前项目应用用户的页面访问权限</p>
<h3 id="权限受控的思路-addRoutes"><a href="#权限受控的思路-addRoutes" class="headerlink" title="权限受控的思路 - addRoutes"></a>权限受控的思路 - addRoutes</h3><p><strong>到了最关键的环节，我们设置的权限如何应用？</strong></p>
<p>在上面的几个小节中，我们已经把给用户分配了角色， 给角色分配了权限，</p>
<p>那么在用户登录获取资料的时候，会自动查出该用户拥有哪些权限，这个权限需要和我们的菜单还有路由有效结合起来</p>
<p>而动态路由表其实就是根据用户的实际权限来访问的，接下来我们操作一下</p>
<img src="/resource/images/image-20200730002842243-1612148541264.png"/>

<img src="/resource/images/image-20210201182944794.png"/>

<p>在权限管理页面中，我们设置了一个<strong>标识</strong>， 这个标识可以和我们的路由模块进行关联，</p>
<p>如果用户拥有这个标识，那么用户就可以 <strong>拥有这个路由模块</strong>，如果没有这个标识，就不能<strong>访问路由模块</strong></p>
<h3 id="addRoutes-的基本使用"><a href="#addRoutes-的基本使用" class="headerlink" title="addRoutes 的基本使用"></a>addRoutes 的基本使用</h3><img src="/resource/images/image-20200815184407204-1612157824216.png"/>

<p><code>router/index.js</code> 去掉 asyncRoutes 的默认合并,</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> createRouter = <span class="function">() =&gt;</span></span><br><span class="line">    <span class="keyword">new</span> Router(&#123;</span><br><span class="line">        <span class="comment">// mode: &#x27;history&#x27;, // require service support</span></span><br><span class="line">        <span class="attr">scrollBehavior</span>: <span class="function">() =&gt;</span> (&#123; <span class="attr">y</span>: <span class="number">0</span> &#125;),</span><br><span class="line">        <span class="attr">routes</span>: [</span><br><span class="line">            ...constantRoutes, <span class="comment">// 静态路由, 首页</span></span><br><span class="line">            <span class="comment">// ...asyncRoutes // 所有的动态路由</span></span><br><span class="line">        ],</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure>

<p><code>permission.js</code> 我们通过 addRoutes 动态添加试一下</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; asyncRoutes &#125; <span class="keyword">from</span> <span class="string">&#x27;@/router/index&#x27;</span></span><br><span class="line"></span><br><span class="line">router.beforeEach(<span class="keyword">async</span>(to, <span class="keyword">from</span>, next) =&gt; &#123;</span><br><span class="line">  ...</span><br><span class="line">  	...</span><br><span class="line">      <span class="keyword">if</span> (!store.state.user.userInfo.userId) &#123;</span><br><span class="line">        <span class="comment">// 调用获取信息的action</span></span><br><span class="line">        <span class="keyword">const</span> res = <span class="keyword">await</span> store.dispatch(<span class="string">&#x27;user/getUserInfo&#x27;</span>)</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;进行权限处理&#x27;</span>, res)</span><br><span class="line">        <span class="comment">// 拿到权限信息之后, 应该根据权限信息, 从动态路由模块中筛选出, 需要追加的路由,</span></span><br><span class="line">        <span class="comment">// 追加到routes规则中, addRoutes</span></span><br><span class="line">        router.addRoutes(asyncRoutes)</span><br><span class="line">        next(&#123;</span><br><span class="line">          ...to, <span class="comment">// next(&#123; ...to &#125;)的目的,是保证路由添加完了再进入页面 (可以理解为重进一次)</span></span><br><span class="line">          <span class="attr">replace</span>: <span class="literal">true</span> <span class="comment">// 重进一次, 不保留重复历史</span></span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">      &#125;</span><br><span class="line">  	...</span><br><span class="line">  ...</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>路由可以新增出来, 但是菜单却没有动态渲染出来</p>
<p>=&gt; router.options.routes (拿的是默认配置的项, 拿不到动态新增的) 不是响应式的!</p>
<p>为了能正确的显示菜单, 为了能够将来正确的获取到, 目前用户的所有路由, 我们需要用 vuex 管理 routes 路由数组</p>
<img src="/resource/images/image-20210202231257679.png"/>

<h3 id="新建-Vuex-路由权限模块"><a href="#新建-Vuex-路由权限模块" class="headerlink" title="新建 Vuex 路由权限模块"></a>新建 Vuex 路由权限模块</h3><p>可以在 vuex 中新增一个 permission 模块, 专门维护管理, 所有的路由 routes 数组 (响应式, 所有地方都能用)</p>
<p><strong>this.$router.options.routes 最初配置的路由信息表</strong> 如果有 addRoutes 动态新增的情况, vuex 管理, 拿 vuex 中 routes</p>
<p>在任何的组件中, 都可以非常方便的将来拿到 vuex 中存的 routes, 而不是去找 router.options.routes (拿的是默认配置)</p>
<p><strong><code>src/store/modules/permission.js</code></strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; constantRoutes &#125; <span class="keyword">from</span> <span class="string">&#x27;@/router&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> state = &#123;</span><br><span class="line">    <span class="comment">// 路由表, 标记当前用户所拥有的所有路由</span></span><br><span class="line">    <span class="attr">routes</span>: constantRoutes, <span class="comment">// 默认静态路由表</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> mutations = &#123;</span><br><span class="line">    <span class="comment">// otherRoutes登录成功后, 需要添加的新路由</span></span><br><span class="line">    <span class="function"><span class="title">setRoutes</span>(<span class="params">state, otherRoutes</span>)</span> &#123;</span><br><span class="line">        <span class="comment">// 静态路由基础上, 累加其他权限路由</span></span><br><span class="line">        state.routes = [...constantRoutes, ...otherRoutes]</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> actions = &#123;&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="attr">namespaced</span>: <span class="literal">true</span>,</span><br><span class="line">    state,</span><br><span class="line">    mutations,</span><br><span class="line">    actions,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在 Vuex 管理模块中引入 permisson 模块</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Vuex <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"><span class="keyword">import</span> getters <span class="keyword">from</span> <span class="string">&#x27;./getters&#x27;</span></span><br><span class="line"><span class="keyword">import</span> app <span class="keyword">from</span> <span class="string">&#x27;./modules/app&#x27;</span></span><br><span class="line"><span class="keyword">import</span> settings <span class="keyword">from</span> <span class="string">&#x27;./modules/settings&#x27;</span></span><br><span class="line"><span class="keyword">import</span> user <span class="keyword">from</span> <span class="string">&#x27;./modules/user&#x27;</span></span><br><span class="line"><span class="keyword">import</span> permission <span class="keyword">from</span> <span class="string">&#x27;./modules/permission&#x27;</span></span><br><span class="line"></span><br><span class="line">Vue.use(Vuex)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> Vuex.Store(&#123;</span><br><span class="line">    <span class="attr">modules</span>: &#123;</span><br><span class="line">        app,</span><br><span class="line">        settings,</span><br><span class="line">        user,</span><br><span class="line">        permission,</span><br><span class="line">    &#125;,</span><br><span class="line">    getters,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store</span><br></pre></td></tr></table></figure>

<h3 id="Vuex-action-筛选权限路由"><a href="#Vuex-action-筛选权限路由" class="headerlink" title="Vuex-action 筛选权限路由"></a>Vuex-action 筛选权限路由</h3><p>将来登录成功时, 个人信息中会有 roles 的 <code>menus</code> 信息, 要基于 menus 来过滤出我们需要给用户 add 的路由,</p>
<img src="/resource/images/image-20210201134941017.png"/>

<p>但是**<code>menus</code>**中的标识又该怎么和路由对应呢？</p>
<p>可以将路由模块**<code>name</code>**属性命名和权限标识一致，这样只要标识能对上，就说明用户拥有了该权限</p>
<p>这一步，在我们命名路由的时候已经操作过了</p>
<img src="/resource/images/image-20210202233945914.png"/>

<p>接下来， vuex 的 permission 中提供一个 action，进行关联</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; asyncRoutes, constantRoutes &#125; <span class="keyword">from</span> <span class="string">&#x27;@/router&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> actions = &#123;</span><br><span class="line">    <span class="comment">// 筛选路由权限</span></span><br><span class="line">    <span class="function"><span class="title">filterRoutes</span>(<span class="params">context, menus</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> otherRoutes = asyncRoutes.filter(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// 如果路由模块的首页name, 在menus数组中包含, 就是这个模块开放</span></span><br><span class="line">            <span class="keyword">if</span> (menus.includes(item.children[<span class="number">0</span>].name)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        context.commit(<span class="string">&#x27;setRoutes&#x27;</span>, otherRoutes)</span><br><span class="line">        <span class="keyword">return</span> otherRoutes</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="调用-Action-管理路由渲染菜单"><a href="#调用-Action-管理路由渲染菜单" class="headerlink" title="调用 Action 管理路由渲染菜单"></a>调用 Action 管理路由渲染菜单</h3><p>在 permission 拦截的位置，调用关联 action， 获取新增 routes，并且<strong>addRoutes</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="keyword">if</span> (!store.state.user.userInfo.userId) &#123;</span><br><span class="line">  <span class="comment">// 调用获取信息的action</span></span><br><span class="line">  <span class="keyword">const</span> &#123; roles &#125; = <span class="keyword">await</span> store.dispatch(<span class="string">&#x27;user/getUserInfo&#x27;</span>)</span><br><span class="line">  <span class="comment">// 调用action同步到vuex中</span></span><br><span class="line">  <span class="keyword">const</span> otherRoutes = <span class="keyword">await</span> store.dispatch(<span class="string">&#x27;permission/filterRoutes&#x27;</span>, roles.menus)</span><br><span class="line">  <span class="comment">// 动态新增路由</span></span><br><span class="line">  router.addRoutes(otherRoutes)</span><br><span class="line">  next(&#123;</span><br><span class="line">    ...to, <span class="comment">// next(&#123; ...to &#125;)的目的,是保证路由添加完了再进入页面 (可以理解为重进一次)</span></span><br><span class="line">    <span class="attr">replace</span>: <span class="literal">true</span> <span class="comment">// 重进一次, 不保留重复历史</span></span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>在**<code>src/store/getters.js</code>**配置导出 routes</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> getters = &#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="attr">routes</span>: <span class="function"><span class="params">state</span> =&gt;</span> state.permission.routes <span class="comment">// 导出当前的路由</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> getters</span><br></pre></td></tr></table></figure>

<p>在左侧菜单 <code>layout/components/Sidebar/index.vue</code> 组件中， 引入 routes, 使用 vuex 的 routes 动态渲染</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">computed: &#123;</span><br><span class="line">  ...mapGetters([</span><br><span class="line">    <span class="string">&#x27;sidebar&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;routes&#x27;</span></span><br><span class="line">  ])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="处理刷新-404-的问题"><a href="#处理刷新-404-的问题" class="headerlink" title="处理刷新 404 的问题"></a>处理刷新 404 的问题</h3><p>页面刷新的时候，本来应该拥有权限的页面出现了 404，这是因为 404 的匹配权限放在了静态路由中 (静态路由的 404 要删除)</p>
<p>我们需要将 404 放置到动态路由的最后</p>
<p>src/permission.js</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> otherRoutes = <span class="keyword">await</span> store.dispatch(<span class="string">&#x27;permission/filterRoutes&#x27;</span>, menus)</span><br><span class="line">router.addRoutes([...otherRoutes, &#123; <span class="attr">path</span>: <span class="string">&#x27;*&#x27;</span>, <span class="attr">redirect</span>: <span class="string">&#x27;/404&#x27;</span>, <span class="attr">hidden</span>: <span class="literal">true</span> &#125;])</span><br></pre></td></tr></table></figure>

<h3 id="退出时重置路由"><a href="#退出时重置路由" class="headerlink" title="退出时重置路由"></a>退出时重置路由</h3><p>退出时, 需要将路由权限重置 (恢复默认), 将来登录后, 再次追加</p>
<p>我们的**<code>router/index.js</code>**文件，发现一个重置路由方法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 重置路由</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">resetRouter</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> newRouter = createRouter()</span><br><span class="line">    router.matcher = newRouter.matcher <span class="comment">// 重新设置路由的可匹配路径</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个方法就是将路由重新实例化，相当于换了一个新的路由，之前**<code>加的路由</code>**就不存在了，需要在登出的时候， 调用一下即可</p>
<p><code>store/modules/user.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; resetRouter &#125; <span class="keyword">from</span> <span class="string">&#x27;@/router&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 退出的action操作</span></span><br><span class="line"><span class="function"><span class="title">logout</span>(<span class="params">context</span>)</span> &#123;</span><br><span class="line">  <span class="comment">// 1. 移除vuex个人信息</span></span><br><span class="line">  context.commit(<span class="string">&#x27;removeUserInfo&#x27;</span>)</span><br><span class="line">  <span class="comment">// 2. 移除token信息</span></span><br><span class="line">  context.commit(<span class="string">&#x27;removeToken&#x27;</span>)</span><br><span class="line">  <span class="comment">// 3. 重置路由</span></span><br><span class="line">  resetRouter()</span><br><span class="line">  <span class="comment">// 4. 重置 vuex 中的路由信息</span></span><br><span class="line">  context.commit(<span class="string">&#x27;permission/setRoutes&#x27;</span>, [], &#123; <span class="attr">root</span>: <span class="literal">true</span> &#125;)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>切换账户访问, 查看效果</p>
<img src="/resource/images/image-20210203004115592.png"/>

<p><strong>注意: 这里后台的权限标识, 和 name 要一一对应, 例如: 叫 permissions, 就要把 name 改一下</strong></p>
<img src="/resource/images/image-20210203164002358.png"/>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/permission&#x27;</span>,</span><br><span class="line">    <span class="attr">component</span>: Layout,</span><br><span class="line">    <span class="attr">children</span>: [</span><br><span class="line">        <span class="comment">// 默认权限管理的首页</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">path</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="attr">name</span>: <span class="string">&#x27;permissions&#x27;</span>, <span class="comment">// name 加上, 后面有用</span></span><br><span class="line">            <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/views/permission/index&#x27;</span>),</span><br><span class="line">            <span class="attr">meta</span>: &#123; <span class="attr">title</span>: <span class="string">&#x27;权限管理&#x27;</span>, <span class="attr">icon</span>: <span class="string">&#x27;lock&#x27;</span> &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">    ],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="前端权限-按钮操作权"><a href="#前端权限-按钮操作权" class="headerlink" title="前端权限 - 按钮操作权"></a>前端权限 - 按钮操作权</h2><h3 id="按钮操作权的受控思路"><a href="#按钮操作权的受控思路" class="headerlink" title="按钮操作权的受控思路"></a>按钮操作权的受控思路</h3><p>当我们拥有了一个模块的访问权限之后，页面中的某些功能，用户可能有，也可能没有</p>
<p>这就是上小节，查询出来的数据中的**<code>points</code>**</p>
<img src="/resource/images/image-20210203003829488.png"/>

<p>当然现在是空, 所以首先需要在员工管理的权限点下， 新增一个删除权限点，并启用</p>
<img src="/resource/images/image-20210203005054757.png"/>

<p>效果如下图所示:</p>
<img src="/resource/images/image-20210203005328509.png"/>

<p>我们要做的就是看看用户，是否拥有<strong>point-user-delete</strong>这个 point，有就可以让删除能用，没有就隐藏或者禁用</p>
<h3 id="基本演示功能"><a href="#基本演示功能" class="headerlink" title="基本演示功能"></a>基本演示功能</h3><p>配置 getters</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> getters = &#123;</span><br><span class="line">  ...,</span><br><span class="line">  <span class="attr">roles</span>: <span class="function"><span class="params">state</span> =&gt;</span> state.user.userInfo.roles,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> getters</span><br></pre></td></tr></table></figure>

<p>添加按钮禁用的控制 (或者 隐藏)</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-button</span><br><span class="line">  :disabled=<span class="string">&quot;!checkPermission(&#x27;POINT-USER-UPDATE&#x27;)&quot;</span></span><br><span class="line">  type=<span class="string">&quot;text&quot;</span></span><br><span class="line">  size=<span class="string">&quot;small&quot;</span></span><br><span class="line">  @click=<span class="string">&quot;$router.push(`/employees/detail/$&#123;row.id&#125;`)&quot;</span></span><br><span class="line">&gt;查看&lt;/el-button&gt;</span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">size</span>=<span class="string">&quot;small&quot;</span>&gt;</span>转正<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">size</span>=<span class="string">&quot;small&quot;</span>&gt;</span>调岗<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">size</span>=<span class="string">&quot;small&quot;</span>&gt;</span>离职<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">size</span>=<span class="string">&quot;small&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;editRole(row.id)&quot;</span>&gt;</span>角色<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">el-button</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">  <span class="attr">:disabled</span>=<span class="string">&quot;!checkPermission(&#x27;POINT-USER-DELETE&#x27;)&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">  <span class="attr">type</span>=<span class="string">&quot;text&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">  <span class="attr">size</span>=<span class="string">&quot;small&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">  @<span class="attr">click</span>=<span class="string">&quot;delEmployee(row.id)&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">&gt;</span>删除<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>提供方法</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"> methods: &#123;</span><br><span class="line">   <span class="comment">// 返回一个布尔值的函数, 返回true, 有权限, 返回false, 没有权限</span></span><br><span class="line">   <span class="function"><span class="title">checkPermission</span>(<span class="params">key</span>)</span> &#123;</span><br><span class="line">     <span class="comment">// 看传过来的 key, 在 points 数组中, 是否存在</span></span><br><span class="line">     <span class="comment">// 存在权限信息后, 再进行权限控制</span></span><br><span class="line">     <span class="keyword">if</span> (<span class="built_in">this</span>.$store.getters.roles) &#123;</span><br><span class="line">       <span class="keyword">return</span> <span class="built_in">this</span>.$store.getters.roles.points.includes(key)</span><br><span class="line">     &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">       <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">     &#125;</span><br><span class="line">   &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>效果图: (有权限, 才能点击, 没权限就禁用, 或者隐藏)</p>
<img src="/resource/images/image-20210331075901421.png"/>

<h2 id="使用-Mixins-将检查方法注入"><a href="#使用-Mixins-将检查方法注入" class="headerlink" title="使用 Mixins 将检查方法注入"></a>使用 Mixins 将检查方法注入</h2><p><code>mixins/hello.js</code></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 这是一个打招呼的mixin, 只要混入了这个mixin, 就可以created打招呼</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="comment">// vue的配置项, data, methods, created, ....</span></span><br><span class="line">    <span class="function"><span class="title">created</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;created: hello, 你好哇&#x27;</span>)</span><br><span class="line">        <span class="built_in">this</span>.sayHi()</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">methods</span>: &#123;</span><br><span class="line">        <span class="function"><span class="title">sayHi</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&#x27;调用方法, sayHi: hello, 你好哇&#x27;</span>)</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>局部混入</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hello <span class="keyword">from</span> <span class="string">&#x27;@/mixins/hello&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="attr">mixins</span>: [hello],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>同理 <code>mixins/checkPermission.js</code></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="attr">methods</span>: &#123;</span><br><span class="line">        <span class="function"><span class="title">checkPermission</span>(<span class="params">key</span>)</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>.$store.getters.roles.points.includes(key)</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>局部混入</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Hello <span class="keyword">from</span> <span class="string">&#x27;@/mixns/hello&#x27;</span></span><br><span class="line"><span class="keyword">import</span> checkPermission <span class="keyword">from</span> <span class="string">&#x27;@/mixns/checkPermission&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="attr">mixins</span>: [hello, checkPermission],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2022/08/13/rz-base-course07/" rel="prev" title="07_人资后台">
      <i class="fa fa-chevron-left"></i> 07_人资后台
    </a></div>
      <div class="post-nav-item">
    <a href="/2022/08/13/rz-base-course09/" rel="next" title="09_人资后台">
      09_人资后台 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%9D%83%E9%99%90%E8%AE%BE%E8%AE%A1%E5%92%8C%E7%AE%A1%E7%90%86"><span class="nav-number">1.</span> <span class="nav-text">权限设计和管理</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#RBAC-%E7%9A%84%E6%9D%83%E9%99%90%E8%AE%BE%E8%AE%A1%E6%80%9D%E6%83%B3"><span class="nav-number">1.1.</span> <span class="nav-text">RBAC 的权限设计思想</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BB%99%E5%91%98%E5%B7%A5%E5%88%86%E9%85%8D%E8%A7%92%E8%89%B2"><span class="nav-number">1.2.</span> <span class="nav-text">给员工分配角色</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%B0%E5%BB%BA%E5%88%86%E9%85%8D%E8%A7%92%E8%89%B2%E5%BC%B9%E6%A1%86"><span class="nav-number">1.2.1.</span> <span class="nav-text">新建分配角色弹框</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BC%B9%E5%B1%82%E7%9A%84%E6%98%BE%E7%A4%BA%E5%92%8C%E5%85%B3%E9%97%AD"><span class="nav-number">1.2.2.</span> <span class="nav-text">弹层的显示和关闭</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E8%A7%92%E8%89%B2%E5%88%97%E8%A1%A8"><span class="nav-number">1.2.3.</span> <span class="nav-text">获取角色列表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E7%94%A8%E6%88%B7%E7%9A%84%E5%BD%93%E5%89%8D%E8%A7%92%E8%89%B2"><span class="nav-number">1.2.4.</span> <span class="nav-text">获取用户的当前角色</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%99%E5%91%98%E5%B7%A5%E5%88%86%E9%85%8D%E8%A7%92%E8%89%B2-1"><span class="nav-number">1.2.5.</span> <span class="nav-text">给员工分配角色</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B7%BB%E5%8A%A0-loading-%E6%95%88%E6%9E%9C"><span class="nav-number">1.2.6.</span> <span class="nav-text">添加 loading 效果</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9D%83%E9%99%90%E7%82%B9%E7%AE%A1%E7%90%86%E9%A1%B5%E9%9D%A2%E5%BC%80%E5%8F%91"><span class="nav-number">1.3.</span> <span class="nav-text">权限点管理页面开发</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%B0%E5%BB%BA%E6%9D%83%E9%99%90%E7%82%B9%E7%AE%A1%E7%90%86%E9%A1%B5%E9%9D%A2"><span class="nav-number">1.3.1.</span> <span class="nav-text">新建权限点管理页面</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E8%AF%B7%E6%B1%82-%E5%B1%95%E7%A4%BA%E6%95%B0%E6%8D%AE"><span class="nav-number">1.3.2.</span> <span class="nav-text">基本请求 - 展示数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E6%9D%83%E9%99%90%E6%95%B0%E6%8D%AE%E5%B9%B6%E8%BD%AC%E5%8C%96%E6%A0%91%E5%BD%A2"><span class="nav-number">1.3.3.</span> <span class="nav-text">获取权限数据并转化树形</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%87%86%E5%A4%87%E6%96%B0%E5%A2%9E%E7%9A%84%E5%BC%B9%E5%B1%82"><span class="nav-number">1.3.4.</span> <span class="nav-text">准备新增的弹层</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%91%E5%AE%9A%E6%95%B0%E6%8D%AE"><span class="nav-number">1.3.5.</span> <span class="nav-text">绑定数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%B0%E5%A2%9E%E5%8A%9F%E8%83%BD"><span class="nav-number">1.3.6.</span> <span class="nav-text">新增功能</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%A0%E9%99%A4%E5%8A%9F%E8%83%BD"><span class="nav-number">1.3.7.</span> <span class="nav-text">删除功能</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E4%BF%AE%E6%94%B9%E5%8A%9F%E8%83%BD"><span class="nav-number">1.3.8.</span> <span class="nav-text">查看修改功能</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BB%99%E8%A7%92%E8%89%B2%E5%88%86%E9%85%8D%E6%9D%83%E9%99%90"><span class="nav-number">1.4.</span> <span class="nav-text">给角色分配权限</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%B0%E5%BB%BA%E5%88%86%E9%85%8D%E6%9D%83%E9%99%90%E5%BC%B9%E5%87%BA%E5%B1%82"><span class="nav-number">1.4.1.</span> <span class="nav-text">新建分配权限弹出层</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E6%9D%83%E9%99%90%E6%95%B0%E6%8D%AE"><span class="nav-number">1.4.2.</span> <span class="nav-text">获取权限数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%93%E5%90%88%E6%A0%91%E5%BD%A2%E6%8E%A7%E4%BB%B6%E6%98%BE%E7%A4%BA"><span class="nav-number">1.4.3.</span> <span class="nav-text">结合树形控件显示</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9B%9E%E6%98%BE%E9%BB%98%E8%AE%A4%E7%9A%84%E6%9D%83%E9%99%90"><span class="nav-number">1.4.4.</span> <span class="nav-text">回显默认的权限</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%99%E8%A7%92%E8%89%B2%E5%88%86%E9%85%8D%E6%9D%83%E9%99%90-1"><span class="nav-number">1.4.5.</span> <span class="nav-text">给角色分配权限</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%89%8D%E7%AB%AF%E6%9D%83%E9%99%90-%E9%A1%B5%E9%9D%A2%E8%AE%BF%E9%97%AE%E6%9D%83-%E8%B7%AF%E7%94%B1"><span class="nav-number">1.5.</span> <span class="nav-text">前端权限 - 页面访问权(路由)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9D%83%E9%99%90%E5%8F%97%E6%8E%A7%E7%9A%84%E6%80%9D%E8%B7%AF-addRoutes"><span class="nav-number">1.5.1.</span> <span class="nav-text">权限受控的思路 - addRoutes</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#addRoutes-%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="nav-number">1.5.2.</span> <span class="nav-text">addRoutes 的基本使用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%B0%E5%BB%BA-Vuex-%E8%B7%AF%E7%94%B1%E6%9D%83%E9%99%90%E6%A8%A1%E5%9D%97"><span class="nav-number">1.5.3.</span> <span class="nav-text">新建 Vuex 路由权限模块</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Vuex-action-%E7%AD%9B%E9%80%89%E6%9D%83%E9%99%90%E8%B7%AF%E7%94%B1"><span class="nav-number">1.5.4.</span> <span class="nav-text">Vuex-action 筛选权限路由</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%B0%83%E7%94%A8-Action-%E7%AE%A1%E7%90%86%E8%B7%AF%E7%94%B1%E6%B8%B2%E6%9F%93%E8%8F%9C%E5%8D%95"><span class="nav-number">1.5.5.</span> <span class="nav-text">调用 Action 管理路由渲染菜单</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%84%E7%90%86%E5%88%B7%E6%96%B0-404-%E7%9A%84%E9%97%AE%E9%A2%98"><span class="nav-number">1.5.6.</span> <span class="nav-text">处理刷新 404 的问题</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%80%80%E5%87%BA%E6%97%B6%E9%87%8D%E7%BD%AE%E8%B7%AF%E7%94%B1"><span class="nav-number">1.5.7.</span> <span class="nav-text">退出时重置路由</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%89%8D%E7%AB%AF%E6%9D%83%E9%99%90-%E6%8C%89%E9%92%AE%E6%93%8D%E4%BD%9C%E6%9D%83"><span class="nav-number">1.6.</span> <span class="nav-text">前端权限 - 按钮操作权</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8C%89%E9%92%AE%E6%93%8D%E4%BD%9C%E6%9D%83%E7%9A%84%E5%8F%97%E6%8E%A7%E6%80%9D%E8%B7%AF"><span class="nav-number">1.6.1.</span> <span class="nav-text">按钮操作权的受控思路</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E6%BC%94%E7%A4%BA%E5%8A%9F%E8%83%BD"><span class="nav-number">1.6.2.</span> <span class="nav-text">基本演示功能</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-Mixins-%E5%B0%86%E6%A3%80%E6%9F%A5%E6%96%B9%E6%B3%95%E6%B3%A8%E5%85%A5"><span class="nav-number">1.7.</span> <span class="nav-text">使用 Mixins 将检查方法注入</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Ifer"
      src="/images/49337922.png">
  <p class="site-author-name" itemprop="name">Ifer</p>
  <div class="site-description" itemprop="description">React 全家桶 <span style='position:relative;top:-2px;'>✍</span></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">60</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://www.bilibili.com/video/BV1iW4y1k7Ci?spm_id_from=333.337.search-card.all.click" title="😚 → https:&#x2F;&#x2F;www.bilibili.com&#x2F;video&#x2F;BV1iW4y1k7Ci?spm_id_from&#x3D;333.337.search-card.all.click" rel="noopener" target="_blank"><i class="a fa-fw"></i>😚</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.zhihu.com/people/weixiantx" title="😙 → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;weixiantx" rel="noopener" target="_blank"><i class="a fa-fw"></i>😙</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Ifer</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
