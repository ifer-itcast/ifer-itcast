<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.ico">
  <link rel="mask-icon" href="/images/favicon.ico" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"mac"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="âœ” ç†è§£ RBAC çš„æƒé™åˆ†é…æ€æƒ³ã€‚ âœ” æŒæ¡è·¯ç”±å’ŒæŒ‰é’®çº§åˆ«çš„æƒé™ç”Ÿæ•ˆçš„æ€è·¯ã€‚">
<meta property="og:type" content="article">
<meta property="og:title" content="08_äººèµ„åå°">
<meta property="og:url" content="http://example.com/2022/08/13/rz-base-course08/index.html">
<meta property="og:site_name" content="å±é™©">
<meta property="og:description" content="âœ” ç†è§£ RBAC çš„æƒé™åˆ†é…æ€æƒ³ã€‚ âœ” æŒæ¡è·¯ç”±å’ŒæŒ‰é’®çº§åˆ«çš„æƒé™ç”Ÿæ•ˆçš„æ€è·¯ã€‚">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/resource/images/image-20200901150655343.png">
<meta property="og:image" content="http://example.com/resource/images/image-20200901151025021.png">
<meta property="og:image" content="http://example.com/resource/images/image-20200901151151286.png">
<meta property="og:image" content="http://example.com/resource/images/image-20200728172853451.png">
<meta property="og:image" content="http://example.com/resource/images/yggl.png">
<meta property="og:image" content="http://example.com/resource/images/image-20200901160508382.png">
<meta property="og:image" content="http://example.com/resource/images/image-20200730002842243.png">
<meta property="og:image" content="http://example.com/resource/images/image-20200901164312005.png">
<meta property="article:published_time" content="2022-08-13T14:08:14.000Z">
<meta property="article:modified_time" content="2022-12-01T15:08:34.690Z">
<meta property="article:author" content="Ifer">
<meta property="article:tag" content="React,Redux,Mobx,Saga,Dva,Umi,AntD,TS">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/resource/images/image-20200901150655343.png">

<link rel="canonical" href="http://example.com/2022/08/13/rz-base-course08/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>08_äººèµ„åå° | å±é™©</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ ">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">å±é™©</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">ä¸ºä¹‹åˆ™æ˜“ï¼Œä¸ä¸ºåˆ™éš¾</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>é¦–é¡µ</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>å½’æ¡£</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>æœç´¢
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="æœç´¢..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/08/13/rz-base-course08/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/49337922.png">
      <meta itemprop="name" content="Ifer">
      <meta itemprop="description" content="React å…¨å®¶æ¡¶ <span style='position:relative;top:-2px;'>âœ</span>">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="å±é™©">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          08_äººèµ„åå°
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2022-08-13 22:08:14" itemprop="dateCreated datePublished" datetime="2022-08-13T22:08:14+08:00">2022-08-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2022-12-01 23:08:34" itemprop="dateModified" datetime="2022-12-01T23:08:34+08:00">2022-12-01</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>âœ” ç†è§£ RBAC çš„æƒé™åˆ†é…æ€æƒ³ã€‚</p>
<p>âœ” æŒæ¡è·¯ç”±å’ŒæŒ‰é’®çº§åˆ«çš„æƒé™ç”Ÿæ•ˆçš„æ€è·¯ã€‚</p>
<span id="more"></span>

<h2 id="æƒé™è®¾è®¡çš„æ€æƒ³"><a href="#æƒé™è®¾è®¡çš„æ€æƒ³" class="headerlink" title="æƒé™è®¾è®¡çš„æ€æƒ³"></a>æƒé™è®¾è®¡çš„æ€æƒ³</h2><p>é¦–å…ˆï¼Œæˆ‘ä»¬å…ˆäº†è§£ä¸‹ä»€ä¹ˆæ˜¯ä¼ ç»Ÿçš„æƒé™è®¾è®¡ã€‚</p>
<p><img src="/resource/images/image-20200901150655343.png" alt="image-20200901150655343"></p>
<p>ä»ä¸Šé¢çš„å›¾ä¸­æˆ‘ä»¬å‘ç°ï¼Œä¼ ç»Ÿçš„æƒé™è®¾è®¡æ˜¯å¯¹æ¯ä¸ªäººè¿›è¡Œå•ç‹¬çš„æƒé™è®¾ç½®ï¼Œè¿™ç§æ–¹å¼å·²ç»ä¸é€‚åˆç›®å‰ä¼ä¸šçš„é«˜æ•ˆéœ€æ±‚ï¼Œå› ä¸ºæ¯ä¸ªäººéƒ½è¦å•ç‹¬å»è®¾ç½®æƒé™ï¼Œç®¡ç†èµ·æ¥æ¯”è¾ƒç¹çã€‚åŸºäºæ­¤ï¼ŒRBAC çš„æƒé™æ¨¡å‹å°±åº”è¿è€Œç”Ÿäº†ï¼ŒRBAC(Role Based Access control) ï¼Œä¹Ÿå°±æ˜¯åŸºäºè§’è‰²çš„æƒé™åˆ†é…è§£å†³æ–¹æ¡ˆï¼Œç›¸å¯¹äºä¼ ç»Ÿæ–¹æ¡ˆï¼ŒRBAC æä¾›äº†ä¸­é—´å±‚ Roleï¼ˆè§’è‰²ï¼‰ï¼Œå…¶æƒé™æ¨¡å¼å¦‚ä¸‹ã€‚</p>
<p><img src="/resource/images/image-20200901151025021.png" alt="image-20200901151025021"></p>
<p>RBAC å®ç°äº†ç”¨æˆ·å’Œæƒé™ç‚¹çš„åˆ†ç¦»ï¼Œæƒ³å¯¹æŸä¸ªç”¨æˆ·è®¾ç½®æƒé™ï¼Œåªéœ€è¦å¯¹è¯¥ç”¨æˆ·è®¾ç½®ç›¸åº”çš„è§’è‰²å³å¯ï¼Œè€Œè¯¥è§’è‰²å°±æ‹¥æœ‰äº†å¯¹åº”çš„æƒé™ï¼Œè¿™æ ·ä¸€æ¥ï¼Œæƒé™çš„åˆ†é…å’Œè®¾è®¡å°±åšåˆ°äº†ç²¾ç®€ã€é«˜æ•ˆï¼Œå½“æƒ³å¯¹ç”¨æˆ·æ”¶å›æƒé™æ—¶ï¼Œåªéœ€è¦æ”¶å›è§’è‰²å³å¯ï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±åœ¨è¯¥é¡¹ç›®ä¸­å®æ–½è¿™ä¸€è®¾æƒ³ã€‚</p>
<h2 id="ç»™å‘˜å·¥åˆ†é…è§’è‰²"><a href="#ç»™å‘˜å·¥åˆ†é…è§’è‰²" class="headerlink" title="ç»™å‘˜å·¥åˆ†é…è§’è‰²"></a>ç»™å‘˜å·¥åˆ†é…è§’è‰²</h2><h3 id="ç›®æ ‡"><a href="#ç›®æ ‡" class="headerlink" title="ç›®æ ‡"></a>ç›®æ ‡</h3><p>åœ¨å‘˜å·¥ç®¡ç†é¡µé¢ï¼Œåˆ†é…è§’è‰²ã€‚</p>
<h3 id="æ–°å»ºåˆ†é…è§’è‰²çª—ä½“"><a href="#æ–°å»ºåˆ†é…è§’è‰²çª—ä½“" class="headerlink" title="æ–°å»ºåˆ†é…è§’è‰²çª—ä½“"></a>æ–°å»ºåˆ†é…è§’è‰²çª—ä½“</h3><p><img src="/resource/images/image-20200901151151286.png" alt="image-20200901151151286"></p>
<p>ä»ä¸Šå›¾ä¸­ï¼Œå¯ä»¥çœ‹å‡ºï¼Œç”¨æˆ·å’Œè§’è‰²æ˜¯ <code>ä¸€å¯¹å¤š</code> çš„å…³ç³»ï¼Œå³ä¸€ä¸ªç”¨æˆ·å¯ä»¥æ‹¥æœ‰å¤šä¸ªè§’è‰²ï¼Œæ¯”å¦‚å…¬å¸çš„è‘£äº‹é•¿å¯ä»¥æ‹¥æœ‰æ€»ç»ç†å’Œç³»ç»Ÿç®¡ç†å‘˜ä¸€æ ·çš„è§’è‰²ã€‚</p>
<ol>
<li>æ–°å»ºåˆ†é…è§’è‰²çª—ä½“ï¼Œ<code>views/employees/components/assign-role.vue</code>ã€‚</li>
</ol>
<p><img src="/resource/images/image-20200728172853451.png" alt="image-20200728172853451"></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-dialog</span> <span class="attr">title</span>=<span class="string">&quot;åˆ†é…è§’è‰²&quot;</span> <span class="attr">:visible</span>=<span class="string">&quot;showRoleDialog&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- el-checkbox-group é€‰ä¸­çš„æ˜¯ å½“å‰ç”¨æˆ·æ‰€æ‹¥æœ‰çš„è§’è‰²  éœ€è¦ç»‘å®š å½“å‰ç”¨æˆ·æ‹¥æœ‰çš„è§’è‰²--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-checkbox-group</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- é€‰é¡¹ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-checkbox-group</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-row</span> <span class="attr">slot</span>=<span class="string">&quot;footer&quot;</span> <span class="attr">type</span>=<span class="string">&quot;flex&quot;</span> <span class="attr">justify</span>=<span class="string">&quot;center&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-col</span> <span class="attr">:span</span>=<span class="string">&quot;6&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> <span class="attr">size</span>=<span class="string">&quot;small&quot;</span>&gt;</span>ç¡®å®š<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">size</span>=<span class="string">&quot;small&quot;</span>&gt;</span>å–æ¶ˆ<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">el-col</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-row</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-dialog</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="attr">props</span>: &#123;</span></span><br><span class="line"><span class="javascript">            <span class="attr">showRoleDialog</span>: &#123;</span></span><br><span class="line"><span class="javascript">                <span class="attr">type</span>: <span class="built_in">Boolean</span>,</span></span><br><span class="line"><span class="javascript">                <span class="attr">default</span>: <span class="literal">false</span>,</span></span><br><span class="line"><span class="javascript">            &#125;,</span></span><br><span class="line"><span class="javascript">            <span class="comment">// ç”¨æˆ·çš„id ç”¨æ¥æŸ¥è¯¢å½“å‰ç”¨æˆ·çš„è§’è‰²ä¿¡æ¯</span></span></span><br><span class="line"><span class="javascript">            <span class="attr">userId</span>: &#123;</span></span><br><span class="line"><span class="javascript">                <span class="attr">type</span>: <span class="built_in">String</span>,</span></span><br><span class="line"><span class="javascript">                <span class="attr">default</span>: <span class="literal">null</span>,</span></span><br><span class="line"><span class="javascript">            &#125;,</span></span><br><span class="line"><span class="javascript">        &#125;,</span></span><br><span class="line"><span class="javascript">    &#125;</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>åœ¨ <code>views/employees/index.vue</code> ä¸­å¼•å…¥ç»„ä»¶ã€‚</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-dialog</span> <span class="attr">title</span>=<span class="string">&quot;äºŒç»´ç &quot;</span> <span class="attr">:visible.sync</span>=<span class="string">&quot;showCodeDialog&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-dialog</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">assign-role</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> AssignRole <span class="keyword">from</span> <span class="string">&#x27;./components/assign-role.vue&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="attr">components</span>: &#123;</span><br><span class="line">        AssignRole,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ç‚¹å‡»è§’è‰²å‡ºç°å¼¹æ¡†"><a href="#ç‚¹å‡»è§’è‰²å‡ºç°å¼¹æ¡†" class="headerlink" title="ç‚¹å‡»è§’è‰²å‡ºç°å¼¹æ¡†"></a>ç‚¹å‡»è§’è‰²å‡ºç°å¼¹æ¡†</h3><ol>
<li>ç»™è§’è‰²æŒ‰é’®ç»‘å®šç‚¹å‡»äº‹ä»¶ï¼Œ<code>views/employees/index.vue</code>ã€‚</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">size</span>=<span class="string">&quot;small&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;editRole&quot;</span>&gt;</span>è§’è‰²<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>å°† showRoleDialog å˜é‡ä½œç”¨äº assign-role ç»„ä»¶ã€‚</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">assign-role</span> <span class="attr">:show-role-dialog.sync</span>=<span class="string">&quot;showRoleDialog&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="attr">showRoleDialog</span>: <span class="literal">false</span>,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">methods</span>: &#123;</span><br><span class="line">        <span class="function"><span class="title">editRole</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.showRoleDialog = <span class="literal">true</span></span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="è·å–æ‰€æœ‰çš„è§’è‰²åˆ—è¡¨"><a href="#è·å–æ‰€æœ‰çš„è§’è‰²åˆ—è¡¨" class="headerlink" title="è·å–æ‰€æœ‰çš„è§’è‰²åˆ—è¡¨"></a>è·å–æ‰€æœ‰çš„è§’è‰²åˆ—è¡¨</h3><ol>
<li>åœ¨ created ä¸­è°ƒç”¨ï¼ˆæ‰“å¼€å¼¹æ¡†æ—¶è°ƒç”¨ä¹Ÿè¡Œï¼‰è·å–æ‰€æœ‰è§’è‰²åˆ—è¡¨çš„æ–¹æ³•ï¼ŒæŠŠç»“æœèµ‹å€¼ç»™ data ä¸­çš„ listï¼Œ<code>views/employees/components/assign-role.vue</code>ã€‚</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">    getRoleList</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;@/api/settings&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="attr">props</span>: &#123;</span><br><span class="line">        <span class="attr">showRoleDialog</span>: &#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="built_in">Boolean</span>,</span><br><span class="line">            <span class="attr">default</span>: <span class="literal">false</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">userId</span>: &#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="built_in">String</span>,</span><br><span class="line">            <span class="attr">default</span>: <span class="literal">null</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="attr">list</span>: [], <span class="comment">// è§’è‰²åˆ—è¡¨</span></span><br><span class="line">            <span class="attr">roleIds</span>: [],</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="title">created</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.getRoleList()</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">methods</span>: &#123;</span><br><span class="line">        <span class="comment">//  è·å–æ‰€æœ‰è§’è‰²</span></span><br><span class="line">        <span class="keyword">async</span> <span class="function"><span class="title">getRoleList</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> &#123;</span><br><span class="line">                rows</span><br><span class="line">            &#125; = <span class="keyword">await</span> getRoleList()</span><br><span class="line">            <span class="built_in">this</span>.list = rows</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>éå† listï¼Œå¹¶å‡†å¤‡æ”¶é›†æ•°æ®çš„å˜é‡ roleIds å’Œ el-checkbox-group ç»„ä»¶ç»‘å®šã€‚</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- åˆ†é…è§’è‰² --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">el-checkbox-group</span> <span class="attr">v-model</span>=<span class="string">&quot;roleIds&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-checkbox</span> <span class="attr">v-for</span>=<span class="string">&quot;item in list&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;item.id&quot;</span> <span class="attr">:label</span>=<span class="string">&quot;item.id&quot;</span>&gt;</span> &#123;&#123; item.name &#125;&#125; <span class="tag">&lt;/<span class="name">el-checkbox</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">el-checkbox-group</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="è·å–ç”¨æˆ·çš„å½“å‰è§’è‰²"><a href="#è·å–ç”¨æˆ·çš„å½“å‰è§’è‰²" class="headerlink" title="è·å–ç”¨æˆ·çš„å½“å‰è§’è‰²"></a>è·å–ç”¨æˆ·çš„å½“å‰è§’è‰²</h3><ol>
<li>å‡†å¤‡ userIdï¼Œ<code>views/employees/index.vue</code>ã€‚</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="attr">userId</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>ç‚¹å‡»è§’è‰²æŒ‰é’®æ—¶ï¼Œé™¤äº†æ˜¾ç¤ºå¼¹æ¡†ï¼Œä¹ŸæŠŠå½“å‰è¡Œçš„è§’è‰² ID èµ‹å€¼ userIdã€‚</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">size</span>=<span class="string">&quot;small&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;editRole(row.id)&quot;</span>&gt;</span>è§’è‰²<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="title">editRole</span>(<span class="params">id</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.showRoleDialog = <span class="literal">true</span></span><br><span class="line">    <span class="comment">// æ³¨æ„ props ä¼ å€¼æ˜¯å¼‚æ­¥çš„</span></span><br><span class="line">    <span class="built_in">this</span>.userId = id</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>æŠŠ userId ä¼ é€’ç»™ assign-role ç»„ä»¶ã€‚</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">assign-role</span> <span class="attr">ref</span>=<span class="string">&quot;assignRole&quot;</span> <span class="attr">:show-role-dialog</span>=<span class="string">&quot;showRoleDialog&quot;</span> <span class="attr">:user-id</span>=<span class="string">&quot;userId&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="4">
<li>å­ç»„ä»¶ä¸­å‡†å¤‡æ ¹æ® userId è·å–è¯¦æƒ…çš„æ–¹æ³•ï¼Œ<code>views/employees/components/assign-role.vue</code>ã€‚</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="title">getUserDetailById</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123;</span><br><span class="line">        roleIds</span><br><span class="line">    &#125; = <span class="keyword">await</span> getUserDetailById(<span class="built_in">this</span>.userId)</span><br><span class="line">    <span class="comment">// èµ‹å€¼æœ¬ç”¨æˆ·çš„è§’è‰²</span></span><br><span class="line">    <span class="built_in">this</span>.roleIds = roleIds</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>çˆ¶ç»„ä»¶è°ƒç”¨æ–¹æ³•ã€‚</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">assign-role</span> <span class="attr">ref</span>=<span class="string">&quot;assignRole&quot;</span> <span class="attr">:show-role-dialog.sync</span>=<span class="string">&quot;showRoleDialog&quot;</span> <span class="attr">:user-id</span>=<span class="string">&quot;userId&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="title">editRole</span>(<span class="params">id</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.showRoleDialog = <span class="literal">true</span></span><br><span class="line">    <span class="built_in">this</span>.userId = id</span><br><span class="line">    <span class="comment">// çˆ¶ç»„ä»¶è°ƒç”¨å­ç»„ä»¶æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">await</span> <span class="built_in">this</span>.$refs.assignRole.getUserDetailById()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ğŸ¤” å‘ç°å‡ºç°äº†é”™è¯¯ï¼Œå­ç»„ä»¶çš„ getUserDetailById æ–¹æ³•ä¸­æ‰“å°å‡ºæ¥çš„ userId è¿˜æ˜¯æœ€å¼€å§‹ä¼ é€’è¿‡æ¥çš„ç©ºå­—ç¬¦ä¸²ï¼Œå› ä¸º props ä¼ å€¼æ˜¯å¼‚æ­¥çš„ã€‚</p>
<ol start="6">
<li>æ”¹é€ å­ç»„ä»¶æ–¹æ³•ï¼Œæ¥æ”¶å‚æ•° idã€‚</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">    getUserDetailById</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;@/api/user&#x27;</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="title">getUserDetailById</span>(<span class="params">id</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123;</span><br><span class="line">        roleIds</span><br><span class="line">    &#125; = <span class="keyword">await</span> getUserDetailById(id)</span><br><span class="line">    <span class="comment">// èµ‹å€¼æœ¬ç”¨æˆ·çš„è§’è‰²</span></span><br><span class="line">    <span class="built_in">this</span>.roleIds = roleIds</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ”¹é€ çˆ¶ç»„ä»¶çš„æ–¹æ³•ï¼Œä¼ é€’ idã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="title">editRole</span>(<span class="params">id</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.showRoleDialog = <span class="literal">true</span></span><br><span class="line">    <span class="comment">// æ³¨æ„ props ä¼ å€¼æ˜¯å¼‚æ­¥çš„</span></span><br><span class="line">    <span class="built_in">this</span>.userId = id</span><br><span class="line">    <span class="comment">// çˆ¶ç»„ä»¶è°ƒç”¨å­ç»„ä»¶æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">await</span> <span class="built_in">this</span>.$refs.assignRole.getUserDetailById(id)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="7">
<li>å¦‚æœä¸æƒ³çœ‹åˆ°æ•°æ®æ‰“é’©çš„è¿‡ç¨‹ï¼Œå¯ä»¥å…ˆè·å–æ•°æ®å®Œæ¯•åï¼Œå†æ‰“å¼€å¼¹æ¡†ï¼Œæˆ–è€…å¦‚ä¸‹å¤„ç†ï¼Œ<code>views/employees/components/assign-role.vue</code>ã€‚</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-checkbox-group</span> <span class="attr">v-model</span>=<span class="string">&quot;roleIds&quot;</span> <span class="attr">v-loading</span>=<span class="string">&quot;loading&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-checkbox-group</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">                <span class="attr">loading</span>: <span class="literal">false</span>,</span></span><br><span class="line"><span class="javascript">            &#125;</span></span><br><span class="line"><span class="javascript">        &#125;,</span></span><br><span class="line"><span class="javascript">        <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">async</span> <span class="function"><span class="title">getUserDetailById</span>(<span class="params">id</span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">                <span class="built_in">this</span>.loading = <span class="literal">true</span></span></span><br><span class="line"><span class="javascript">                <span class="comment">// ...</span></span></span><br><span class="line"><span class="javascript">                <span class="built_in">this</span>.loading = <span class="literal">false</span></span></span><br><span class="line"><span class="javascript">            &#125;,</span></span><br><span class="line"><span class="javascript">        &#125;,</span></span><br><span class="line"><span class="javascript">    &#125;</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="ç»™å‘˜å·¥åˆ†é…è§’è‰²åŠŸèƒ½"><a href="#ç»™å‘˜å·¥åˆ†é…è§’è‰²åŠŸèƒ½" class="headerlink" title="ç»™å‘˜å·¥åˆ†é…è§’è‰²åŠŸèƒ½"></a>ç»™å‘˜å·¥åˆ†é…è§’è‰²åŠŸèƒ½</h3><ol>
<li>å»ºç«‹åˆ†é…è§’è‰²çš„æ¥å£ï¼Œ<code>api/employees.js</code>ã€‚</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç»™ç”¨æˆ·åˆ†é…è§’è‰²</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">assignRoles</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> request(&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="string">&#x27;/sys/user/assignRoles&#x27;</span>,</span><br><span class="line">        data,</span><br><span class="line">        <span class="attr">method</span>: <span class="string">&#x27;put&#x27;</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>ç‚¹å‡»å¼¹æ¡†ä¸­çš„ç¡®å®šæŒ‰é’®æ—¶ï¼Œè°ƒç”¨åˆ†é…è§’è‰²çš„æ¥å£å¹¶å…³é—­å¼¹æ¡†ï¼Œ<code>views/employees/components/assign-role.vue</code>ã€‚</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">    assignRoles</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;@/api/employees&#x27;</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="title">btnOK</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">await</span> assignRoles(&#123;</span><br><span class="line">        <span class="attr">id</span>: <span class="built_in">this</span>.userId,</span><br><span class="line">        <span class="attr">roleIds</span>: <span class="built_in">this</span>.roleIds</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">// å…³é—­çª—ä½“</span></span><br><span class="line">    <span class="built_in">this</span>.$emit(<span class="string">&#x27;update:showRoleDialog&#x27;</span>, <span class="literal">false</span>)</span><br><span class="line">    <span class="built_in">this</span>.$message.success(<span class="string">&#x27;åˆ†é…è§’è‰²æˆåŠŸ&#x27;</span>)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>å–æ¶ˆç‚¹å‡»å…³é—­å›¾æ ‡æ—¶ï¼Œé‡ç½®æ•°æ®å¹¶å…³é—­å¼¹æ¡†ï¼Œ<code>views/employees/components/assign-role.vue</code>ã€‚</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-dialog</span> <span class="attr">title</span>=<span class="string">&quot;åˆ†é…è§’è‰²&quot;</span> <span class="attr">:visible</span>=<span class="string">&quot;showRoleDialog&quot;</span> @<span class="attr">close</span>=<span class="string">&quot;btnCancel&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-dialog</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">btnCancel</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.roleIds = [] <span class="comment">// æ¸…ç©ºåŸæ¥çš„æ•°ç»„</span></span><br><span class="line">    <span class="built_in">this</span>.$emit(<span class="string">&#x27;update:showRoleDialog&#x27;</span>, <span class="literal">false</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="æƒé™ç‚¹ç®¡ç†é¡µé¢"><a href="#æƒé™ç‚¹ç®¡ç†é¡µé¢" class="headerlink" title="æƒé™ç‚¹ç®¡ç†é¡µé¢"></a>æƒé™ç‚¹ç®¡ç†é¡µé¢</h2><h3 id="ç›®æ ‡-1"><a href="#ç›®æ ‡-1" class="headerlink" title="ç›®æ ‡"></a>ç›®æ ‡</h3><p>å®Œæˆæƒé™ç‚¹é¡µé¢çš„å¼€å‘å’Œç®¡ç†ã€‚</p>
<p><img src="/resource/images/yggl.png" alt="yggl.png"></p>
<h3 id="æ–°å»ºæƒé™ç‚¹ç®¡ç†é¡µé¢"><a href="#æ–°å»ºæƒé™ç‚¹ç®¡ç†é¡µé¢" class="headerlink" title="æ–°å»ºæƒé™ç‚¹ç®¡ç†é¡µé¢"></a>æ–°å»ºæƒé™ç‚¹ç®¡ç†é¡µé¢</h3><p>äººå·²ç»æœ‰äº†è§’è‰²ï¼Œé‚£ä¹ˆæƒé™æ˜¯ä»€ä¹ˆï¼Ÿåœ¨ä¼ä¸šæœåŠ¡ä¸­ï¼Œæƒé™ä¸€èˆ¬åˆ†å‰²ä¸ºé¡µé¢è®¿é—®æƒé™ï¼ŒæŒ‰é’®æ“ä½œæƒé™ã€‚</p>
<p><img src="/resource/images/image-20200901160508382.png" alt="image-20200901160508382"></p>
<ol>
<li>å‡†å¤‡æƒé™é¡µé¢ç»“æ„ï¼Œ<code>views/permission/index.vue</code>ã€‚</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;dashboard-container&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;app-container&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- é å³çš„æŒ‰é’® --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">page-tools</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-slot:after</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> <span class="attr">size</span>=<span class="string">&quot;small&quot;</span>&gt;</span>æ·»åŠ æƒé™<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">page-tools</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- è¡¨æ ¼ --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-table</span> <span class="attr">border</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">align</span>=<span class="string">&quot;center&quot;</span> <span class="attr">label</span>=<span class="string">&quot;åç§°&quot;</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">align</span>=<span class="string">&quot;center&quot;</span> <span class="attr">label</span>=<span class="string">&quot;æ ‡è¯†&quot;</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">align</span>=<span class="string">&quot;center&quot;</span> <span class="attr">label</span>=<span class="string">&quot;æè¿°&quot;</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">align</span>=<span class="string">&quot;center&quot;</span> <span class="attr">label</span>=<span class="string">&quot;æ“ä½œ&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span>&gt;</span>æ·»åŠ <span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span>&gt;</span>ç¼–è¾‘<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span>&gt;</span>åˆ é™¤<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">el-table-column</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">el-table</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>å°è£…æƒé™ç®¡ç†çš„å¢åˆ æ”¹æŸ¥æ¥å£ï¼Œ<code>api/permission.js</code>ã€‚</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span></span><br><span class="line"><span class="comment">// è·å–æƒé™</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">getPermissionList</span>(<span class="params">params</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> request(&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="string">&#x27;/sys/permission&#x27;</span>,</span><br><span class="line">        params,</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æ–°å¢æƒé™</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">addPermission</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> request(&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="string">&#x27;/sys/permission&#x27;</span>,</span><br><span class="line">        <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">        data,</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ›´æ–°æƒé™</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">updatePermission</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> request(&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="string">`/sys/permission/<span class="subst">$&#123;data.id&#125;</span>`</span>,</span><br><span class="line">        <span class="attr">method</span>: <span class="string">&#x27;put&#x27;</span>,</span><br><span class="line">        data,</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ é™¤æƒé™</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">delPermission</span>(<span class="params">id</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> request(&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="string">`/sys/permission/<span class="subst">$&#123;id&#125;</span>`</span>,</span><br><span class="line">        <span class="attr">method</span>: <span class="string">&#x27;delete&#x27;</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è·å–æƒé™è¯¦æƒ…</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">getPermissionDetail</span>(<span class="params">id</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> request(&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="string">`/sys/permission/<span class="subst">$&#123;id&#125;</span>`</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="è·å–æƒé™æ•°æ®å¹¶æ¸²æŸ“"><a href="#è·å–æƒé™æ•°æ®å¹¶æ¸²æŸ“" class="headerlink" title="è·å–æƒé™æ•°æ®å¹¶æ¸²æŸ“"></a>è·å–æƒé™æ•°æ®å¹¶æ¸²æŸ“</h3><ol>
<li>è·å–æƒé™æ•°æ®ï¼Œ<code>views/permission/index.vue</code>ã€‚</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">import</span> &#123;</span></span><br><span class="line"><span class="javascript">        getPermissionList</span></span><br><span class="line"><span class="javascript">    &#125; <span class="keyword">from</span> <span class="string">&#x27;@/api/permission&#x27;</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">                <span class="attr">list</span>: [],</span></span><br><span class="line"><span class="javascript">            &#125;</span></span><br><span class="line"><span class="javascript">        &#125;,</span></span><br><span class="line"><span class="javascript">        <span class="function"><span class="title">created</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">this</span>.getPermissionList()</span></span><br><span class="line"><span class="javascript">        &#125;,</span></span><br><span class="line"><span class="javascript">        <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">async</span> <span class="function"><span class="title">getPermissionList</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">                <span class="built_in">this</span>.list = <span class="keyword">await</span> getPermissionList()</span></span><br><span class="line"><span class="javascript">            &#125;,</span></span><br><span class="line"><span class="javascript">        &#125;,</span></span><br><span class="line"><span class="javascript">    &#125;</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>æŠŠæ•°æ®ç»‘å®šåˆ°è¡¨æ ¼ã€‚</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-table</span> <span class="attr">:data</span>=<span class="string">&quot;list&quot;</span> <span class="attr">border</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">label</span>=<span class="string">&quot;åç§°&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;name&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">label</span>=<span class="string">&quot;æ ‡è¯†&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;code&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">label</span>=<span class="string">&quot;æè¿°&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;description&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">label</span>=<span class="string">&quot;æ“ä½œ&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span>&gt;</span>æ·»åŠ <span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span>&gt;</span>ç¼–è¾‘<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span>&gt;</span> åˆ é™¤<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-table-column</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">el-table</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="æ•°æ®è½¬æˆæ ‘å½¢å¹¶æ¸²æŸ“"><a href="#æ•°æ®è½¬æˆæ ‘å½¢å¹¶æ¸²æŸ“" class="headerlink" title="æ•°æ®è½¬æˆæ ‘å½¢å¹¶æ¸²æŸ“"></a>æ•°æ®è½¬æˆæ ‘å½¢å¹¶æ¸²æŸ“</h3><p>æ¸²æŸ“æ ‘å½¢æ•°æ®æ—¶ï¼Œå¿…é¡»ç»™ el-table æŒ‡å®š row-key å±æ€§ï¼Œå½“åˆ—è¡¨é¡¹æ•°æ®ä¸­å…·å¤‡ children ä¹‹åä¼šè‡ªåŠ¨æ¸²æŸ“å¯¹åº”çš„å­çº§ã€‚</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- #1 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">el-table</span> <span class="attr">:data</span>=<span class="string">&quot;list&quot;</span> <span class="attr">border</span> <span class="attr">row-key</span>=<span class="string">&quot;id&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">label</span>=<span class="string">&quot;åç§°&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;name&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">label</span>=<span class="string">&quot;æ ‡è¯†&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;code&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">label</span>=<span class="string">&quot;æè¿°&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;description&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">label</span>=<span class="string">&quot;æ“ä½œ&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">template</span> <span class="attr">slot-scope</span>=<span class="string">&quot;&#123; row &#125;&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- #2ï¼Œåªæœ‰ä¸€çº§è·¯ç”±æƒé™æ—¶æ‰å±•ç¤ºæ·»åŠ æŒ‰é’®ï¼ŒäºŒçº§æŒ‰é’®æƒé™ä¸å±•ç¤º --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">v-if</span>=<span class="string">&quot;row.type === 1&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span>&gt;</span>æ·»åŠ <span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span>&gt;</span>ç¼–è¾‘<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span>&gt;</span> åˆ é™¤<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-table-column</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">el-table</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">import</span> &#123;</span></span><br><span class="line"><span class="javascript">        getPermissionList</span></span><br><span class="line"><span class="javascript">    &#125; <span class="keyword">from</span> <span class="string">&#x27;@/api/permission&#x27;</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">import</span> &#123;</span></span><br><span class="line"><span class="javascript">        transListToTreeData</span></span><br><span class="line"><span class="javascript">    &#125; <span class="keyword">from</span> <span class="string">&#x27;@/utils&#x27;</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="comment">// ...</span></span></span><br><span class="line"><span class="javascript">        <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">async</span> <span class="function"><span class="title">getPermissionList</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">                <span class="built_in">this</span>.list = transListToTreeData(<span class="keyword">await</span> getPermissionList(), <span class="string">&#x27;0&#x27;</span>)</span></span><br><span class="line"><span class="javascript">            &#125;,</span></span><br><span class="line"><span class="javascript">        &#125;,</span></span><br><span class="line"><span class="javascript">    &#125;</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="æ–°å¢æƒé™"><a href="#æ–°å¢æƒé™" class="headerlink" title="æ–°å¢æƒé™"></a>æ–°å¢æƒé™</h3><p>åŒ…æ‹¬é¡µé¢çº§åˆ«å’ŒæŒ‰é’®çº§åˆ«çš„æƒé™ã€‚</p>
<ol>
<li>å‡†å¤‡å¼¹å±‚çš„é™æ€ç»“æ„ï¼Œ<code>views/permission/index.vue</code>ã€‚</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- æ”¾ç½®ä¸€ä¸ªå¼¹å±‚ï¼Œç”¨æ¥æ–°å¢/ç¼–è¾‘èŠ‚ç‚¹ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">el-dialog</span> <span class="attr">title</span>=<span class="string">&quot;æ–°å¢æƒé™ç‚¹&quot;</span> <span class="attr">:visible</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- è¡¨å• --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-form</span> <span class="attr">label-width</span>=<span class="string">&quot;120px&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;æƒé™åç§°&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">style</span>=<span class="string">&quot;width:90%&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;æƒé™æ ‡è¯†&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">style</span>=<span class="string">&quot;width:90%&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;æƒé™æè¿°&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">style</span>=<span class="string">&quot;width:90%&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;å¼€å¯&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-switch</span> <span class="attr">active-value</span>=<span class="string">&quot;1&quot;</span> <span class="attr">inactive-value</span>=<span class="string">&quot;0&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-row</span> <span class="attr">slot</span>=<span class="string">&quot;footer&quot;</span> <span class="attr">type</span>=<span class="string">&quot;flex&quot;</span> <span class="attr">justify</span>=<span class="string">&quot;center&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-col</span> <span class="attr">:span</span>=<span class="string">&quot;6&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">size</span>=<span class="string">&quot;small&quot;</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span>&gt;</span>ç¡®å®š<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">size</span>=<span class="string">&quot;small&quot;</span>&gt;</span>å–æ¶ˆ<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-col</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-row</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">el-dialog</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>ç»‘å®šç‚¹å‡»äº‹ä»¶æ˜¾ç¤ºå¼¹å±‚ã€‚</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> <span class="attr">size</span>=<span class="string">&quot;small&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;addPermission&quot;</span>&gt;</span>æ·»åŠ æƒé™<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- type ç­‰äº 1 è¡¨ç¤ºå½“å‰è¡Œæ•°æ®æ˜¯è·¯ç”±åŸºæœ¬çš„ï¼Œåªæœ‰æ˜¯è·¯ç”±çº§åˆ«çš„æ‰æœ‰å¿…è¦å±•ç¤ºæ·»åŠ æŒ‰é’® --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">el-button</span> <span class="attr">v-if</span>=<span class="string">&quot;row.type === 1&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;addPermission&quot;</span>&gt;</span>æ·»åŠ <span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;Permissions&#x27;</span>,</span><br><span class="line">    <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="comment">// ...</span></span><br><span class="line">            <span class="attr">showDialog</span>: <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">methods</span>: &#123;</span><br><span class="line">        <span class="function"><span class="title">addPermission</span>(<span class="params">type, pid</span>)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.showDialog = <span class="literal">true</span></span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>ç»‘å®šæ•°æ®å’Œæ ¡éªŒè§„åˆ™åˆ°å¼¹æ¡†ä¸­çš„è¡¨å•ï¼Œå¹¶åˆ©ç”¨è®¡ç®—å±æ€§å±•ç¤ºæ ‡é¢˜ã€‚</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="attr">list</span>: [],</span><br><span class="line">            <span class="attr">formData</span>: &#123;</span><br><span class="line">                <span class="attr">name</span>: <span class="string">&#x27;&#x27;</span>, <span class="comment">// åç§°</span></span><br><span class="line">                <span class="attr">code</span>: <span class="string">&#x27;&#x27;</span>, <span class="comment">// æ ‡è¯†</span></span><br><span class="line">                <span class="attr">description</span>: <span class="string">&#x27;&#x27;</span>, <span class="comment">// æè¿°</span></span><br><span class="line">                <span class="attr">enVisible</span>: <span class="string">&#x27;0&#x27;</span>, <span class="comment">// å¼€å¯</span></span><br><span class="line">                <span class="attr">type</span>: <span class="string">&#x27;&#x27;</span>, <span class="comment">// ç±»å‹ è¯¥ç±»å‹ ä¸éœ€è¦æ˜¾ç¤º å› ä¸ºç‚¹å‡»æ·»åŠ çš„æ—¶å€™å·²ç»çŸ¥é“ç±»å‹äº†</span></span><br><span class="line">                <span class="attr">pid</span>: <span class="string">&#x27;&#x27;</span>, <span class="comment">// å› ä¸ºåšçš„æ˜¯æ ‘ éœ€è¦çŸ¥é“æ·»åŠ åˆ°å“ªä¸ªèŠ‚ç‚¹ä¸‹äº†</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">rules</span>: &#123;</span><br><span class="line">                <span class="attr">name</span>: [&#123;</span><br><span class="line">                    <span class="attr">required</span>: <span class="literal">true</span>,</span><br><span class="line">                    <span class="attr">message</span>: <span class="string">&#x27;æƒé™åç§°ä¸èƒ½ä¸ºç©º&#x27;</span>,</span><br><span class="line">                    <span class="attr">trigger</span>: <span class="string">&#x27;blur&#x27;</span></span><br><span class="line">                &#125;],</span><br><span class="line">                <span class="attr">code</span>: [&#123;</span><br><span class="line">                    <span class="attr">required</span>: <span class="literal">true</span>,</span><br><span class="line">                    <span class="attr">message</span>: <span class="string">&#x27;æƒé™æ ‡è¯†ä¸èƒ½ä¸ºç©º&#x27;</span>,</span><br><span class="line">                    <span class="attr">trigger</span>: <span class="string">&#x27;blur&#x27;</span></span><br><span class="line">                &#125;],</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">showDialog</span>: <span class="literal">false</span>,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">computed</span>: &#123;</span><br><span class="line">        <span class="function"><span class="title">showText</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>.formData.id ? <span class="string">&#x27;ç¼–è¾‘&#x27;</span> : <span class="string">&#x27;æ–°å¢&#x27;</span></span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- æ”¾ç½®ä¸€ä¸ªå¼¹å±‚ ç”¨æ¥ç¼–è¾‘æ–°å¢èŠ‚ç‚¹ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">el-dialog</span> <span class="attr">:title</span>=<span class="string">&quot;`$&#123;showText&#125;æƒé™ç‚¹`&quot;</span> <span class="attr">:visible</span>=<span class="string">&quot;showDialog&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- è¡¨å• --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-form</span> <span class="attr">ref</span>=<span class="string">&quot;perForm&quot;</span> <span class="attr">:model</span>=<span class="string">&quot;formData&quot;</span> <span class="attr">:rules</span>=<span class="string">&quot;rules&quot;</span> <span class="attr">label-width</span>=<span class="string">&quot;120px&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;æƒé™åç§°&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;name&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">v-model</span>=<span class="string">&quot;formData.name&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width:90%&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;æƒé™æ ‡è¯†&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;code&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">v-model</span>=<span class="string">&quot;formData.code&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width:90%&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;æƒé™æè¿°&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">v-model</span>=<span class="string">&quot;formData.description&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width:90%&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;å¼€å¯&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-switch</span> <span class="attr">v-model</span>=<span class="string">&quot;formData.enVisible&quot;</span> <span class="attr">active-value</span>=<span class="string">&quot;1&quot;</span> <span class="attr">inactive-value</span>=<span class="string">&quot;0&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-row</span> <span class="attr">slot</span>=<span class="string">&quot;footer&quot;</span> <span class="attr">type</span>=<span class="string">&quot;flex&quot;</span> <span class="attr">justify</span>=<span class="string">&quot;center&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-col</span> <span class="attr">:span</span>=<span class="string">&quot;6&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">size</span>=<span class="string">&quot;small&quot;</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span>&gt;</span>ç¡®å®š<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">size</span>=<span class="string">&quot;small&quot;</span>&gt;</span>å–æ¶ˆ<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-col</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-row</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">el-dialog</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="4">
<li>ç‚¹å‡»æ·»åŠ æŒ‰é’®æŒ‰é’®æ—¶è®°å½•è¦æ·»åŠ çš„ type å’Œ pid åˆ° formDataã€‚</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> <span class="attr">size</span>=<span class="string">&quot;small&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;addPermission(1, &#x27;0&#x27;)&quot;</span>&gt;</span>æ·»åŠ æƒé™<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;addPermission(2, row.id)&quot;</span>&gt;</span>æ·»åŠ <span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;Permissions&#x27;</span>,</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="attr">methods</span>: &#123;</span><br><span class="line">        <span class="function"><span class="title">addPermission</span>(<span class="params">type, pid</span>)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.formData.pid = pid</span><br><span class="line">            <span class="built_in">this</span>.formData.type = type</span><br><span class="line">            <span class="built_in">this</span>.showDialog = <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>ç‚¹å‡»å¼¹æ¡†ä¸­çš„ç¡®å®šæŒ‰é’®å®ç°æ–°å¢åŠŸèƒ½ã€‚</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-button</span> <span class="attr">size</span>=<span class="string">&quot;small&quot;</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;btnOK&quot;</span>&gt;</span>ç¡®å®š<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">    getPermissionList,</span><br><span class="line">    addPermission</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;@/api/permission&#x27;</span></span><br><span class="line"><span class="function"><span class="title">btnOK</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.$refs.perForm</span><br><span class="line">        .validate()</span><br><span class="line">        .then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> addPermission(<span class="built_in">this</span>.formData)</span><br><span class="line">        &#125;)</span><br><span class="line">        .then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// æç¤ºæ¶ˆæ¯</span></span><br><span class="line">            <span class="built_in">this</span>.$message.success(<span class="string">&#x27;æ“ä½œæˆåŠŸ&#x27;</span>)</span><br><span class="line">            <span class="built_in">this</span>.getPermissionList()</span><br><span class="line">            <span class="built_in">this</span>.showDialog = <span class="literal">false</span></span><br><span class="line">        &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="6">
<li>å…³é—­å¼¹æ¡†æ—¶é‡ç½®æ ¡éªŒè§„åˆ™ã€‚</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-dialog</span> <span class="attr">:title</span>=<span class="string">&quot;`$&#123;showText&#125;æƒé™ç‚¹`&quot;</span> <span class="attr">:visible</span>=<span class="string">&quot;showDialog&quot;</span> @<span class="attr">close</span>=<span class="string">&quot;btnCancel&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-dialog</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">btnCancel</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.formData = &#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;&#x27;</span>, <span class="comment">// åç§°</span></span><br><span class="line">        <span class="attr">code</span>: <span class="string">&#x27;&#x27;</span>, <span class="comment">// æ ‡è¯†</span></span><br><span class="line">        <span class="attr">description</span>: <span class="string">&#x27;&#x27;</span>, <span class="comment">// æè¿°</span></span><br><span class="line">        <span class="attr">enVisible</span>: <span class="string">&#x27;0&#x27;</span>, <span class="comment">// å¼€å¯</span></span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;&#x27;</span>, <span class="comment">// ç±»å‹ è¯¥ç±»å‹ ä¸éœ€è¦æ˜¾ç¤º å› ä¸ºç‚¹å‡»æ·»åŠ çš„æ—¶å€™å·²ç»çŸ¥é“ç±»å‹äº†</span></span><br><span class="line">        <span class="attr">pid</span>: <span class="string">&#x27;&#x27;</span>, <span class="comment">// å› ä¸ºåšçš„æ˜¯æ ‘ éœ€è¦çŸ¥é“æ·»åŠ åˆ°å“ªä¸ªèŠ‚ç‚¹ä¸‹äº†</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">this</span>.$refs.perForm.resetFields()</span><br><span class="line">    <span class="built_in">this</span>.showDialog = <span class="literal">false</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<h3 id="ç¼–è¾‘æƒé™"><a href="#ç¼–è¾‘æƒé™" class="headerlink" title="ç¼–è¾‘æƒé™"></a>ç¼–è¾‘æƒé™</h3><ol>
<li>ç»™ç¼–è¾‘æŒ‰é’®ç»‘å®šç‚¹å‡»äº‹ä»¶ï¼Œè·å–è¯¦æƒ…å¹¶å›å¡«è¡¨å•ã€‚</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;editPermission(row.id)&quot;</span>&gt;</span>ç¼–è¾‘<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">    getPermissionDetail</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;@/api/permission&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="attr">methods</span>: &#123;</span><br><span class="line">        <span class="keyword">async</span> <span class="function"><span class="title">editPermission</span>(<span class="params">id</span>)</span> &#123;</span><br><span class="line">            <span class="comment">// æ ¹æ®è·å–idè·å–è¯¦æƒ…</span></span><br><span class="line">            <span class="built_in">this</span>.formData = <span class="keyword">await</span> getPermissionDetail(id)</span><br><span class="line">            <span class="built_in">this</span>.showDialog = <span class="literal">true</span></span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>æ”¹é€  btnOK æ–¹æ³•ã€‚</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">    getPermissionList,</span><br><span class="line">    addPermission,</span><br><span class="line">    updatePermission</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;@/api/permission&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="attr">methods</span>: &#123;</span><br><span class="line">        <span class="function"><span class="title">btnOK</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.$refs.perForm</span><br><span class="line">                .validate()</span><br><span class="line">                .then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                    <span class="comment">// #mark</span></span><br><span class="line">                    <span class="keyword">if</span> (<span class="built_in">this</span>.formData.id) &#123;</span><br><span class="line">                        <span class="keyword">return</span> updatePermission(<span class="built_in">this</span>.formData)</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">return</span> addPermission(<span class="built_in">this</span>.formData)</span><br><span class="line">                &#125;)</span><br><span class="line">                .then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                    <span class="comment">//  æç¤ºæ¶ˆæ¯</span></span><br><span class="line">                    <span class="built_in">this</span>.$message.success(<span class="string">&#x27;æ“ä½œæˆåŠŸ&#x27;</span>)</span><br><span class="line">                    <span class="built_in">this</span>.getPermissionList()</span><br><span class="line">                    <span class="built_in">this</span>.showDialog = <span class="literal">false</span></span><br><span class="line">                &#125;)</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="åˆ é™¤æƒé™"><a href="#åˆ é™¤æƒé™" class="headerlink" title="åˆ é™¤æƒé™"></a>åˆ é™¤æƒé™</h3><ol>
<li>ç»™åˆ é™¤æŒ‰é’®ç»‘å®šç‚¹å‡»äº‹ä»¶å¹¶ä¼ é€’æƒé™ idã€‚</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;delPermission(row.id)&quot;</span>&gt;</span>åˆ é™¤<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>åˆ é™¤æƒé™å¹¶é‡æ–°æ¸²æŸ“æœ€æ–°æ•°æ®ã€‚</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">    delPermission,</span><br><span class="line">    getPermissionList</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;@/api/permission&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="attr">methods</span>: &#123;</span><br><span class="line">        <span class="comment">// åˆ é™¤æ“ä½œ</span></span><br><span class="line">        <span class="keyword">async</span> <span class="function"><span class="title">delPermission</span>(<span class="params">id</span>)</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">await</span> <span class="built_in">this</span>.$confirm(<span class="string">&#x27;ç¡®å®šè¦åˆ é™¤è¯¥æ•°æ®å—&#x27;</span>)</span><br><span class="line">                <span class="keyword">await</span> delPermission(id)</span><br><span class="line">                <span class="built_in">this</span>.getPermissionList()</span><br><span class="line">                <span class="built_in">this</span>.$message.success(<span class="string">&#x27;åˆ é™¤æˆåŠŸ&#x27;</span>)</span><br><span class="line">            &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">                <span class="built_in">console</span>.log(error)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ç»™è§’è‰²åˆ†é…æƒé™"><a href="#ç»™è§’è‰²åˆ†é…æƒé™" class="headerlink" title="ç»™è§’è‰²åˆ†é…æƒé™"></a>ç»™è§’è‰²åˆ†é…æƒé™</h2><h3 id="ç›®æ ‡-2"><a href="#ç›®æ ‡-2" class="headerlink" title="ç›®æ ‡"></a>ç›®æ ‡</h3><p>åœ¨å…¬å¸è®¾ç½®é¡µé¢ï¼Œå®Œæˆç»™è§’è‰²åˆ†é…æƒé™çš„åŠŸèƒ½ã€‚</p>
<h3 id="å†…å®¹"><a href="#å†…å®¹" class="headerlink" title="å†…å®¹"></a>å†…å®¹</h3><ol>
<li>å°è£…åˆ†é…æƒé™çš„ apiï¼Œ<code>api/settings.js</code>ã€‚</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç»™è§’è‰²åˆ†é…æƒé™</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">assignPerm</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> request(&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="string">&#x27;/sys/role/assignPrem&#x27;</span>,</span><br><span class="line">        <span class="attr">method</span>: <span class="string">&#x27;put&#x27;</span>,</span><br><span class="line">        data,</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>å‡†å¤‡ç»™è§’è‰²åˆ†é…æƒé™çš„å¼¹å±‚ï¼Œ<code>views/settings/index.vue</code>ã€‚</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-dialog</span> <span class="attr">title</span>=<span class="string">&quot;åˆ†é…æƒé™&quot;</span> <span class="attr">:visible</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-tree</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- ç¡®å®š å–æ¶ˆ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-row</span> <span class="attr">slot</span>=<span class="string">&quot;footer&quot;</span> <span class="attr">type</span>=<span class="string">&quot;flex&quot;</span> <span class="attr">justify</span>=<span class="string">&quot;center&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-col</span> <span class="attr">:span</span>=<span class="string">&quot;6&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> <span class="attr">size</span>=<span class="string">&quot;small&quot;</span>&gt;</span>ç¡®å®š<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">size</span>=<span class="string">&quot;small&quot;</span>&gt;</span>å–æ¶ˆ<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-col</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-row</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">el-dialog</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>ç‚¹å‡»æŒ‰é’®æ˜¾ç¤ºå¼¹å±‚å¹¶è®°å½•è§’è‰² IDã€‚</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- #1 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">size</span>=<span class="string">&quot;small&quot;</span> <span class="attr">type</span>=<span class="string">&quot;success&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;assignPerm(row.id)&quot;</span>&gt;</span>åˆ†é…æƒé™<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="attr">name</span>: <span class="string">&#x27;Settings&#x27;</span>,</span></span><br><span class="line"><span class="javascript">        <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">                <span class="attr">showPermDialog</span>: <span class="literal">false</span>,</span></span><br><span class="line"><span class="javascript">                <span class="attr">roleId</span>: <span class="literal">null</span></span></span><br><span class="line"><span class="javascript">            &#125;</span></span><br><span class="line"><span class="javascript">        &#125;,</span></span><br><span class="line"><span class="javascript">        <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="javascript">            <span class="comment">// #2</span></span></span><br><span class="line"><span class="javascript">            <span class="function"><span class="title">assignPerm</span>(<span class="params">id</span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">                <span class="built_in">this</span>.roleId = id</span></span><br><span class="line"><span class="javascript">                <span class="built_in">this</span>.showPermDialog = <span class="literal">true</span></span></span><br><span class="line"><span class="javascript">            &#125;</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript">    &#125;</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="4">
<li>å‡†å¤‡æ ‘å½¢ç»„ä»¶ç›¸å…³çš„å±æ€§ã€‚</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-dialog</span> <span class="attr">title</span>=<span class="string">&quot;åˆ†é…æƒé™&quot;</span> <span class="attr">:visible</span>=<span class="string">&quot;showPermDialog&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- æƒé™æ˜¯ä»¥æ ‘å½¢çš„ç»“æ„è¿›è¡Œå±•ç¤º --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- data æ•°æ®æº --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- props é…ç½®å¯¹è±¡ --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- show-checkbox æ˜¯å¦æ˜¾ç¤ºå¤é€‰æ¡† --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- check-strictly çˆ¶å­æ˜¯å¦ä¸¥æ ¼å…³è”ï¼Œå¦‚æœä¸º true é‚£è¡¨ç¤ºçˆ¶å­å‹¾é€‰æ—¶ï¼Œä¸äº’ç›¸å…³è”ï¼›å¦‚æœä¸º false å°±äº’ç›¸å…³è” --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- node-key æ¯ä¸ªæ ‘èŠ‚ç‚¹ç”¨æ¥ä½œä¸ºå”¯ä¸€æ ‡è¯†çš„å±æ€§ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-tree</span> <span class="attr">ref</span>=<span class="string">&quot;permTree&quot;</span> <span class="attr">:data</span>=<span class="string">&quot;permData&quot;</span> <span class="attr">:props</span>=<span class="string">&quot;defaultProps&quot;</span> <span class="attr">:show-checkbox</span>=<span class="string">&quot;true&quot;</span> <span class="attr">:check-strictly</span>=<span class="string">&quot;true&quot;</span> <span class="attr">:default-expand-all</span>=<span class="string">&quot;true&quot;</span> <span class="attr">:default-checked-keys</span>=<span class="string">&quot;selectCheck&quot;</span> <span class="attr">node-key</span>=<span class="string">&quot;id&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- ç¡®å®š å–æ¶ˆ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-row</span> <span class="attr">slot</span>=<span class="string">&quot;footer&quot;</span> <span class="attr">type</span>=<span class="string">&quot;flex&quot;</span> <span class="attr">justify</span>=<span class="string">&quot;center&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-col</span> <span class="attr">:span</span>=<span class="string">&quot;6&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> <span class="attr">size</span>=<span class="string">&quot;small&quot;</span>&gt;</span>ç¡®å®š<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">size</span>=<span class="string">&quot;small&quot;</span>&gt;</span>å–æ¶ˆ<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-col</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-row</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">el-dialog</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="comment">// ...</span></span><br><span class="line">            <span class="attr">defaultProps</span>: &#123;</span><br><span class="line">                <span class="attr">label</span>: <span class="string">&#x27;name&#x27;</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">permData</span>: [], <span class="comment">// ç”¨æ¥æ¥æ”¶æƒé™æ•°æ®çš„æ•°æ®ï¼Œæ ‘å½¢ç»“æ„</span></span><br><span class="line">            <span class="attr">selectCheck</span>: [], <span class="comment">// æ¥æ”¶ï¼Œå·²ç»é€‰ä¸­çš„èŠ‚ç‚¹</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>ç‚¹å‡»åˆ†é…æƒé™æŒ‰é’®ï¼Œå±•ç¤ºå¼¹å±‚ï¼Œè·å–æ‰€æœ‰æƒé™å¹¶é€‰ä¸­å½“å‰è§’è‰²å¯¹åº”çš„æƒé™ã€‚</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-button</span> <span class="attr">size</span>=<span class="string">&quot;small&quot;</span> <span class="attr">type</span>=<span class="string">&quot;success&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;assignPerm(row.id)&quot;</span>&gt;</span>åˆ†é…æƒé™<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">    getPermissionList</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;@/api/permission&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">    transArray2Tree</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;@/utils&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="attr">methods</span>: &#123;</span><br><span class="line">        <span class="keyword">async</span> <span class="function"><span class="title">assignPerm</span>(<span class="params">id</span>)</span> &#123;</span><br><span class="line">            <span class="comment">// ...</span></span><br><span class="line">            <span class="comment">// è·å–æ‰€æœ‰æƒé™</span></span><br><span class="line">            <span class="built_in">this</span>.permData = transArray2Tree(<span class="keyword">await</span> getPermissionList(), <span class="string">&#x27;0&#x27;</span>) <span class="comment">// è½¬åŒ–liståˆ°æ ‘å½¢æ•°æ®</span></span><br><span class="line">            <span class="comment">// æ ¹æ®è§’è‰² ID è·å–å½“å‰è§’è‰²çš„æƒé™å¹¶èµ‹å€¼ç»™ permIds</span></span><br><span class="line">            <span class="keyword">const</span> &#123;</span><br><span class="line">                permIds</span><br><span class="line">            &#125; = <span class="keyword">await</span> getRoleDetail(id)</span><br><span class="line">            <span class="built_in">this</span>.selectCheck = permIds</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="6">
<li>ç‚¹å‡»ç¡®å®šæŒ‰é’®åå®Œæˆåˆ†é…æƒé™åŠŸèƒ½ã€‚</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">    assignPerm</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;@/api/settings&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="attr">methods</span>: &#123;</span><br><span class="line">        <span class="keyword">async</span> <span class="function"><span class="title">btnPermOK</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">            <span class="keyword">await</span> assignPerm(&#123;</span><br><span class="line">                <span class="attr">permIds</span>: <span class="built_in">this</span>.$refs.permTree.getCheckedKeys(),</span><br><span class="line">                <span class="attr">id</span>: <span class="built_in">this</span>.roleId</span><br><span class="line">            &#125;)</span><br><span class="line">            <span class="built_in">this</span>.$message.success(<span class="string">&#x27;åˆ†é…æƒé™æˆåŠŸ&#x27;</span>)</span><br><span class="line">            <span class="built_in">this</span>.showPermDialog = <span class="literal">false</span></span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="7">
<li>å…³é—­å¼¹æ¡†ã€‚</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-dialog</span> <span class="attr">title</span>=<span class="string">&quot;åˆ†é…æƒé™&quot;</span> <span class="attr">:visible</span>=<span class="string">&quot;showPermDialog&quot;</span> @<span class="attr">close</span>=<span class="string">&quot;btnPermCancel&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-dialog</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="attr">methods</span>: &#123;</span><br><span class="line">        <span class="function"><span class="title">btnPermCancel</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">            <span class="comment">// å…³é—­å¼¹å±‚é‡ç½®æ•°æ®</span></span><br><span class="line">            <span class="built_in">this</span>.selectCheck = []</span><br><span class="line">            <span class="built_in">this</span>.showPermDialog = <span class="literal">false</span></span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="å‰ç«¯æƒé™çš„åº”ç”¨"><a href="#å‰ç«¯æƒé™çš„åº”ç”¨" class="headerlink" title="å‰ç«¯æƒé™çš„åº”ç”¨"></a>å‰ç«¯æƒé™çš„åº”ç”¨</h2><h3 id="ç›®æ ‡-3"><a href="#ç›®æ ‡-3" class="headerlink" title="ç›®æ ‡"></a>ç›®æ ‡</h3><p>åœ¨å½“å‰é¡¹ç›®åº”ç”¨å¯¹åº”ç”¨æˆ·çš„é¡µé¢è®¿é—®æƒé™ã€‚</p>
<h3 id="æƒé™å—æ§çš„ä¸»ä½“æ€è·¯"><a href="#æƒé™å—æ§çš„ä¸»ä½“æ€è·¯" class="headerlink" title="æƒé™å—æ§çš„ä¸»ä½“æ€è·¯"></a>æƒé™å—æ§çš„ä¸»ä½“æ€è·¯</h3><p>åˆ°äº†æœ€å…³é”®çš„ç¯èŠ‚ï¼Œæˆ‘ä»¬è®¾ç½®çš„æƒé™å¦‚ä½•åº”ç”¨/ç”Ÿæ•ˆï¼Ÿ</p>
<p>æˆ‘ä»¬å·²ç»åšåˆ°äº†ç»™ç”¨æˆ·åˆ†é…è§’è‰²ï¼Œç»™è§’è‰²åˆ†é…æƒé™ï¼Œè¿™ä¸ªæƒé™æ€ä¹ˆå’Œæˆ‘ä»¬çš„è·¯ç”±ä»¥åŠå·¦ä¾§èœå•ç»“åˆèµ·æ¥å‘¢ï¼Ÿ</p>
<p><img src="/resource/images/image-20200730002842243.png" alt="image-20200730002842243"></p>
<p>åœ¨æƒé™ç®¡ç†é¡µé¢ä¸­ï¼Œæˆ‘ä»¬è®¾ç½®äº†ä¸€ä¸ªæ ‡è¯†ï¼Œè¿™ä¸ªæ ‡è¯†å¯ä»¥å’Œæˆ‘ä»¬çš„è·¯ç”±æ¨¡å—è¿›è¡Œå…³è”ï¼ˆå’Œè·¯ç”±çš„ name ä¸€æ ·ï¼‰ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœç”¨æˆ·æ‹¥æœ‰è¿™ä¸ªæ ‡è¯†ï¼Œé‚£ä¹ˆç”¨æˆ·å°±å¯ä»¥è®¿é—®è¿™ä¸ªè·¯ç”±æ¨¡å—ï¼Œå¦‚æœæ²¡æœ‰è¿™ä¸ªæ ‡è¯†ï¼Œå°±ä¸èƒ½è®¿é—®è·¯ç”±æ¨¡å—ã€‚</p>
<p>ç”¨ä»€ä¹ˆæ¥å®ç°å‘¢ï¼Ÿ</p>
<p>vue-router æä¾›äº†ä¸€ä¸ªå«åš <a target="_blank" rel="noopener" href="https://router.vuejs.org/zh/api/#router-addroutes">addRoutes</a> çš„ API æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•çš„å«ä¹‰æ˜¯åŠ¨æ€æ·»åŠ è·¯ç”±è§„åˆ™ï¼Œæ€è·¯å¦‚ä¸‹ã€‚</p>
<p><img src="/resource/images/image-20200901164312005.png" alt="image-20200901164312005"></p>
<h3 id="addRoutes"><a href="#addRoutes" class="headerlink" title="addRoutes"></a>addRoutes</h3><ol>
<li>åˆ é™¤é»˜è®¤çš„åŠ¨æ€è·¯ç”± asyncRoutesï¼Œ<code>router/index.js</code>ã€‚</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> createRouter = <span class="function">() =&gt;</span></span><br><span class="line">    <span class="keyword">new</span> Router(&#123;</span><br><span class="line">        <span class="attr">scrollBehavior</span>: <span class="function">() =&gt;</span> (&#123;</span><br><span class="line">            <span class="attr">y</span>: <span class="number">0</span></span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="attr">routes</span>: [...constantRoutes],</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>å…ˆé€šè¿‡ addRoutes æ·»åŠ æ‰€æœ‰çš„åŠ¨æ€è·¯ç”±æµ‹è¯•ä¸€ä¸‹ï¼Œ<code>permission.js</code>ã€‚</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// #1</span></span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">    asyncRoutes</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;@/router&#x27;</span></span><br><span class="line"></span><br><span class="line">router.beforeEach(<span class="keyword">async</span> <span class="function"><span class="keyword">function</span>(<span class="params">to, <span class="keyword">from</span>, next</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// å¼€å¯è¿›åº¦æ¡</span></span><br><span class="line">    NProgress.start()</span><br><span class="line">    <span class="comment">// å¦‚æœæœ‰ token</span></span><br><span class="line">    <span class="keyword">if</span> (store.getters.token) &#123;</span><br><span class="line">        <span class="comment">// ç»§ç»­åˆ¤æ–­æ˜¯ä¸æ˜¯å»ç™»å½•é¡µ</span></span><br><span class="line">        <span class="keyword">if</span> (to.path === <span class="string">&#x27;/login&#x27;</span>) &#123;</span><br><span class="line">            <span class="comment">// è¡¨ç¤ºå»çš„æ˜¯ç™»å½•é¡µï¼Œåˆ™è·³åˆ°ä¸»é¡µ</span></span><br><span class="line">            next(<span class="string">&#x27;/&#x27;</span>)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (!store.getters.userId) &#123;</span><br><span class="line">                <span class="keyword">await</span> store.dispatch(<span class="string">&#x27;user/getUserInfo&#x27;</span>)</span><br><span class="line">                <span class="comment">// å…ˆåŠ¨æ€æ·»åŠ æ‰€æœ‰çš„è¯•è¯•</span></span><br><span class="line">                <span class="comment">// #2</span></span><br><span class="line">                router.addRoutes(asyncRoutes)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// å¦åˆ™ç›´æ¥æ”¾è¡Œ</span></span><br><span class="line">            next()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•ï¼šåœ¨åœ°å€æ è¾“å…¥å¯¹åº”çš„è·¯ç”±åœ°å€è¯•è¯•ï¼Œä¾‹å¦‚ <code>http://localhost:8888/#/permissions</code> ã€‚</p>
<p>é—®é¢˜ï¼šé¡µé¢æ˜¯èƒ½å‡ºæ¥ï¼Œåˆ·æ–°çš„æ—¶å€™ä¸ºä»€ä¹ˆè¿˜æ˜¯ 404 äº†ï¼Ÿ</p>
<h3 id="404-é—®é¢˜"><a href="#404-é—®é¢˜" class="headerlink" title="404 é—®é¢˜"></a>404 é—®é¢˜</h3><ol>
<li><p>åˆ é™¤ <code>router/index.js</code> ä¸­çš„ <code>&#123; path: &#39;*&#39;, redirect: &#39;/404&#39;, hidden: true &#125;</code> è·¯ç”±é…ç½®é¡¹ã€‚</p>
</li>
<li><p><code>permission.js</code>ã€‚</p>
</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">router.addRoutes([...asyncRoutesï¼Œ &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;*&#x27;</span>,</span><br><span class="line">    <span class="attr">redirect</span>: <span class="string">&#x27;/404&#x27;</span>,</span><br><span class="line">    <span class="attr">hidden</span>: <span class="literal">true</span></span><br><span class="line">&#125;])</span><br></pre></td></tr></table></figure>

<p>é—®é¢˜ï¼šåˆ·æ–°çš„æ—¶å€™ç™½å±äº†ï¼Ÿ</p>
<h3 id="ç™½å±é—®é¢˜"><a href="#ç™½å±é—®é¢˜" class="headerlink" title="ç™½å±é—®é¢˜"></a>ç™½å±é—®é¢˜</h3><p>é€šè¿‡ addRoutes åŠ¨æ€æ–°å¢çš„è·¯ç”±æ˜¯å¼‚æ­¥çš„ï¼Œä¸ä¼šå³å¯ç”Ÿæ•ˆï¼Œä¸ºäº†ä¿è¯ç”Ÿæ•ˆï¼Œéœ€è¦è®©ç”¨æˆ·é‡æ–°è¿›ä¸€ä¸‹é¦–é¡µï¼ˆé‡æ–°èµ°ä¸€ä¸‹ beforeEach çš„é€»è¾‘ï¼‰ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">    asyncRoutes</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;@/router&#x27;</span></span><br><span class="line"></span><br><span class="line">router.beforeEach(<span class="keyword">async</span> <span class="function"><span class="keyword">function</span>(<span class="params">to, <span class="keyword">from</span>, next</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// å¼€å¯è¿›åº¦æ¡</span></span><br><span class="line">    NProgress.start()</span><br><span class="line">    <span class="comment">// å¦‚æœæœ‰ token</span></span><br><span class="line">    <span class="keyword">if</span> (store.getters.token) &#123;</span><br><span class="line">        <span class="comment">// ç»§ç»­åˆ¤æ–­æ˜¯ä¸æ˜¯å»ç™»å½•é¡µ</span></span><br><span class="line">        <span class="keyword">if</span> (to.path === <span class="string">&#x27;/login&#x27;</span>) &#123;</span><br><span class="line">            <span class="comment">// è¡¨ç¤ºå»çš„æ˜¯ç™»å½•é¡µï¼Œåˆ™è·³åˆ°ä¸»é¡µ</span></span><br><span class="line">            next(<span class="string">&#x27;/&#x27;</span>)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (!store.getters.userId) &#123;</span><br><span class="line">                <span class="keyword">await</span> store.dispatch(<span class="string">&#x27;user/getUserInfo&#x27;</span>)</span><br><span class="line">                <span class="comment">// å…ˆåŠ¨æ€æ·»åŠ æ‰€æœ‰çš„è¯•è¯•</span></span><br><span class="line">                router.addRoutes([...asyncRoutes, &#123;</span><br><span class="line">                    <span class="attr">path</span>: <span class="string">&#x27;*&#x27;</span>,</span><br><span class="line">                    <span class="attr">redirect</span>: <span class="string">&#x27;/404&#x27;</span>,</span><br><span class="line">                    <span class="attr">hidden</span>: <span class="literal">true</span></span><br><span class="line">                &#125;])</span><br><span class="line">                <span class="comment">// æ€ä¹ˆæ¥çš„ï¼Œå°±æ€ä¹ˆé‡æ–°è¿›ä¸€æ¬¡</span></span><br><span class="line">                <span class="comment">// #1</span></span><br><span class="line">                next(&#123;</span><br><span class="line">                    <span class="comment">// path: &#x27;/&#x27;</span></span><br><span class="line">                    <span class="comment">// path: to.path</span></span><br><span class="line">                    ...to,</span><br><span class="line">                    <span class="comment">// é¿å…é‡æ–°è¿›é¡µé¢å†å²é‡å¤çš„é—®é¢˜</span></span><br><span class="line">                    <span class="attr">replace</span>: <span class="literal">true</span>,</span><br><span class="line">                &#125;)</span><br><span class="line">                <span class="comment">// #2</span></span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// å¦åˆ™ç›´æ¥æ”¾è¡Œ</span></span><br><span class="line">            next()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="ç­›é€‰è·¯ç”±"><a href="#ç­›é€‰è·¯ç”±" class="headerlink" title="ç­›é€‰è·¯ç”±"></a>ç­›é€‰è·¯ç”±</h3><ol>
<li>å‡†å¤‡ç­›é€‰è·¯ç”±çš„ actionï¼Œ<code>store/modules/permissions.js</code>ã€‚</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">    asyncRoutes</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;@/router&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="attr">namespaced</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">actions</span>: &#123;</span><br><span class="line">        <span class="comment">// æ ¹æ® asyncRoutes å…¨éƒ¨çš„åŠ¨æ€è·¯ç”±ï¼Œè¿‡æ»¤å‡ºéœ€è¦åŠ¨æ€æ–°å¢çš„è·¯ç”±</span></span><br><span class="line">        <span class="function"><span class="title">filterRoutes</span>(<span class="params">context, menus</span>)</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> otherRoutes = asyncRoutes.filter(<span class="function">(<span class="params">item</span>) =&gt;</span> menus.includes(item.children[<span class="number">0</span>].name))</span><br><span class="line">            <span class="keyword">return</span> otherRoutes</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>å¯¼å…¥ä¸Šé¢çš„ permissions store æ¨¡å—ï¼Œ<code>store/index.js</code>ã€‚</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> permissions <span class="keyword">from</span> <span class="string">&#x27;./modules/permissions&#x27;</span></span><br><span class="line">Vue.use(Vuex)</span><br><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> Vuex.Store(&#123;</span><br><span class="line">    <span class="attr">modules</span>: &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">        permissions,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>åœ¨ getUserInfo action ä¸­ <code>return baseInfo</code>ï¼Œä¸ºäº†è§¦å‘æ­¤ action æ—¶å¯ä»¥ç›´æ¥æ‹¿åˆ°ç”¨æˆ·ä¿¡æ¯ï¼Œæ‹¿åˆ°ç”¨æˆ·ä¿¡æ¯çš„ç›®çš„æ˜¯æ ¹æ®æ­¤ä¿¡æ¯è¿›è¡Œè·¯ç”±æƒé™çš„ç­›é€‰ï¼Œ<code>store/modules/user.js</code>ã€‚</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="title">getUserInfo</span>(<span class="params">&#123;</span></span></span><br><span class="line"><span class="params"><span class="function">    commit</span></span></span><br><span class="line"><span class="params"><span class="function">&#125;</span>)</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">return</span> baseInfo</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>åœ¨è·¯ç”±å‰ç½®å¯¼èˆªå®ˆå«ä¸­è°ƒç”¨ç­›é€‰è·¯ç”±çš„ mutationï¼Œ<code>permission.js</code>ã€‚</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!store.getters.userId) &#123;</span><br><span class="line">    <span class="comment">// #1</span></span><br><span class="line">    <span class="keyword">const</span> &#123;</span><br><span class="line">        <span class="attr">roles</span>: &#123;</span><br><span class="line">            menus</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125; = <span class="keyword">await</span> store.dispatch(<span class="string">&#x27;user/getUserInfo&#x27;</span>)</span><br><span class="line">    <span class="comment">// #2</span></span><br><span class="line">    <span class="keyword">const</span> otherRoutes = <span class="keyword">await</span> store.dispatch(<span class="string">&#x27;permissions/filterRoutes&#x27;</span>, menus)</span><br><span class="line">    <span class="comment">// #3</span></span><br><span class="line">    router.addRoutes(otherRoutes)</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨åœ°å€æ æ‰‹åŠ¨è¾“å…¥ç­›é€‰åçš„è·¯ç”±åœ°å€è¿›è¡Œæµ‹è¯•ã€‚</p>
<p>ğŸ¤” æ ¼å¤–æ³¨æ„ï¼šéœ€è¦æŠŠ router/modules ä¸­æ¯ä¸€ä¸ªè·¯ç”±æ–‡ä»¶çš„ name å’Œåç«¯è¿”å›çš„ menus ä¿æŒä¸€è‡´ã€‚</p>
<h3 id="ä¾§è¾¹æ é—®é¢˜"><a href="#ä¾§è¾¹æ é—®é¢˜" class="headerlink" title="ä¾§è¾¹æ é—®é¢˜"></a>ä¾§è¾¹æ é—®é¢˜</h3><ol>
<li><p>é—®é¢˜ï¼š<code>router.options.routes</code> åªä¼šæ‹¿åˆ°åˆå§‹åŒ–æ—¶çš„ routes è§„åˆ™ï¼Œåç»­åŠ¨æ€æ–°å¢çš„æ‹¿ä¸åˆ°ã€‚</p>
</li>
<li><p>æ€è·¯ï¼šæŠŠåŠ¨æ€è·¯ç”±ä¹Ÿå­˜å‚¨åˆ° Vuex ä¸€ä»½ï¼Œ<code>store/modules/permissions.js</code>ã€‚</p>
</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  asyncRoutes,</span><br><span class="line">  constantRoutes</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;@/router&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">namespaced</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// #1</span></span><br><span class="line">  <span class="attr">state</span>: &#123;</span><br><span class="line">    <span class="attr">routes</span>: constantRoutes || []</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">mutations</span>: &#123;</span><br><span class="line">    <span class="comment">// #2</span></span><br><span class="line">    <span class="function"><span class="title">setRoutes</span>(<span class="params">state, otherRoutes</span>)</span> &#123;</span><br><span class="line">      <span class="comment">// æ³¨æ„è¿™å„¿ï¼Œæ¯æ¬¡åº”è¯¥æ˜¯åœ¨åˆå§‹çš„ constantRoutes åŸºç¡€ä¸Šæ·»åŠ ï¼Œæœ€å¥½ä¸è¦ä½¿ç”¨ pushï¼Œé˜²æ­¢åˆ‡æ¢ç”¨æˆ·è´¦å·åç´¯åŠ çš„é—®é¢˜</span></span><br><span class="line">      <span class="comment">// ä¸ºäº† vuex ä¸­çš„è·¯ç”±ä¿¡æ¯å’Œ router å®ä¾‹ä¸­çš„è·¯ç”±ä¿¡æ¯ä¿æŒç»Ÿä¸€ï¼Œæœ€åæœ€å¥½å†åŠ ä¸€ä¸ª 404ï¼ˆä¸åŠ ä¹Ÿä¸å½±å“åŠŸèƒ½ï¼‰</span></span><br><span class="line">      state.routes = [...constantRoutes, ...otherRoutes, &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;*&#x27;</span>,</span><br><span class="line">        <span class="attr">redirect</span>: <span class="string">&#x27;/404&#x27;</span>,</span><br><span class="line">        <span class="attr">hidden</span>: <span class="literal">true</span></span><br><span class="line">      &#125;]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">actions</span>: &#123;</span><br><span class="line">    <span class="comment">// æ ¹æ® asyncRoutes å…¨éƒ¨çš„åŠ¨æ€è·¯ç”±ï¼Œè¿‡æ»¤å‡ºéœ€è¦åŠ¨æ€æ–°å¢çš„è·¯ç”±</span></span><br><span class="line">    <span class="function"><span class="title">filterRoutes</span>(<span class="params">context, menus</span>)</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> otherRoutes = asyncRoutes.filter(<span class="function">(<span class="params">item</span>) =&gt;</span> menus.includes(item.children[<span class="number">0</span>].name))</span><br><span class="line">      <span class="comment">// #3</span></span><br><span class="line">      context.commit(<span class="string">&#x27;setRoutes&#x27;</span>, otherRoutes)</span><br><span class="line">      <span class="keyword">return</span> otherRoutes</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>å»ºç«‹è·å– Vuex ä¸­è·¯ç”±çš„å¿«æ·è®¿é—®ï¼Œ<code>store/getters.js</code>ã€‚</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> getters = &#123;</span><br><span class="line">    <span class="attr">routes</span>: <span class="function">(<span class="params">state</span>) =&gt;</span> state.permissions.routes,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> getters</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>é€šè¿‡ mapGetters å–å‡º routesï¼Œ<code>layout/components/Sidebar/index.vue</code>ã€‚</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="attr">components</span>: &#123;</span></span><br><span class="line"><span class="javascript">            SidebarItem,</span></span><br><span class="line"><span class="javascript">            Logo</span></span><br><span class="line"><span class="javascript">        &#125;,</span></span><br><span class="line"><span class="javascript">        <span class="attr">computed</span>: &#123;</span></span><br><span class="line"><span class="javascript">            <span class="comment">// #1</span></span></span><br><span class="line"><span class="javascript">            ...mapGetters([<span class="string">&#x27;sidebar&#x27;</span>, <span class="string">&#x27;routes&#x27;</span>]),</span></span><br><span class="line"><span class="javascript">            <span class="comment">// #2</span></span></span><br><span class="line"><span class="javascript">            <span class="comment">/* routes() &#123;</span></span></span><br><span class="line"><span class="comment"><span class="javascript">                return this.$router.options.routes</span></span></span><br><span class="line"><span class="comment"><span class="javascript">            &#125;, */</span></span></span><br><span class="line"><span class="javascript">        &#125;,</span></span><br><span class="line"><span class="javascript">    &#125;</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="5">
<li>ç»™å¦å¤–ä¸€ä¸ªè´¦å·åˆ†é…æƒé™æµ‹è¯•ã€‚</li>
</ol>
<p><font color=e32d40>å‘˜å·¥ç®¡ç†</font> =&gt; ç»™â€œä¹”æµ·â€åˆ†é…è§’è‰² =&gt; <font color=e32d40>å…¬å¸è®¾ç½®</font> =&gt; ç»™è§’è‰²åˆ†é…æƒé™ =&gt; é‡æ–°ç™»å½•â€œä¹”æµ·â€çš„è´¦å·æŸ¥çœ‹æ˜¯å¦ç”Ÿæ•ˆã€‚</p>
<p>ğŸ¤” æ³¨æ„ï¼šåç«¯å¯¹ç®¡ç†å‘˜çš„è§’è‰²åšäº†ç‰¹æ®Šå¤„ç†ï¼Œæ°¸è¿œå…·æœ‰æ‰€æœ‰æƒé™ï¼Œæ‰€ä»¥è¯·ç”¨å…¶ä»–è´¦å·æµ‹è¯•ã€‚</p>
<ol start="6">
<li>æ–°é—®é¢˜ï¼šé€šè¿‡æµè§ˆå™¨åœ°å€æ æ‰‹åŠ¨è¾“å…¥çš„æ—¶å€™ï¼Œå‘ç°ç«Ÿèƒ½è®¿é—®ä¾§è¾¹æ æ²¡æœ‰çš„è·¯ç”±ã€‚</li>
</ol>
<p>åŸå› ï¼šå› ä¸ºæˆ‘ä»¬å‰é¢åœ¨ addRoutes çš„æ—¶å€™ï¼Œä¸€ç›´éƒ½æ˜¯å¾€ router å®ä¾‹æ·»åŠ ï¼Œä¹”æµ·å—åˆ°äº†å‰é¢ç®¡ç†å‘˜çš„å½±å“ã€‚</p>
<h2 id="é€€å‡ºæ—¶é‡ç½®è·¯ç”±"><a href="#é€€å‡ºæ—¶é‡ç½®è·¯ç”±" class="headerlink" title="é€€å‡ºæ—¶é‡ç½®è·¯ç”±"></a>é€€å‡ºæ—¶é‡ç½®è·¯ç”±</h2><h3 id="ç›®æ ‡-4"><a href="#ç›®æ ‡-4" class="headerlink" title="ç›®æ ‡"></a>ç›®æ ‡</h3><p>å½“å¤šä¸ªè´¦å·ç›¸äº’åˆ‡æ¢æ—¶ï¼Œå¤„ç† router ç›¸äº’å½±å“çš„é—®é¢˜ã€‚</p>
<h3 id="å†…å®¹-1"><a href="#å†…å®¹-1" class="headerlink" title="å†…å®¹"></a>å†…å®¹</h3><ol>
<li>ä½¿ç”¨é¡¹ç›®æä¾›å¥½çš„è·¯ç”±é‡ç½®æ–¹æ³•ï¼Œ<code>router/index.js</code>ã€‚</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Detail see: https://github.com/vuejs/vue-router/issues/1234#issuecomment-357941465</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">resetRouter</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> newRouter = createRouter()</span><br><span class="line">    router.matcher = newRouter.matcher <span class="comment">// reset router</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>é‡ç½®è·¯ç”±å®ä¾‹å’Œ Vuex ä¸­çš„è·¯ç”±æ•°æ®ï¼Œ<code>store/modules/user.js</code>ã€‚</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">logout</span>(<span class="params">context</span>)</span> &#123;</span><br><span class="line">    <span class="comment">// åˆ é™¤ tokenï¼ˆåŒ…å« Vuex å’Œ Cookie ä¸­çš„ï¼‰</span></span><br><span class="line">    context.commit(<span class="string">&#x27;removeToken&#x27;</span>)</span><br><span class="line">    <span class="comment">// åˆ é™¤ç”¨æˆ·èµ„æ–™</span></span><br><span class="line">    context.commit(<span class="string">&#x27;removeUserInfo&#x27;</span>)</span><br><span class="line">    <span class="comment">// é‡ç½®è·¯ç”±å®ä¾‹</span></span><br><span class="line">    resetRouter()</span><br><span class="line">    <span class="comment">// å­æ¨¡å—è°ƒç”¨å­æ¨¡å—çš„action å¯ä»¥ å°† commitçš„ç¬¬ä¸‰ä¸ªå‚æ•° è®¾ç½®æˆ  &#123; root: true &#125; å°±è¡¨ç¤ºå½“å‰çš„contextä¸æ˜¯å­æ¨¡å—äº† è€Œæ˜¯çˆ¶æ¨¡å—</span></span><br><span class="line">    context.commit(<span class="string">&#x27;permissions/setRoutes&#x27;</span>, [], &#123;</span><br><span class="line">        <span class="attr">root</span>: <span class="literal">true</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="åŠŸèƒ½æƒé™åº”ç”¨"><a href="#åŠŸèƒ½æƒé™åº”ç”¨" class="headerlink" title="åŠŸèƒ½æƒé™åº”ç”¨"></a>åŠŸèƒ½æƒé™åº”ç”¨</h2><h3 id="åŠŸèƒ½æƒé™çš„å—æ§æ€è·¯"><a href="#åŠŸèƒ½æƒé™çš„å—æ§æ€è·¯" class="headerlink" title="åŠŸèƒ½æƒé™çš„å—æ§æ€è·¯"></a>åŠŸèƒ½æƒé™çš„å—æ§æ€è·¯</h3><p>é¡µé¢èƒ½è®¿é—®ï¼Œé¡µé¢ä¸­çš„åŠŸèƒ½ä¸ä¸€å®šèƒ½å…¨éƒ¨ä½¿ç”¨ï¼Œä¾‹å¦‚å¯ä»¥åœ¨ã€å‘˜å·¥ç®¡ç†ã€‘å’Œã€æƒé™ç®¡ç†ã€‘é¡µé¢ä¸‹ï¼Œæ–°å¢ä¸€ä¸ªåˆ é™¤çš„åŠŸèƒ½æƒé™ç‚¹ï¼Œåˆ†åˆ«æ˜¯ <code>point-user-delete</code> å’Œ <code>point-permissions-delete</code> ï¼Œæˆ‘ä»¬è¦åšçš„å°±æ˜¯æ‹¥æœ‰è¿™ä¸ª pointï¼Œæœ‰å°±å¯ä»¥è®©åˆ é™¤èƒ½ç”¨ï¼Œå¦åˆ™å°±éšè—æˆ–è€…ç¦ç”¨åˆ é™¤æŒ‰é’®ã€‚</p>
<h3 id="methods-ä¸­å°è£…æ–¹æ³•"><a href="#methods-ä¸­å°è£…æ–¹æ³•" class="headerlink" title="methods ä¸­å°è£…æ–¹æ³•"></a>methods ä¸­å°è£…æ–¹æ³•</h3><ol>
<li>å»ºç«‹ roles çš„å¿«æ·è®¿é—®ï¼Œ<code>store/getters.js</code>ã€‚</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> getters = &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="attr">roles</span>: <span class="function">(<span class="params">state</span>) =&gt;</span> state.user.userInfo.roles,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> getters</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>åœ¨ methods ä¸­å‡†å¤‡ checkPermission æ–¹æ³•å¹¶åœ¨è§†å›¾ä¸­åº”ç”¨ï¼Œ<code>views/employees/index.vue</code>ã€‚</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">checkPermission</span>(<span class="params">key</span>)</span> &#123;</span><br><span class="line">    <span class="comment">// ä¸ºä»€ä¹ˆåŠ  ? å·</span></span><br><span class="line">    <span class="comment">// ç‚¹å‡»é€€å‡ºï¼Œå¿«æ·è®¿é—®ä¸­çš„ `roles: state =&gt; state.user.userInfo.roles`</span></span><br><span class="line">    <span class="comment">// userInfo æ˜¯ç©ºå¯¹è±¡ï¼Œæ‰€ä»¥ userInfo.roles æ˜¯ undefined</span></span><br><span class="line">    <span class="comment">// å¦‚æœé€€å‡ºçš„é¡µé¢ç”¨åˆ°äº†è¿™ä¸ª checkPermission æ–¹æ³•ï¼Œä¸‹é¢çš„ä»£ç ä¼šæŠ¥é”™</span></span><br><span class="line">    <span class="comment">// this.$store.getters.roles.points ä¼šæŠ¥é”™</span></span><br><span class="line">    <span class="comment">// æ‰€ä»¥...</span></span><br><span class="line">    <span class="keyword">const</span> points = <span class="built_in">this</span>.$store.getters.roles?.points</span><br><span class="line">    <span class="comment">// æ–°æ·»åŠ çš„ç”¨æˆ·çš„ points å¯èƒ½æ˜¯ null</span></span><br><span class="line">    <span class="keyword">if</span> (points &amp;&amp; points.length) &#123;</span><br><span class="line">        <span class="keyword">return</span> points.includes(key)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">size</span>=<span class="string">&quot;small&quot;</span> <span class="attr">:disabled</span>=<span class="string">&quot;!checkPermission(&#x27;point-user-delete&#x27;)&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;deleteEmployee(row.id)&quot;</span>&gt;</span>åˆ é™¤<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li><code>views/permissions/index.vue</code>ï¼Œåœ¨ methods ä¸­å‡†å¤‡ checkPermission æ–¹æ³•å¹¶åœ¨è§†å›¾ä¸­åº”ç”¨ã€‚</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">:disabled</span>=<span class="string">&quot;!checkPermission(&#x27;point-permissions-delete&#x27;)&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;delPermission(row.id)&quot;</span>&gt;</span>åˆ é™¤<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ğŸœ <font color=e32d40><strong>å¦‚ä½•ä½¿ç”¨æˆ‘ä»¬è‡ªå·±å¼€å‘çš„æƒé™ç³»ç»Ÿï¼Ÿ</strong></font></p>
<p>a. ç‚¹å‡»ã€æƒé™ç®¡ç†ã€‘ï¼ŒæŒ‰æŸä¸ªè·¯ç”±é¡µé¢æ·»åŠ æŒ‰é’®æƒé™ï¼›</p>
<p>b. æ‰¾åˆ°ã€å‘˜å·¥ç®¡ç†ã€‘ï¼Œç»™ç”¨æˆ·åˆ†é…è§’è‰²ã€‚</p>
<p>c. æ‰¾åˆ°ã€å…¬å¸è®¾ç½®ã€‘ï¼Œç»™è§’è‰²åˆ†é…æƒé™ã€‚</p>
<h3 id="å¦‚ä½•ä½¿ç”¨-mixins-æŠ€æœ¯"><a href="#å¦‚ä½•ä½¿ç”¨-mixins-æŠ€æœ¯" class="headerlink" title="å¦‚ä½•ä½¿ç”¨ mixins æŠ€æœ¯"></a>å¦‚ä½•ä½¿ç”¨ mixins æŠ€æœ¯</h3><p>ç›®æ ‡ï¼šå°†æ£€æŸ¥æ–¹æ³•æ³¨å…¥éœ€è¦ç”¨åˆ° checkPermission æ–¹æ³•çš„ç»„ä»¶ã€‚</p>
<p><a target="_blank" rel="noopener" href="https://cn.vuejs.org/v2/guide/mixins.html">mixins</a> ç¿»è¯‘è¿‡æ¥æ˜¯æ··å…¥çš„æ„æ€ï¼Œå¯ä»¥æ··å…¥å¤šä¸ªç»„ä»¶ä¸­å…±æœ‰çš„é…ç½®é¡¹ï¼Œä¾‹å¦‚ dataã€methodsã€createdã€watch ç­‰ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ç§æŠ€æœ¯æ¥æ··å…¥ä¸€ä¸ªå…¬å…±çš„ checkPermission æ–¹æ³•ã€‚</p>
<ol>
<li>æ–°å»º <code>mixins/checkPermission.js</code>ã€‚</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="attr">methods</span>: &#123;</span><br><span class="line">        <span class="function"><span class="title">checkPermission</span>(<span class="params">key</span>)</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> points = <span class="built_in">this</span>.$store.getters.roles?.points</span><br><span class="line">            <span class="keyword">if</span> (points &amp;&amp; points.length) &#123;</span><br><span class="line">                <span class="keyword">return</span> points.includes(key)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>å±€éƒ¨æ··å…¥ï¼Œ<code>views/employees/index.vue</code> å’Œ <code>views/permission/index.vue</code>ã€‚</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> checkPermission <span class="keyword">from</span> <span class="string">&#x27;@/mixins/checkPermission&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="attr">mixins</span>: [checkPermission],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>å…¨å±€æ··å…¥ï¼Œ<code>main.js</code>ã€‚</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> checkPermission <span class="keyword">from</span> <span class="string">&#x27;@/mixins/checkPermission&#x27;</span></span><br><span class="line">Vue.mixin(checkPermission)</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>å…¶ä»–æ–¹æ³•ï¼Ÿ</li>
</ol>
<p>æŠŠ checkPermission ç›´æ¥æŒ‚è½½åˆ° Vue.prototype åŸå‹ä¸Šï¼Œæ‰€æœ‰çš„ç»„ä»¶ä¸­éƒ½å¯ä»¥é€šè¿‡ this è®¿é—®åˆ°ã€‚</p>
<h3 id="mixins-é¢è¯•é¢˜"><a href="#mixins-é¢è¯•é¢˜" class="headerlink" title="mixins é¢è¯•é¢˜"></a>mixins é¢è¯•é¢˜</h3><p>æ··å…¥è¿‡æ¥çš„å†…å®¹ï¼Œæ‰§è¡Œé¡ºåºæ˜¯æ€ä¹ˆæ ·çš„ï¼Ÿ</p>
<ul>
<li><p>  ç”Ÿå‘½å‘¨æœŸï¼šå¦‚æœé…ç½®äº†ç›¸åŒçš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼Œå…ˆæ‰§è¡Œæ··å…¥çš„ï¼Œå†æ‰§è¡Œç»„ä»¶è‡ªèº«çš„ã€‚</p>
</li>
<li><p>  data å’Œ methodsï¼šç›¸åŒçš„ä¼šè¦†ç›–ï¼Œç»„ä»¶å†…çš„ä¼šè¦†ç›– mixin ä¸­çš„ã€‚</p>
</li>
</ul>
<p>mixins çš„ç¼ºç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ</p>
<p>å‘½åå†²çªï¼›æ•°æ®æ¥æºä¸æ¸…æ™°ã€‚</p>

    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2022/08/13/rz-base-course07/" rel="prev" title="07_äººèµ„åå°">
      <i class="fa fa-chevron-left"></i> 07_äººèµ„åå°
    </a></div>
      <div class="post-nav-item">
    <a href="/2022/08/13/rz-base-course09/" rel="next" title="09_äººèµ„åå°">
      09_äººèµ„åå° <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9D%83%E9%99%90%E8%AE%BE%E8%AE%A1%E7%9A%84%E6%80%9D%E6%83%B3"><span class="nav-number">1.</span> <span class="nav-text">æƒé™è®¾è®¡çš„æ€æƒ³</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BB%99%E5%91%98%E5%B7%A5%E5%88%86%E9%85%8D%E8%A7%92%E8%89%B2"><span class="nav-number">2.</span> <span class="nav-text">ç»™å‘˜å·¥åˆ†é…è§’è‰²</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9B%AE%E6%A0%87"><span class="nav-number">2.1.</span> <span class="nav-text">ç›®æ ‡</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%B0%E5%BB%BA%E5%88%86%E9%85%8D%E8%A7%92%E8%89%B2%E7%AA%97%E4%BD%93"><span class="nav-number">2.2.</span> <span class="nav-text">æ–°å»ºåˆ†é…è§’è‰²çª—ä½“</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%82%B9%E5%87%BB%E8%A7%92%E8%89%B2%E5%87%BA%E7%8E%B0%E5%BC%B9%E6%A1%86"><span class="nav-number">2.3.</span> <span class="nav-text">ç‚¹å‡»è§’è‰²å‡ºç°å¼¹æ¡†</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E6%89%80%E6%9C%89%E7%9A%84%E8%A7%92%E8%89%B2%E5%88%97%E8%A1%A8"><span class="nav-number">2.4.</span> <span class="nav-text">è·å–æ‰€æœ‰çš„è§’è‰²åˆ—è¡¨</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E7%94%A8%E6%88%B7%E7%9A%84%E5%BD%93%E5%89%8D%E8%A7%92%E8%89%B2"><span class="nav-number">2.5.</span> <span class="nav-text">è·å–ç”¨æˆ·çš„å½“å‰è§’è‰²</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%99%E5%91%98%E5%B7%A5%E5%88%86%E9%85%8D%E8%A7%92%E8%89%B2%E5%8A%9F%E8%83%BD"><span class="nav-number">2.6.</span> <span class="nav-text">ç»™å‘˜å·¥åˆ†é…è§’è‰²åŠŸèƒ½</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9D%83%E9%99%90%E7%82%B9%E7%AE%A1%E7%90%86%E9%A1%B5%E9%9D%A2"><span class="nav-number">3.</span> <span class="nav-text">æƒé™ç‚¹ç®¡ç†é¡µé¢</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9B%AE%E6%A0%87-1"><span class="nav-number">3.1.</span> <span class="nav-text">ç›®æ ‡</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%B0%E5%BB%BA%E6%9D%83%E9%99%90%E7%82%B9%E7%AE%A1%E7%90%86%E9%A1%B5%E9%9D%A2"><span class="nav-number">3.2.</span> <span class="nav-text">æ–°å»ºæƒé™ç‚¹ç®¡ç†é¡µé¢</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E6%9D%83%E9%99%90%E6%95%B0%E6%8D%AE%E5%B9%B6%E6%B8%B2%E6%9F%93"><span class="nav-number">3.3.</span> <span class="nav-text">è·å–æƒé™æ•°æ®å¹¶æ¸²æŸ“</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E8%BD%AC%E6%88%90%E6%A0%91%E5%BD%A2%E5%B9%B6%E6%B8%B2%E6%9F%93"><span class="nav-number">3.4.</span> <span class="nav-text">æ•°æ®è½¬æˆæ ‘å½¢å¹¶æ¸²æŸ“</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%B0%E5%A2%9E%E6%9D%83%E9%99%90"><span class="nav-number">3.5.</span> <span class="nav-text">æ–°å¢æƒé™</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%96%E8%BE%91%E6%9D%83%E9%99%90"><span class="nav-number">3.6.</span> <span class="nav-text">ç¼–è¾‘æƒé™</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%A0%E9%99%A4%E6%9D%83%E9%99%90"><span class="nav-number">3.7.</span> <span class="nav-text">åˆ é™¤æƒé™</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BB%99%E8%A7%92%E8%89%B2%E5%88%86%E9%85%8D%E6%9D%83%E9%99%90"><span class="nav-number">4.</span> <span class="nav-text">ç»™è§’è‰²åˆ†é…æƒé™</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9B%AE%E6%A0%87-2"><span class="nav-number">4.1.</span> <span class="nav-text">ç›®æ ‡</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%86%85%E5%AE%B9"><span class="nav-number">4.2.</span> <span class="nav-text">å†…å®¹</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%89%8D%E7%AB%AF%E6%9D%83%E9%99%90%E7%9A%84%E5%BA%94%E7%94%A8"><span class="nav-number">5.</span> <span class="nav-text">å‰ç«¯æƒé™çš„åº”ç”¨</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9B%AE%E6%A0%87-3"><span class="nav-number">5.1.</span> <span class="nav-text">ç›®æ ‡</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9D%83%E9%99%90%E5%8F%97%E6%8E%A7%E7%9A%84%E4%B8%BB%E4%BD%93%E6%80%9D%E8%B7%AF"><span class="nav-number">5.2.</span> <span class="nav-text">æƒé™å—æ§çš„ä¸»ä½“æ€è·¯</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#addRoutes"><span class="nav-number">5.3.</span> <span class="nav-text">addRoutes</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#404-%E9%97%AE%E9%A2%98"><span class="nav-number">5.4.</span> <span class="nav-text">404 é—®é¢˜</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%99%BD%E5%B1%8F%E9%97%AE%E9%A2%98"><span class="nav-number">5.5.</span> <span class="nav-text">ç™½å±é—®é¢˜</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AD%9B%E9%80%89%E8%B7%AF%E7%94%B1"><span class="nav-number">5.6.</span> <span class="nav-text">ç­›é€‰è·¯ç”±</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BE%A7%E8%BE%B9%E6%A0%8F%E9%97%AE%E9%A2%98"><span class="nav-number">5.7.</span> <span class="nav-text">ä¾§è¾¹æ é—®é¢˜</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%80%80%E5%87%BA%E6%97%B6%E9%87%8D%E7%BD%AE%E8%B7%AF%E7%94%B1"><span class="nav-number">6.</span> <span class="nav-text">é€€å‡ºæ—¶é‡ç½®è·¯ç”±</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9B%AE%E6%A0%87-4"><span class="nav-number">6.1.</span> <span class="nav-text">ç›®æ ‡</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%86%85%E5%AE%B9-1"><span class="nav-number">6.2.</span> <span class="nav-text">å†…å®¹</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8A%9F%E8%83%BD%E6%9D%83%E9%99%90%E5%BA%94%E7%94%A8"><span class="nav-number">7.</span> <span class="nav-text">åŠŸèƒ½æƒé™åº”ç”¨</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8A%9F%E8%83%BD%E6%9D%83%E9%99%90%E7%9A%84%E5%8F%97%E6%8E%A7%E6%80%9D%E8%B7%AF"><span class="nav-number">7.1.</span> <span class="nav-text">åŠŸèƒ½æƒé™çš„å—æ§æ€è·¯</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#methods-%E4%B8%AD%E5%B0%81%E8%A3%85%E6%96%B9%E6%B3%95"><span class="nav-number">7.2.</span> <span class="nav-text">methods ä¸­å°è£…æ–¹æ³•</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8-mixins-%E6%8A%80%E6%9C%AF"><span class="nav-number">7.3.</span> <span class="nav-text">å¦‚ä½•ä½¿ç”¨ mixins æŠ€æœ¯</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#mixins-%E9%9D%A2%E8%AF%95%E9%A2%98"><span class="nav-number">7.4.</span> <span class="nav-text">mixins é¢è¯•é¢˜</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Ifer"
      src="/images/49337922.png">
  <p class="site-author-name" itemprop="name">Ifer</p>
  <div class="site-description" itemprop="description">React å…¨å®¶æ¡¶ <span style='position:relative;top:-2px;'>âœ</span></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">99</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://www.bilibili.com/video/BV1iW4y1k7Ci?spm_id_from=333.337.search-card.all.click" title="ğŸ˜š â†’ https:&#x2F;&#x2F;www.bilibili.com&#x2F;video&#x2F;BV1iW4y1k7Ci?spm_id_from&#x3D;333.337.search-card.all.click" rel="noopener" target="_blank"><i class="a fa-fw"></i>ğŸ˜š</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.zhihu.com/people/weixiantx" title="ğŸ˜™ â†’ https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;weixiantx" rel="noopener" target="_blank"><i class="a fa-fw"></i>ğŸ˜™</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Ifer</span>
</div>
  <div class="powered-by">ç”± <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> å¼ºåŠ›é©±åŠ¨
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
