<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.ico">
  <link rel="mask-icon" href="/images/favicon.ico" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"mac"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="今日目标✔ 频道管理。">
<meta property="og:type" content="article">
<meta property="og:title" content="19_极客园 H5">
<meta property="og:url" content="http://example.com/2022/01/07/react-base-course19/index.html">
<meta property="og:site_name" content="危险">
<meta property="og:description" content="今日目标✔ 频道管理。">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2022-01-07T14:05:48.000Z">
<meta property="article:modified_time" content="2022-01-11T13:23:24.656Z">
<meta property="article:author" content="Ifer">
<meta property="article:tag" content="React,Redux,Mobx,Saga,Dva,Umi,AntD,TS">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/2022/01/07/react-base-course19/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>19_极客园 H5 | 危险</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">危险</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">为之则易，不为则难</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/01/07/react-base-course19/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/49337922.png">
      <meta itemprop="name" content="Ifer">
      <meta itemprop="description" content="React 全家桶 <span style='position:relative;top:-2px;'>✍</span>">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="危险">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          19_极客园 H5
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-01-07 22:05:48" itemprop="dateCreated datePublished" datetime="2022-01-07T22:05:48+08:00">2022-01-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-01-11 21:23:24" itemprop="dateModified" datetime="2022-01-11T21:23:24+08:00">2022-01-11</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="今日目标"><a href="#今日目标" class="headerlink" title="今日目标"></a>今日目标</h2><p>✔ 频道管理。</p>
<span id="more"></span>

<h2 id="页面结构"><a href="#页面结构" class="headerlink" title="页面结构"></a>页面结构</h2><h3 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h3><p>能够根据模板搭建首页页面结构。</p>
<h3 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h3><p><code>pages/Home/index.tsx</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Icon <span class="keyword">from</span> <span class="string">&#x27;@/components/Icon&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&#x27;./index.module.scss&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Home = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;styles.root&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">            &#123;/* 频道 Tabs 列表 */&#125;</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;tabs-opration&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Icon</span> <span class="attr">type</span>=<span class="string">&#x27;iconbtn_search&#x27;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Icon</span> <span class="attr">type</span>=<span class="string">&#x27;iconbtn_channel&#x27;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Home</span><br></pre></td></tr></table></figure>

<p><code>pages/Home/index.module.scss</code></p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.root</span> &#123;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line"></span><br><span class="line">    :global &#123;</span><br><span class="line">        .tabs &#123;</span><br><span class="line">            height: <span class="number">100%</span>;</span><br><span class="line">            <span class="attribute">padding</span>: <span class="number">44px</span> <span class="number">0</span> <span class="number">50px</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">            <span class="selector-class">.adm-tabs-header</span> &#123;</span><br><span class="line">                <span class="attribute">position</span>: fixed;</span><br><span class="line">                <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">                <span class="attribute">z-index</span>: <span class="number">2</span>;</span><br><span class="line">                <span class="attribute">height</span>: <span class="number">44px</span>;</span><br><span class="line">                <span class="attribute">width</span>: calc(<span class="number">100vw</span> - <span class="number">86px</span>);</span><br><span class="line">                <span class="attribute">background-color</span>: <span class="number">#fff</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="selector-class">.adm-tabs-tab</span> &#123;</span><br><span class="line">                <span class="attribute">line-height</span>: <span class="number">25px</span>;</span><br><span class="line">                <span class="attribute">color</span>: <span class="number">#9ea1ae</span>;</span><br><span class="line">                <span class="attribute">font-size</span>: <span class="number">15px</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="selector-class">.adm-tabs-tab-active</span> &#123;</span><br><span class="line">                <span class="attribute">color</span>: var(--adm-color-text);</span><br><span class="line">                <span class="attribute">font-size</span>: <span class="number">18px</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="selector-class">.adm-tabs-tab-line</span> &#123;</span><br><span class="line">                <span class="attribute">height</span>: <span class="number">3px</span>;</span><br><span class="line">                <span class="attribute">border-radius</span>: <span class="number">2px</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="selector-class">.adm-tabs-content</span> &#123;</span><br><span class="line">                <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">                <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="selector-class">.tabs-opration</span> &#123;</span><br><span class="line">            <span class="attribute">position</span>: absolute;</span><br><span class="line">            <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">            <span class="attribute">right</span>: <span class="number">0</span>;</span><br><span class="line">            <span class="attribute">z-index</span>: <span class="number">2</span>;</span><br><span class="line">            <span class="attribute">display</span>: flex;</span><br><span class="line">            <span class="attribute">align-items</span>: center;</span><br><span class="line">            <span class="attribute">width</span>: <span class="number">86px</span>;</span><br><span class="line">            <span class="attribute">height</span>: <span class="number">44px</span>;</span><br><span class="line">            <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">14px</span>;</span><br><span class="line">            <span class="attribute">background</span>: <span class="number">#fff</span>;</span><br><span class="line">            <span class="attribute">border-bottom</span>: <span class="number">1px</span> solid <span class="number">#efefef</span>;</span><br><span class="line"></span><br><span class="line">            <span class="selector-class">.icon</span> &#123;</span><br><span class="line">                <span class="attribute">color</span>: <span class="number">#9ea1ae</span>;</span><br><span class="line">                <span class="attribute">font-size</span>: <span class="number">18px</span>;</span><br><span class="line"></span><br><span class="line">                &amp;<span class="selector-pseudo">:first</span>-child &#123;</span><br><span class="line">                    <span class="attribute">margin-right</span>: <span class="number">21px</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">:global &#123;</span><br><span class="line">    .channel-popup &#123;</span><br><span class="line">        .adm-popup-body &#123;</span><br><span class="line">            overflow-y: scroll;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="使用-Tabs-组件"><a href="#使用-Tabs-组件" class="headerlink" title="使用 Tabs 组件"></a>使用 Tabs 组件</h2><h3 id="目标-1"><a href="#目标-1" class="headerlink" title="目标"></a>目标</h3><p>能够掌握 antd-mobile 组件中 Tabs 组件的使用。</p>
<h3 id="步骤-1"><a href="#步骤-1" class="headerlink" title="步骤"></a>步骤</h3><ol>
<li><p>打开 antd-mobile 组件库的文档，找到 Tabs 组件。</p>
</li>
<li><p>找到示例代码，并拷贝到项目中。</p>
</li>
<li><p>分析 Tabs 组件的结构和基本使用。</p>
</li>
<li><p>调整 Tabs 的样式。</p>
</li>
</ol>
<p><strong>核心代码</strong>：</p>
<p><code>pages/Home/index.tsx</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Icon <span class="keyword">from</span> <span class="string">&#x27;@/components/Icon&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; Tabs &#125; <span class="keyword">from</span> <span class="string">&#x27;antd-mobile&#x27;</span></span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&#x27;./index.module.scss&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Home = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;styles.root&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Tabs</span> <span class="attr">className</span>=<span class="string">&#x27;tabs&#x27;</span> <span class="attr">activeLineMode</span>=<span class="string">&#x27;fixed&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Tabs.Tab</span> <span class="attr">title</span>=<span class="string">&#x27;推荐&#x27;</span> <span class="attr">key</span>=<span class="string">&#x27;1&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    推荐频道的内容</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">Tabs.Tab</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Tabs.Tab</span> <span class="attr">title</span>=<span class="string">&#x27;html&#x27;</span> <span class="attr">key</span>=<span class="string">&#x27;2&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    html频道的内容</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">Tabs.Tab</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Tabs.Tab</span> <span class="attr">title</span>=<span class="string">&#x27;开发者资讯&#x27;</span> <span class="attr">key</span>=<span class="string">&#x27;3&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    开发者资讯频道的内容</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">Tabs.Tab</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Tabs.Tab</span> <span class="attr">title</span>=<span class="string">&#x27;c++&#x27;</span> <span class="attr">key</span>=<span class="string">&#x27;4&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    c++频道的内容</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">Tabs.Tab</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Tabs.Tab</span> <span class="attr">title</span>=<span class="string">&#x27;css&#x27;</span> <span class="attr">key</span>=<span class="string">&#x27;5&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    css频道的内容</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">Tabs.Tab</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">Tabs</span>&gt;</span></span></span><br><span class="line"><span class="xml">            &#123;/* 频道 Tabs 列表 */&#125;</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;tabs-opration&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Icon</span> <span class="attr">type</span>=<span class="string">&#x27;iconbtn_search&#x27;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Icon</span> <span class="attr">type</span>=<span class="string">&#x27;iconbtn_channel&#x27;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Home</span><br></pre></td></tr></table></figure>

<h2 id="获取频道列表数据"><a href="#获取频道列表数据" class="headerlink" title="获取频道列表数据"></a>获取频道列表数据</h2><h3 id="目标-2"><a href="#目标-2" class="headerlink" title="目标"></a>目标</h3><p>能够获取到首页的频道列表数据。</p>
<h3 id="步骤-2"><a href="#步骤-2" class="headerlink" title="步骤"></a>步骤</h3><p><code>types/data.d.ts</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> Channel = &#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="built_in">number</span></span><br><span class="line">    <span class="attr">name</span>: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>actions/home.ts</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ApiResponse, Channel &#125; <span class="keyword">from</span> <span class="string">&#x27;@/types/data&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; RootThunkAction &#125; <span class="keyword">from</span> <span class="string">&#x27;@/types/store&#x27;</span></span><br><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getUserChannel = (): <span class="function"><span class="params">RootThunkAction</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">async</span> (dispatch, getState) =&gt; &#123;</span><br><span class="line">        <span class="keyword">const</span> res = <span class="keyword">await</span> request.get&lt;ApiResponse&lt;&#123; <span class="attr">channels</span>: Channel[] &#125;&gt;&gt;(<span class="string">&#x27;/user/channels&#x27;</span>)</span><br><span class="line">        <span class="keyword">const</span> &#123; channels &#125; = res.data.data</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;频道&#x27;</span>, channels)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>pages/Home/index.tsx</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 测试测试请求发了没，实际应该拿 &#x27;home&#x27; 的数据</span></span><br><span class="line">useInitState(getUserChannel, <span class="string">&#x27;profile&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="获取频道列表数据-存储与渲染"><a href="#获取频道列表数据-存储与渲染" class="headerlink" title="获取频道列表数据-存储与渲染"></a>获取频道列表数据-存储与渲染</h2><p><code>types/store.d.ts</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; Channel &#125; <span class="keyword">from</span> <span class="string">&#x27;./data&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> HomeAction = &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;home/saveUserChannels&#x27;</span></span><br><span class="line">    <span class="attr">payload</span>: Channel[]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> RootAction = LoginAction | ProfileAction | HomeAction</span><br></pre></td></tr></table></figure>

<p><code>actions/home.ts</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">getUserChannel</span>(<span class="params"></span>): <span class="title">RootThunkAction</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">async</span> (dispatch) =&gt; &#123;</span><br><span class="line">        <span class="keyword">const</span> res = <span class="keyword">await</span> request.get&lt;ApiResponse&lt;&#123; <span class="attr">channels</span>: Channel[] &#125;&gt;&gt;(<span class="string">&#x27;/user/channels&#x27;</span>)</span><br><span class="line">        dispatch(&#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;home/saveUserChannels&#x27;</span>,</span><br><span class="line">            <span class="attr">payload</span>: res.data.data.channels,</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>reducers/home.ts</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Channel &#125; <span class="keyword">from</span> <span class="string">&#x27;@/types/data&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; HomeAction &#125; <span class="keyword">from</span> <span class="string">&#x27;@/types/store&#x27;</span></span><br><span class="line"><span class="keyword">type</span> HomeType = &#123;</span><br><span class="line">    <span class="attr">userChannels</span>: Channel[]</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> initValue: HomeType = &#123;</span><br><span class="line">    <span class="attr">userChannels</span>: [],</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">home</span>(<span class="params">state = initValue, action: HomeAction</span>): <span class="title">HomeType</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (action.type === <span class="string">&#x27;home/saveUserChannels&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            ...state,</span><br><span class="line">            <span class="attr">userChannels</span>: action.payload,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> state</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>reducers/index.ts</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> home <span class="keyword">from</span> <span class="string">&#x27;./home&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> combineReducers(&#123; login, profile, home &#125;)</span><br></pre></td></tr></table></figure>

<p>渲染频道数据，在组件 Home/index.tsx 中</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Icon <span class="keyword">from</span> <span class="string">&#x27;@/components/Icon&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; getUserChannel &#125; <span class="keyword">from</span> <span class="string">&#x27;@/store/actions/home&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useInitState &#125; <span class="keyword">from</span> <span class="string">&#x27;@/utils/hooks&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; Tabs &#125; <span class="keyword">from</span> <span class="string">&#x27;antd-mobile&#x27;</span></span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&#x27;./index.module.scss&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Home = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; userChannels &#125; = useInitState(getUserChannel, <span class="string">&#x27;home&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;styles.root&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Tabs</span> <span class="attr">className</span>=<span class="string">&#x27;tabs&#x27;</span> <span class="attr">activeLineMode</span>=<span class="string">&#x27;fixed&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                &#123;userChannels.map((item) =&gt; (</span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">Tabs.Tab</span> <span class="attr">title</span>=<span class="string">&#123;item.name&#125;</span> <span class="attr">key</span>=<span class="string">&#123;item.id&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        &#123;item.name&#125;的内容</span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">Tabs.Tab</span>&gt;</span></span></span><br><span class="line"><span class="xml">                ))&#125;</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">Tabs</span>&gt;</span></span></span><br><span class="line"><span class="xml">            &#123;/* 频道 Tabs 列表 */&#125;</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;tabs-opration&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Icon</span> <span class="attr">type</span>=<span class="string">&#x27;iconbtn_search&#x27;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Icon</span> <span class="attr">type</span>=<span class="string">&#x27;iconbtn_channel&#x27;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Home</span><br></pre></td></tr></table></figure>

<p>解决初始高亮 Tab 的位置问题</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    userChannels.length &gt; <span class="number">0</span> &amp;&amp; (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">Tabs</span> <span class="attr">className</span>=<span class="string">&#x27;tabs&#x27;</span> <span class="attr">activeLineMode</span>=<span class="string">&#x27;fixed&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">            &#123;userChannels.map((item) =&gt; (</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Tabs.Tab</span> <span class="attr">title</span>=<span class="string">&#123;item.name&#125;</span> <span class="attr">key</span>=<span class="string">&#123;item.id&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    &#123;item.name&#125;的内容</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">Tabs.Tab</span>&gt;</span></span></span><br><span class="line"><span class="xml">            ))&#125;</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">Tabs</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="频道管理-控制弹层显示隐藏"><a href="#频道管理-控制弹层显示隐藏" class="headerlink" title="频道管理-控制弹层显示隐藏"></a>频道管理-控制弹层显示隐藏</h2><h3 id="目标-3"><a href="#目标-3" class="headerlink" title="目标"></a>目标</h3><p>能够渲染频道管理弹出层。</p>
<h3 id="步骤-3"><a href="#步骤-3" class="headerlink" title="步骤"></a>步骤</h3><ol>
<li><p>将模板 Channels 拷贝到 Home/components 目录中。</p>
</li>
<li><p>在 Home 组件中导入 Channels 组件。</p>
</li>
<li><p>使用 Popup 组件渲染 Channels 内容。</p>
</li>
<li><p>创建控制频道管理弹出层展示或隐藏的状态。</p>
</li>
<li><p>控制弹出层的展示或隐藏。</p>
</li>
</ol>
<h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><p><code>Home/index.tsx</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Icon <span class="keyword">from</span> <span class="string">&#x27;@/components/Icon&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; getUserChannel &#125; <span class="keyword">from</span> <span class="string">&#x27;@/store/actions/home&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useInitState &#125; <span class="keyword">from</span> <span class="string">&#x27;@/utils/hooks&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; Tabs, Popup &#125; <span class="keyword">from</span> <span class="string">&#x27;antd-mobile&#x27;</span></span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&#x27;./index.module.scss&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Channels <span class="keyword">from</span> <span class="string">&#x27;./components/Channels&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Home = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> [visible, setVisible] = useState(<span class="literal">false</span>)</span><br><span class="line">    <span class="keyword">const</span> &#123; userChannels &#125; = useInitState(getUserChannel, <span class="string">&#x27;home&#x27;</span>)</span><br><span class="line">    <span class="keyword">const</span> show = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        setVisible(<span class="literal">true</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> hide = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        setVisible(<span class="literal">false</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;styles.root&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">            &#123;userChannels.length &gt; 0 &amp;&amp; (</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Tabs</span> <span class="attr">className</span>=<span class="string">&#x27;tabs&#x27;</span> <span class="attr">activeLineMode</span>=<span class="string">&#x27;fixed&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    &#123;userChannels.map((item) =&gt; (</span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">Tabs.Tab</span> <span class="attr">title</span>=<span class="string">&#123;item.name&#125;</span> <span class="attr">key</span>=<span class="string">&#123;item.id&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                            &#123;item.name&#125;的内容</span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;/<span class="name">Tabs.Tab</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    ))&#125;</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">Tabs</span>&gt;</span></span></span><br><span class="line"><span class="xml">            )&#125;</span></span><br><span class="line"><span class="xml">            &#123;/* 频道 Tabs 列表 */&#125;</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;tabs-opration&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Icon</span> <span class="attr">type</span>=<span class="string">&#x27;iconbtn_search&#x27;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Icon</span> <span class="attr">type</span>=<span class="string">&#x27;iconbtn_channel&#x27;</span> <span class="attr">onClick</span>=<span class="string">&#123;show&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Popup</span> <span class="attr">position</span>=<span class="string">&#x27;left&#x27;</span> <span class="attr">visible</span>=<span class="string">&#123;visible&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Channels</span> <span class="attr">hide</span>=<span class="string">&#123;hide&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">Popup</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Home</span><br></pre></td></tr></table></figure>

<p><code>Home/components/Channels/index.tsx</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Props = &#123;</span><br><span class="line">    <span class="attr">hide</span>: <span class="function">() =&gt;</span> <span class="built_in">void</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Channels = <span class="function">(<span class="params">&#123; hide &#125;: Props</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;styles.root&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;channel-header&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Icon</span> <span class="attr">type</span>=<span class="string">&#x27;iconbtn_channel_close&#x27;</span> <span class="attr">onClick</span>=<span class="string">&#123;hide&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="频道管理-渲染我的频道"><a href="#频道管理-渲染我的频道" class="headerlink" title="频道管理-渲染我的频道"></a>频道管理-渲染我的频道</h2><h3 id="目标-4"><a href="#目标-4" class="headerlink" title="目标"></a>目标</h3><p>能够渲染我的频道列表。</p>
<h3 id="步骤-4"><a href="#步骤-4" class="headerlink" title="步骤"></a>步骤</h3><p>我的频道中展示的数据就是在首页中获取到的用户频道列表数据，因此，只需要在频道管理组件中拿到用户频道列表数据即可</p>
<ol>
<li><p>在 Channels 中，从 redux 中获取到用户频道数据。</p>
</li>
<li><p>渲染用户频道列表数据。</p>
</li>
</ol>
<p><code>Channels/index.tsx</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useSelector &#125; <span class="keyword">from</span> <span class="string">&#x27;react-redux&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; RootState &#125; <span class="keyword">from</span> <span class="string">&#x27;@/types/store&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Channels = <span class="function">(<span class="params">&#123; hide &#125;: Props</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; userChannels &#125; = useSelector(<span class="function">(<span class="params">state: RootState</span>) =&gt;</span> state.home)</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;channel-list&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">            &#123;/* 选中时，添加类名 selected */&#125;</span></span><br><span class="line"><span class="xml">            &#123;userChannels.map((item) =&gt; (</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">key</span>=<span class="string">&#123;item.id&#125;</span> <span class="attr">className</span>=<span class="string">&#123;classnames(</span>&#x27;<span class="attr">channel-list-item</span>&#x27;)&#125;&gt;</span></span></span><br><span class="line"><span class="xml">                    &#123;item.name&#125;</span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">Icon</span> <span class="attr">type</span>=<span class="string">&#x27;iconbtn_tag_close&#x27;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">            ))&#125;</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="频道管理-获取所有频道"><a href="#频道管理-获取所有频道" class="headerlink" title="频道管理-获取所有频道"></a>频道管理-获取所有频道</h2><h3 id="目标-5"><a href="#目标-5" class="headerlink" title="目标"></a>目标</h3><p>能够获取到所有频道的数据。</p>
<h3 id="代码-1"><a href="#代码-1" class="headerlink" title="代码"></a>代码</h3><p>频道推荐中展示的是除了我的频道之外的其他频道数据，由于接口并没有直接提供频道推荐数据，</p>
<p>因此，可以拿到所有频道数据，然后，排除掉我的频道数据，剩下的就是频道推荐数据了。</p>
<p><code>types/store.d.ts</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> HomeAction =</span><br><span class="line">    | &#123;</span><br><span class="line">          <span class="attr">type</span>: <span class="string">&#x27;home/saveUserChannels&#x27;</span></span><br><span class="line">          <span class="attr">payload</span>: Channel[]</span><br><span class="line">      &#125;</span><br><span class="line">    | &#123;</span><br><span class="line">          <span class="attr">type</span>: <span class="string">&#x27;home/saveAllChannels&#x27;</span></span><br><span class="line">          <span class="attr">payload</span>: Channel[]</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure>

<p><code>actions/home.ts</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">getAllChannel</span>(<span class="params"></span>): <span class="title">RootThunkAction</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">async</span> (dispatch) =&gt; &#123;</span><br><span class="line">        <span class="keyword">const</span> res = <span class="keyword">await</span> request.get&lt;ApiResponse&lt;&#123; <span class="attr">channels</span>: Channel[] &#125;&gt;&gt;(<span class="string">&#x27;/channels&#x27;</span>)</span><br><span class="line">        dispatch(&#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;home/saveAllChannels&#x27;</span>,</span><br><span class="line">            <span class="attr">payload</span>: res.data.data.channels,</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>reducers/home.ts</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Channel &#125; <span class="keyword">from</span> <span class="string">&#x27;@/types/data&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; HomeAction &#125; <span class="keyword">from</span> <span class="string">&#x27;@/types/store&#x27;</span></span><br><span class="line"><span class="keyword">type</span> HomeType = &#123;</span><br><span class="line">    <span class="attr">userChannels</span>: Channel[]</span><br><span class="line">    <span class="attr">allChannels</span>: Channel[]</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> initValue: HomeType = &#123;</span><br><span class="line">    <span class="attr">userChannels</span>: [],</span><br><span class="line">    <span class="attr">allChannels</span>: [],</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">home</span>(<span class="params">state = initValue, action: HomeAction</span>): <span class="title">HomeType</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (action.type === <span class="string">&#x27;home/saveUserChannels&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            ...state,</span><br><span class="line">            <span class="attr">userChannels</span>: action.payload,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (action.type === <span class="string">&#x27;home/saveAllChannels&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            ...state,</span><br><span class="line">            <span class="attr">allChannels</span>: action.payload,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> state</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>home/index.tsx</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Home = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    useInitialState(getAllChannel, <span class="string">&#x27;home&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="频道管理-渲染频道推荐"><a href="#频道管理-渲染频道推荐" class="headerlink" title="频道管理-渲染频道推荐"></a>频道管理-渲染频道推荐</h2><h3 id="目标-6"><a href="#目标-6" class="headerlink" title="目标"></a>目标</h3><p>能够渲染频道推荐列表。</p>
<h3 id="代码-2"><a href="#代码-2" class="headerlink" title="代码"></a>代码</h3><p><code>Channels/index.tsx</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Channels = <span class="function">(<span class="params">&#123; hide &#125;: Props</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; userChannels &#125; = useSelector(<span class="function">(<span class="params">state: RootState</span>) =&gt;</span> state.home)</span><br><span class="line">    <span class="keyword">const</span> recommendChannels = useSelector(<span class="function">(<span class="params">state: RootState</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; userChannels, allChannels &#125; = state.home</span><br><span class="line">        <span class="keyword">return</span> allChannels.filter(<span class="function">(<span class="params">item</span>) =&gt;</span> userChannels.findIndex(<span class="function">(<span class="params">v</span>) =&gt;</span> v.id === item.id) === -<span class="number">1</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;channel-list&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">            &#123;recommendChannels.map((item) =&gt; (</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">key</span>=<span class="string">&#123;item.id&#125;</span> <span class="attr">className</span>=<span class="string">&#x27;channel-list-item&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    + &#123;item.name&#125;</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">            ))&#125;</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用 lodash 提供的方法，计算出推荐频道。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add lodash @types/lodash</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> recommendChannels = differenceBy(allChannels, userChannels, <span class="string">&#x27;id&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="获取频道列表数据-逻辑优化"><a href="#获取频道列表数据-逻辑优化" class="headerlink" title="获取频道列表数据-逻辑优化"></a>获取频道列表数据-逻辑优化</h2><h3 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h3><ul>
<li><p>  如果用户登录了，需要发送请求获取用户的频道</p>
</li>
<li><p>  如果用户没有登录，从 localstorage 中获取用户的频道信息</p>
</li>
<li><p>  如果本地没有用户的频道信息，需要发送请求获取默认的频道，把默认频道存储到本地。</p>
</li>
</ul>
<h3 id="代码-3"><a href="#代码-3" class="headerlink" title="代码"></a>代码</h3><p><code>utils/storage.ts</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> CHANNEL_KEY = <span class="string">&#x27;GEEK_H5_CHANNEL&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">setChannels</span>(<span class="params">channels: Channel[]</span>): <span class="title">void</span> </span>&#123;</span><br><span class="line">    <span class="built_in">localStorage</span>.setItem(CHANNEL_KEY, <span class="built_in">JSON</span>.stringify(channels))</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">getChannels</span>(<span class="params"></span>): <span class="title">Channel</span>[] </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">JSON</span>.parse(<span class="built_in">localStorage</span>.getItem(CHANNEL_KEY) || <span class="string">&#x27;[]&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>actions/home.ts</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getUserChannel = (): <span class="function"><span class="params">RootThunkAction</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">async</span> (dispatch) =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (hasToken()) &#123;</span><br><span class="line">            <span class="comment">// !#1 登录了</span></span><br><span class="line">            <span class="keyword">const</span> res = <span class="keyword">await</span> request.get&lt;ApiResponse&lt;&#123; <span class="attr">channels</span>: Channel[] &#125;&gt;&gt;(<span class="string">&#x27;/user/channels&#x27;</span>)</span><br><span class="line">            dispatch(&#123;</span><br><span class="line">                <span class="attr">type</span>: <span class="string">&#x27;home/saveUserChannels&#x27;</span>,</span><br><span class="line">                <span class="attr">payload</span>: res.data.data.channels,</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// !#2 未登录</span></span><br><span class="line">            <span class="keyword">const</span> channels = getChannels()</span><br><span class="line">            <span class="keyword">if</span> (channels.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="comment">// !#3 本地有</span></span><br><span class="line">                dispatch(&#123;</span><br><span class="line">                    <span class="attr">type</span>: <span class="string">&#x27;home/saveUserChannels&#x27;</span>,</span><br><span class="line">                    <span class="attr">payload</span>: channels,</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// !#4 本地无</span></span><br><span class="line">                <span class="keyword">const</span> res = <span class="keyword">await</span> request.get&lt;ApiResponse&lt;&#123; <span class="attr">channels</span>: Channel[] &#125;&gt;&gt;(<span class="string">&#x27;/user/channels&#x27;</span>)</span><br><span class="line">                dispatch(&#123;</span><br><span class="line">                    <span class="attr">type</span>: <span class="string">&#x27;home/saveUserChannels&#x27;</span>,</span><br><span class="line">                    <span class="attr">payload</span>: res.data.data.channels,</span><br><span class="line">                &#125;)</span><br><span class="line">                <span class="comment">// !#5 存储</span></span><br><span class="line">                setChannels(res.data.data.channels)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="频道管理-点击我的频道高亮"><a href="#频道管理-点击我的频道高亮" class="headerlink" title="频道管理-点击我的频道高亮"></a>频道管理-点击我的频道高亮</h2><h3 id="目标-7"><a href="#目标-7" class="headerlink" title="目标"></a>目标</h3><p>能够实现切换频道功能。</p>
<h3 id="分析-1"><a href="#分析-1" class="headerlink" title="分析"></a>分析</h3><p>首页顶部的频道和频道管理中的我的频道是关联在一起的：</p>
<ol>
<li><p>点击频道管理中的我的频道时，首页顶部的频道会切换，并高亮。</p>
</li>
<li><p>点击首页顶部的频道时，频道管理对应的频道也要高亮。</p>
</li>
</ol>
<p>因此，需要准备一个状态用来记录当前选中频道，并且两个组件中都需要用到该状态，所以，可以直接将该状态存储到 redux 中，实现状态共享。</p>
<p>然后，不管是首页顶部的频道还是频道管理中的我的频道，只需要在点击切换时，修改 redux 中记录的状态值即可。</p>
<h3 id="代码-4"><a href="#代码-4" class="headerlink" title="代码"></a>代码</h3><p><code>redcuers/home.ts</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> HomeType = &#123;</span><br><span class="line">    <span class="attr">userChannels</span>: Channel[]</span><br><span class="line">    <span class="attr">allChannels</span>: Channel[]</span><br><span class="line">    <span class="attr">active</span>: <span class="built_in">number</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> initValue: HomeType = &#123;</span><br><span class="line">    <span class="attr">userChannels</span>: [],</span><br><span class="line">    <span class="attr">allChannels</span>: [],</span><br><span class="line">    <span class="attr">active</span>: <span class="number">0</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>types/store.d.ts</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> HomeAction =</span><br><span class="line">    | &#123;</span><br><span class="line">          <span class="attr">type</span>: <span class="string">&#x27;home/saveUserChannels&#x27;</span></span><br><span class="line">          <span class="attr">payload</span>: Channel[]</span><br><span class="line">      &#125;</span><br><span class="line">    | &#123;</span><br><span class="line">          <span class="attr">type</span>: <span class="string">&#x27;home/saveAllChannels&#x27;</span></span><br><span class="line">          <span class="attr">payload</span>: Channel[]</span><br><span class="line">      &#125;</span><br><span class="line">    | &#123;</span><br><span class="line">          <span class="attr">type</span>: <span class="string">&#x27;home/changeActive&#x27;</span></span><br><span class="line">          <span class="attr">payload</span>: <span class="built_in">number</span></span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure>

<p><code>actions/home.ts</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">changeActive</span>(<span class="params">id: <span class="built_in">number</span></span>): <span class="title">HomeAction</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;home/changeActive&#x27;</span>,</span><br><span class="line">        <span class="attr">payload</span>: id,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>reducers/home.ts</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (action.type === <span class="string">&#x27;home/changeActive&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        ...state,</span><br><span class="line">        <span class="attr">active</span>: action.payload,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>pages/Home/components/Channels/index.tsx</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> classnames <span class="keyword">from</span> <span class="string">&#x27;classnames&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useSelector, useDispatch &#125; <span class="keyword">from</span> <span class="string">&#x27;react-redux&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; RootState &#125; <span class="keyword">from</span> <span class="string">&#x27;@/types/store&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Icon <span class="keyword">from</span> <span class="string">&#x27;@/components/Icon&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; differenceBy &#125; <span class="keyword">from</span> <span class="string">&#x27;lodash&#x27;</span></span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&#x27;./index.module.scss&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; changeActive &#125; <span class="keyword">from</span> <span class="string">&#x27;@/store/actions/home&#x27;</span></span><br><span class="line"><span class="keyword">type</span> Props = &#123;</span><br><span class="line">    <span class="attr">hide</span>: <span class="function">() =&gt;</span> <span class="built_in">void</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> Channels = <span class="function">(<span class="params">&#123; hide &#125;: Props</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> dispatch = useDispatch()</span><br><span class="line">    <span class="comment">// !#3 获取 Redux 中的 active 并和循环时候的 item.id 进行比较，命中则应用高亮的 class</span></span><br><span class="line">    <span class="keyword">const</span> &#123; userChannels, allChannels, active &#125; = useSelector(<span class="function">(<span class="params">state: RootState</span>) =&gt;</span> state.home)</span><br><span class="line">    <span class="keyword">const</span> recommendChannels = differenceBy(allChannels, userChannels, <span class="string">&#x27;id&#x27;</span>)</span><br><span class="line">    <span class="comment">// !#2 修改 Redux 中的 active 并隐藏弹框</span></span><br><span class="line">    <span class="keyword">const</span> onChange = <span class="function">(<span class="params">id: <span class="built_in">number</span></span>) =&gt;</span> &#123;</span><br><span class="line">        dispatch(changeActive(id))</span><br><span class="line">        hide()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;styles.root&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;channel-header&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Icon</span> <span class="attr">type</span>=<span class="string">&#x27;iconbtn_channel_close&#x27;</span> <span class="attr">onClick</span>=<span class="string">&#123;hide&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;channel-content&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                &#123;/* 编辑时，添加类名 edit */&#125;</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;classnames(</span>&#x27;<span class="attr">channel-item</span>&#x27;)&#125;&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;channel-item-header&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">span</span> <span class="attr">className</span>=<span class="string">&#x27;channel-item-title&#x27;</span>&gt;</span>我的频道<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">span</span> <span class="attr">className</span>=<span class="string">&#x27;channel-item-title-extra&#x27;</span>&gt;</span>点击进入频道<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">span</span> <span class="attr">className</span>=<span class="string">&#x27;channel-item-edit&#x27;</span>&gt;</span>编辑<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;channel-list&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        &#123;/* //!#1 绑定点击事件 */&#125;</span></span><br><span class="line"><span class="xml">                        &#123;userChannels.map((item) =&gt; (</span></span><br><span class="line"><span class="xml">                            <span class="tag">&lt;<span class="name">span</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                                <span class="attr">key</span>=<span class="string">&#123;item.id&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                                <span class="attr">className</span>=<span class="string">&#123;classnames(</span>&#x27;<span class="attr">channel-list-item</span>&#x27;, &#123;</span></span></span><br><span class="line"><span class="tag"><span class="xml">                                    <span class="attr">selected:</span> <span class="attr">item.id</span> === <span class="string">active,</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                                &#125;)&#125;</span></span></span><br><span class="line"><span class="tag"><span class="xml">                                <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> onChange(item.id)&#125;</span></span><br><span class="line"><span class="xml">                            &gt;</span></span><br><span class="line"><span class="xml">                                &#123;item.name&#125;</span></span><br><span class="line"><span class="xml">                                <span class="tag">&lt;<span class="name">Icon</span> <span class="attr">type</span>=<span class="string">&#x27;iconbtn_tag_close&#x27;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                            <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        ))&#125;</span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;channel-item&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;channel-item-header&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">span</span> <span class="attr">className</span>=<span class="string">&#x27;channel-item-title&#x27;</span>&gt;</span>频道推荐<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">span</span> <span class="attr">className</span>=<span class="string">&#x27;channel-item-title-extra&#x27;</span>&gt;</span>点击添加频道<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;channel-list&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        &#123;recommendChannels.map((item) =&gt; (</span></span><br><span class="line"><span class="xml">                            <span class="tag">&lt;<span class="name">span</span> <span class="attr">key</span>=<span class="string">&#123;item.id&#125;</span> <span class="attr">className</span>=<span class="string">&#x27;channel-list-item&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                                + &#123;item.name&#125;</span></span><br><span class="line"><span class="xml">                            <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        ))&#125;</span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Channels</span><br></pre></td></tr></table></figure>

<h2 id="频道管理-处理-Tabs-的高亮"><a href="#频道管理-处理-Tabs-的高亮" class="headerlink" title="频道管理-处理 Tabs 的高亮"></a>频道管理-处理 Tabs 的高亮</h2><h3 id="目标-8"><a href="#目标-8" class="headerlink" title="目标"></a>目标</h3><p>能够实现首页频道切换和高亮功能。</p>
<h3 id="步骤-5"><a href="#步骤-5" class="headerlink" title="步骤"></a>步骤</h3><ol>
<li><p>在 Home 组件中拿到该状态，并设置为 Tabs 组件的 activeKey。</p>
</li>
<li><p>为 Tabs 组件添加 onChange，拿到当前选中的 tab 的键，并且分发 action 来修改 channelActiveKey。</p>
</li>
</ol>
<h3 id="核心代码"><a href="#核心代码" class="headerlink" title="核心代码"></a>核心代码</h3><p><code>Home/index.tsx</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useDispatch &#125; <span class="keyword">from</span> <span class="string">&#x27;react-redux&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Icon <span class="keyword">from</span> <span class="string">&#x27;@/components/Icon&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; changeActive, getAllChannel, getUserChannel &#125; <span class="keyword">from</span> <span class="string">&#x27;@/store/actions/home&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useInitState &#125; <span class="keyword">from</span> <span class="string">&#x27;@/utils/hooks&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; Tabs, Popup &#125; <span class="keyword">from</span> <span class="string">&#x27;antd-mobile&#x27;</span></span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&#x27;./index.module.scss&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Channels <span class="keyword">from</span> <span class="string">&#x27;./components/Channels&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Home = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> dispatch = useDispatch()</span><br><span class="line">    <span class="keyword">const</span> [visible, setVisible] = useState(<span class="literal">false</span>)</span><br><span class="line">    <span class="keyword">const</span> &#123; userChannels, active &#125; = useInitState(getUserChannel, <span class="string">&#x27;home&#x27;</span>)</span><br><span class="line">    useInitState(getAllChannel, <span class="string">&#x27;home&#x27;</span>)</span><br><span class="line">    <span class="keyword">const</span> show = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        setVisible(<span class="literal">true</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> hide = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        setVisible(<span class="literal">false</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// !#2</span></span><br><span class="line">    <span class="keyword">const</span> onChange = <span class="function">(<span class="params">key: <span class="built_in">string</span></span>) =&gt;</span> &#123;</span><br><span class="line">        dispatch(changeActive(+key))</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;styles.root&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">            &#123;/* //!#1 */&#125;</span></span><br><span class="line"><span class="xml">            &#123;userChannels.length &gt; 0 &amp;&amp; (</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Tabs</span> <span class="attr">className</span>=<span class="string">&#x27;tabs&#x27;</span> <span class="attr">activeLineMode</span>=<span class="string">&#x27;fixed&#x27;</span> <span class="attr">activeKey</span>=<span class="string">&#123;active</span> + &#x27;&#x27;&#125; <span class="attr">onChange</span>=<span class="string">&#123;onChange&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    &#123;userChannels.map((item) =&gt; (</span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">Tabs.Tab</span> <span class="attr">title</span>=<span class="string">&#123;item.name&#125;</span> <span class="attr">key</span>=<span class="string">&#123;item.id&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                            &#123;item.name&#125;的内容</span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;/<span class="name">Tabs.Tab</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    ))&#125;</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">Tabs</span>&gt;</span></span></span><br><span class="line"><span class="xml">            )&#125;</span></span><br><span class="line"><span class="xml">            &#123;/* 频道 Tabs 列表 */&#125;</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;tabs-opration&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Icon</span> <span class="attr">type</span>=<span class="string">&#x27;iconbtn_search&#x27;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Icon</span> <span class="attr">type</span>=<span class="string">&#x27;iconbtn_channel&#x27;</span> <span class="attr">onClick</span>=<span class="string">&#123;show&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Popup</span> <span class="attr">position</span>=<span class="string">&#x27;left&#x27;</span> <span class="attr">visible</span>=<span class="string">&#123;visible&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Channels</span> <span class="attr">hide</span>=<span class="string">&#123;hide&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">Popup</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Home</span><br></pre></td></tr></table></figure>

<h2 id="频道管理-编辑状态的处理"><a href="#频道管理-编辑状态的处理" class="headerlink" title="频道管理-编辑状态的处理"></a>频道管理-编辑状态的处理</h2><h3 id="目标-9"><a href="#目标-9" class="headerlink" title="目标"></a>目标</h3><p>能够切换频道编辑状态。</p>
<h3 id="步骤-6"><a href="#步骤-6" class="headerlink" title="步骤"></a>步骤</h3><ol>
<li><p>添加控制是否为编辑的状态。</p>
</li>
<li><p>给编辑/保存按钮添加点击事件。</p>
</li>
<li><p>在点击事件中切换编辑状态。</p>
</li>
<li><p>根据编辑状态判断展示保存或编辑文字内容。</p>
</li>
</ol>
<h3 id="代码-5"><a href="#代码-5" class="headerlink" title="代码"></a>代码</h3><p><code>pages/Home/components/Channels/index.tsx</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> classnames <span class="keyword">from</span> <span class="string">&#x27;classnames&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useSelector, useDispatch &#125; <span class="keyword">from</span> <span class="string">&#x27;react-redux&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; RootState &#125; <span class="keyword">from</span> <span class="string">&#x27;@/types/store&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Icon <span class="keyword">from</span> <span class="string">&#x27;@/components/Icon&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; differenceBy &#125; <span class="keyword">from</span> <span class="string">&#x27;lodash&#x27;</span></span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&#x27;./index.module.scss&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; changeActive &#125; <span class="keyword">from</span> <span class="string">&#x27;@/store/actions/home&#x27;</span></span><br><span class="line"><span class="keyword">type</span> Props = &#123;</span><br><span class="line">    <span class="attr">hide</span>: <span class="function">() =&gt;</span> <span class="built_in">void</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> Channels = <span class="function">(<span class="params">&#123; hide &#125;: Props</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> dispatch = useDispatch()</span><br><span class="line">    <span class="comment">// !#1</span></span><br><span class="line">    <span class="keyword">const</span> [isEdit, setIsEdit] = useState(<span class="literal">false</span>)</span><br><span class="line">    <span class="keyword">const</span> &#123; userChannels, allChannels, active &#125; = useSelector(<span class="function">(<span class="params">state: RootState</span>) =&gt;</span> state.home)</span><br><span class="line">    <span class="keyword">const</span> recommendChannels = differenceBy(allChannels, userChannels, <span class="string">&#x27;id&#x27;</span>)</span><br><span class="line">    <span class="keyword">const</span> onChange = <span class="function">(<span class="params">id: <span class="built_in">number</span></span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// !#6 编辑状态不允许切换</span></span><br><span class="line">        <span class="keyword">if</span> (isEdit) <span class="keyword">return</span></span><br><span class="line">        dispatch(changeActive(id))</span><br><span class="line">        hide()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// !#4</span></span><br><span class="line">    <span class="keyword">const</span> changeEdit = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        setIsEdit(!isEdit)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;styles.root&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;channel-header&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Icon</span> <span class="attr">type</span>=<span class="string">&#x27;iconbtn_channel_close&#x27;</span> <span class="attr">onClick</span>=<span class="string">&#123;hide&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;channel-content&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                &#123;/* //!#2 编辑时，添加类名 edit */&#125;</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;classnames(</span>&#x27;<span class="attr">channel-item</span>&#x27;, <span class="attr">isEdit</span> &amp;&amp; &#x27;<span class="attr">edit</span>&#x27;)&#125;&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;channel-item-header&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">span</span> <span class="attr">className</span>=<span class="string">&#x27;channel-item-title&#x27;</span>&gt;</span>我的频道<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        &#123;/* //!#5 */&#125;</span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">span</span> <span class="attr">className</span>=<span class="string">&#x27;channel-item-title-extra&#x27;</span>&gt;</span>&#123;isEdit ? &#x27;点击删除频道&#x27; : &#x27;点击进入频道&#x27;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        &#123;/* //!#3 */&#125;</span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">span</span> <span class="attr">className</span>=<span class="string">&#x27;channel-item-edit&#x27;</span> <span class="attr">onClick</span>=<span class="string">&#123;changeEdit&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                            &#123;isEdit ? &#x27;完成&#x27; : &#x27;编辑&#x27;&#125;</span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;channel-list&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        &#123;userChannels.map((item) =&gt; (</span></span><br><span class="line"><span class="xml">                            <span class="tag">&lt;<span class="name">span</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                                <span class="attr">key</span>=<span class="string">&#123;item.id&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                                <span class="attr">className</span>=<span class="string">&#123;classnames(</span>&#x27;<span class="attr">channel-list-item</span>&#x27;, &#123;</span></span></span><br><span class="line"><span class="tag"><span class="xml">                                    <span class="attr">selected:</span> <span class="attr">item.id</span> === <span class="string">active,</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                                &#125;)&#125;</span></span></span><br><span class="line"><span class="tag"><span class="xml">                                <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> onChange(item.id)&#125;</span></span><br><span class="line"><span class="xml">                            &gt;</span></span><br><span class="line"><span class="xml">                                &#123;item.name&#125;</span></span><br><span class="line"><span class="xml">                                <span class="tag">&lt;<span class="name">Icon</span> <span class="attr">type</span>=<span class="string">&#x27;iconbtn_tag_close&#x27;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                            <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        ))&#125;</span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;channel-item&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;channel-item-header&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">span</span> <span class="attr">className</span>=<span class="string">&#x27;channel-item-title&#x27;</span>&gt;</span>频道推荐<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">span</span> <span class="attr">className</span>=<span class="string">&#x27;channel-item-title-extra&#x27;</span>&gt;</span>点击添加频道<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;channel-list&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        &#123;recommendChannels.map((item) =&gt; (</span></span><br><span class="line"><span class="xml">                            <span class="tag">&lt;<span class="name">span</span> <span class="attr">key</span>=<span class="string">&#123;item.id&#125;</span> <span class="attr">className</span>=<span class="string">&#x27;channel-list-item&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                                + &#123;item.name&#125;</span></span><br><span class="line"><span class="xml">                            <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        ))&#125;</span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Channels</span><br></pre></td></tr></table></figure>

<h2 id="频道管理-删除频道"><a href="#频道管理-删除频道" class="headerlink" title="频道管理-删除频道"></a>频道管理-删除频道</h2><h3 id="目标-10"><a href="#目标-10" class="headerlink" title="目标"></a>目标</h3><p>能够删除我的频道数据。</p>
<h3 id="分析-2"><a href="#分析-2" class="headerlink" title="分析"></a>分析</h3><ol>
<li><p>推荐频道不能删除。</p>
</li>
<li><p>至少要保留 4 个频道。</p>
</li>
</ol>
<h3 id="步骤-7"><a href="#步骤-7" class="headerlink" title="步骤"></a>步骤</h3><ol>
<li><p>修改频道项的点击事件参数为 channel 即当前频道数据。</p>
</li>
<li><p>在我的频道项的点击事件中，判断当前是否为编辑状态。</p>
</li>
<li><p>如果不是编辑状态，执行频道切换操作。</p>
</li>
<li><p>如果是编辑状态，判断是否为推荐频道或频道数量小于等于 4。</p>
</li>
<li><p>如果是，阻止删除。</p>
</li>
<li><p>如果不是，分发删除频道的 action。</p>
</li>
</ol>
<h3 id="代码-6"><a href="#代码-6" class="headerlink" title="代码"></a>代码</h3><p><code>Channels/index.tsx</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Icon <span class="keyword">type</span>=<span class="string">&#x27;iconbtn_tag_close&#x27;</span> onClick=&#123;<span class="function">() =&gt;</span> dispatch(delChannel(item.id))&#125; /&gt;</span><br></pre></td></tr></table></figure>

<p><code>actions/home.ts</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">delChannel</span>(<span class="params">id: <span class="built_in">number</span></span>): <span class="title">RootThunkAction</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">async</span> (dispatch, getState) =&gt; &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; userChannels &#125; = getState().home</span><br><span class="line">        <span class="keyword">if</span> (hasToken()) &#123;</span><br><span class="line">            <span class="comment">// 登录了</span></span><br><span class="line">            <span class="keyword">await</span> request.delete(<span class="string">&#x27;/user/channels&#x27;</span>, &#123;</span><br><span class="line">                <span class="attr">data</span>: &#123;</span><br><span class="line">                    <span class="attr">channels</span>: [id],</span><br><span class="line">                &#125;,</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 没有登录</span></span><br><span class="line">            <span class="comment">// const userChannels = getChannels()</span></span><br><span class="line">            setChannels(userChannels.filter(<span class="function">(<span class="params">item</span>) =&gt;</span> item.id !== id))</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 更新到 Redux</span></span><br><span class="line">        <span class="comment">/* dispatch(&#123;</span></span><br><span class="line"><span class="comment">            type: &#x27;home/saveUserChannels&#x27;,</span></span><br><span class="line"><span class="comment">            payload: userChannels.filter((item) =&gt; item.id !== id),</span></span><br><span class="line"><span class="comment">        &#125;) */</span></span><br><span class="line">        dispatch(getUserChannel())</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="优化"><a href="#优化" class="headerlink" title="优化"></a>优化</h3><p>推荐不能有 x 号，超过 4 条才能删。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;div className=<span class="string">&#x27;channel-list&#x27;</span>&gt;</span><br><span class="line">    &#123;userChannels.map(<span class="function">(<span class="params">item</span>) =&gt;</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">span</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">            <span class="attr">key</span>=<span class="string">&#123;item.id&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">            <span class="attr">className</span>=<span class="string">&#123;classnames(</span>&#x27;<span class="attr">channel-list-item</span>&#x27;, &#123;</span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">selected:</span> <span class="attr">item.id</span> === <span class="string">active,</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">            &#125;)&#125;</span></span></span><br><span class="line"><span class="tag"><span class="xml">            <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> onChange(item.id)&#125;</span></span><br><span class="line"><span class="xml">        &gt;</span></span><br><span class="line"><span class="xml">            &#123;item.name&#125;</span></span><br><span class="line"><span class="xml">            &#123;item.id !== 0 &amp;&amp; (</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Icon</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                    <span class="attr">type</span>=<span class="string">&#x27;iconbtn_tag_close&#x27;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                    <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="xml">                        if (userChannels.length &lt;= 4) return</span></span><br><span class="line"><span class="xml">                        // 删除的是当前的，就回到推荐吧</span></span><br><span class="line"><span class="xml">                        if (item.id === active) dispatch(changeActive(0))</span></span><br><span class="line"><span class="xml">                        dispatch(delChannel(item.id))</span></span><br><span class="line"><span class="xml">                    &#125;&#125;</span></span><br><span class="line"><span class="xml">                /&gt;</span></span><br><span class="line"><span class="xml">            )&#125;</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line">    ))&#125;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<h2 id="频道管理-添加频道"><a href="#频道管理-添加频道" class="headerlink" title="频道管理-添加频道"></a>频道管理-添加频道</h2><h3 id="目标-11"><a href="#目标-11" class="headerlink" title="目标"></a>目标</h3><p>能够实现添加频道功能。</p>
<h3 id="代码-7"><a href="#代码-7" class="headerlink" title="代码"></a>代码</h3><p>在 <code>store/actions/home.ts</code> 中，实现 Action Creator。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> addChannel = (channel: Channel): <span class="function"><span class="params">RootThunkAction</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">async</span> (dispatch, getState) =&gt; &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; userChannels &#125; = getState().home</span><br><span class="line">        <span class="keyword">if</span> (hasToken()) &#123;</span><br><span class="line">            <span class="keyword">await</span> request.patch(<span class="string">&#x27;/user/channels&#x27;</span>, &#123;</span><br><span class="line">                <span class="attr">channels</span>: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="attr">id</span>: channel.id,</span><br><span class="line">                        <span class="attr">seq</span>: userChannels.length + <span class="number">1</span>,</span><br><span class="line">                    &#125;,</span><br><span class="line">                ],</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            setChannels([...userChannels, channel])</span><br><span class="line">        &#125;</span><br><span class="line">        dispatch(&#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;home/saveUserChannels&#x27;</span>,</span><br><span class="line">            <span class="attr">payload</span>: [...userChannels, channel],</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>Channels/index.tsx</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Channels = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> onAddChannel = <span class="function">(<span class="params">channel: Channel</span>) =&gt;</span> &#123;</span><br><span class="line">        dispatch(addChannel(channel))</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;channel-list&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">            &#123;restChannel.map((item) =&gt; (</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> onAddChannel(item)&#125;&gt;+ &#123;item.name&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">            ))&#125;</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="文章列表-基本结构"><a href="#文章列表-基本结构" class="headerlink" title="文章列表-基本结构"></a>文章列表-基本结构</h2><h3 id="目标-12"><a href="#目标-12" class="headerlink" title="目标"></a>目标</h3><p>能够根据模板搭建频道文章列表结构。</p>
<h3 id="步骤-8"><a href="#步骤-8" class="headerlink" title="步骤"></a>步骤</h3><ol>
<li><p>将模板 ArticleList 和 ArticleItem 拷贝到 <code>pages/Home/components</code> 目录中。</p>
</li>
<li><p>在 Home 组件中渲染文章列表结构。</p>
</li>
<li><p>分析每个模板的作用，以及模板的结构。</p>
</li>
</ol>
<h3 id="代码-8"><a href="#代码-8" class="headerlink" title="代码"></a>代码</h3><p><code>Home/index.tsx</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> ArticleList <span class="keyword">from</span> <span class="string">&#x27;./components/ArticleList&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Home = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">Tabs.Tab</span>&gt;</span></span></span><br><span class="line"><span class="xml">            &#123;/* 在每个 Tabs.TabPane 中渲染文章列表组件 */&#125;</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">ArticleList</span> /&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">Tabs.Tab</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="文章列表-获取文章列表数据"><a href="#文章列表-获取文章列表数据" class="headerlink" title="文章列表-获取文章列表数据"></a>文章列表-获取文章列表数据</h2><h3 id="目标-13"><a href="#目标-13" class="headerlink" title="目标"></a>目标</h3><p>能够获取到文章列表数据并且进行渲染。</p>
<h3 id="步骤-9"><a href="#步骤-9" class="headerlink" title="步骤"></a>步骤</h3><ol>
<li><p>分析接口文档，定义频道的数据类型，<code>types/data.d.ts</code> 中。</p>
</li>
<li><p>准备获取文章列表的 action，在 action 中发送请求。</p>
</li>
<li><p>发送请求需要频道 id，父组件将频道 id 传递给 ArticleList 组件。</p>
</li>
<li><p>ArticleList 组件接受频道 Id 并发送请求获取频道列表数据。</p>
</li>
</ol>
<h3 id="代码-9"><a href="#代码-9" class="headerlink" title="代码"></a>代码</h3><ul>
<li>  分析接口文档，定义频道的数据类型，<code>types/data.d.ts</code> 中：</li>
</ul>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> Article = &#123;</span><br><span class="line">    <span class="attr">art_id</span>: <span class="built_in">string</span></span><br><span class="line">    <span class="attr">title</span>: <span class="built_in">string</span></span><br><span class="line">    <span class="attr">aut_id</span>: <span class="built_in">string</span></span><br><span class="line">    <span class="attr">comm_count</span>: <span class="built_in">number</span></span><br><span class="line">    <span class="attr">pubdate</span>: <span class="built_in">string</span></span><br><span class="line">    <span class="attr">aut_name</span>: <span class="built_in">string</span></span><br><span class="line">    <span class="attr">is_top</span>: <span class="built_in">number</span></span><br><span class="line">    <span class="attr">cover</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="number">0</span> | <span class="number">1</span> | <span class="number">3</span></span><br><span class="line">        <span class="attr">images</span>: <span class="built_in">string</span>[]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> ArticleRes = &#123;</span><br><span class="line">    <span class="attr">pre_timestamp</span>: <span class="built_in">string</span></span><br><span class="line">    <span class="attr">results</span>: Article[]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>  准备获取文章列表的 action，<code>actions/home.ts</code> 中：</li>
</ul>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getArticleList = (channel_id: <span class="built_in">number</span>, <span class="attr">timestamp</span>: <span class="built_in">string</span>): <span class="function"><span class="params">RootThunkAction</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">async</span> (dispatch) =&gt; &#123;</span><br><span class="line">        <span class="keyword">const</span> res = <span class="keyword">await</span> request.get&lt;ApiResponse&lt;ArticleRes&gt;&gt;(<span class="string">&#x27;/articles&#x27;</span>, &#123;</span><br><span class="line">            <span class="attr">params</span>: &#123;</span><br><span class="line">                channel_id,</span><br><span class="line">                timestamp,</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="built_in">console</span>.log(res)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>  在 <code>Home/index.tsx</code> 父组件中将频道 id 传递给 ArticleList 组件 。</li>
</ul>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Home = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">Tabs</span>&gt;</span></span></span><br><span class="line"><span class="xml">            &#123;userChannel.map((item) =&gt; (</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Tabs.Tab</span> <span class="attr">title</span>=<span class="string">&#123;item.name&#125;</span> <span class="attr">key</span>=<span class="string">&#123;item.id&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    &#123;/* 传递频道 id */&#125;</span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">ArticleList</span> <span class="attr">channelId</span>=<span class="string">&#123;item.id&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">Tabs.Tab</span>&gt;</span></span></span><br><span class="line"><span class="xml">            ))&#125;</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">Tabs</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>  ArticleList 组件接受频道 Id <code>Home/components/ArticleList.tsx</code></li>
</ul>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; getArticleList &#125; <span class="keyword">from</span> <span class="string">&#x27;@/store/actions/home&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useDispatch &#125; <span class="keyword">from</span> <span class="string">&#x27;react-redux&#x27;</span></span><br><span class="line"><span class="keyword">import</span> ArticleItem <span class="keyword">from</span> <span class="string">&#x27;../ArticleItem&#x27;</span></span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&#x27;./index.module.scss&#x27;</span></span><br><span class="line"><span class="keyword">type</span> Props = &#123;</span><br><span class="line">    <span class="attr">channelId</span>: <span class="built_in">number</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> ArticleList = <span class="function">(<span class="params">&#123; channelId &#125;: Props</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> dispatch = useDispatch()</span><br><span class="line">    useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        dispatch(getArticleList(channelId, <span class="built_in">Date</span>.now() + <span class="string">&#x27;&#x27;</span>))</span><br><span class="line">    &#125;, [dispatch, channelId])</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;styles.root&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">            &#123;[1, 2, 3].map((item, index) =&gt; (</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;article-item&#x27;</span> <span class="attr">key</span>=<span class="string">&#123;index&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">ArticleItem</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            ))&#125;</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> ArticleList</span><br></pre></td></tr></table></figure>

<h2 id="文章列表-将数据存储到-Redux-中"><a href="#文章列表-将数据存储到-Redux-中" class="headerlink" title="文章列表-将数据存储到 Redux 中"></a>文章列表-将数据存储到 Redux 中</h2><h3 id="目标-14"><a href="#目标-14" class="headerlink" title="目标"></a>目标</h3><p>能够将数据存储到 Redux 中。</p>
<h3 id="分析-3"><a href="#分析-3" class="headerlink" title="分析"></a>分析</h3><p>问题：用什么样的数据格式存储频道文章列表数据？每个频道，都对应到一个文章列表数据</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 推荐频道</span></span><br><span class="line"><span class="number">0</span> ==&gt; &#123;</span><br><span class="line">    <span class="attr">pre_timestamp</span>: xxxx,</span><br><span class="line">    <span class="attr">articles</span>: []</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// html 频道</span></span><br><span class="line"><span class="number">1</span> ==&gt; &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 开发者资讯频道</span></span><br><span class="line"><span class="number">2</span> ==&gt; &#123;&#125;</span><br></pre></td></tr></table></figure>

<p>为了高效的存储数据，我们使用 <code>对象</code> 来存储频道文章列表数据。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 数据格式：</span></span><br><span class="line">channelArticles = &#123;</span><br><span class="line">    <span class="number">1</span>: &#123;</span><br><span class="line">        <span class="attr">timestamp</span>: <span class="string">&#x27;1638408103353&#x27;</span>,</span><br><span class="line">        <span class="attr">articles</span>: [],</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="number">2</span>: &#123;</span><br><span class="line">        <span class="attr">timestamp</span>: <span class="string">&#x27;1638408103353&#x27;</span>,</span><br><span class="line">        <span class="attr">articles</span>: [],</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="number">3</span>: &#123;</span><br><span class="line">        <span class="attr">timestamp</span>: <span class="string">&#x27;1638408103353&#x27;</span>,</span><br><span class="line">        <span class="attr">articles</span>: [],</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="代码-10"><a href="#代码-10" class="headerlink" title="代码"></a>代码</h3><ul>
<li>  在 <code>types/store.d.ts</code> 中，定义 action 的类型。</li>
</ul>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> HomeAction =</span><br><span class="line">    | &#123;</span><br><span class="line">          <span class="attr">type</span>: <span class="string">&#x27;home/saveUserChannels&#x27;</span></span><br><span class="line">          <span class="attr">payload</span>: Channel[]</span><br><span class="line">      &#125;</span><br><span class="line">    | &#123;</span><br><span class="line">          <span class="attr">type</span>: <span class="string">&#x27;home/saveAllChannels&#x27;</span></span><br><span class="line">          <span class="attr">payload</span>: Channel[]</span><br><span class="line">      &#125;</span><br><span class="line">    | &#123;</span><br><span class="line">          <span class="attr">type</span>: <span class="string">&#x27;home/changeActive&#x27;</span></span><br><span class="line">          <span class="attr">payload</span>: <span class="built_in">number</span></span><br><span class="line">      &#125;</span><br><span class="line">    | &#123;</span><br><span class="line">          <span class="attr">type</span>: <span class="string">&#x27;home/saveChannelArticles&#x27;</span></span><br><span class="line">          <span class="attr">payload</span>: &#123;</span><br><span class="line">              <span class="attr">channel_id</span>: <span class="built_in">number</span></span><br><span class="line">              <span class="attr">timestamp</span>: <span class="built_in">string</span></span><br><span class="line">              <span class="attr">articles</span>: Article[]</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>  在 actions/home.ts 中，分发 action。</li>
</ul>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getArticleList = (channel_id: <span class="built_in">number</span>, <span class="attr">timestamp</span>: <span class="built_in">string</span>): <span class="function"><span class="params">RootThunkAction</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">async</span> (dispatch) =&gt; &#123;</span><br><span class="line">        <span class="keyword">const</span> res = <span class="keyword">await</span> request.get&lt;ApiResponse&lt;ArticleRes&gt;&gt;(<span class="string">&#x27;/articles&#x27;</span>, &#123;</span><br><span class="line">            <span class="attr">params</span>: &#123;</span><br><span class="line">                channel_id,</span><br><span class="line">                timestamp,</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">const</span> &#123; pre_timestamp, results &#125; = res.data.data</span><br><span class="line">        dispatch(&#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;home/saveChannelArticles&#x27;</span>,</span><br><span class="line">            <span class="attr">payload</span>: &#123;</span><br><span class="line">                channel_id,</span><br><span class="line">                <span class="attr">timestamp</span>: pre_timestamp,</span><br><span class="line">                <span class="attr">articles</span>: results,</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>  在 reducers/home.ts 中。</li>
</ul>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Article, Channel &#125; <span class="keyword">from</span> <span class="string">&#x27;@/types/data&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; HomeAction &#125; <span class="keyword">from</span> <span class="string">&#x27;@/types/store&#x27;</span></span><br><span class="line"><span class="keyword">type</span> HomeType = &#123;</span><br><span class="line">    <span class="attr">userChannels</span>: Channel[]</span><br><span class="line">    <span class="attr">allChannels</span>: Channel[]</span><br><span class="line">    <span class="attr">active</span>: <span class="built_in">number</span></span><br><span class="line">    <span class="comment">// #1</span></span><br><span class="line">    <span class="attr">channelArticles</span>: &#123;</span><br><span class="line">        [key: <span class="built_in">number</span>]: &#123;</span><br><span class="line">            <span class="attr">timestamp</span>: <span class="built_in">string</span></span><br><span class="line">            <span class="attr">articles</span>: Article[]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> initValue: HomeType = &#123;</span><br><span class="line">    <span class="attr">userChannels</span>: [],</span><br><span class="line">    <span class="attr">allChannels</span>: [],</span><br><span class="line">    <span class="attr">active</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="comment">// #2</span></span><br><span class="line">    <span class="attr">channelArticles</span>: &#123;&#125;,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">home</span>(<span class="params">state = initValue, action: HomeAction</span>): <span class="title">HomeType</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (action.type === <span class="string">&#x27;home/saveUserChannels&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            ...state,</span><br><span class="line">            <span class="attr">userChannels</span>: action.payload,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (action.type === <span class="string">&#x27;home/saveAllChannels&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            ...state,</span><br><span class="line">            <span class="attr">allChannels</span>: action.payload,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (action.type === <span class="string">&#x27;home/changeActive&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            ...state,</span><br><span class="line">            <span class="attr">active</span>: action.payload,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// #3</span></span><br><span class="line">    <span class="keyword">if</span> (action.type === <span class="string">&#x27;home/saveChannelArticles&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; channel_id, timestamp, articles &#125; = action.payload</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            ...state,</span><br><span class="line">            <span class="attr">channelArticles</span>: &#123;</span><br><span class="line">                ...state.channelArticles,</span><br><span class="line">                [channel_id]: &#123;</span><br><span class="line">                    timestamp,</span><br><span class="line">                    articles,</span><br><span class="line">                &#125;,</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> state</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="文章列表-渲染文章列表"><a href="#文章列表-渲染文章列表" class="headerlink" title="文章列表-渲染文章列表"></a>文章列表-渲染文章列表</h2><h3 id="目标-15"><a href="#目标-15" class="headerlink" title="目标"></a>目标</h3><p>根据文章列表数据渲染文章。</p>
<h3 id="步骤-10"><a href="#步骤-10" class="headerlink" title="步骤"></a>步骤</h3><ul>
<li>  在 ArticleList 中获取文章列表数据。</li>
</ul>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> ArticleList = <span class="function">(<span class="params">&#123; channelId &#125;: Props</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> dispatch = useDispatch()</span><br><span class="line">    <span class="keyword">const</span> &#123; channelArticles &#125; = useSelector(<span class="function">(<span class="params">state: RootState</span>) =&gt;</span> state.home)</span><br><span class="line">    <span class="keyword">const</span> &#123; articles = [] &#125; = channelArticles[channelId] || &#123;&#125;</span><br><span class="line">    useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        dispatch(getArticleList(channelId, <span class="built_in">Date</span>.now() + <span class="string">&#x27;&#x27;</span>))</span><br><span class="line">    &#125;, [dispatch, channelId])</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;styles.root&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">            &#123;articles.map((item, index) =&gt; (</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">key</span>=<span class="string">&#123;item.art_id&#125;</span> <span class="attr">className</span>=<span class="string">&#x27;article-item&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">ArticleItem</span> <span class="attr">article</span>=<span class="string">&#123;item&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            ))&#125;</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>  传递给 ArticleItem 组件进行渲染</li>
</ul>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> classnames <span class="keyword">from</span> <span class="string">&#x27;classnames&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useSelector &#125; <span class="keyword">from</span> <span class="string">&#x27;react-redux&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Icon <span class="keyword">from</span> <span class="string">&#x27;@/components/Icon&#x27;</span></span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&#x27;./index.module.scss&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; Article &#125; <span class="keyword">from</span> <span class="string">&#x27;@/types/data&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; RootState &#125; <span class="keyword">from</span> <span class="string">&#x27;@/types/store&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Props = &#123;</span><br><span class="line">    <span class="attr">article</span>: Article</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ArticleItem = <span class="function">(<span class="params">&#123; article &#125;: Props</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> token = useSelector(<span class="function">(<span class="params">state: RootState</span>) =&gt;</span> state.login.token)</span><br><span class="line">    <span class="keyword">const</span> &#123;</span><br><span class="line">        title,</span><br><span class="line">        <span class="attr">cover</span>: &#123; <span class="keyword">type</span>, images &#125;,</span><br><span class="line">        aut_name,</span><br><span class="line">        comm_count,</span><br><span class="line">        pubdate,</span><br><span class="line">    &#125; = article</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;styles.root&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;classnames(</span>&#x27;<span class="attr">article-content</span>&#x27;, <span class="attr">type</span> === <span class="string">3</span> &amp;&amp; &#x27;<span class="attr">t3</span>&#x27;, <span class="attr">type</span> === <span class="string">0</span> &amp;&amp; &#x27;<span class="attr">none-mt</span>&#x27;)&#125;&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">h3</span>&gt;</span>&#123;title&#125;<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line"><span class="xml">                &#123;type !== 0 &amp;&amp; (</span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;article-imgs&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        &#123;images.map((image, index) =&gt; (</span></span><br><span class="line"><span class="xml">                            <span class="tag">&lt;<span class="name">div</span> <span class="attr">key</span>=<span class="string">&#123;index&#125;</span> <span class="attr">className</span>=<span class="string">&#x27;article-img-wrapper&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                                <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&#123;image&#125;</span> <span class="attr">alt</span>=<span class="string">&#x27;&#x27;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        ))&#125;</span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                )&#125;</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;classnames(</span>&#x27;<span class="attr">article-info</span>&#x27;, <span class="attr">type</span> === <span class="string">0</span> &amp;&amp; &#x27;<span class="attr">none-mt</span>&#x27;)&#125;&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;aut_name&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;comm_count&#125; 评论<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;pubdate&#125; 天前<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">className</span>=<span class="string">&#x27;close&#x27;</span>&gt;</span>&#123;token &amp;&amp; <span class="tag">&lt;<span class="name">Icon</span> <span class="attr">type</span>=<span class="string">&#x27;iconbtn_essay_close&#x27;</span> /&gt;</span>&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> ArticleItem</span><br></pre></td></tr></table></figure>

<ul>
<li>  处理时间</li>
</ul>
<p><code>src/index.tsx</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> dayjs <span class="keyword">from</span> <span class="string">&#x27;dayjs&#x27;</span></span><br><span class="line"><span class="keyword">import</span> relativeTime <span class="keyword">from</span> <span class="string">&#x27;dayjs/plugin/relativeTime&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;dayjs/locale/zh-cn&#x27;</span></span><br><span class="line">dayjs.extend(relativeTime)</span><br><span class="line">dayjs.locale(<span class="string">&#x27;zh-cn&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p><code>src/pages/Home/components/ArticleItem/index.tsx</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> dayjs <span class="keyword">from</span> <span class="string">&#x27;dayjs&#x27;</span></span><br><span class="line">;<span class="xml"><span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;dayjs(pubdate).fromNow()&#125; 天前<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<h2 id="文章列表-触底加载更多"><a href="#文章列表-触底加载更多" class="headerlink" title="文章列表-触底加载更多"></a>文章列表-触底加载更多</h2><h3 id="目标-16"><a href="#目标-16" class="headerlink" title="目标"></a>目标</h3><p>能够使用 antd-mobile 的 InfiniteScroll 组件。</p>
<h3 id="代码-11"><a href="#代码-11" class="headerlink" title="代码"></a>代码</h3><ul>
<li>  使用 InfiniteScroll 组件</li>
</ul>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; getArticleList &#125; <span class="keyword">from</span> <span class="string">&#x27;@/store/actions/home&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; RootState &#125; <span class="keyword">from</span> <span class="string">&#x27;@/types/store&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useDispatch, useSelector &#125; <span class="keyword">from</span> <span class="string">&#x27;react-redux&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; InfiniteScroll &#125; <span class="keyword">from</span> <span class="string">&#x27;antd-mobile&#x27;</span></span><br><span class="line"><span class="keyword">import</span> ArticleItem <span class="keyword">from</span> <span class="string">&#x27;../ArticleItem&#x27;</span></span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&#x27;./index.module.scss&#x27;</span></span><br><span class="line"><span class="keyword">type</span> Props = &#123;</span><br><span class="line">    <span class="attr">channelId</span>: <span class="built_in">number</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> ArticleList = <span class="function">(<span class="params">&#123; channelId &#125;: Props</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> dispatch = useDispatch()</span><br><span class="line">    <span class="keyword">const</span> &#123; channelArticles &#125; = useSelector(<span class="function">(<span class="params">state: RootState</span>) =&gt;</span> state.home)</span><br><span class="line">    <span class="keyword">const</span> &#123; articles = [] &#125; = channelArticles[channelId] || &#123;&#125;</span><br><span class="line">    <span class="comment">// #4 可以注释掉了</span></span><br><span class="line">    <span class="comment">/* useEffect(() =&gt; &#123;</span></span><br><span class="line"><span class="comment">        dispatch(getArticleList(channelId, Date.now() + &#x27;&#x27;))</span></span><br><span class="line"><span class="comment">    &#125;, [dispatch, channelId]) */</span></span><br><span class="line">    <span class="comment">// #2</span></span><br><span class="line">    <span class="keyword">const</span> hasMore = <span class="literal">true</span></span><br><span class="line">    <span class="comment">// #3</span></span><br><span class="line">    <span class="keyword">const</span> loadMore = <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">        <span class="keyword">await</span> dispatch(getArticleList(channelId, <span class="built_in">Date</span>.now() + <span class="string">&#x27;&#x27;</span>))</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;styles.root&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">            &#123;articles.map((item, index) =&gt; (</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">key</span>=<span class="string">&#123;item.art_id&#125;</span> <span class="attr">className</span>=<span class="string">&#x27;article-item&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">ArticleItem</span> <span class="attr">article</span>=<span class="string">&#123;item&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            ))&#125;</span></span><br><span class="line"><span class="xml">            &#123;/* #1 */&#125;</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">InfiniteScroll</span> <span class="attr">loadMore</span>=<span class="string">&#123;loadMore&#125;</span> <span class="attr">hasMore</span>=<span class="string">&#123;hasMore&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> ArticleList</span><br></pre></td></tr></table></figure>

<ul>
<li>  修改 reducers/home.ts，将数据改成追加</li>
</ul>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (action.type === <span class="string">&#x27;home/saveChannelArticles&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; channel_id, timestamp, articles &#125; = action.payload</span><br><span class="line">    <span class="keyword">const</span> old = state.channelArticles[channel_id]?.articles || []</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        ...state,</span><br><span class="line">        <span class="attr">channelArticles</span>: &#123;</span><br><span class="line">            ...state.channelArticles,</span><br><span class="line">            [channel_id]: &#123;</span><br><span class="line">                timestamp,</span><br><span class="line">                <span class="attr">articles</span>: [...old, ...articles],</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>  时间戳和 hasMore 的处理。</li>
</ul>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> ArticleList = <span class="function">(<span class="params">&#123; channelId &#125;: Props</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> dispatch = useDispatch()</span><br><span class="line">    <span class="keyword">const</span> &#123; channelArticles &#125; = useSelector(<span class="function">(<span class="params">state: RootState</span>) =&gt;</span> state.home)</span><br><span class="line">    <span class="comment">// #1</span></span><br><span class="line">    <span class="keyword">const</span> &#123; articles = [], timestamp &#125; = channelArticles[channelId] || &#123;&#125;</span><br><span class="line">    <span class="comment">// #3</span></span><br><span class="line">    <span class="keyword">const</span> hasMore = timestamp !== <span class="literal">null</span></span><br><span class="line">    <span class="keyword">const</span> loadMore = <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">        <span class="comment">// #2</span></span><br><span class="line">        <span class="keyword">await</span> dispatch(getArticleList(channelId, timestamp || <span class="built_in">Date</span>.now() + <span class="string">&#x27;&#x27;</span>))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="文章列表-下拉刷新"><a href="#文章列表-下拉刷新" class="headerlink" title="文章列表-下拉刷新"></a>文章列表-下拉刷新</h2><h3 id="目标-17"><a href="#目标-17" class="headerlink" title="目标"></a>目标</h3><p>能够下拉刷新文章数据。</p>
<h3 id="分析-4"><a href="#分析-4" class="headerlink" title="分析"></a>分析</h3><p><code>Home/components/ArticleList/index.tsx</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> onRefresh = <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">await</span> dispatch(getNewList(channelId, <span class="built_in">Date</span>.now() + <span class="string">&#x27;&#x27;</span>))</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;styles.root&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">PullToRefresh</span> <span class="attr">onRefresh</span>=<span class="string">&#123;onRefresh&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">            &#123;articles.map((item, index) =&gt; (</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">key</span>=<span class="string">&#123;item.art_id&#125;</span> <span class="attr">className</span>=<span class="string">&#x27;article-item&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">ArticleItem</span> <span class="attr">article</span>=<span class="string">&#123;item&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            ))&#125;</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">InfiniteScroll</span> <span class="attr">loadMore</span>=<span class="string">&#123;loadMore&#125;</span> <span class="attr">hasMore</span>=<span class="string">&#123;hasMore&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">PullToRefresh</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p><code>store.d.ts</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> HomeAction =</span><br><span class="line">    | &#123;</span><br><span class="line">          <span class="attr">type</span>: <span class="string">&#x27;home/saveUserChannels&#x27;</span></span><br><span class="line">          <span class="attr">payload</span>: Channel[]</span><br><span class="line">      &#125;</span><br><span class="line">    | &#123;</span><br><span class="line">          <span class="attr">type</span>: <span class="string">&#x27;home/saveAllChannels&#x27;</span></span><br><span class="line">          <span class="attr">payload</span>: Channel[]</span><br><span class="line">      &#125;</span><br><span class="line">    | &#123;</span><br><span class="line">          <span class="attr">type</span>: <span class="string">&#x27;home/changeActive&#x27;</span></span><br><span class="line">          <span class="attr">payload</span>: <span class="built_in">number</span></span><br><span class="line">      &#125;</span><br><span class="line">    | &#123;</span><br><span class="line">          <span class="attr">type</span>: <span class="string">&#x27;home/saveChannelArticles&#x27;</span></span><br><span class="line">          <span class="attr">payload</span>: &#123;</span><br><span class="line">              <span class="attr">channel_id</span>: <span class="built_in">number</span></span><br><span class="line">              <span class="attr">timestamp</span>: <span class="built_in">string</span></span><br><span class="line">              <span class="attr">articles</span>: Article[]</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    | &#123;</span><br><span class="line">          <span class="attr">type</span>: <span class="string">&#x27;home/saveNewArticles&#x27;</span></span><br><span class="line">          <span class="attr">payload</span>: &#123;</span><br><span class="line">              <span class="attr">channel_id</span>: <span class="built_in">number</span></span><br><span class="line">              <span class="attr">timestamp</span>: <span class="built_in">string</span></span><br><span class="line">              <span class="attr">articles</span>: Article[]</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure>

<p><code>actions/home.ts</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getNewList = (channel_id: <span class="built_in">number</span>, <span class="attr">timestamp</span>: <span class="built_in">string</span>): <span class="function"><span class="params">RootThunkAction</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">async</span> (dispatch) =&gt; &#123;</span><br><span class="line">        <span class="keyword">const</span> res = <span class="keyword">await</span> request.get&lt;ApiResponse&lt;ArticleRes&gt;&gt;(<span class="string">&#x27;/articles&#x27;</span>, &#123;</span><br><span class="line">            <span class="attr">params</span>: &#123;</span><br><span class="line">                channel_id,</span><br><span class="line">                timestamp,</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">const</span> &#123; pre_timestamp, results &#125; = res.data.data</span><br><span class="line">        dispatch(&#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;home/saveNewArticles&#x27;</span>,</span><br><span class="line">            <span class="attr">payload</span>: &#123;</span><br><span class="line">                channel_id,</span><br><span class="line">                <span class="attr">timestamp</span>: pre_timestamp,</span><br><span class="line">                <span class="attr">articles</span>: results,</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>reducers/home.ts</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (action.type === <span class="string">&#x27;home/saveNewArticles&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; channel_id, timestamp, articles &#125; = action.payload</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        ...state,</span><br><span class="line">        <span class="attr">channelArticles</span>: &#123;</span><br><span class="line">            ...state.channelArticles,</span><br><span class="line">            [channel_id]: &#123;</span><br><span class="line">                timestamp,</span><br><span class="line">                <span class="attr">articles</span>: [...articles],</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="IntersectionObserver"><a href="#IntersectionObserver" class="headerlink" title="IntersectionObserver"></a>IntersectionObserver</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;height: 2000px;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">img</span> <span class="attr">data-src</span>=<span class="string">&quot;http://geek.itheima.net/resources/images/19.jpg&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">            <span class="keyword">const</span> oImg = <span class="built_in">document</span>.querySelector(<span class="string">&#x27;img&#x27;</span>)</span></span><br><span class="line"><span class="javascript">            <span class="keyword">const</span> observer = <span class="keyword">new</span> IntersectionObserver(<span class="function"><span class="keyword">function</span> (<span class="params">[&#123; isIntersecting &#125;]</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">if</span> (isIntersecting) &#123;</span></span><br><span class="line"><span class="javascript">                    oImg.src = oImg.getAttribute(<span class="string">&#x27;data-src&#x27;</span>)</span></span><br><span class="line"><span class="javascript">                    observer.unobserve()</span></span><br><span class="line"><span class="javascript">                &#125;</span></span><br><span class="line"><span class="javascript">            &#125;)</span></span><br><span class="line"><span class="javascript">            observer.observe(oImg)</span></span><br><span class="line"><span class="javascript">        </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="文章列表-图片懒加载的封装"><a href="#文章列表-图片懒加载的封装" class="headerlink" title="文章列表-图片懒加载的封装"></a>文章列表-图片懒加载的封装</h2><h3 id="目标-18"><a href="#目标-18" class="headerlink" title="目标"></a>目标</h3><p>封装一个拥有懒加载功能的图片组件，实现对文章列表项上的封面图片进行懒加载。</p>
<p>当前问题：文章列表一旦开始渲染，上面所有的封面图都会一次性加载，可能会浪费网络资源和降低用户体验。</p>
<p>解决方案：只有当用户滚动页面，真正浏览到这些列表项，才开始加载封面图片。</p>
<p>实现思路：利用浏览器提供的 <code>IntersectionObserver</code>，监听图片元素是否进入可视区域，进入后才真正去设置图片元素的 <code>src</code> 属性进行图片加载。</p>
<h3 id="步骤-11"><a href="#步骤-11" class="headerlink" title="步骤"></a>步骤</h3><ol>
<li>基本封装。</li>
</ol>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> classnames <span class="keyword">from</span> <span class="string">&#x27;classnames&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useRef, useEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&#x27;./index.module.scss&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Props = &#123;</span><br><span class="line">    <span class="attr">src</span>: <span class="built_in">string</span></span><br><span class="line">    className?: <span class="built_in">string</span></span><br><span class="line">    alt?: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> Img = <span class="function">(<span class="params">&#123; src, className &#125;: Props</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> imgRef = useRef&lt;HTMLImageElement&gt;(<span class="literal">null</span>)</span><br><span class="line">    useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> img = imgRef.current!</span><br><span class="line">        <span class="keyword">const</span> observer = <span class="keyword">new</span> IntersectionObserver(<span class="function">(<span class="params">[&#123; isIntersecting &#125;]</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (isIntersecting) &#123;</span><br><span class="line">                img.src = img.getAttribute(<span class="string">&#x27;data-src&#x27;</span>)!</span><br><span class="line">                observer.unobserve(img)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        observer.observe(img)</span><br><span class="line">        <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">            observer.unobserve(img)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, [])</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;classnames(styles.root,</span> <span class="attr">className</span>)&#125;&gt;</span></span></span><br><span class="line"><span class="xml">            &#123;/* //!加载成功 */&#125;</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">img</span> <span class="attr">alt</span>=<span class="string">&#x27;&#x27;</span> <span class="attr">data-src</span>=<span class="string">&#123;src&#125;</span> <span class="attr">ref</span>=<span class="string">&#123;imgRef&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Img</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><code>pages/Question/index.tsx</code> 中基本使用。</li>
</ol>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; NavBar &#125; <span class="keyword">from</span> <span class="string">&#x27;antd-mobile&#x27;</span></span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&#x27;./index.module.scss&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Img <span class="keyword">from</span> <span class="string">&#x27;@/components/Img&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Question = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;styles.root&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">NavBar</span>&gt;</span>问答<span class="tag">&lt;/<span class="name">NavBar</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">height:</span> <span class="attr">2000</span> &#125;&#125;&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Img</span> <span class="attr">src</span>=<span class="string">&#x27;http://geek.itheima.net/resources/images/19.jpg&#x27;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Question</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>处理加载状态。</li>
</ol>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> classnames <span class="keyword">from</span> <span class="string">&#x27;classnames&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useRef, useEffect, useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Icon <span class="keyword">from</span> <span class="string">&#x27;../Icon&#x27;</span></span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&#x27;./index.module.scss&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Props = &#123;</span><br><span class="line">    <span class="attr">src</span>: <span class="built_in">string</span></span><br><span class="line">    className?: <span class="built_in">string</span></span><br><span class="line">    alt?: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> Img = <span class="function">(<span class="params">&#123; src, className &#125;: Props</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> [error, setError] = useState(<span class="literal">false</span>)</span><br><span class="line">    <span class="keyword">const</span> [loading, setLoading] = useState(<span class="literal">true</span>)</span><br><span class="line">    <span class="keyword">const</span> imgRef = useRef&lt;HTMLImageElement&gt;(<span class="literal">null</span>)</span><br><span class="line">    <span class="comment">// #2</span></span><br><span class="line">    <span class="keyword">const</span> onError = <span class="function">() =&gt;</span> setError(<span class="literal">true</span>)</span><br><span class="line">    <span class="keyword">const</span> onLoad = <span class="function">() =&gt;</span> setLoading(<span class="literal">false</span>)</span><br><span class="line">    useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> img = imgRef.current!</span><br><span class="line">        <span class="keyword">const</span> observer = <span class="keyword">new</span> IntersectionObserver(<span class="function">(<span class="params">[&#123; isIntersecting &#125;]</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (isIntersecting) &#123;</span><br><span class="line">                img.src = img.getAttribute(<span class="string">&#x27;data-src&#x27;</span>)!</span><br><span class="line">                observer.unobserve(img)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        observer.observe(img)</span><br><span class="line">        <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">            observer.unobserve(img)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, [])</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;classnames(styles.root,</span> <span class="attr">className</span>)&#125;&gt;</span></span></span><br><span class="line"><span class="xml">            &#123;/* //!加载中... */&#125;</span></span><br><span class="line"><span class="xml">            &#123;loading &amp;&amp; (</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;image-icon&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">Icon</span> <span class="attr">type</span>=<span class="string">&#x27;iconphoto&#x27;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            )&#125;</span></span><br><span class="line"><span class="xml">            &#123;/* //!加载失败 */&#125;</span></span><br><span class="line"><span class="xml">            &#123;/* #3 */&#125;</span></span><br><span class="line"><span class="xml">            &#123;error &amp;&amp; (</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;image-icon&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">Icon</span> <span class="attr">type</span>=<span class="string">&#x27;iconphoto-fail&#x27;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            )&#125;</span></span><br><span class="line"><span class="xml">            &#123;/* #1 */&#125;</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">img</span> <span class="attr">alt</span>=<span class="string">&#x27;&#x27;</span> <span class="attr">data-src</span>=<span class="string">&#123;src&#125;</span> <span class="attr">ref</span>=<span class="string">&#123;imgRef&#125;</span> <span class="attr">onError</span>=<span class="string">&#123;onError&#125;</span> <span class="attr">onLoad</span>=<span class="string">&#123;onLoad&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Img</span><br></pre></td></tr></table></figure>

<ol start="4">
<li><code>pages/Home/components/ArticleItem/index.tsx</code> 中使用懒加载组件。</li>
</ol>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;div className=<span class="string">&#x27;article-imgs&#x27;</span>&gt;</span><br><span class="line">    &#123;images.map(<span class="function">(<span class="params">image, index</span>) =&gt;</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">key</span>=<span class="string">&#123;index&#125;</span> <span class="attr">className</span>=<span class="string">&#x27;article-img-wrapper&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Img</span> <span class="attr">src</span>=<span class="string">&#123;image&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    ))&#125;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<h2 id="文章列表-点击文章项跳转到详情"><a href="#文章列表-点击文章项跳转到详情" class="headerlink" title="文章列表-点击文章项跳转到详情"></a>文章列表-点击文章项跳转到详情</h2><h3 id="目标-19"><a href="#目标-19" class="headerlink" title="目标"></a>目标</h3><p>能够在点击文章项时跳转到文章详情页面。</p>
<h3 id="步骤-12"><a href="#步骤-12" class="headerlink" title="步骤"></a>步骤</h3><ol>
<li><p>将文章详情页面模板拷贝到 pages 目录中。</p>
</li>
<li><p>在 App 组件中配置文章详情页路由。</p>
</li>
<li><p>为每个文章列表项绑定点击事件。</p>
</li>
<li><p>点击时，根据文章 id，跳转到文章详情页对应的路由。</p>
</li>
</ol>
<h3 id="代码-12"><a href="#代码-12" class="headerlink" title="代码"></a>代码</h3><p><code>pages/Home/component/ArticleList/index.tsx</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;div key=&#123;item.art_id&#125; className=<span class="string">&#x27;article-item&#x27;</span> onClick=&#123;<span class="function">() =&gt;</span> history.push(<span class="string">`/article/<span class="subst">$&#123;item.art_id&#125;</span>`</span>)&#125;&gt;</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">ArticleItem</span> <span class="attr">article</span>=<span class="string">&#123;item&#125;</span> /&gt;</span></span></span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<p><code>App.tsx</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Article <span class="keyword">from</span> <span class="string">&#x27;./pages/Article&#x27;</span></span><br><span class="line">;<span class="xml"><span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&#x27;/article/:id&#x27;</span> <span class="attr">component</span>=<span class="string">&#123;Article&#125;</span> /&gt;</span></span></span><br></pre></td></tr></table></figure>

    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2021/12/24/react-base-course18/" rel="prev" title="18_极客园 H5">
      <i class="fa fa-chevron-left"></i> 18_极客园 H5
    </a></div>
      <div class="post-nav-item">
    <a href="/2022/01/08/react-base-course20/" rel="next" title="20_极客园 H5">
      20_极客园 H5 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BB%8A%E6%97%A5%E7%9B%AE%E6%A0%87"><span class="nav-number">1.</span> <span class="nav-text">今日目标</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%A1%B5%E9%9D%A2%E7%BB%93%E6%9E%84"><span class="nav-number">2.</span> <span class="nav-text">页面结构</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9B%AE%E6%A0%87"><span class="nav-number">2.1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A4"><span class="nav-number">2.2.</span> <span class="nav-text">步骤</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-Tabs-%E7%BB%84%E4%BB%B6"><span class="nav-number">3.</span> <span class="nav-text">使用 Tabs 组件</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9B%AE%E6%A0%87-1"><span class="nav-number">3.1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A4-1"><span class="nav-number">3.2.</span> <span class="nav-text">步骤</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E9%A2%91%E9%81%93%E5%88%97%E8%A1%A8%E6%95%B0%E6%8D%AE"><span class="nav-number">4.</span> <span class="nav-text">获取频道列表数据</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9B%AE%E6%A0%87-2"><span class="nav-number">4.1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A4-2"><span class="nav-number">4.2.</span> <span class="nav-text">步骤</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E9%A2%91%E9%81%93%E5%88%97%E8%A1%A8%E6%95%B0%E6%8D%AE-%E5%AD%98%E5%82%A8%E4%B8%8E%E6%B8%B2%E6%9F%93"><span class="nav-number">5.</span> <span class="nav-text">获取频道列表数据-存储与渲染</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%A2%91%E9%81%93%E7%AE%A1%E7%90%86-%E6%8E%A7%E5%88%B6%E5%BC%B9%E5%B1%82%E6%98%BE%E7%A4%BA%E9%9A%90%E8%97%8F"><span class="nav-number">6.</span> <span class="nav-text">频道管理-控制弹层显示隐藏</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9B%AE%E6%A0%87-3"><span class="nav-number">6.1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A4-3"><span class="nav-number">6.2.</span> <span class="nav-text">步骤</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81"><span class="nav-number">6.3.</span> <span class="nav-text">代码</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%A2%91%E9%81%93%E7%AE%A1%E7%90%86-%E6%B8%B2%E6%9F%93%E6%88%91%E7%9A%84%E9%A2%91%E9%81%93"><span class="nav-number">7.</span> <span class="nav-text">频道管理-渲染我的频道</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9B%AE%E6%A0%87-4"><span class="nav-number">7.1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A4-4"><span class="nav-number">7.2.</span> <span class="nav-text">步骤</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%A2%91%E9%81%93%E7%AE%A1%E7%90%86-%E8%8E%B7%E5%8F%96%E6%89%80%E6%9C%89%E9%A2%91%E9%81%93"><span class="nav-number">8.</span> <span class="nav-text">频道管理-获取所有频道</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9B%AE%E6%A0%87-5"><span class="nav-number">8.1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81-1"><span class="nav-number">8.2.</span> <span class="nav-text">代码</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%A2%91%E9%81%93%E7%AE%A1%E7%90%86-%E6%B8%B2%E6%9F%93%E9%A2%91%E9%81%93%E6%8E%A8%E8%8D%90"><span class="nav-number">9.</span> <span class="nav-text">频道管理-渲染频道推荐</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9B%AE%E6%A0%87-6"><span class="nav-number">9.1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81-2"><span class="nav-number">9.2.</span> <span class="nav-text">代码</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E9%A2%91%E9%81%93%E5%88%97%E8%A1%A8%E6%95%B0%E6%8D%AE-%E9%80%BB%E8%BE%91%E4%BC%98%E5%8C%96"><span class="nav-number">10.</span> <span class="nav-text">获取频道列表数据-逻辑优化</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%86%E6%9E%90"><span class="nav-number">10.1.</span> <span class="nav-text">分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81-3"><span class="nav-number">10.2.</span> <span class="nav-text">代码</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%A2%91%E9%81%93%E7%AE%A1%E7%90%86-%E7%82%B9%E5%87%BB%E6%88%91%E7%9A%84%E9%A2%91%E9%81%93%E9%AB%98%E4%BA%AE"><span class="nav-number">11.</span> <span class="nav-text">频道管理-点击我的频道高亮</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9B%AE%E6%A0%87-7"><span class="nav-number">11.1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%86%E6%9E%90-1"><span class="nav-number">11.2.</span> <span class="nav-text">分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81-4"><span class="nav-number">11.3.</span> <span class="nav-text">代码</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%A2%91%E9%81%93%E7%AE%A1%E7%90%86-%E5%A4%84%E7%90%86-Tabs-%E7%9A%84%E9%AB%98%E4%BA%AE"><span class="nav-number">12.</span> <span class="nav-text">频道管理-处理 Tabs 的高亮</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9B%AE%E6%A0%87-8"><span class="nav-number">12.1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A4-5"><span class="nav-number">12.2.</span> <span class="nav-text">步骤</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A0%B8%E5%BF%83%E4%BB%A3%E7%A0%81"><span class="nav-number">12.3.</span> <span class="nav-text">核心代码</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%A2%91%E9%81%93%E7%AE%A1%E7%90%86-%E7%BC%96%E8%BE%91%E7%8A%B6%E6%80%81%E7%9A%84%E5%A4%84%E7%90%86"><span class="nav-number">13.</span> <span class="nav-text">频道管理-编辑状态的处理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9B%AE%E6%A0%87-9"><span class="nav-number">13.1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A4-6"><span class="nav-number">13.2.</span> <span class="nav-text">步骤</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81-5"><span class="nav-number">13.3.</span> <span class="nav-text">代码</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%A2%91%E9%81%93%E7%AE%A1%E7%90%86-%E5%88%A0%E9%99%A4%E9%A2%91%E9%81%93"><span class="nav-number">14.</span> <span class="nav-text">频道管理-删除频道</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9B%AE%E6%A0%87-10"><span class="nav-number">14.1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%86%E6%9E%90-2"><span class="nav-number">14.2.</span> <span class="nav-text">分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A4-7"><span class="nav-number">14.3.</span> <span class="nav-text">步骤</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81-6"><span class="nav-number">14.4.</span> <span class="nav-text">代码</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BC%98%E5%8C%96"><span class="nav-number">14.5.</span> <span class="nav-text">优化</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%A2%91%E9%81%93%E7%AE%A1%E7%90%86-%E6%B7%BB%E5%8A%A0%E9%A2%91%E9%81%93"><span class="nav-number">15.</span> <span class="nav-text">频道管理-添加频道</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9B%AE%E6%A0%87-11"><span class="nav-number">15.1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81-7"><span class="nav-number">15.2.</span> <span class="nav-text">代码</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%96%87%E7%AB%A0%E5%88%97%E8%A1%A8-%E5%9F%BA%E6%9C%AC%E7%BB%93%E6%9E%84"><span class="nav-number">16.</span> <span class="nav-text">文章列表-基本结构</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9B%AE%E6%A0%87-12"><span class="nav-number">16.1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A4-8"><span class="nav-number">16.2.</span> <span class="nav-text">步骤</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81-8"><span class="nav-number">16.3.</span> <span class="nav-text">代码</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%96%87%E7%AB%A0%E5%88%97%E8%A1%A8-%E8%8E%B7%E5%8F%96%E6%96%87%E7%AB%A0%E5%88%97%E8%A1%A8%E6%95%B0%E6%8D%AE"><span class="nav-number">17.</span> <span class="nav-text">文章列表-获取文章列表数据</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9B%AE%E6%A0%87-13"><span class="nav-number">17.1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A4-9"><span class="nav-number">17.2.</span> <span class="nav-text">步骤</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81-9"><span class="nav-number">17.3.</span> <span class="nav-text">代码</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%96%87%E7%AB%A0%E5%88%97%E8%A1%A8-%E5%B0%86%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8%E5%88%B0-Redux-%E4%B8%AD"><span class="nav-number">18.</span> <span class="nav-text">文章列表-将数据存储到 Redux 中</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9B%AE%E6%A0%87-14"><span class="nav-number">18.1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%86%E6%9E%90-3"><span class="nav-number">18.2.</span> <span class="nav-text">分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81-10"><span class="nav-number">18.3.</span> <span class="nav-text">代码</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%96%87%E7%AB%A0%E5%88%97%E8%A1%A8-%E6%B8%B2%E6%9F%93%E6%96%87%E7%AB%A0%E5%88%97%E8%A1%A8"><span class="nav-number">19.</span> <span class="nav-text">文章列表-渲染文章列表</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9B%AE%E6%A0%87-15"><span class="nav-number">19.1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A4-10"><span class="nav-number">19.2.</span> <span class="nav-text">步骤</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%96%87%E7%AB%A0%E5%88%97%E8%A1%A8-%E8%A7%A6%E5%BA%95%E5%8A%A0%E8%BD%BD%E6%9B%B4%E5%A4%9A"><span class="nav-number">20.</span> <span class="nav-text">文章列表-触底加载更多</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9B%AE%E6%A0%87-16"><span class="nav-number">20.1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81-11"><span class="nav-number">20.2.</span> <span class="nav-text">代码</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%96%87%E7%AB%A0%E5%88%97%E8%A1%A8-%E4%B8%8B%E6%8B%89%E5%88%B7%E6%96%B0"><span class="nav-number">21.</span> <span class="nav-text">文章列表-下拉刷新</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9B%AE%E6%A0%87-17"><span class="nav-number">21.1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%86%E6%9E%90-4"><span class="nav-number">21.2.</span> <span class="nav-text">分析</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#IntersectionObserver"><span class="nav-number">22.</span> <span class="nav-text">IntersectionObserver</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%96%87%E7%AB%A0%E5%88%97%E8%A1%A8-%E5%9B%BE%E7%89%87%E6%87%92%E5%8A%A0%E8%BD%BD%E7%9A%84%E5%B0%81%E8%A3%85"><span class="nav-number">23.</span> <span class="nav-text">文章列表-图片懒加载的封装</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9B%AE%E6%A0%87-18"><span class="nav-number">23.1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A4-11"><span class="nav-number">23.2.</span> <span class="nav-text">步骤</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%96%87%E7%AB%A0%E5%88%97%E8%A1%A8-%E7%82%B9%E5%87%BB%E6%96%87%E7%AB%A0%E9%A1%B9%E8%B7%B3%E8%BD%AC%E5%88%B0%E8%AF%A6%E6%83%85"><span class="nav-number">24.</span> <span class="nav-text">文章列表-点击文章项跳转到详情</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9B%AE%E6%A0%87-19"><span class="nav-number">24.1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A4-12"><span class="nav-number">24.2.</span> <span class="nav-text">步骤</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81-12"><span class="nav-number">24.3.</span> <span class="nav-text">代码</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Ifer"
      src="/images/49337922.png">
  <p class="site-author-name" itemprop="name">Ifer</p>
  <div class="site-description" itemprop="description">React 全家桶 <span style='position:relative;top:-2px;'>✍</span></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">23</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://www.zhihu.com/people/weixiantx" title=" → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;weixiantx" rel="noopener" target="_blank"><i class="fab fa-zhihu fa-fw"></i></a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Ifer</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
