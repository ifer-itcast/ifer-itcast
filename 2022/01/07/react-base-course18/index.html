<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.ico">
  <link rel="mask-icon" href="/images/favicon.ico" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"mac"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="今日目标✔ 理解频道管理的业务逻辑。 ✔ 理解文章列表的业务逻辑。 ✔ 理解搜索功能的业务逻辑。">
<meta property="og:type" content="article">
<meta property="og:title" content="18_极客园 H5">
<meta property="og:url" content="http://example.com/2022/01/07/react-base-course18/index.html">
<meta property="og:site_name" content="危险">
<meta property="og:description" content="今日目标✔ 理解频道管理的业务逻辑。 ✔ 理解文章列表的业务逻辑。 ✔ 理解搜索功能的业务逻辑。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/resource/images/image-20210908185453822.png">
<meta property="og:image" content="http://example.com/resource/images/image-20210909103450023.png">
<meta property="og:image" content="http://example.com/resource/images/image-20210909102100740.png">
<meta property="og:image" content="http://example.com/resource/images/image-20210909105543672.png">
<meta property="article:published_time" content="2022-01-07T14:05:48.000Z">
<meta property="article:modified_time" content="2022-07-08T00:44:47.525Z">
<meta property="article:author" content="Ifer">
<meta property="article:tag" content="React,Redux,Mobx,Saga,Dva,Umi,AntD,TS">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/resource/images/image-20210908185453822.png">

<link rel="canonical" href="http://example.com/2022/01/07/react-base-course18/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>18_极客园 H5 | 危险</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">危险</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">为之则易，不为则难</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/01/07/react-base-course18/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/49337922.png">
      <meta itemprop="name" content="Ifer">
      <meta itemprop="description" content="React 全家桶 <span style='position:relative;top:-2px;'>✍</span>">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="危险">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          18_极客园 H5
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-01-07 22:05:48" itemprop="dateCreated datePublished" datetime="2022-01-07T22:05:48+08:00">2022-01-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-07-08 08:44:47" itemprop="dateModified" datetime="2022-07-08T08:44:47+08:00">2022-07-08</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="今日目标"><a href="#今日目标" class="headerlink" title="今日目标"></a>今日目标</h2><p>✔ 理解频道管理的业务逻辑。</p>
<p>✔ 理解文章列表的业务逻辑。</p>
<p>✔ 理解搜索功能的业务逻辑。</p>
<span id="more"></span>

<h2 id="渲染我的频道"><a href="#渲染我的频道" class="headerlink" title="渲染我的频道"></a>渲染我的频道</h2><h3 id="页面结构"><a href="#页面结构" class="headerlink" title="页面结构"></a>页面结构</h3><p><code>pages/Home/index.tsx</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Icon <span class="keyword">from</span> <span class="string">&#x27;@/components/Icon&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&#x27;./index.module.scss&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Home = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;styles.root&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">            &#123;/* 频道 Tabs 列表 */&#125;</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;tabs-opration&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Icon</span> <span class="attr">type</span>=<span class="string">&#x27;iconbtn_search&#x27;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Icon</span> <span class="attr">type</span>=<span class="string">&#x27;iconbtn_channel&#x27;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Home</span><br></pre></td></tr></table></figure>

<p><code>pages/Home/index.module.scss</code></p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.root</span> &#123;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line"></span><br><span class="line">    :global &#123;</span><br><span class="line">        .tabs &#123;</span><br><span class="line">            height: <span class="number">100%</span>;</span><br><span class="line">            <span class="attribute">padding</span>: <span class="number">44px</span> <span class="number">0</span> <span class="number">50px</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">            <span class="selector-class">.adm-tabs-header</span> &#123;</span><br><span class="line">                <span class="attribute">position</span>: fixed;</span><br><span class="line">                <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">                <span class="attribute">z-index</span>: <span class="number">2</span>;</span><br><span class="line">                <span class="attribute">height</span>: <span class="number">44px</span>;</span><br><span class="line">                <span class="attribute">width</span>: calc(<span class="number">100vw</span> - <span class="number">86px</span>);</span><br><span class="line">                <span class="attribute">background-color</span>: <span class="number">#fff</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="selector-class">.adm-tabs-tab</span> &#123;</span><br><span class="line">                <span class="attribute">line-height</span>: <span class="number">25px</span>;</span><br><span class="line">                <span class="attribute">color</span>: <span class="number">#9ea1ae</span>;</span><br><span class="line">                <span class="attribute">font-size</span>: <span class="number">15px</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="selector-class">.adm-tabs-tab-active</span> &#123;</span><br><span class="line">                <span class="attribute">color</span>: var(--adm-color-text);</span><br><span class="line">                <span class="attribute">font-size</span>: <span class="number">18px</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="selector-class">.adm-tabs-tab-line</span> &#123;</span><br><span class="line">                <span class="attribute">height</span>: <span class="number">3px</span>;</span><br><span class="line">                <span class="attribute">border-radius</span>: <span class="number">2px</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="selector-class">.adm-tabs-content</span> &#123;</span><br><span class="line">                <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">                <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="selector-class">.tabs-opration</span> &#123;</span><br><span class="line">            <span class="attribute">position</span>: absolute;</span><br><span class="line">            <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">            <span class="attribute">right</span>: <span class="number">0</span>;</span><br><span class="line">            <span class="attribute">z-index</span>: <span class="number">2</span>;</span><br><span class="line">            <span class="attribute">display</span>: flex;</span><br><span class="line">            <span class="attribute">align-items</span>: center;</span><br><span class="line">            <span class="attribute">width</span>: <span class="number">86px</span>;</span><br><span class="line">            <span class="attribute">height</span>: <span class="number">44px</span>;</span><br><span class="line">            <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">14px</span>;</span><br><span class="line">            <span class="attribute">background</span>: <span class="number">#fff</span>;</span><br><span class="line">            <span class="attribute">border-bottom</span>: <span class="number">1px</span> solid <span class="number">#efefef</span>;</span><br><span class="line"></span><br><span class="line">            <span class="selector-class">.icon</span> &#123;</span><br><span class="line">                <span class="attribute">color</span>: <span class="number">#9ea1ae</span>;</span><br><span class="line">                <span class="attribute">font-size</span>: <span class="number">18px</span>;</span><br><span class="line"></span><br><span class="line">                &amp;<span class="selector-pseudo">:first</span>-child &#123;</span><br><span class="line">                    <span class="attribute">margin-right</span>: <span class="number">21px</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">:global &#123;</span><br><span class="line">    .channel-popup &#123;</span><br><span class="line">        .adm-popup-body &#123;</span><br><span class="line">            overflow-y: scroll;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Tabs-组件"><a href="#Tabs-组件" class="headerlink" title="Tabs 组件"></a>Tabs 组件</h3><p><code>pages/Home/index.tsx</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Icon <span class="keyword">from</span> <span class="string">&#x27;@/components/Icon&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; Tabs &#125; <span class="keyword">from</span> <span class="string">&#x27;antd-mobile&#x27;</span></span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&#x27;./index.module.scss&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Home = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;styles.root&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Tabs</span> <span class="attr">className</span>=<span class="string">&#x27;tabs&#x27;</span> <span class="attr">activeLineMode</span>=<span class="string">&#x27;fixed&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Tabs.Tab</span> <span class="attr">title</span>=<span class="string">&#x27;推荐&#x27;</span> <span class="attr">key</span>=<span class="string">&#x27;1&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    推荐频道的内容</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">Tabs.Tab</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Tabs.Tab</span> <span class="attr">title</span>=<span class="string">&#x27;html&#x27;</span> <span class="attr">key</span>=<span class="string">&#x27;2&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    html频道的内容</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">Tabs.Tab</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Tabs.Tab</span> <span class="attr">title</span>=<span class="string">&#x27;开发者资讯&#x27;</span> <span class="attr">key</span>=<span class="string">&#x27;3&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    开发者资讯频道的内容</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">Tabs.Tab</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Tabs.Tab</span> <span class="attr">title</span>=<span class="string">&#x27;c++&#x27;</span> <span class="attr">key</span>=<span class="string">&#x27;4&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    c++频道的内容</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">Tabs.Tab</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Tabs.Tab</span> <span class="attr">title</span>=<span class="string">&#x27;css&#x27;</span> <span class="attr">key</span>=<span class="string">&#x27;5&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    css频道的内容</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">Tabs.Tab</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">Tabs</span>&gt;</span></span></span><br><span class="line"><span class="xml">            &#123;/* 频道 Tabs 列表 */&#125;</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;tabs-opration&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Icon</span> <span class="attr">type</span>=<span class="string">&#x27;iconbtn_search&#x27;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Icon</span> <span class="attr">type</span>=<span class="string">&#x27;iconbtn_channel&#x27;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Home</span><br></pre></td></tr></table></figure>

<h3 id="获取频道列表数据"><a href="#获取频道列表数据" class="headerlink" title="获取频道列表数据"></a>获取频道列表数据</h3><ol>
<li><code>types/data.d.ts</code></li>
</ol>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> Channel = &#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="built_in">number</span></span><br><span class="line">    <span class="attr">name</span>: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><code>actions/home.ts</code></li>
</ol>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ApiResponse, Channel &#125; <span class="keyword">from</span> <span class="string">&#x27;@/types/data&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; RootThunkAction &#125; <span class="keyword">from</span> <span class="string">&#x27;@/types/store&#x27;</span></span><br><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getUserChannel = (): <span class="function"><span class="params">RootThunkAction</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">async</span> (dispatch, getState) =&gt; &#123;</span><br><span class="line">        <span class="keyword">const</span> res = <span class="keyword">await</span> request.get&lt;ApiResponse&lt;&#123; <span class="attr">channels</span>: Channel[] &#125;&gt;&gt;(<span class="string">&#x27;/user/channels&#x27;</span>)</span><br><span class="line">        <span class="keyword">const</span> &#123; channels &#125; = res.data.data</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;频道&#x27;</span>, channels)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li><code>pages/Home/index.tsx</code></li>
</ol>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 先测试下拿到的数据，实际应该拿 &#x27;home&#x27; 的数据</span></span><br><span class="line">useInitState(getUserChannel, <span class="string">&#x27;profile&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="存储到-Redux"><a href="#存储到-Redux" class="headerlink" title="存储到 Redux"></a>存储到 Redux</h3><p><code>types/store.d.ts</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Channel &#125; <span class="keyword">from</span> <span class="string">&#x27;./data&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> HomeAction = &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;home/getUserChannels&#x27;</span></span><br><span class="line">    <span class="attr">payload</span>: Channel[]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> RootAction = LoginAction | ProfileAction | HomeAction</span><br></pre></td></tr></table></figure>

<p><code>actions/home.ts</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">getUserChannel</span>(<span class="params"></span>): <span class="title">RootThunkAction</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">async</span> (dispatch) =&gt; &#123;</span><br><span class="line">        <span class="keyword">const</span> res = <span class="keyword">await</span> request.get&lt;ApiResponse&lt;&#123; <span class="attr">channels</span>: Channel[] &#125;&gt;&gt;(<span class="string">&#x27;/user/channels&#x27;</span>)</span><br><span class="line">        dispatch(&#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;home/getUserChannels&#x27;</span>,</span><br><span class="line">            <span class="attr">payload</span>: res.data.data.channels,</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>reducers/home.ts</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Channel &#125; <span class="keyword">from</span> <span class="string">&#x27;@/types/data&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; HomeAction &#125; <span class="keyword">from</span> <span class="string">&#x27;@/types/store&#x27;</span></span><br><span class="line"><span class="keyword">type</span> HomeState = &#123;</span><br><span class="line">    <span class="attr">userChannels</span>: Channel[]</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> initValue: HomeState = &#123;</span><br><span class="line">    <span class="attr">userChannels</span>: [],</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">home</span>(<span class="params">state = initValue, action: HomeAction</span>): <span class="title">HomeState</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (action.type === <span class="string">&#x27;home/getUserChannels&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            ...state,</span><br><span class="line">            <span class="attr">userChannels</span>: action.payload,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> state</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>reducers/index.ts</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> home <span class="keyword">from</span> <span class="string">&#x27;./home&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> combineReducers(&#123; login, profile, home &#125;)</span><br></pre></td></tr></table></figure>

<h3 id="渲染数据"><a href="#渲染数据" class="headerlink" title="渲染数据"></a>渲染数据</h3><p><code>Home/index.tsx</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Icon <span class="keyword">from</span> <span class="string">&#x27;@/components/Icon&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; getUserChannel &#125; <span class="keyword">from</span> <span class="string">&#x27;@/store/actions/home&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useInitState &#125; <span class="keyword">from</span> <span class="string">&#x27;@/utils/hooks&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; Tabs &#125; <span class="keyword">from</span> <span class="string">&#x27;antd-mobile&#x27;</span></span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&#x27;./index.module.scss&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Home = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; userChannels &#125; = useInitState(getUserChannel, <span class="string">&#x27;home&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;styles.root&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Tabs</span> <span class="attr">className</span>=<span class="string">&#x27;tabs&#x27;</span> <span class="attr">activeLineMode</span>=<span class="string">&#x27;fixed&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                &#123;userChannels.map((item) =&gt; (</span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">Tabs.Tab</span> <span class="attr">title</span>=<span class="string">&#123;item.name&#125;</span> <span class="attr">key</span>=<span class="string">&#123;item.id&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        &#123;item.name&#125;的内容</span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">Tabs.Tab</span>&gt;</span></span></span><br><span class="line"><span class="xml">                ))&#125;</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">Tabs</span>&gt;</span></span></span><br><span class="line"><span class="xml">            &#123;/* 频道 Tabs 列表 */&#125;</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;tabs-opration&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Icon</span> <span class="attr">type</span>=<span class="string">&#x27;iconbtn_search&#x27;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Icon</span> <span class="attr">type</span>=<span class="string">&#x27;iconbtn_channel&#x27;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Home</span><br></pre></td></tr></table></figure>

<p>解决初始高亮 Tab 底部的位置问题。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 注意 userChannels 是在外部做的判断，ok 的话渲染整个 Tabs 组件</span></span><br><span class="line">&#123;</span><br><span class="line">    userChannels.length &gt; <span class="number">0</span> &amp;&amp; (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">Tabs</span> <span class="attr">className</span>=<span class="string">&#x27;tabs&#x27;</span> <span class="attr">activeLineMode</span>=<span class="string">&#x27;fixed&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">            &#123;userChannels.map((item) =&gt; (</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Tabs.Tab</span> <span class="attr">title</span>=<span class="string">&#123;item.name&#125;</span> <span class="attr">key</span>=<span class="string">&#123;item.id&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    &#123;item.name&#125;的内容</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">Tabs.Tab</span>&gt;</span></span></span><br><span class="line"><span class="xml">            ))&#125;</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">Tabs</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="渲染频道管理"><a href="#渲染频道管理" class="headerlink" title="渲染频道管理"></a>渲染频道管理</h2><h3 id="弹层显示隐藏"><a href="#弹层显示隐藏" class="headerlink" title="弹层显示隐藏"></a>弹层显示隐藏</h3><h4 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h4><p>能够渲染频道管理弹出层。</p>
<h4 id="素材"><a href="#素材" class="headerlink" title="素材"></a>素材</h4><p><code>Home/components/Channels/index.tsx</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> classnames <span class="keyword">from</span> <span class="string">&#x27;classnames&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> Icon <span class="keyword">from</span> <span class="string">&#x27;@/components/Icon&#x27;</span></span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&#x27;./index.module.scss&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Channels = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;styles.root&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;channel-header&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Icon</span> <span class="attr">type</span>=<span class="string">&#x27;iconbtn_channel_close&#x27;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;channel-content&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                &#123;/* 编辑时，添加类名 edit */&#125;</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;classnames(</span>&#x27;<span class="attr">channel-item</span>&#x27;)&#125;&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;channel-item-header&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">span</span> <span class="attr">className</span>=<span class="string">&#x27;channel-item-title&#x27;</span>&gt;</span>我的频道<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">span</span> <span class="attr">className</span>=<span class="string">&#x27;channel-item-title-extra&#x27;</span>&gt;</span>点击进入频道<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">span</span> <span class="attr">className</span>=<span class="string">&#x27;channel-item-edit&#x27;</span>&gt;</span>编辑<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;channel-list&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        &#123;/* 选中时，添加类名 selected */&#125;</span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">span</span> <span class="attr">className</span>=<span class="string">&#123;classnames(</span>&#x27;<span class="attr">channel-list-item</span>&#x27;)&#125;&gt;</span></span></span><br><span class="line"><span class="xml">                            推荐</span></span><br><span class="line"><span class="xml">                            <span class="tag">&lt;<span class="name">Icon</span> <span class="attr">type</span>=<span class="string">&#x27;iconbtn_tag_close&#x27;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;channel-item&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;channel-item-header&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">span</span> <span class="attr">className</span>=<span class="string">&#x27;channel-item-title&#x27;</span>&gt;</span>频道推荐<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">span</span> <span class="attr">className</span>=<span class="string">&#x27;channel-item-title-extra&#x27;</span>&gt;</span>点击添加频道<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;channel-list&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">span</span> <span class="attr">className</span>=<span class="string">&#x27;channel-list-item&#x27;</span>&gt;</span>+ HTML<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Channels</span><br></pre></td></tr></table></figure>

<p><code>Home/components/Channels/index.module.scss</code></p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.root</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">375px</span>;</span><br><span class="line">    :global &#123;</span><br><span class="line">        .channel-header &#123;</span><br><span class="line">            position: relative;</span><br><span class="line">            <span class="attribute">height</span>: <span class="number">44px</span>;</span><br><span class="line">            <span class="attribute">padding</span>: <span class="number">13px</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">            <span class="selector-class">.icon</span> &#123;</span><br><span class="line">                <span class="attribute">position</span>: absolute;</span><br><span class="line">                <span class="attribute">right</span>: <span class="number">16px</span>;</span><br><span class="line">                <span class="attribute">width</span>: <span class="number">18px</span>;</span><br><span class="line">                <span class="attribute">height</span>: <span class="number">18px</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="selector-class">.channel-content</span> &#123;</span><br><span class="line">            <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">16px</span>;</span><br><span class="line"></span><br><span class="line">            <span class="selector-class">.channel-item</span> &#123;</span><br><span class="line">                <span class="attribute">margin-bottom</span>: <span class="number">16px</span>;</span><br><span class="line"></span><br><span class="line">                &amp;<span class="selector-class">.edit</span> &#123;</span><br><span class="line">                    <span class="selector-class">.channel-item-edit</span> &#123;</span><br><span class="line">                        <span class="attribute">color</span>: <span class="number">#fff</span>;</span><br><span class="line">                        <span class="attribute">background-color</span>: <span class="number">#de644b</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="selector-class">.icon</span> &#123;</span><br><span class="line">                        <span class="attribute">display</span>: block;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="selector-class">.channel-item-header</span> &#123;</span><br><span class="line">                <span class="attribute">position</span>: relative;</span><br><span class="line">                <span class="attribute">height</span>: <span class="number">22px</span>;</span><br><span class="line">                <span class="attribute">line-height</span>: <span class="number">22px</span>;</span><br><span class="line">                <span class="attribute">margin-bottom</span>: <span class="number">22px</span>;</span><br><span class="line"></span><br><span class="line">                <span class="selector-class">.channel-item-title</span> &#123;</span><br><span class="line">                    <span class="attribute">margin-right</span>: <span class="number">10px</span>;</span><br><span class="line">                    <span class="attribute">font-size</span>: <span class="number">17px</span>;</span><br><span class="line">                    <span class="attribute">color</span>: <span class="number">#333</span>;</span><br><span class="line">                    <span class="attribute">font-weight</span>: <span class="number">500</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="selector-class">.channel-item-title-extra</span> &#123;</span><br><span class="line">                    <span class="attribute">font-size</span>: <span class="number">12px</span>;</span><br><span class="line">                    <span class="attribute">color</span>: <span class="number">#a5a6ab</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="selector-class">.channel-item-edit</span> &#123;</span><br><span class="line">                    <span class="attribute">display</span>: inline-block;</span><br><span class="line">                    <span class="attribute">position</span>: absolute;</span><br><span class="line">                    <span class="attribute">right</span>: <span class="number">0</span>;</span><br><span class="line">                    <span class="attribute">width</span>: <span class="number">52px</span>;</span><br><span class="line">                    <span class="attribute">height</span>: <span class="number">22px</span>;</span><br><span class="line">                    <span class="attribute">line-height</span>: <span class="number">21px</span>;</span><br><span class="line">                    <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#de644b</span>;</span><br><span class="line">                    <span class="attribute">border-radius</span>: <span class="number">12px</span>;</span><br><span class="line">                    <span class="attribute">color</span>: <span class="number">#de644b</span>;</span><br><span class="line">                    <span class="attribute">text-align</span>: center;</span><br><span class="line">                    <span class="attribute">font-size</span>: <span class="number">12px</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="selector-class">.channel-list</span> &#123;</span><br><span class="line">                &amp;-item &#123;</span><br><span class="line">                    <span class="attribute">position</span>: relative;</span><br><span class="line">                    <span class="attribute">display</span>: inline-block;</span><br><span class="line">                    <span class="attribute">padding</span>: <span class="number">10px</span> <span class="number">23px</span>;</span><br><span class="line">                    <span class="attribute">margin-right</span>: <span class="number">13px</span>;</span><br><span class="line">                    <span class="attribute">margin-bottom</span>: <span class="number">16px</span>;</span><br><span class="line">                    <span class="attribute">border-radius</span>: <span class="number">18px</span>;</span><br><span class="line">                    <span class="attribute">color</span>: <span class="number">#3a3948</span>;</span><br><span class="line">                    <span class="attribute">font-size</span>: <span class="number">14px</span>;</span><br><span class="line">                    <span class="attribute">background-color</span>: <span class="number">#f7f8fa</span>;</span><br><span class="line"></span><br><span class="line">                    <span class="selector-class">.icon</span> &#123;</span><br><span class="line">                        <span class="attribute">display</span>: none;</span><br><span class="line">                        <span class="attribute">position</span>: absolute;</span><br><span class="line">                        <span class="attribute">top</span>: -<span class="number">5px</span>;</span><br><span class="line">                        <span class="attribute">right</span>: <span class="number">0</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                &amp;-item<span class="selector-class">.selected</span> &#123;</span><br><span class="line">                    <span class="attribute">color</span>: <span class="number">#fc6627</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h4><ol>
<li><p>将模板 Channels 拷贝到 Home/components 目录中。</p>
</li>
<li><p>在 Home 组件中导入 Channels 组件。</p>
</li>
<li><p>使用 Popup 组件渲染 Channels 内容。</p>
</li>
<li><p>创建控制频道管理弹出层展示或隐藏的状态。</p>
</li>
<li><p>控制弹出层的展示或隐藏。</p>
</li>
</ol>
<h4 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h4><p><code>Home/index.tsx</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Icon <span class="keyword">from</span> <span class="string">&#x27;@/components/Icon&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; getUserChannel &#125; <span class="keyword">from</span> <span class="string">&#x27;@/store/actions/home&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useInitState &#125; <span class="keyword">from</span> <span class="string">&#x27;@/utils/hooks&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; Tabs, Popup &#125; <span class="keyword">from</span> <span class="string">&#x27;antd-mobile&#x27;</span></span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&#x27;./index.module.scss&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Channels <span class="keyword">from</span> <span class="string">&#x27;./components/Channels&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Home = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> [visible, setVisible] = useState(<span class="literal">false</span>)</span><br><span class="line">    <span class="keyword">const</span> &#123; userChannels &#125; = useInitState(getUserChannel, <span class="string">&#x27;home&#x27;</span>)</span><br><span class="line">    <span class="keyword">const</span> show = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        setVisible(<span class="literal">true</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> hide = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        setVisible(<span class="literal">false</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;styles.root&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">            &#123;userChannels.length &gt; 0 &amp;&amp; (</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Tabs</span> <span class="attr">className</span>=<span class="string">&#x27;tabs&#x27;</span> <span class="attr">activeLineMode</span>=<span class="string">&#x27;fixed&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    &#123;userChannels.map((item) =&gt; (</span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">Tabs.Tab</span> <span class="attr">title</span>=<span class="string">&#123;item.name&#125;</span> <span class="attr">key</span>=<span class="string">&#123;item.id&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                            &#123;item.name&#125;的内容</span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;/<span class="name">Tabs.Tab</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    ))&#125;</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">Tabs</span>&gt;</span></span></span><br><span class="line"><span class="xml">            )&#125;</span></span><br><span class="line"><span class="xml">            &#123;/* 频道 Tabs 列表 */&#125;</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;tabs-opration&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Icon</span> <span class="attr">type</span>=<span class="string">&#x27;iconbtn_search&#x27;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Icon</span> <span class="attr">type</span>=<span class="string">&#x27;iconbtn_channel&#x27;</span> <span class="attr">onClick</span>=<span class="string">&#123;show&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Popup</span> <span class="attr">position</span>=<span class="string">&#x27;left&#x27;</span> <span class="attr">visible</span>=<span class="string">&#123;visible&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Channels</span> <span class="attr">hide</span>=<span class="string">&#123;hide&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">Popup</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Home</span><br></pre></td></tr></table></figure>

<p><code>Home/components/Channels/index.tsx</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Props = &#123;</span><br><span class="line">    <span class="attr">hide</span>: <span class="function">() =&gt;</span> <span class="built_in">void</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Channels = <span class="function">(<span class="params">&#123; hide &#125;: Props</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;styles.root&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;channel-header&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Icon</span> <span class="attr">type</span>=<span class="string">&#x27;iconbtn_channel_close&#x27;</span> <span class="attr">onClick</span>=<span class="string">&#123;hide&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="渲染我的频道-1"><a href="#渲染我的频道-1" class="headerlink" title="渲染我的频道"></a>渲染我的频道</h3><h4 id="目标-1"><a href="#目标-1" class="headerlink" title="目标"></a>目标</h4><p>能够渲染我的频道列表。</p>
<h4 id="步骤-1"><a href="#步骤-1" class="headerlink" title="步骤"></a>步骤</h4><p>我的频道中展示的数据就是在首页中获取到的用户频道列表数据，因此只需要在频道管理组件中拿到用户频道列表数据即可。</p>
<ol>
<li><p>在 Channels 中，从 redux 中获取到用户频道数据。</p>
</li>
<li><p>渲染用户频道列表数据。</p>
</li>
</ol>
<p><code>Channels/index.tsx</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useSelector &#125; <span class="keyword">from</span> <span class="string">&#x27;react-redux&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; RootState &#125; <span class="keyword">from</span> <span class="string">&#x27;@/types/store&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Channels = <span class="function">(<span class="params">&#123; hide &#125;: Props</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; userChannels &#125; = useSelector(<span class="function">(<span class="params">state: RootState</span>) =&gt;</span> state.home)</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;channel-list&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">            &#123;/* 选中时，添加类名 selected */&#125;</span></span><br><span class="line"><span class="xml">            &#123;userChannels.map((item) =&gt; (</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">key</span>=<span class="string">&#123;item.id&#125;</span> <span class="attr">className</span>=<span class="string">&#123;classnames(</span>&#x27;<span class="attr">channel-list-item</span>&#x27;)&#125;&gt;</span></span></span><br><span class="line"><span class="xml">                    &#123;item.name&#125;</span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">Icon</span> <span class="attr">type</span>=<span class="string">&#x27;iconbtn_tag_close&#x27;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">            ))&#125;</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="获取所有频道"><a href="#获取所有频道" class="headerlink" title="获取所有频道"></a>获取所有频道</h3><h4 id="目标-2"><a href="#目标-2" class="headerlink" title="目标"></a>目标</h4><p>能够获取到所有频道的数据。</p>
<h4 id="代码-1"><a href="#代码-1" class="headerlink" title="代码"></a>代码</h4><p>频道推荐中展示的是除了我的频道之外的其他频道数据，由于接口并没有直接提供频道推荐数据，因此可以拿到所有频道数据，然后排除掉我的频道数据，剩下的就是频道推荐数据了。</p>
<p><code>types/store.d.ts</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> HomeAction =</span><br><span class="line">    | &#123;</span><br><span class="line">          <span class="attr">type</span>: <span class="string">&#x27;home/getUserChannels&#x27;</span></span><br><span class="line">          <span class="attr">payload</span>: Channel[]</span><br><span class="line">      &#125;</span><br><span class="line">    | &#123;</span><br><span class="line">          <span class="attr">type</span>: <span class="string">&#x27;home/getAllChannels&#x27;</span></span><br><span class="line">          <span class="attr">payload</span>: Channel[]</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure>

<p><code>actions/home.ts</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">getAllChannel</span>(<span class="params"></span>): <span class="title">RootThunkAction</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">async</span> (dispatch) =&gt; &#123;</span><br><span class="line">        <span class="keyword">const</span> res = <span class="keyword">await</span> request.get&lt;ApiResponse&lt;&#123; <span class="attr">channels</span>: Channel[] &#125;&gt;&gt;(<span class="string">&#x27;/channels&#x27;</span>)</span><br><span class="line">        dispatch(&#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;home/getAllChannels&#x27;</span>,</span><br><span class="line">            <span class="attr">payload</span>: res.data.data.channels,</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>reducers/home.ts</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Channel &#125; <span class="keyword">from</span> <span class="string">&#x27;@/types/data&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; HomeAction &#125; <span class="keyword">from</span> <span class="string">&#x27;@/types/store&#x27;</span></span><br><span class="line"><span class="keyword">type</span> HomeState = &#123;</span><br><span class="line">    <span class="attr">userChannels</span>: Channel[]</span><br><span class="line">    <span class="attr">allChannels</span>: Channel[]</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> initValue: HomeState = &#123;</span><br><span class="line">    <span class="attr">userChannels</span>: [],</span><br><span class="line">    <span class="attr">allChannels</span>: [],</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">home</span>(<span class="params">state = initValue, action: HomeAction</span>): <span class="title">HomeState</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (action.type === <span class="string">&#x27;home/getUserChannels&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            ...state,</span><br><span class="line">            <span class="attr">userChannels</span>: action.payload,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (action.type === <span class="string">&#x27;home/getAllChannels&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            ...state,</span><br><span class="line">            <span class="attr">allChannels</span>: action.payload,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> state</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>home/index.tsx</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Home = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 目的：把请求到的数据存储到 Redux</span></span><br><span class="line">    useInitState(getAllChannel, <span class="string">&#x27;home&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="渲染频道推荐"><a href="#渲染频道推荐" class="headerlink" title="渲染频道推荐"></a>渲染频道推荐</h3><h4 id="目标-3"><a href="#目标-3" class="headerlink" title="目标"></a>目标</h4><p>能够渲染频道推荐列表。</p>
<h4 id="代码-2"><a href="#代码-2" class="headerlink" title="代码"></a>代码</h4><p><code>Home/components/Channels/index.tsx</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Channels = <span class="function">(<span class="params">&#123; hide &#125;: Props</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; userChannels &#125; = useSelector(<span class="function">(<span class="params">state: RootState</span>) =&gt;</span> state.home)</span><br><span class="line">    <span class="keyword">const</span> recommendChannels = useSelector(<span class="function">(<span class="params">state: RootState</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; userChannels, allChannels &#125; = state.home</span><br><span class="line">        <span class="comment">// 保留从 userChannels 中找不到的</span></span><br><span class="line">        <span class="keyword">return</span> allChannels.filter(<span class="function">(<span class="params">item</span>) =&gt;</span> userChannels.findIndex(<span class="function">(<span class="params">v</span>) =&gt;</span> v.id === item.id) === -<span class="number">1</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;channel-list&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">            &#123;recommendChannels.map((item) =&gt; (</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">key</span>=<span class="string">&#123;item.id&#125;</span> <span class="attr">className</span>=<span class="string">&#x27;channel-list-item&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    + &#123;item.name&#125;</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">            ))&#125;</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用 lodash 提供的方法，计算出推荐频道。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add lodash @types/lodash</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> recommendChannels = differenceBy(allChannels, userChannels, <span class="string">&#x27;id&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="我的频道逻辑"><a href="#我的频道逻辑" class="headerlink" title="我的频道逻辑"></a>我的频道逻辑</h3><h4 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h4><ul>
<li><p>  如果用户登录了，需要发送请求获取用户的频道。</p>
</li>
<li><p>  如果用户没有登录，从 localstorage 中获取用户的频道信息。</p>
</li>
<li><p>  如果本地没有用户的频道信息，需要发送请求获取默认的频道，把默认频道存储到本地。</p>
</li>
</ul>
<h4 id="代码-3"><a href="#代码-3" class="headerlink" title="代码"></a>代码</h4><p><code>utils/storage.ts</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> CHANNEL_KEY = <span class="string">&#x27;GEEK_H5_CHANNEL&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">setChannels</span>(<span class="params">channels: Channel[]</span>): <span class="title">void</span> </span>&#123;</span><br><span class="line">    <span class="built_in">localStorage</span>.setItem(CHANNEL_KEY, <span class="built_in">JSON</span>.stringify(channels))</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">getChannels</span>(<span class="params"></span>): <span class="title">Channel</span>[] </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">JSON</span>.parse(<span class="built_in">localStorage</span>.getItem(CHANNEL_KEY) || <span class="string">&#x27;[]&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>actions/home.ts</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getUserChannel = (): <span class="function"><span class="params">RootThunkAction</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">async</span> (dispatch) =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (hasToken()) &#123;</span><br><span class="line">            <span class="comment">// !#1 登录了</span></span><br><span class="line">            <span class="keyword">const</span> res = <span class="keyword">await</span> request.get&lt;ApiResponse&lt;&#123; <span class="attr">channels</span>: Channel[] &#125;&gt;&gt;(<span class="string">&#x27;/user/channels&#x27;</span>)</span><br><span class="line">            dispatch(&#123;</span><br><span class="line">                <span class="attr">type</span>: <span class="string">&#x27;home/getUserChannels&#x27;</span>,</span><br><span class="line">                <span class="attr">payload</span>: res.data.data.channels,</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// !#2 未登录</span></span><br><span class="line">            <span class="keyword">const</span> channels = getChannels()</span><br><span class="line">            <span class="keyword">if</span> (channels.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="comment">// !#3 本地有</span></span><br><span class="line">                dispatch(&#123;</span><br><span class="line">                    <span class="attr">type</span>: <span class="string">&#x27;home/getUserChannels&#x27;</span>,</span><br><span class="line">                    <span class="attr">payload</span>: channels,</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// !#4 本地无</span></span><br><span class="line">                <span class="keyword">const</span> res = <span class="keyword">await</span> request.get&lt;ApiResponse&lt;&#123; <span class="attr">channels</span>: Channel[] &#125;&gt;&gt;(<span class="string">&#x27;/user/channels&#x27;</span>)</span><br><span class="line">                dispatch(&#123;</span><br><span class="line">                    <span class="attr">type</span>: <span class="string">&#x27;home/getUserChannels&#x27;</span>,</span><br><span class="line">                    <span class="attr">payload</span>: res.data.data.channels,</span><br><span class="line">                &#125;)</span><br><span class="line">                <span class="comment">// !#5 存储：本地存储的应该是与登录状态无关的频道数据</span></span><br><span class="line">                setChannels(res.data.data.channels)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="频道管理交互"><a href="#频道管理交互" class="headerlink" title="频道管理交互"></a>频道管理交互</h2><h3 id="点击我的频道高亮"><a href="#点击我的频道高亮" class="headerlink" title="点击我的频道高亮"></a>点击我的频道高亮</h3><h4 id="目标-4"><a href="#目标-4" class="headerlink" title="目标"></a>目标</h4><p>能够实现切换频道功能。</p>
<h4 id="分析-1"><a href="#分析-1" class="headerlink" title="分析"></a>分析</h4><ol>
<li><p>首先明确：首页顶部的频道和频道管理中的我的频道是关联在一起的。</p>
</li>
<li><p>点击频道管理中的我的频道时，首页顶部的频道会切换，并高亮。</p>
</li>
<li><p>点击首页顶部的频道时，频道管理对应的频道也要高亮。</p>
</li>
<li><p>因此，需要准备一个状态用来记录当前选中频道，并且两个组件中都需要用到该状态，所以，可以直接将该状态存储到 redux 中，实现状态共享。然后，不管是首页顶部的频道还是频道管理中的我的频道，只需要在点击切换时，修改 redux 中记录的状态值即可。</p>
</li>
</ol>
<h4 id="代码-4"><a href="#代码-4" class="headerlink" title="代码"></a>代码</h4><p><code>types/store.d.ts</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> HomeAction =</span><br><span class="line">    | &#123;</span><br><span class="line">          <span class="attr">type</span>: <span class="string">&#x27;home/getUserChannels&#x27;</span></span><br><span class="line">          <span class="attr">payload</span>: Channel[]</span><br><span class="line">      &#125;</span><br><span class="line">    | &#123;</span><br><span class="line">          <span class="attr">type</span>: <span class="string">&#x27;home/getAllChannels&#x27;</span></span><br><span class="line">          <span class="attr">payload</span>: Channel[]</span><br><span class="line">      &#125;</span><br><span class="line">    | &#123;</span><br><span class="line">          <span class="attr">type</span>: <span class="string">&#x27;home/changeActive&#x27;</span></span><br><span class="line">          <span class="attr">payload</span>: <span class="built_in">number</span></span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure>

<p><code>actions/home.ts</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">changeActive</span>(<span class="params">id: <span class="built_in">number</span></span>): <span class="title">HomeAction</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;home/changeActive&#x27;</span>,</span><br><span class="line">        <span class="attr">payload</span>: id,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>redcuers/home.ts</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Channel &#125; <span class="keyword">from</span> <span class="string">&#x27;@/types/data&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; HomeAction &#125; <span class="keyword">from</span> <span class="string">&#x27;@/types/store&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> HomeState = &#123;</span><br><span class="line">    <span class="attr">userChannels</span>: Channel[]</span><br><span class="line">    <span class="attr">allChannels</span>: Channel[]</span><br><span class="line">    <span class="comment">// #1</span></span><br><span class="line">    <span class="attr">active</span>: <span class="built_in">number</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> initState: HomeState = &#123;</span><br><span class="line">    <span class="attr">userChannels</span>: [],</span><br><span class="line">    <span class="attr">allChannels</span>: [],</span><br><span class="line">    <span class="comment">// #2</span></span><br><span class="line">    <span class="attr">active</span>: <span class="number">0</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">home</span>(<span class="params">state = initState, action: HomeAction</span>): <span class="title">HomeState</span> </span>&#123;</span><br><span class="line">    <span class="keyword">switch</span> (action.type) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;home/getUserChannels&#x27;</span>:</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                ...state,</span><br><span class="line">                <span class="attr">userChannels</span>: action.payload,</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;home/getAllChannels&#x27;</span>:</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                ...state,</span><br><span class="line">                <span class="attr">allChannels</span>: action.payload,</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="comment">// #3</span></span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;home/changeActive&#x27;</span>:</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                ...state,</span><br><span class="line">                <span class="attr">active</span>: action.payload,</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="attr">default</span>:</span><br><span class="line">            <span class="keyword">return</span> state</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>pages/Home/components/Channels/index.tsx</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> classnames <span class="keyword">from</span> <span class="string">&#x27;classnames&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useSelector, useDispatch &#125; <span class="keyword">from</span> <span class="string">&#x27;react-redux&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; RootState &#125; <span class="keyword">from</span> <span class="string">&#x27;@/types/store&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Icon <span class="keyword">from</span> <span class="string">&#x27;@/components/Icon&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; differenceBy &#125; <span class="keyword">from</span> <span class="string">&#x27;lodash&#x27;</span></span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&#x27;./index.module.scss&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; changeActive &#125; <span class="keyword">from</span> <span class="string">&#x27;@/store/actions/home&#x27;</span></span><br><span class="line"><span class="keyword">type</span> Props = &#123;</span><br><span class="line">    <span class="attr">hide</span>: <span class="function">() =&gt;</span> <span class="built_in">void</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> Channels = <span class="function">(<span class="params">&#123; hide &#125;: Props</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> dispatch = useDispatch()</span><br><span class="line">    <span class="comment">// !#3 获取 Redux 中的 active 并和循环时候的 item.id 进行比较，命中则应用高亮的 class</span></span><br><span class="line">    <span class="keyword">const</span> &#123; userChannels, allChannels, active &#125; = useSelector(<span class="function">(<span class="params">state: RootState</span>) =&gt;</span> state.home)</span><br><span class="line">    <span class="keyword">const</span> recommendChannels = differenceBy(allChannels, userChannels, <span class="string">&#x27;id&#x27;</span>)</span><br><span class="line">    <span class="comment">// !#2 修改 Redux 中的 active 并隐藏弹框</span></span><br><span class="line">    <span class="keyword">const</span> onChange = <span class="function">(<span class="params">id: <span class="built_in">number</span></span>) =&gt;</span> &#123;</span><br><span class="line">        dispatch(changeActive(id))</span><br><span class="line">        hide()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;styles.root&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;channel-header&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Icon</span> <span class="attr">type</span>=<span class="string">&#x27;iconbtn_channel_close&#x27;</span> <span class="attr">onClick</span>=<span class="string">&#123;hide&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;channel-content&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                &#123;/* 编辑时，添加类名 edit */&#125;</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;classnames(</span>&#x27;<span class="attr">channel-item</span>&#x27;)&#125;&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;channel-item-header&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">span</span> <span class="attr">className</span>=<span class="string">&#x27;channel-item-title&#x27;</span>&gt;</span>我的频道<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">span</span> <span class="attr">className</span>=<span class="string">&#x27;channel-item-title-extra&#x27;</span>&gt;</span>点击进入频道<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">span</span> <span class="attr">className</span>=<span class="string">&#x27;channel-item-edit&#x27;</span>&gt;</span>编辑<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;channel-list&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        &#123;/* //!#1 绑定点击事件 */&#125;</span></span><br><span class="line"><span class="xml">                        &#123;userChannels.map((item) =&gt; (</span></span><br><span class="line"><span class="xml">                            <span class="tag">&lt;<span class="name">span</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                                <span class="attr">key</span>=<span class="string">&#123;item.id&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                                <span class="attr">className</span>=<span class="string">&#123;classnames(</span>&#x27;<span class="attr">channel-list-item</span>&#x27;, &#123;</span></span></span><br><span class="line"><span class="tag"><span class="xml">                                    <span class="attr">selected:</span> <span class="attr">item.id</span> === <span class="string">active,</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                                &#125;)&#125;</span></span></span><br><span class="line"><span class="tag"><span class="xml">                                <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> onChange(item.id)&#125;</span></span><br><span class="line"><span class="xml">                            &gt;</span></span><br><span class="line"><span class="xml">                                &#123;item.name&#125;</span></span><br><span class="line"><span class="xml">                                <span class="tag">&lt;<span class="name">Icon</span> <span class="attr">type</span>=<span class="string">&#x27;iconbtn_tag_close&#x27;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                            <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        ))&#125;</span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;channel-item&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;channel-item-header&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">span</span> <span class="attr">className</span>=<span class="string">&#x27;channel-item-title&#x27;</span>&gt;</span>频道推荐<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">span</span> <span class="attr">className</span>=<span class="string">&#x27;channel-item-title-extra&#x27;</span>&gt;</span>点击添加频道<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;channel-list&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        &#123;recommendChannels.map((item) =&gt; (</span></span><br><span class="line"><span class="xml">                            <span class="tag">&lt;<span class="name">span</span> <span class="attr">key</span>=<span class="string">&#123;item.id&#125;</span> <span class="attr">className</span>=<span class="string">&#x27;channel-list-item&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                                + &#123;item.name&#125;</span></span><br><span class="line"><span class="xml">                            <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        ))&#125;</span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Channels</span><br></pre></td></tr></table></figure>

<h3 id="处理-Tabs-的高亮"><a href="#处理-Tabs-的高亮" class="headerlink" title="处理 Tabs 的高亮"></a>处理 Tabs 的高亮</h3><h4 id="目标-5"><a href="#目标-5" class="headerlink" title="目标"></a>目标</h4><p>能够实现首页频道切换和高亮功能。</p>
<h4 id="步骤-2"><a href="#步骤-2" class="headerlink" title="步骤"></a>步骤</h4><ol>
<li><p>在 Home 组件中拿到该状态（active），并设置为 Tabs 组件的 activeKey。</p>
</li>
<li><p>为 Tabs 组件添加 onChange，拿到当前选中的 tab 的键，并且分发 action 来修改 channelActiveKey。</p>
</li>
</ol>
<h4 id="核心代码"><a href="#核心代码" class="headerlink" title="核心代码"></a>核心代码</h4><p><code>Home/index.tsx</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useDispatch &#125; <span class="keyword">from</span> <span class="string">&#x27;react-redux&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Icon <span class="keyword">from</span> <span class="string">&#x27;@/components/Icon&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; changeActive, getAllChannel, getUserChannel &#125; <span class="keyword">from</span> <span class="string">&#x27;@/store/actions/home&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useInitState &#125; <span class="keyword">from</span> <span class="string">&#x27;@/utils/hooks&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; Tabs, Popup &#125; <span class="keyword">from</span> <span class="string">&#x27;antd-mobile&#x27;</span></span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&#x27;./index.module.scss&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Channels <span class="keyword">from</span> <span class="string">&#x27;./components/Channels&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Home = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> dispatch = useDispatch()</span><br><span class="line">    <span class="keyword">const</span> [visible, setVisible] = useState(<span class="literal">false</span>)</span><br><span class="line">    <span class="comment">// #1</span></span><br><span class="line">    <span class="keyword">const</span> &#123; userChannels, active &#125; = useInitState(getUserChannel, <span class="string">&#x27;home&#x27;</span>)</span><br><span class="line">    useInitState(getAllChannel, <span class="string">&#x27;home&#x27;</span>)</span><br><span class="line">    <span class="keyword">const</span> show = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        setVisible(<span class="literal">true</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> hide = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        setVisible(<span class="literal">false</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// !#3</span></span><br><span class="line">    <span class="keyword">const</span> onChange = <span class="function">(<span class="params">key: <span class="built_in">string</span></span>) =&gt;</span> &#123;</span><br><span class="line">        dispatch(changeActive(+key))</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;styles.root&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">            &#123;/* //!#2 */&#125;</span></span><br><span class="line"><span class="xml">            &#123;userChannels.length &gt; 0 &amp;&amp; (</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Tabs</span> <span class="attr">className</span>=<span class="string">&#x27;tabs&#x27;</span> <span class="attr">activeLineMode</span>=<span class="string">&#x27;fixed&#x27;</span> <span class="attr">activeKey</span>=<span class="string">&#123;active</span> + &#x27;&#x27;&#125; <span class="attr">onChange</span>=<span class="string">&#123;onChange&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    &#123;userChannels.map((item) =&gt; (</span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">Tabs.Tab</span> <span class="attr">title</span>=<span class="string">&#123;item.name&#125;</span> <span class="attr">key</span>=<span class="string">&#123;item.id&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                            &#123;item.name&#125;的内容</span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;/<span class="name">Tabs.Tab</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    ))&#125;</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">Tabs</span>&gt;</span></span></span><br><span class="line"><span class="xml">            )&#125;</span></span><br><span class="line"><span class="xml">            &#123;/* 频道 Tabs 列表 */&#125;</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;tabs-opration&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Icon</span> <span class="attr">type</span>=<span class="string">&#x27;iconbtn_search&#x27;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Icon</span> <span class="attr">type</span>=<span class="string">&#x27;iconbtn_channel&#x27;</span> <span class="attr">onClick</span>=<span class="string">&#123;show&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Popup</span> <span class="attr">position</span>=<span class="string">&#x27;left&#x27;</span> <span class="attr">visible</span>=<span class="string">&#123;visible&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Channels</span> <span class="attr">hide</span>=<span class="string">&#123;hide&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">Popup</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Home</span><br></pre></td></tr></table></figure>

<h3 id="编辑状态的处理"><a href="#编辑状态的处理" class="headerlink" title="编辑状态的处理"></a>编辑状态的处理</h3><h4 id="目标-6"><a href="#目标-6" class="headerlink" title="目标"></a>目标</h4><p>能够切换频道编辑状态。</p>
<h4 id="步骤-3"><a href="#步骤-3" class="headerlink" title="步骤"></a>步骤</h4><ol>
<li><p>添加控制是否为编辑的状态。</p>
</li>
<li><p>给编辑/保存按钮添加点击事件。</p>
</li>
<li><p>在点击事件中切换编辑状态。</p>
</li>
<li><p>根据编辑状态判断展示保存或编辑文字内容。</p>
</li>
</ol>
<h4 id="代码-5"><a href="#代码-5" class="headerlink" title="代码"></a>代码</h4><p><code>pages/Home/components/Channels/index.tsx</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> classnames <span class="keyword">from</span> <span class="string">&#x27;classnames&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useSelector, useDispatch &#125; <span class="keyword">from</span> <span class="string">&#x27;react-redux&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; RootState &#125; <span class="keyword">from</span> <span class="string">&#x27;@/types/store&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Icon <span class="keyword">from</span> <span class="string">&#x27;@/components/Icon&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; differenceBy &#125; <span class="keyword">from</span> <span class="string">&#x27;lodash&#x27;</span></span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&#x27;./index.module.scss&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; changeActive &#125; <span class="keyword">from</span> <span class="string">&#x27;@/store/actions/home&#x27;</span></span><br><span class="line"><span class="keyword">type</span> Props = &#123;</span><br><span class="line">    <span class="attr">hide</span>: <span class="function">() =&gt;</span> <span class="built_in">void</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> Channels = <span class="function">(<span class="params">&#123; hide &#125;: Props</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> dispatch = useDispatch()</span><br><span class="line">    <span class="comment">// !#1</span></span><br><span class="line">    <span class="keyword">const</span> [isEdit, setIsEdit] = useState(<span class="literal">false</span>)</span><br><span class="line">    <span class="keyword">const</span> &#123; userChannels, allChannels, active &#125; = useSelector(<span class="function">(<span class="params">state: RootState</span>) =&gt;</span> state.home)</span><br><span class="line">    <span class="keyword">const</span> recommendChannels = differenceBy(allChannels, userChannels, <span class="string">&#x27;id&#x27;</span>)</span><br><span class="line">    <span class="keyword">const</span> onChange = <span class="function">(<span class="params">id: <span class="built_in">number</span></span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// !#6 编辑状态不允许切换</span></span><br><span class="line">        <span class="keyword">if</span> (isEdit) <span class="keyword">return</span></span><br><span class="line">        dispatch(changeActive(id))</span><br><span class="line">        hide()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// !#4</span></span><br><span class="line">    <span class="keyword">const</span> changeEdit = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        setIsEdit(!isEdit)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;styles.root&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;channel-header&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Icon</span> <span class="attr">type</span>=<span class="string">&#x27;iconbtn_channel_close&#x27;</span> <span class="attr">onClick</span>=<span class="string">&#123;hide&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;channel-content&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                &#123;/* //!#2 编辑时，添加类名 edit */&#125;</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;classnames(</span>&#x27;<span class="attr">channel-item</span>&#x27;, <span class="attr">isEdit</span> &amp;&amp; &#x27;<span class="attr">edit</span>&#x27;)&#125;&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;channel-item-header&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">span</span> <span class="attr">className</span>=<span class="string">&#x27;channel-item-title&#x27;</span>&gt;</span>我的频道<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        &#123;/* //!#5 */&#125;</span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">span</span> <span class="attr">className</span>=<span class="string">&#x27;channel-item-title-extra&#x27;</span>&gt;</span>&#123;isEdit ? &#x27;点击删除频道&#x27; : &#x27;点击进入频道&#x27;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        &#123;/* //!#3: 绑定点击事件并处理文案 */&#125;</span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">span</span> <span class="attr">className</span>=<span class="string">&#x27;channel-item-edit&#x27;</span> <span class="attr">onClick</span>=<span class="string">&#123;changeEdit&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                            &#123;isEdit ? &#x27;完成&#x27; : &#x27;编辑&#x27;&#125;</span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;channel-list&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        &#123;userChannels.map((item) =&gt; (</span></span><br><span class="line"><span class="xml">                            <span class="tag">&lt;<span class="name">span</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                                <span class="attr">key</span>=<span class="string">&#123;item.id&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                                <span class="attr">className</span>=<span class="string">&#123;classnames(</span>&#x27;<span class="attr">channel-list-item</span>&#x27;, &#123;</span></span></span><br><span class="line"><span class="tag"><span class="xml">                                    <span class="attr">selected:</span> <span class="attr">item.id</span> === <span class="string">active,</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                                &#125;)&#125;</span></span></span><br><span class="line"><span class="tag"><span class="xml">                                <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> onChange(item.id)&#125;</span></span><br><span class="line"><span class="xml">                            &gt;</span></span><br><span class="line"><span class="xml">                                &#123;item.name&#125;</span></span><br><span class="line"><span class="xml">                                <span class="tag">&lt;<span class="name">Icon</span> <span class="attr">type</span>=<span class="string">&#x27;iconbtn_tag_close&#x27;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                            <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        ))&#125;</span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;channel-item&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;channel-item-header&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">span</span> <span class="attr">className</span>=<span class="string">&#x27;channel-item-title&#x27;</span>&gt;</span>频道推荐<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">span</span> <span class="attr">className</span>=<span class="string">&#x27;channel-item-title-extra&#x27;</span>&gt;</span>点击添加频道<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;channel-list&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        &#123;recommendChannels.map((item) =&gt; (</span></span><br><span class="line"><span class="xml">                            <span class="tag">&lt;<span class="name">span</span> <span class="attr">key</span>=<span class="string">&#123;item.id&#125;</span> <span class="attr">className</span>=<span class="string">&#x27;channel-list-item&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                                + &#123;item.name&#125;</span></span><br><span class="line"><span class="xml">                            <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        ))&#125;</span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Channels</span><br></pre></td></tr></table></figure>

<h3 id="删除频道"><a href="#删除频道" class="headerlink" title="删除频道"></a>删除频道</h3><h4 id="目标-7"><a href="#目标-7" class="headerlink" title="目标"></a>目标</h4><p>能够删除我的频道数据。</p>
<h4 id="分析-2"><a href="#分析-2" class="headerlink" title="分析"></a>分析</h4><ol>
<li><p>推荐频道不能删除。</p>
</li>
<li><p>至少要保留 4 个频道。</p>
</li>
</ol>
<h4 id="步骤-4"><a href="#步骤-4" class="headerlink" title="步骤"></a>步骤</h4><ol>
<li><p>如果是推荐频道则不显示删除按钮。</p>
</li>
<li><p>给频道的删除按钮绑定点击事件。</p>
</li>
<li><p>如果频道数量小于等于 4 则返回。</p>
</li>
<li><p>如果点击的是当前的，则激活推荐频道。</p>
</li>
<li><p>删除。</p>
</li>
</ol>
<h4 id="代码-6"><a href="#代码-6" class="headerlink" title="代码"></a>代码</h4><p><code>actions/home.ts</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">delChannel</span>(<span class="params">id: <span class="built_in">number</span></span>): <span class="title">RootThunkAction</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">async</span> (dispatch, getState) =&gt; &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; userChannels &#125; = getState().home</span><br><span class="line">        <span class="keyword">if</span> (hasToken()) &#123;</span><br><span class="line">            <span class="comment">// 登录了</span></span><br><span class="line">            <span class="keyword">await</span> request.delete(<span class="string">&#x27;/user/channels&#x27;</span>, &#123;</span><br><span class="line">                <span class="attr">data</span>: &#123;</span><br><span class="line">                    <span class="attr">channels</span>: [id],</span><br><span class="line">                &#125;,</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 没有登录</span></span><br><span class="line">            <span class="comment">// const userChannels = getChannels()</span></span><br><span class="line">            setChannels(userChannels.filter(<span class="function">(<span class="params">item</span>) =&gt;</span> item.id !== id))</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 更新到 Redux</span></span><br><span class="line">        <span class="comment">/* dispatch(&#123;</span></span><br><span class="line"><span class="comment">            type: &#x27;home/getUserChannels&#x27;,</span></span><br><span class="line"><span class="comment">            payload: userChannels.filter((item) =&gt; item.id !== id),</span></span><br><span class="line"><span class="comment">        &#125;) */</span></span><br><span class="line">        dispatch(getUserChannel())</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>Channels/index.tsx</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Icon <span class="keyword">type</span>=<span class="string">&#x27;iconbtn_tag_close&#x27;</span> onClick=&#123;<span class="function">() =&gt;</span> dispatch(delChannel(item.id))&#125; /&gt;</span><br></pre></td></tr></table></figure>

<h4 id="优化"><a href="#优化" class="headerlink" title="优化"></a>优化</h4><p>推荐不能有 x 号，超过 4 条才能删。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;div className=<span class="string">&#x27;channel-list&#x27;</span>&gt;</span><br><span class="line">    &#123;userChannels.map(<span class="function">(<span class="params">item</span>) =&gt;</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">span</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">            <span class="attr">key</span>=<span class="string">&#123;item.id&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">            <span class="attr">className</span>=<span class="string">&#123;classnames(</span>&#x27;<span class="attr">channel-list-item</span>&#x27;, &#123;</span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">selected:</span> <span class="attr">item.id</span> === <span class="string">active,</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">            &#125;)&#125;</span></span></span><br><span class="line"><span class="tag"><span class="xml">            <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> onChange(item.id)&#125;</span></span><br><span class="line"><span class="xml">        &gt;</span></span><br><span class="line"><span class="xml">            &#123;item.name&#125;</span></span><br><span class="line"><span class="xml">            &#123;item.id !== 0 &amp;&amp; (</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Icon</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                    <span class="attr">type</span>=<span class="string">&#x27;iconbtn_tag_close&#x27;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                    <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="xml">                        if (userChannels.length &lt;= 4) return</span></span><br><span class="line"><span class="xml">                        // 删除的是当前的，就回到推荐吧</span></span><br><span class="line"><span class="xml">                        if (item.id === active) dispatch(changeActive(0))</span></span><br><span class="line"><span class="xml">                        dispatch(delChannel(item.id))</span></span><br><span class="line"><span class="xml">                    &#125;&#125;</span></span><br><span class="line"><span class="xml">                /&gt;</span></span><br><span class="line"><span class="xml">            )&#125;</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line">    ))&#125;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<h3 id="添加频道"><a href="#添加频道" class="headerlink" title="添加频道"></a>添加频道</h3><h4 id="目标-8"><a href="#目标-8" class="headerlink" title="目标"></a>目标</h4><p>能够实现添加频道功能。</p>
<h4 id="代码-7"><a href="#代码-7" class="headerlink" title="代码"></a>代码</h4><p>在 <code>store/actions/home.ts</code> 中，实现 Action Creator。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> addChannel = (channel: Channel): <span class="function"><span class="params">RootThunkAction</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">async</span> (dispatch, getState) =&gt; &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; userChannels &#125; = getState().home</span><br><span class="line">        <span class="keyword">if</span> (hasToken()) &#123;</span><br><span class="line">            <span class="keyword">await</span> request.patch(<span class="string">&#x27;/user/channels&#x27;</span>, &#123;</span><br><span class="line">                <span class="attr">channels</span>: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="attr">id</span>: channel.id,</span><br><span class="line">                        <span class="attr">seq</span>: userChannels.length + <span class="number">1</span>,</span><br><span class="line">                    &#125;,</span><br><span class="line">                ],</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            setChannels([...userChannels, channel])</span><br><span class="line">        &#125;</span><br><span class="line">        dispatch(&#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;home/getUserChannels&#x27;</span>,</span><br><span class="line">            <span class="attr">payload</span>: [...userChannels, channel],</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>Channels/index.tsx</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Channels = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> onAddChannel = <span class="function">(<span class="params">channel: Channel</span>) =&gt;</span> &#123;</span><br><span class="line">        dispatch(addChannel(channel))</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;channel-list&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">            &#123;recommendChannels.map((item) =&gt; (</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">key</span>=<span class="string">&#123;item.id&#125;</span> <span class="attr">className</span>=<span class="string">&#x27;channel-list-item&#x27;</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> onAddChannel(item)&#125;&gt;</span></span><br><span class="line"><span class="xml">                    + &#123;item.name&#125;</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">            ))&#125;</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="文章列表处理"><a href="#文章列表处理" class="headerlink" title="文章列表处理"></a>文章列表处理</h2><h3 id="基本结构"><a href="#基本结构" class="headerlink" title="基本结构"></a>基本结构</h3><h4 id="目标-9"><a href="#目标-9" class="headerlink" title="目标"></a>目标</h4><p>能够根据模板搭建频道文章列表结构。</p>
<h4 id="素材-1"><a href="#素材-1" class="headerlink" title="素材"></a>素材</h4><p><code>pages/Home/components/ArticleItem/index.tsx</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> classnames <span class="keyword">from</span> <span class="string">&#x27;classnames&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> Icon <span class="keyword">from</span> <span class="string">&#x27;@/components/Icon&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&#x27;./index.module.scss&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Props = &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 0 表示无图</span></span><br><span class="line"><span class="comment">     * 1 表示单图</span></span><br><span class="line"><span class="comment">     * 3 表示三图</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">type</span>?: <span class="number">0</span> | <span class="number">1</span> | <span class="number">3</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ArticleItem = <span class="function">(<span class="params">&#123; <span class="keyword">type</span> = <span class="number">0</span> &#125;: Props</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;styles.root&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;classnames(</span>&#x27;<span class="attr">article-content</span>&#x27;, <span class="attr">type</span> === <span class="string">3</span> &amp;&amp; &#x27;<span class="attr">t3</span>&#x27;, <span class="attr">type</span> === <span class="string">0</span> &amp;&amp; &#x27;<span class="attr">none-mt</span>&#x27;)&#125;&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">h3</span>&gt;</span>Vue响应式----数据响应式原理<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line"><span class="xml">                &#123;type !== 0 &amp;&amp; (</span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;article-imgs&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;article-img-wrapper&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                            <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&#x27;http://geek.itheima.net/resources/images/63.jpg&#x27;</span> <span class="attr">alt</span>=<span class="string">&#x27;&#x27;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                )&#125;</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;classnames(</span>&#x27;<span class="attr">article-info</span>&#x27;, <span class="attr">type</span> === <span class="string">0</span> &amp;&amp; &#x27;<span class="attr">none-mt</span>&#x27;)&#125;&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">span</span>&gt;</span>黑马先锋<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">span</span>&gt;</span>99 评论<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">span</span>&gt;</span>2 天前<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">className</span>=<span class="string">&#x27;close&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">Icon</span> <span class="attr">type</span>=<span class="string">&#x27;iconbtn_essay_close&#x27;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> ArticleItem</span><br></pre></td></tr></table></figure>

<p><code>pages/Home/components/ArticleItem/index.module.scss</code></p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@import</span> <span class="string">&#x27;@scss/hairline.scss&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.root</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: relative;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">15px</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">@include</span> hairline(bottom, <span class="number">#f0f0f0</span>);</span><br><span class="line"></span><br><span class="line">    :global &#123;</span><br><span class="line">        .article-content &#123;</span><br><span class="line">            display: flex;</span><br><span class="line">            <span class="attribute">align-items</span>: flex-start;</span><br><span class="line"></span><br><span class="line">            <span class="selector-tag">h3</span> &#123;</span><br><span class="line">                <span class="attribute">flex</span>: <span class="number">1</span>;</span><br><span class="line">                <span class="attribute">padding-right</span>: <span class="number">10px</span>;</span><br><span class="line">                <span class="attribute">margin-bottom</span>: <span class="number">10px</span>;</span><br><span class="line">                <span class="attribute">font-weight</span>: normal;</span><br><span class="line">                <span class="attribute">line-height</span>: <span class="number">22px</span>;</span><br><span class="line">                <span class="attribute">font-size</span>: <span class="number">17px</span>;</span><br><span class="line">                <span class="attribute">word-break</span>: break-all;</span><br><span class="line"></span><br><span class="line">                <span class="attribute">display</span>: -webkit-box;</span><br><span class="line">                <span class="attribute">overflow</span>: hidden;</span><br><span class="line">                <span class="attribute">text-overflow</span>: ellipsis;</span><br><span class="line">                -webkit-line-clamp: <span class="number">2</span>;</span><br><span class="line">                -webkit-box-orient: vertical;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="selector-class">.article-img-wrapper</span> &#123;</span><br><span class="line">                <span class="attribute">width</span>: <span class="number">110px</span>;</span><br><span class="line">                <span class="attribute">height</span>: <span class="number">75px</span>;</span><br><span class="line">                <span class="comment">// 不要添 overflow 否则会导致 Image lazy 出现 Bug</span></span><br><span class="line">                <span class="comment">// overflow: hidden;</span></span><br><span class="line">                <span class="attribute">border-radius</span>: <span class="number">4px</span>;</span><br><span class="line"></span><br><span class="line">                <span class="selector-tag">img</span> &#123;</span><br><span class="line">                    <span class="selector-tag">object</span>-fit: cover;</span><br><span class="line">                    <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">                    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="selector-class">.article-content</span><span class="selector-class">.t3</span> &#123;</span><br><span class="line">            <span class="attribute">display</span>: block;</span><br><span class="line"></span><br><span class="line">            <span class="selector-class">.article-imgs</span> &#123;</span><br><span class="line">                <span class="attribute">display</span>: flex;</span><br><span class="line">                <span class="attribute">justify-content</span>: space-between;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="selector-class">.article-info</span> &#123;</span><br><span class="line">            <span class="attribute">position</span>: relative;</span><br><span class="line">            <span class="attribute">margin-top</span>: <span class="number">10px</span>;</span><br><span class="line">            <span class="attribute">color</span>: <span class="number">#999</span>;</span><br><span class="line">            <span class="attribute">line-height</span>: <span class="number">22px</span>;</span><br><span class="line">            <span class="attribute">font-size</span>: <span class="number">12px</span>;</span><br><span class="line"></span><br><span class="line">            <span class="selector-tag">span</span> &#123;</span><br><span class="line">                <span class="attribute">padding-right</span>: <span class="number">10px</span>;</span><br><span class="line"></span><br><span class="line">                &amp;<span class="selector-class">.close</span> &#123;</span><br><span class="line">                    <span class="attribute">position</span>: absolute;</span><br><span class="line">                    <span class="attribute">right</span>: <span class="number">0</span>;</span><br><span class="line">                    <span class="attribute">padding-right</span>: <span class="number">0</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="selector-class">.none-mt</span> &#123;</span><br><span class="line">            <span class="attribute">margin-top</span>: <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">            <span class="selector-tag">h3</span> &#123;</span><br><span class="line">                <span class="attribute">margin-bottom</span>: <span class="number">4px</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>pages/Home/components/ArticleList/index.tsx</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> ArticleItem <span class="keyword">from</span> <span class="string">&#x27;../ArticleItem&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&#x27;./index.module.scss&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ArticleList = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;styles.root&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">            &#123;/* 文章列表中的每一项 */&#125;</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;article-item&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">ArticleItem</span> /&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> ArticleList</span><br></pre></td></tr></table></figure>

<p><code>pages/Home/components/ArticleList/index.module.scss</code></p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.root</span> &#123;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">16px</span>;</span><br><span class="line">    <span class="comment">// 注意：需要在此处设置超出滚动，这样才能保证每个 tab 之间的滚动位置不会相互影响</span></span><br><span class="line">    <span class="attribute">overflow-y</span>: scroll;</span><br><span class="line"></span><br><span class="line">    :global &#123;</span><br><span class="line">        .articles &#123;</span><br><span class="line">            padding-bottom: <span class="number">50px</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="selector-class">.article-item</span> &#123;</span><br><span class="line">            <span class="attribute">position</span>: relative;</span><br><span class="line">            <span class="attribute">color</span>: <span class="number">#323233</span>;</span><br><span class="line">            <span class="attribute">font-size</span>: <span class="number">14px</span>;</span><br><span class="line">            <span class="attribute">background-color</span>: <span class="number">#fff</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="步骤-5"><a href="#步骤-5" class="headerlink" title="步骤"></a>步骤</h4><ol>
<li><p>将模板 ArticleList 和 ArticleItem 拷贝到 <code>pages/Home/components</code> 目录中。</p>
</li>
<li><p>在 Home 组件中渲染文章列表结构。</p>
</li>
<li><p>分析每个模板的作用，以及模板的结构。</p>
</li>
</ol>
<h4 id="代码-8"><a href="#代码-8" class="headerlink" title="代码"></a>代码</h4><p><code>Home/index.tsx</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> ArticleList <span class="keyword">from</span> <span class="string">&#x27;./components/ArticleList&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Home = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">Tabs.Tab</span>&gt;</span></span></span><br><span class="line"><span class="xml">            &#123;/* 在每个 Tabs.TabPane 中渲染文章列表组件 */&#125;</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">ArticleList</span> /&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">Tabs.Tab</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="获取文章列表数据"><a href="#获取文章列表数据" class="headerlink" title="获取文章列表数据"></a>获取文章列表数据</h3><h4 id="目标-10"><a href="#目标-10" class="headerlink" title="目标"></a>目标</h4><p>能够获取到文章列表数据并且进行渲染。</p>
<h4 id="步骤-6"><a href="#步骤-6" class="headerlink" title="步骤"></a>步骤</h4><ol>
<li><p>分析接口文档，定义频道的数据类型，<code>types/data.d.ts</code> 中。</p>
</li>
<li><p>准备获取文章列表的 action，在 action 中发送请求。</p>
</li>
<li><p>发送请求需要频道 id，父组件将频道 id 传递给 ArticleList 组件。</p>
</li>
<li><p>ArticleList 组件接受频道 Id 并发送请求获取频道列表数据。</p>
</li>
</ol>
<h4 id="代码-9"><a href="#代码-9" class="headerlink" title="代码"></a>代码</h4><ul>
<li>  分析接口文档，定义频道的数据类型，<code>types/data.d.ts</code> 中：</li>
</ul>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> Article = &#123;</span><br><span class="line">    <span class="attr">art_id</span>: <span class="built_in">string</span></span><br><span class="line">    <span class="attr">title</span>: <span class="built_in">string</span></span><br><span class="line">    <span class="attr">aut_id</span>: <span class="built_in">string</span></span><br><span class="line">    <span class="attr">comm_count</span>: <span class="built_in">number</span></span><br><span class="line">    <span class="attr">pubdate</span>: <span class="built_in">string</span></span><br><span class="line">    <span class="attr">aut_name</span>: <span class="built_in">string</span></span><br><span class="line">    <span class="attr">is_top</span>: <span class="built_in">number</span></span><br><span class="line">    <span class="attr">cover</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="number">0</span> | <span class="number">1</span> | <span class="number">3</span></span><br><span class="line">        <span class="attr">images</span>: <span class="built_in">string</span>[]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> ArticleRes = &#123;</span><br><span class="line">    <span class="attr">pre_timestamp</span>: <span class="built_in">string</span></span><br><span class="line">    <span class="attr">results</span>: Article[]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>  准备获取文章列表的 action，<code>actions/home.ts</code> 中：</li>
</ul>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getArticleList = (channel_id: <span class="built_in">number</span>, <span class="attr">timestamp</span>: <span class="built_in">string</span>): <span class="function"><span class="params">RootThunkAction</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">async</span> (dispatch) =&gt; &#123;</span><br><span class="line">        <span class="keyword">const</span> res = <span class="keyword">await</span> request.get&lt;ApiResponse&lt;ArticleRes&gt;&gt;(<span class="string">&#x27;/articles&#x27;</span>, &#123;</span><br><span class="line">            <span class="attr">params</span>: &#123;</span><br><span class="line">                channel_id,</span><br><span class="line">                timestamp,</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="built_in">console</span>.log(res)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>  在 <code>Home/index.tsx</code> 父组件中将频道 id 传递给 ArticleList 组件 。</li>
</ul>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Home = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">Tabs</span>&gt;</span></span></span><br><span class="line"><span class="xml">            &#123;userChannel.map((item) =&gt; (</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Tabs.Tab</span> <span class="attr">title</span>=<span class="string">&#123;item.name&#125;</span> <span class="attr">key</span>=<span class="string">&#123;item.id&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    &#123;/* 传递频道 id */&#125;</span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">ArticleList</span> <span class="attr">channelId</span>=<span class="string">&#123;item.id&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">Tabs.Tab</span>&gt;</span></span></span><br><span class="line"><span class="xml">            ))&#125;</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">Tabs</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>  ArticleList 组件接受频道 Id <code>Home/components/ArticleList.tsx</code></li>
</ul>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; getArticleList &#125; <span class="keyword">from</span> <span class="string">&#x27;@/store/actions/home&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useDispatch &#125; <span class="keyword">from</span> <span class="string">&#x27;react-redux&#x27;</span></span><br><span class="line"><span class="keyword">import</span> ArticleItem <span class="keyword">from</span> <span class="string">&#x27;../ArticleItem&#x27;</span></span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&#x27;./index.module.scss&#x27;</span></span><br><span class="line"><span class="keyword">type</span> Props = &#123;</span><br><span class="line">    <span class="attr">channelId</span>: <span class="built_in">number</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> ArticleList = <span class="function">(<span class="params">&#123; channelId &#125;: Props</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> dispatch = useDispatch()</span><br><span class="line">    useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        dispatch(getArticleList(channelId, <span class="built_in">Date</span>.now() + <span class="string">&#x27;&#x27;</span>))</span><br><span class="line">    &#125;, [dispatch, channelId])</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;styles.root&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">            &#123;[1, 2, 3].map((item, index) =&gt; (</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;article-item&#x27;</span> <span class="attr">key</span>=<span class="string">&#123;index&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">ArticleItem</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            ))&#125;</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> ArticleList</span><br></pre></td></tr></table></figure>

<h3 id="将数据存储到-Redux-中"><a href="#将数据存储到-Redux-中" class="headerlink" title="将数据存储到 Redux 中"></a>将数据存储到 Redux 中</h3><h4 id="目标-11"><a href="#目标-11" class="headerlink" title="目标"></a>目标</h4><p>能够将数据存储到 Redux 中。</p>
<h4 id="分析-3"><a href="#分析-3" class="headerlink" title="分析"></a>分析</h4><p>问题：用什么样的数据格式存储频道文章列表数据？每个频道，都对应到一个文章列表数据</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 推荐频道</span></span><br><span class="line"><span class="number">0</span> ==&gt; &#123;</span><br><span class="line">    <span class="attr">pre_timestamp</span>: xxxx,</span><br><span class="line">    <span class="attr">articles</span>: []</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// html 频道</span></span><br><span class="line"><span class="number">1</span> ==&gt; &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 开发者资讯频道</span></span><br><span class="line"><span class="number">2</span> ==&gt; &#123;&#125;</span><br></pre></td></tr></table></figure>

<p>为了高效的存储数据，我们使用 <code>对象</code> 来存储频道文章列表数据。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 数据格式：</span></span><br><span class="line">channelArticles = &#123;</span><br><span class="line">    <span class="number">1</span>: &#123;</span><br><span class="line">        <span class="attr">timestamp</span>: <span class="string">&#x27;1638408103353&#x27;</span>,</span><br><span class="line">        <span class="attr">articles</span>: [],</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="number">2</span>: &#123;</span><br><span class="line">        <span class="attr">timestamp</span>: <span class="string">&#x27;1638408103353&#x27;</span>,</span><br><span class="line">        <span class="attr">articles</span>: [],</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="number">3</span>: &#123;</span><br><span class="line">        <span class="attr">timestamp</span>: <span class="string">&#x27;1638408103353&#x27;</span>,</span><br><span class="line">        <span class="attr">articles</span>: [],</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="代码-10"><a href="#代码-10" class="headerlink" title="代码"></a>代码</h4><ul>
<li>  在 <code>types/store.d.ts</code> 中，定义 action 的类型。</li>
</ul>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> HomeAction =</span><br><span class="line">    | &#123;</span><br><span class="line">          <span class="attr">type</span>: <span class="string">&#x27;home/getUserChannels&#x27;</span></span><br><span class="line">          <span class="attr">payload</span>: Channel[]</span><br><span class="line">      &#125;</span><br><span class="line">    | &#123;</span><br><span class="line">          <span class="attr">type</span>: <span class="string">&#x27;home/getAllChannels&#x27;</span></span><br><span class="line">          <span class="attr">payload</span>: Channel[]</span><br><span class="line">      &#125;</span><br><span class="line">    | &#123;</span><br><span class="line">          <span class="attr">type</span>: <span class="string">&#x27;home/changeActive&#x27;</span></span><br><span class="line">          <span class="attr">payload</span>: <span class="built_in">number</span></span><br><span class="line">      &#125;</span><br><span class="line">    | &#123;</span><br><span class="line">          <span class="attr">type</span>: <span class="string">&#x27;home/saveChannelArticles&#x27;</span></span><br><span class="line">          <span class="attr">payload</span>: &#123;</span><br><span class="line">              <span class="attr">channel_id</span>: <span class="built_in">number</span> <span class="comment">// key</span></span><br><span class="line">              <span class="attr">timestamp</span>: <span class="built_in">string</span> <span class="comment">// 请求下一页数据用的</span></span><br><span class="line">              <span class="attr">articles</span>: Article[] <span class="comment">// 列表</span></span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>  在 actions/home.ts 中，分发 action。</li>
</ul>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getArticleList = (channel_id: <span class="built_in">number</span>, <span class="attr">timestamp</span>: <span class="built_in">string</span>): <span class="function"><span class="params">RootThunkAction</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">async</span> (dispatch) =&gt; &#123;</span><br><span class="line">        <span class="keyword">const</span> res = <span class="keyword">await</span> request.get&lt;ApiResponse&lt;ArticleRes&gt;&gt;(<span class="string">&#x27;/articles&#x27;</span>, &#123;</span><br><span class="line">            <span class="attr">params</span>: &#123;</span><br><span class="line">                channel_id,</span><br><span class="line">                timestamp,</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">const</span> &#123; pre_timestamp, results &#125; = res.data.data</span><br><span class="line">        dispatch(&#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;home/saveChannelArticles&#x27;</span>,</span><br><span class="line">            <span class="attr">payload</span>: &#123;</span><br><span class="line">                channel_id,</span><br><span class="line">                <span class="attr">timestamp</span>: pre_timestamp,</span><br><span class="line">                <span class="attr">articles</span>: results,</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>  在 reducers/home.ts 中。</li>
</ul>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Article, Channel &#125; <span class="keyword">from</span> <span class="string">&#x27;@/types/data&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; HomeAction &#125; <span class="keyword">from</span> <span class="string">&#x27;@/types/store&#x27;</span></span><br><span class="line"><span class="keyword">type</span> HomeState = &#123;</span><br><span class="line">    <span class="attr">userChannels</span>: Channel[]</span><br><span class="line">    <span class="attr">allChannels</span>: Channel[]</span><br><span class="line">    <span class="attr">active</span>: <span class="built_in">number</span></span><br><span class="line">    <span class="comment">// #1</span></span><br><span class="line">    <span class="attr">channelArticles</span>: &#123;</span><br><span class="line">        [key: <span class="built_in">number</span>]: &#123;</span><br><span class="line">            <span class="attr">timestamp</span>: <span class="built_in">string</span></span><br><span class="line">            <span class="attr">articles</span>: Article[]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> initValue: HomeState = &#123;</span><br><span class="line">    <span class="attr">userChannels</span>: [],</span><br><span class="line">    <span class="attr">allChannels</span>: [],</span><br><span class="line">    <span class="attr">active</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="comment">// #2</span></span><br><span class="line">    <span class="attr">channelArticles</span>: &#123;&#125;,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">home</span>(<span class="params">state = initValue, action: HomeAction</span>): <span class="title">HomeState</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (action.type === <span class="string">&#x27;home/getUserChannels&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            ...state,</span><br><span class="line">            <span class="attr">userChannels</span>: action.payload,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (action.type === <span class="string">&#x27;home/getAllChannels&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            ...state,</span><br><span class="line">            <span class="attr">allChannels</span>: action.payload,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (action.type === <span class="string">&#x27;home/changeActive&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            ...state,</span><br><span class="line">            <span class="attr">active</span>: action.payload,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// #3</span></span><br><span class="line">    <span class="keyword">if</span> (action.type === <span class="string">&#x27;home/saveChannelArticles&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; channel_id, timestamp, articles &#125; = action.payload</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            ...state,</span><br><span class="line">            <span class="attr">channelArticles</span>: &#123;</span><br><span class="line">                ...state.channelArticles,</span><br><span class="line">                [channel_id]: &#123;</span><br><span class="line">                    timestamp,</span><br><span class="line">                    articles,</span><br><span class="line">                &#125;,</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> state</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="渲染文章列表"><a href="#渲染文章列表" class="headerlink" title="渲染文章列表"></a>渲染文章列表</h3><h4 id="目标-12"><a href="#目标-12" class="headerlink" title="目标"></a>目标</h4><p>根据文章列表数据渲染文章。</p>
<h4 id="步骤-7"><a href="#步骤-7" class="headerlink" title="步骤"></a>步骤</h4><ul>
<li>  在 ArticleList 中获取文章列表数据。</li>
</ul>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> ArticleList = <span class="function">(<span class="params">&#123; channelId &#125;: Props</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> dispatch = useDispatch()</span><br><span class="line">    <span class="keyword">const</span> &#123; channelArticles &#125; = useSelector(<span class="function">(<span class="params">state: RootState</span>) =&gt;</span> state.home)</span><br><span class="line">    <span class="keyword">const</span> &#123; articles = [] &#125; = channelArticles[channelId] || &#123;&#125;</span><br><span class="line">    useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        dispatch(getArticleList(channelId, <span class="built_in">Date</span>.now() + <span class="string">&#x27;&#x27;</span>))</span><br><span class="line">    &#125;, [dispatch, channelId])</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;styles.root&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">            &#123;articles.map((item, index) =&gt; (</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">key</span>=<span class="string">&#123;item.art_id&#125;</span> <span class="attr">className</span>=<span class="string">&#x27;article-item&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">ArticleItem</span> <span class="attr">article</span>=<span class="string">&#123;item&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            ))&#125;</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>  传递给 ArticleItem 组件进行渲染</li>
</ul>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> classnames <span class="keyword">from</span> <span class="string">&#x27;classnames&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useSelector &#125; <span class="keyword">from</span> <span class="string">&#x27;react-redux&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Icon <span class="keyword">from</span> <span class="string">&#x27;@/components/Icon&#x27;</span></span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&#x27;./index.module.scss&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; Article &#125; <span class="keyword">from</span> <span class="string">&#x27;@/types/data&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; RootState &#125; <span class="keyword">from</span> <span class="string">&#x27;@/types/store&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Props = &#123;</span><br><span class="line">    <span class="attr">article</span>: Article</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ArticleItem = <span class="function">(<span class="params">&#123; article &#125;: Props</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> token = useSelector(<span class="function">(<span class="params">state: RootState</span>) =&gt;</span> state.login.token)</span><br><span class="line">    <span class="keyword">const</span> &#123;</span><br><span class="line">        title,</span><br><span class="line">        <span class="attr">cover</span>: &#123; <span class="keyword">type</span>, images &#125;,</span><br><span class="line">        aut_name,</span><br><span class="line">        comm_count,</span><br><span class="line">        pubdate,</span><br><span class="line">    &#125; = article</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;styles.root&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;classnames(</span>&#x27;<span class="attr">article-content</span>&#x27;, <span class="attr">type</span> === <span class="string">3</span> &amp;&amp; &#x27;<span class="attr">t3</span>&#x27;, <span class="attr">type</span> === <span class="string">0</span> &amp;&amp; &#x27;<span class="attr">none-mt</span>&#x27;)&#125;&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">h3</span>&gt;</span>&#123;title&#125;<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line"><span class="xml">                &#123;type !== 0 &amp;&amp; (</span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;article-imgs&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        &#123;images.map((image, index) =&gt; (</span></span><br><span class="line"><span class="xml">                            <span class="tag">&lt;<span class="name">div</span> <span class="attr">key</span>=<span class="string">&#123;index&#125;</span> <span class="attr">className</span>=<span class="string">&#x27;article-img-wrapper&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                                <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&#123;image&#125;</span> <span class="attr">alt</span>=<span class="string">&#x27;&#x27;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        ))&#125;</span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                )&#125;</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;classnames(</span>&#x27;<span class="attr">article-info</span>&#x27;, <span class="attr">type</span> === <span class="string">0</span> &amp;&amp; &#x27;<span class="attr">none-mt</span>&#x27;)&#125;&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;aut_name&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;comm_count&#125; 评论<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;pubdate&#125; 天前<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">className</span>=<span class="string">&#x27;close&#x27;</span>&gt;</span>&#123;token &amp;&amp; <span class="tag">&lt;<span class="name">Icon</span> <span class="attr">type</span>=<span class="string">&#x27;iconbtn_essay_close&#x27;</span> /&gt;</span>&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> ArticleItem</span><br></pre></td></tr></table></figure>

<ul>
<li>  处理时间</li>
</ul>
<p><code>src/index.tsx</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> dayjs <span class="keyword">from</span> <span class="string">&#x27;dayjs&#x27;</span></span><br><span class="line"><span class="keyword">import</span> relativeTime <span class="keyword">from</span> <span class="string">&#x27;dayjs/plugin/relativeTime&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;dayjs/locale/zh-cn&#x27;</span></span><br><span class="line">dayjs.extend(relativeTime)</span><br><span class="line">dayjs.locale(<span class="string">&#x27;zh-cn&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p><code>src/pages/Home/components/ArticleItem/index.tsx</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> dayjs <span class="keyword">from</span> <span class="string">&#x27;dayjs&#x27;</span></span><br><span class="line">;<span class="xml"><span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;dayjs(pubdate).fromNow()&#125; 天前<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<h3 id="触底加载更多"><a href="#触底加载更多" class="headerlink" title="触底加载更多"></a>触底加载更多</h3><h4 id="目标-13"><a href="#目标-13" class="headerlink" title="目标"></a>目标</h4><p>能够使用 antd-mobile 的 InfiniteScroll 组件。</p>
<h4 id="代码-11"><a href="#代码-11" class="headerlink" title="代码"></a>代码</h4><p><code>pages/Home/components/ArticleList/index.tsx</code></p>
<ul>
<li>  使用 InfiniteScroll 组件，<font color=e32d40><strong>注意：有了 loadMore，useEffect 的第一个请求就可以注释了</strong></font>。</li>
</ul>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; getArticleList &#125; <span class="keyword">from</span> <span class="string">&#x27;@/store/actions/home&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; RootState &#125; <span class="keyword">from</span> <span class="string">&#x27;@/types/store&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useDispatch, useSelector &#125; <span class="keyword">from</span> <span class="string">&#x27;react-redux&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; InfiniteScroll &#125; <span class="keyword">from</span> <span class="string">&#x27;antd-mobile&#x27;</span></span><br><span class="line"><span class="keyword">import</span> ArticleItem <span class="keyword">from</span> <span class="string">&#x27;../ArticleItem&#x27;</span></span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&#x27;./index.module.scss&#x27;</span></span><br><span class="line"><span class="keyword">type</span> Props = &#123;</span><br><span class="line">    <span class="attr">channelId</span>: <span class="built_in">number</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> ArticleList = <span class="function">(<span class="params">&#123; channelId &#125;: Props</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> dispatch = useDispatch()</span><br><span class="line">    <span class="keyword">const</span> &#123; channelArticles &#125; = useSelector(<span class="function">(<span class="params">state: RootState</span>) =&gt;</span> state.home)</span><br><span class="line">    <span class="keyword">const</span> &#123; articles = [] &#125; = channelArticles[channelId] || &#123;&#125;</span><br><span class="line">    <span class="comment">// #4 可以注释掉了</span></span><br><span class="line">    <span class="comment">/* useEffect(() =&gt; &#123;</span></span><br><span class="line"><span class="comment">        dispatch(getArticleList(channelId, Date.now() + &#x27;&#x27;))</span></span><br><span class="line"><span class="comment">    &#125;, [dispatch, channelId]) */</span></span><br><span class="line">    <span class="comment">// #2</span></span><br><span class="line">    <span class="keyword">const</span> hasMore = <span class="literal">true</span></span><br><span class="line">    <span class="comment">// #3</span></span><br><span class="line">    <span class="keyword">const</span> loadMore = <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">        <span class="keyword">await</span> dispatch(getArticleList(channelId, <span class="built_in">Date</span>.now() + <span class="string">&#x27;&#x27;</span>))</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;styles.root&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">            &#123;articles.map((item, index) =&gt; (</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">key</span>=<span class="string">&#123;item.art_id&#125;</span> <span class="attr">className</span>=<span class="string">&#x27;article-item&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">ArticleItem</span> <span class="attr">article</span>=<span class="string">&#123;item&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            ))&#125;</span></span><br><span class="line"><span class="xml">            &#123;/* #1 */&#125;</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">InfiniteScroll</span> <span class="attr">loadMore</span>=<span class="string">&#123;loadMore&#125;</span> <span class="attr">hasMore</span>=<span class="string">&#123;hasMore&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> ArticleList</span><br></pre></td></tr></table></figure>

<ul>
<li>  修改 <code>reducers/home.ts</code>，将数据改成追加。</li>
</ul>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (action.type === <span class="string">&#x27;home/saveChannelArticles&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; channel_id, timestamp, articles &#125; = action.payload</span><br><span class="line">    <span class="comment">// state.channelArticles =&gt; 可能是个空对象</span></span><br><span class="line">    <span class="keyword">const</span> old = state.channelArticles[channel_id]?.articles || []</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        ...state,</span><br><span class="line">        <span class="attr">channelArticles</span>: &#123;</span><br><span class="line">            ...state.channelArticles,</span><br><span class="line">            [channel_id]: &#123;</span><br><span class="line">                timestamp,</span><br><span class="line">                <span class="attr">articles</span>: [...old, ...articles],</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>  时间戳和 hasMore 的处理。</li>
</ul>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> ArticleList = <span class="function">(<span class="params">&#123; channelId &#125;: Props</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> dispatch = useDispatch()</span><br><span class="line">    <span class="keyword">const</span> &#123; channelArticles &#125; = useSelector(<span class="function">(<span class="params">state: RootState</span>) =&gt;</span> state.home)</span><br><span class="line">    <span class="comment">// #1</span></span><br><span class="line">    <span class="keyword">const</span> &#123; articles = [], timestamp &#125; = channelArticles[channelId] || &#123;&#125;</span><br><span class="line">    <span class="comment">// #3</span></span><br><span class="line">    <span class="keyword">const</span> hasMore = timestamp !== <span class="literal">null</span></span><br><span class="line">    <span class="keyword">const</span> loadMore = <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">        <span class="comment">// #2</span></span><br><span class="line">        <span class="keyword">await</span> dispatch(getArticleList(channelId, timestamp || <span class="built_in">Date</span>.now() + <span class="string">&#x27;&#x27;</span>))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="下拉刷新"><a href="#下拉刷新" class="headerlink" title="下拉刷新"></a>下拉刷新</h3><h4 id="目标-14"><a href="#目标-14" class="headerlink" title="目标"></a>目标</h4><p>能够下拉刷新文章数据。</p>
<h4 id="分析-4"><a href="#分析-4" class="headerlink" title="分析"></a>分析</h4><p><code>store.d.ts</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> HomeAction =</span><br><span class="line">    | &#123;</span><br><span class="line">          <span class="attr">type</span>: <span class="string">&#x27;home/getUserChannels&#x27;</span></span><br><span class="line">          <span class="attr">payload</span>: Channel[]</span><br><span class="line">      &#125;</span><br><span class="line">    | &#123;</span><br><span class="line">          <span class="attr">type</span>: <span class="string">&#x27;home/getAllChannels&#x27;</span></span><br><span class="line">          <span class="attr">payload</span>: Channel[]</span><br><span class="line">      &#125;</span><br><span class="line">    | &#123;</span><br><span class="line">          <span class="attr">type</span>: <span class="string">&#x27;home/changeActive&#x27;</span></span><br><span class="line">          <span class="attr">payload</span>: <span class="built_in">number</span></span><br><span class="line">      &#125;</span><br><span class="line">    | &#123;</span><br><span class="line">          <span class="attr">type</span>: <span class="string">&#x27;home/saveChannelArticles&#x27;</span></span><br><span class="line">          <span class="attr">payload</span>: &#123;</span><br><span class="line">              <span class="attr">channel_id</span>: <span class="built_in">number</span></span><br><span class="line">              <span class="attr">timestamp</span>: <span class="built_in">string</span></span><br><span class="line">              <span class="attr">articles</span>: Article[]</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    | &#123;</span><br><span class="line">          <span class="attr">type</span>: <span class="string">&#x27;home/saveNewArticles&#x27;</span></span><br><span class="line">          <span class="attr">payload</span>: &#123;</span><br><span class="line">              <span class="attr">channel_id</span>: <span class="built_in">number</span></span><br><span class="line">              <span class="attr">timestamp</span>: <span class="built_in">string</span></span><br><span class="line">              <span class="attr">articles</span>: Article[]</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure>

<p><code>actions/home.ts</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getNewList = (channel_id: <span class="built_in">number</span>, <span class="attr">timestamp</span>: <span class="built_in">string</span>): <span class="function"><span class="params">RootThunkAction</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">async</span> (dispatch) =&gt; &#123;</span><br><span class="line">        <span class="keyword">const</span> res = <span class="keyword">await</span> request.get&lt;ApiResponse&lt;ArticleRes&gt;&gt;(<span class="string">&#x27;/articles&#x27;</span>, &#123;</span><br><span class="line">            <span class="attr">params</span>: &#123;</span><br><span class="line">                channel_id,</span><br><span class="line">                timestamp,</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">const</span> &#123; pre_timestamp, results &#125; = res.data.data</span><br><span class="line">        dispatch(&#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;home/saveNewArticles&#x27;</span>,</span><br><span class="line">            <span class="attr">payload</span>: &#123;</span><br><span class="line">                channel_id,</span><br><span class="line">                <span class="attr">timestamp</span>: pre_timestamp,</span><br><span class="line">                <span class="attr">articles</span>: results,</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>reducers/home.ts</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (action.type === <span class="string">&#x27;home/saveNewArticles&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; channel_id, timestamp, articles &#125; = action.payload</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        ...state,</span><br><span class="line">        <span class="attr">channelArticles</span>: &#123;</span><br><span class="line">            ...state.channelArticles,</span><br><span class="line">            [channel_id]: &#123;</span><br><span class="line">                timestamp,</span><br><span class="line">                <span class="attr">articles</span>: [...articles],</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>Home/components/ArticleList/index.tsx</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> onRefresh = <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">await</span> dispatch(getNewList(channelId, <span class="built_in">Date</span>.now() + <span class="string">&#x27;&#x27;</span>))</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;styles.root&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">PullToRefresh</span> <span class="attr">onRefresh</span>=<span class="string">&#123;onRefresh&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">            &#123;articles.map((item, index) =&gt; (</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">key</span>=<span class="string">&#123;item.art_id&#125;</span> <span class="attr">className</span>=<span class="string">&#x27;article-item&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">ArticleItem</span> <span class="attr">article</span>=<span class="string">&#123;item&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            ))&#125;</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">InfiniteScroll</span> <span class="attr">loadMore</span>=<span class="string">&#123;loadMore&#125;</span> <span class="attr">hasMore</span>=<span class="string">&#123;hasMore&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">PullToRefresh</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h3 id="IntersectionObserver"><a href="#IntersectionObserver" class="headerlink" title="IntersectionObserver"></a>IntersectionObserver</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;height: 2000px;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">img</span> <span class="attr">data-src</span>=<span class="string">&quot;http://geek.itheima.net/resources/images/19.jpg&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">            <span class="keyword">const</span> oImg = <span class="built_in">document</span>.querySelector(<span class="string">&#x27;img&#x27;</span>)</span></span><br><span class="line"><span class="javascript">            <span class="keyword">const</span> observer = <span class="keyword">new</span> IntersectionObserver(<span class="function"><span class="keyword">function</span> (<span class="params">[&#123; isIntersecting &#125;]</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">if</span> (isIntersecting) &#123;</span></span><br><span class="line"><span class="javascript">                    oImg.src = oImg.getAttribute(<span class="string">&#x27;data-src&#x27;</span>)</span></span><br><span class="line"><span class="javascript">                    observer.unobserve()</span></span><br><span class="line"><span class="javascript">                &#125;</span></span><br><span class="line"><span class="javascript">            &#125;)</span></span><br><span class="line"><span class="javascript">            observer.observe(oImg)</span></span><br><span class="line"><span class="javascript">        </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="图片懒加载的封装"><a href="#图片懒加载的封装" class="headerlink" title="图片懒加载的封装"></a>图片懒加载的封装</h3><h4 id="目标-15"><a href="#目标-15" class="headerlink" title="目标"></a>目标</h4><p>封装一个拥有懒加载功能的图片组件，实现对文章列表项上的封面图片进行懒加载。</p>
<p>当前问题：文章列表一旦开始渲染，上面所有的封面图都会一次性加载，可能会浪费网络资源和降低用户体验。</p>
<p>解决方案：只有当用户滚动页面，真正浏览到这些列表项，才开始加载封面图片。</p>
<p>实现思路：利用浏览器提供的 <code>IntersectionObserver</code>，监听图片元素是否进入可视区域，进入后才真正去设置图片元素的 <code>src</code> 属性进行图片加载。</p>
<h4 id="步骤-8"><a href="#步骤-8" class="headerlink" title="步骤"></a>步骤</h4><ol>
<li>基本封装。</li>
</ol>
<p><code>components/img/index.tsx</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> classnames <span class="keyword">from</span> <span class="string">&#x27;classnames&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useRef, useEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&#x27;./index.module.scss&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Props = &#123;</span><br><span class="line">    <span class="attr">src</span>: <span class="built_in">string</span></span><br><span class="line">    className?: <span class="built_in">string</span></span><br><span class="line">    alt?: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> Img = <span class="function">(<span class="params">&#123; src, className &#125;: Props</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> imgRef = useRef&lt;HTMLImageElement&gt;(<span class="literal">null</span>)</span><br><span class="line">    useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> img = imgRef.current!</span><br><span class="line">        <span class="keyword">const</span> observer = <span class="keyword">new</span> IntersectionObserver(<span class="function">(<span class="params">[&#123; isIntersecting &#125;]</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (isIntersecting) &#123;</span><br><span class="line">                img.src = img.getAttribute(<span class="string">&#x27;data-src&#x27;</span>)!</span><br><span class="line">                observer.unobserve(img)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        observer.observe(img)</span><br><span class="line">        <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">            observer.unobserve(img)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, [])</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;classnames(styles.root,</span> <span class="attr">className</span>)&#125;&gt;</span></span></span><br><span class="line"><span class="xml">            &#123;/* //!加载成功 */&#125;</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">img</span> <span class="attr">alt</span>=<span class="string">&#x27;&#x27;</span> <span class="attr">data-src</span>=<span class="string">&#123;src&#125;</span> <span class="attr">ref</span>=<span class="string">&#123;imgRef&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Img</span><br></pre></td></tr></table></figure>

<p><code>components/img/index.module.scss</code></p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.root</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: relative;</span><br><span class="line">    <span class="attribute">display</span>: inline-block;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">    :global &#123;</span><br><span class="line">        img &#123;</span><br><span class="line">            display: block;</span><br><span class="line">            <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">            <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="selector-class">.image-icon</span> &#123;</span><br><span class="line">            <span class="attribute">position</span>: absolute;</span><br><span class="line">            <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">            <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">            <span class="attribute">display</span>: flex;</span><br><span class="line">            <span class="attribute">justify-content</span>: center;</span><br><span class="line">            <span class="attribute">align-items</span>: center;</span><br><span class="line">            <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">            <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">            <span class="attribute">background-color</span>: <span class="number">#f7f8fa</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="selector-class">.icon</span> &#123;</span><br><span class="line">            <span class="attribute">color</span>: <span class="number">#dcdee0</span>;</span><br><span class="line">            <span class="attribute">font-size</span>: <span class="number">32px</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><code>pages/Question/index.tsx</code> 中测试使用。</li>
</ol>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; NavBar &#125; <span class="keyword">from</span> <span class="string">&#x27;antd-mobile&#x27;</span></span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&#x27;./index.module.scss&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Img <span class="keyword">from</span> <span class="string">&#x27;@/components/Img&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Question = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;styles.root&#125;</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">paddingBottom:</span> <span class="attr">50</span> &#125;&#125;&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">NavBar</span>&gt;</span>问答<span class="tag">&lt;/<span class="name">NavBar</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">height:</span> <span class="attr">2000</span> &#125;&#125;&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Img</span> <span class="attr">src</span>=<span class="string">&#x27;http://geek.itheima.net/resources/images/19.jpg&#x27;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Question</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>处理加载状态。</li>
</ol>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> classnames <span class="keyword">from</span> <span class="string">&#x27;classnames&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useRef, useEffect, useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Icon <span class="keyword">from</span> <span class="string">&#x27;../Icon&#x27;</span></span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&#x27;./index.module.scss&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Props = &#123;</span><br><span class="line">    <span class="attr">src</span>: <span class="built_in">string</span></span><br><span class="line">    className?: <span class="built_in">string</span></span><br><span class="line">    alt?: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> Img = <span class="function">(<span class="params">&#123; src, className &#125;: Props</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> [error, setError] = useState(<span class="literal">false</span>)</span><br><span class="line">    <span class="keyword">const</span> [loading, setLoading] = useState(<span class="literal">true</span>)</span><br><span class="line">    <span class="keyword">const</span> imgRef = useRef&lt;HTMLImageElement&gt;(<span class="literal">null</span>)</span><br><span class="line">    <span class="comment">// #2</span></span><br><span class="line">    <span class="comment">// 如果触发 onError 表示有错</span></span><br><span class="line">    <span class="keyword">const</span> onError = <span class="function">() =&gt;</span> setError(<span class="literal">true</span>)</span><br><span class="line">    <span class="comment">// 如果触发 onLoad 表示加载完了</span></span><br><span class="line">    <span class="keyword">const</span> onLoad = <span class="function">() =&gt;</span> setLoading(<span class="literal">false</span>)</span><br><span class="line">    useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> img = imgRef.current!</span><br><span class="line">        <span class="keyword">const</span> observer = <span class="keyword">new</span> IntersectionObserver(<span class="function">(<span class="params">[&#123; isIntersecting &#125;]</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (isIntersecting) &#123;</span><br><span class="line">                img.src = img.getAttribute(<span class="string">&#x27;data-src&#x27;</span>)!</span><br><span class="line">                observer.unobserve(img)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        observer.observe(img)</span><br><span class="line">        <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">            observer.unobserve(img)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, [])</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;classnames(styles.root,</span> <span class="attr">className</span>)&#125;&gt;</span></span></span><br><span class="line"><span class="xml">            &#123;/* //!加载中... */&#125;</span></span><br><span class="line"><span class="xml">            &#123;loading &amp;&amp; (</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;image-icon&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">Icon</span> <span class="attr">type</span>=<span class="string">&#x27;iconphoto&#x27;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            )&#125;</span></span><br><span class="line"><span class="xml">            &#123;/* //!加载失败 */&#125;</span></span><br><span class="line"><span class="xml">            &#123;/* #3 */&#125;</span></span><br><span class="line"><span class="xml">            &#123;error &amp;&amp; (</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;image-icon&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">Icon</span> <span class="attr">type</span>=<span class="string">&#x27;iconphoto-fail&#x27;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            )&#125;</span></span><br><span class="line"><span class="xml">            &#123;/* #1 */&#125;</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">img</span> <span class="attr">alt</span>=<span class="string">&#x27;&#x27;</span> <span class="attr">data-src</span>=<span class="string">&#123;src&#125;</span> <span class="attr">ref</span>=<span class="string">&#123;imgRef&#125;</span> <span class="attr">onError</span>=<span class="string">&#123;onError&#125;</span> <span class="attr">onLoad</span>=<span class="string">&#123;onLoad&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Img</span><br></pre></td></tr></table></figure>

<ol start="4">
<li><code>pages/Home/components/ArticleItem/index.tsx</code> 中使用懒加载组件。</li>
</ol>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;div className=<span class="string">&#x27;article-imgs&#x27;</span>&gt;</span><br><span class="line">    &#123;images.map(<span class="function">(<span class="params">image, index</span>) =&gt;</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">key</span>=<span class="string">&#123;index&#125;</span> <span class="attr">className</span>=<span class="string">&#x27;article-img-wrapper&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Img</span> <span class="attr">src</span>=<span class="string">&#123;image&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    ))&#125;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<h3 id="点击文章项跳转到详情"><a href="#点击文章项跳转到详情" class="headerlink" title="点击文章项跳转到详情"></a>点击文章项跳转到详情</h3><h4 id="目标-16"><a href="#目标-16" class="headerlink" title="目标"></a>目标</h4><p>能够在点击文章项时跳转到文章详情页面。</p>
<h4 id="素材-2"><a href="#素材-2" class="headerlink" title="素材"></a>素材</h4><p><code>pages/Article/index.tsx</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; NavBar, InfiniteScroll &#125; <span class="keyword">from</span> <span class="string">&#x27;antd-mobile&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useHistory &#125; <span class="keyword">from</span> <span class="string">&#x27;react-router-dom&#x27;</span></span><br><span class="line"><span class="keyword">import</span> classNames <span class="keyword">from</span> <span class="string">&#x27;classnames&#x27;</span></span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&#x27;./index.module.scss&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> Icon <span class="keyword">from</span> <span class="string">&#x27;@/components/Icon&#x27;</span></span><br><span class="line"><span class="keyword">import</span> CommentItem <span class="keyword">from</span> <span class="string">&#x27;./components/CommentItem&#x27;</span></span><br><span class="line"><span class="keyword">import</span> CommentFooter <span class="keyword">from</span> <span class="string">&#x27;./components/CommentFooter&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Article = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> history = useHistory()</span><br><span class="line">    <span class="keyword">const</span> renderArticle = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 文章详情</span></span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;wrapper&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;article-wrapper&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;header&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">h1</span> <span class="attr">className</span>=<span class="string">&#x27;title&#x27;</span>&gt;</span>ES6 Promise 和 Async/await的使用<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;info&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                            <span class="tag">&lt;<span class="name">span</span>&gt;</span>2019-03-11<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">                            <span class="tag">&lt;<span class="name">span</span>&gt;</span>202 阅读<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">                            <span class="tag">&lt;<span class="name">span</span>&gt;</span>10 评论<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;author&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                            <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&#x27;http://geek.itheima.net/images/user_head.jpg&#x27;</span> <span class="attr">alt</span>=<span class="string">&#x27;&#x27;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                            <span class="tag">&lt;<span class="name">span</span> <span class="attr">className</span>=<span class="string">&#x27;name&#x27;</span>&gt;</span>黑马先锋<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">                            <span class="tag">&lt;<span class="name">span</span> <span class="attr">className</span>=<span class="string">&#123;classNames(</span>&#x27;<span class="attr">follow</span>&#x27;, <span class="attr">true</span> ? &#x27;<span class="attr">followed</span>&#x27; <span class="attr">:</span> &#x27;&#x27;)&#125;&gt;</span>&#123;true ? &#x27;已关注&#x27; : &#x27;关注&#x27;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;content&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;content-html dg-html&#x27;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;date&#x27;</span>&gt;</span>发布文章时间：2021-2-1<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;comment&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;comment-header&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">span</span>&gt;</span>全部评论（10）<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">span</span>&gt;</span>20 点赞<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;comment-list&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">CommentItem</span> /&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">InfiniteScroll</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                            <span class="attr">hasMore</span>=<span class="string">&#123;false&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                            <span class="attr">loadMore</span>=<span class="string">&#123;async</span> () =&gt;</span> &#123;</span></span><br><span class="line"><span class="xml">                                console.log(1)</span></span><br><span class="line"><span class="xml">                            &#125;&#125;</span></span><br><span class="line"><span class="xml">                        /&gt;</span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;styles.root&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;root-wrapper&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">NavBar</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                    <span class="attr">onBack</span>=<span class="string">&#123;()</span> =&gt;</span> history.go(-1)&#125;</span></span><br><span class="line"><span class="xml">                    right=&#123;</span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">                            <span class="tag">&lt;<span class="name">Icon</span> <span class="attr">type</span>=<span class="string">&#x27;icongengduo&#x27;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    &#125;</span></span><br><span class="line"><span class="xml">                &gt;</span></span><br><span class="line"><span class="xml">                    &#123;true &amp;&amp; (</span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;nav-author&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                            <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&#x27;http://geek.itheima.net/images/user_head.jpg&#x27;</span> <span class="attr">alt</span>=<span class="string">&#x27;&#x27;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                            <span class="tag">&lt;<span class="name">span</span> <span class="attr">className</span>=<span class="string">&#x27;name&#x27;</span>&gt;</span>黑马先锋<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">                            <span class="tag">&lt;<span class="name">span</span> <span class="attr">className</span>=<span class="string">&#123;classNames(</span>&#x27;<span class="attr">follow</span>&#x27;, <span class="attr">true</span> ? &#x27;<span class="attr">followed</span>&#x27; <span class="attr">:</span> &#x27;&#x27;)&#125;&gt;</span>&#123;true ? &#x27;已关注&#x27; : &#x27;关注&#x27;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    )&#125;</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">NavBar</span>&gt;</span></span></span><br><span class="line"><span class="xml">                &#123;/* 文章详情和评论 */&#125;</span></span><br><span class="line"><span class="xml">                &#123;renderArticle()&#125;</span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">                &#123;/* 底部评论栏 */&#125;</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">CommentFooter</span> /&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Article</span><br></pre></td></tr></table></figure>

<p><code>pages/Article/index.module.scss</code></p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@import</span> <span class="string">&#x27;@scss/hairline.scss&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.root</span> &#123;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line"></span><br><span class="line">    :global &#123;</span><br><span class="line">        .root-wrapper &#123;</span><br><span class="line">            position: relative;</span><br><span class="line">            <span class="attribute">display</span>: flex;</span><br><span class="line">            <span class="attribute">flex-direction</span>: column;</span><br><span class="line">            <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">            <span class="attribute">z-index</span>: <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="selector-class">.adm-nav-bar-left</span> &#123;</span><br><span class="line">            <span class="attribute">flex</span>: unset;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="selector-class">.adm-nav-bar-title</span> &#123;</span><br><span class="line">            <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="selector-class">.am-icon-ellipsis</span> &#123;</span><br><span class="line">            <span class="attribute">color</span>: <span class="number">#323233</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="selector-class">.nav-author</span> &#123;</span><br><span class="line">            <span class="attribute">display</span>: flex;</span><br><span class="line">            <span class="attribute">text-align</span>: left;</span><br><span class="line">            <span class="attribute">align-items</span>: center;</span><br><span class="line">            <span class="attribute">color</span>: <span class="number">#3a3948</span>;</span><br><span class="line">            <span class="attribute">font-size</span>: <span class="number">15px</span>;</span><br><span class="line">            <span class="selector-tag">img</span> &#123;</span><br><span class="line">                <span class="attribute">width</span>: <span class="number">24px</span>;</span><br><span class="line">                <span class="attribute">height</span>: <span class="number">24px</span>;</span><br><span class="line">                <span class="attribute">border-radius</span>: <span class="number">50%</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="selector-class">.name</span> &#123;</span><br><span class="line">                <span class="attribute">margin</span>: <span class="number">0</span> <span class="number">8px</span>;</span><br><span class="line">                <span class="attribute">padding-right</span>: <span class="number">10px</span>;</span><br><span class="line">                <span class="attribute">border-right</span>: <span class="number">1px</span> solid <span class="number">#bfc2cb</span>;</span><br><span class="line">                <span class="attribute">line-height</span>: <span class="number">10px</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="selector-class">.follow</span> &#123;</span><br><span class="line">                <span class="attribute">color</span>: <span class="number">#de644b</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="selector-class">.followed</span> &#123;</span><br><span class="line">                <span class="attribute">color</span>: <span class="number">#ccc</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="selector-class">.wrapper</span> &#123;</span><br><span class="line">            <span class="attribute">flex</span>: <span class="number">1</span>;</span><br><span class="line">            <span class="attribute">padding-bottom</span>: <span class="number">50px</span>;</span><br><span class="line">            <span class="attribute">overflow-y</span>: auto;</span><br><span class="line">            <span class="attribute">background-color</span>: <span class="number">#f7f8fa</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="selector-class">.article-wrapper</span> &#123;</span><br><span class="line">            <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">16px</span>;</span><br><span class="line">            <span class="attribute">background-color</span>: <span class="number">#fff</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="selector-class">.header</span> &#123;</span><br><span class="line">            <span class="attribute">position</span>: relative;</span><br><span class="line">            <span class="attribute">padding</span>: <span class="number">18px</span> <span class="number">0</span> <span class="number">12px</span>;</span><br><span class="line">            <span class="keyword">@include</span> hairline(bottom, <span class="number">#f0f0f0</span>);</span><br><span class="line"></span><br><span class="line">            <span class="selector-class">.title</span> &#123;</span><br><span class="line">                <span class="attribute">margin-bottom</span>: <span class="number">12px</span>;</span><br><span class="line">                <span class="attribute">font-size</span>: <span class="number">23px</span>;</span><br><span class="line">                <span class="attribute">color</span>: <span class="number">#333</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="selector-class">.info</span> &#123;</span><br><span class="line">                <span class="attribute">height</span>: <span class="number">12px</span>;</span><br><span class="line">                <span class="attribute">margin-bottom</span>: <span class="number">23px</span>;</span><br><span class="line">                <span class="attribute">line-height</span>: <span class="number">12px</span>;</span><br><span class="line">                <span class="attribute">color</span>: <span class="number">#a5a6ab</span>;</span><br><span class="line">                <span class="attribute">font-size</span>: <span class="number">11px</span>;</span><br><span class="line"></span><br><span class="line">                <span class="selector-tag">span</span> &#123;</span><br><span class="line">                    <span class="attribute">display</span>: inline-block;</span><br><span class="line">                    <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">8px</span>;</span><br><span class="line">                    <span class="attribute">border-right</span>: <span class="number">1px</span> solid <span class="number">#bfc2cb</span>;</span><br><span class="line"></span><br><span class="line">                    &amp;<span class="selector-pseudo">:first</span>-child &#123;</span><br><span class="line">                        <span class="attribute">padding-left</span>: <span class="number">0</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    &amp;<span class="selector-pseudo">:last-child</span> &#123;</span><br><span class="line">                        <span class="attribute">border-right</span>: <span class="number">0</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="selector-class">.author</span> &#123;</span><br><span class="line">                <span class="attribute">position</span>: relative;</span><br><span class="line">                <span class="attribute">display</span>: flex;</span><br><span class="line">                <span class="attribute">align-items</span>: center;</span><br><span class="line"></span><br><span class="line">                <span class="selector-tag">img</span> &#123;</span><br><span class="line">                    <span class="attribute">width</span>: <span class="number">34px</span>;</span><br><span class="line">                    <span class="attribute">height</span>: <span class="number">34px</span>;</span><br><span class="line">                    <span class="attribute">margin-right</span>: <span class="number">12px</span>;</span><br><span class="line">                    <span class="selector-tag">object</span>-fit: cover;</span><br><span class="line">                    <span class="attribute">border-radius</span>: <span class="number">50%</span>;</span><br><span class="line">                    <span class="attribute">overflow</span>: hidden;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="selector-class">.name</span> &#123;</span><br><span class="line">                    <span class="attribute">color</span>: <span class="number">#333</span>;</span><br><span class="line">                    <span class="attribute">font-size</span>: <span class="number">15px</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="selector-class">.follow</span> &#123;</span><br><span class="line">                    <span class="attribute">position</span>: absolute;</span><br><span class="line">                    <span class="attribute">right</span>: <span class="number">0</span>;</span><br><span class="line">                    <span class="attribute">height</span>: <span class="number">29px</span>;</span><br><span class="line">                    <span class="attribute">padding</span>: <span class="number">8px</span> <span class="number">18px</span>;</span><br><span class="line">                    <span class="attribute">border-radius</span>: <span class="number">15px</span>;</span><br><span class="line">                    <span class="attribute">line-height</span>: <span class="number">1</span>;</span><br><span class="line">                    <span class="attribute">color</span>: <span class="number">#fff</span>;</span><br><span class="line">                    <span class="attribute">font-size</span>: <span class="number">14px</span>;</span><br><span class="line">                    <span class="attribute">background-color</span>: <span class="number">#fc6627</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="selector-class">.followed</span> &#123;</span><br><span class="line">                    <span class="attribute">color</span>: <span class="number">#a5a6ab</span>;</span><br><span class="line">                    <span class="attribute">background-color</span>: <span class="number">#f7f8fa</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="selector-class">.content</span> &#123;</span><br><span class="line">            <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">            <span class="attribute">padding</span>: <span class="number">30px</span> <span class="number">0</span> <span class="number">25px</span>;</span><br><span class="line">            <span class="attribute">line-height</span>: <span class="number">27px</span>;</span><br><span class="line">            <span class="attribute">overflow</span>: hidden;</span><br><span class="line">            <span class="attribute">color</span>: <span class="number">#595769</span>;</span><br><span class="line">            <span class="attribute">font-size</span>: <span class="number">16px</span>;</span><br><span class="line"></span><br><span class="line">            <span class="selector-class">.content-html</span> &#123;</span><br><span class="line">                <span class="attribute">min-height</span>: <span class="number">200px</span>;</span><br><span class="line">                <span class="attribute">word-break</span>: break-all;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 动态内容中的元素</span></span><br><span class="line">                pre &#123;</span><br><span class="line">                    <span class="attribute">font-size</span>: <span class="number">14px</span>;</span><br><span class="line">                    <span class="attribute">white-space</span>: pre-wrap;</span><br><span class="line"></span><br><span class="line">                    <span class="selector-tag">code</span> &#123;</span><br><span class="line">                        <span class="attribute">white-space</span>: pre;</span><br><span class="line"></span><br><span class="line">                        &amp;<span class="selector-class">.hljs</span> &#123;</span><br><span class="line">                            <span class="attribute">display</span>: block;</span><br><span class="line">                            <span class="attribute">padding</span>: <span class="number">7px</span>;</span><br><span class="line">                            <span class="attribute">overflow-x</span>: auto;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="selector-tag">img</span> &#123;</span><br><span class="line">                <span class="attribute">max-width</span>: <span class="number">100%</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="selector-class">.date</span> &#123;</span><br><span class="line">                <span class="attribute">padding-top</span>: <span class="number">25px</span>;</span><br><span class="line">                <span class="attribute">text-align</span>: right;</span><br><span class="line">                <span class="attribute">font-size</span>: <span class="number">12px</span>;</span><br><span class="line">                <span class="attribute">color</span>: <span class="number">#a5a6ab</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="selector-class">.comment</span> &#123;</span><br><span class="line">            <span class="attribute">margin-top</span>: <span class="number">12px</span>;</span><br><span class="line">            <span class="attribute">background-color</span>: <span class="number">#fff</span>;</span><br><span class="line"></span><br><span class="line">            <span class="selector-class">.comment-header</span> &#123;</span><br><span class="line">                <span class="attribute">display</span>: flex;</span><br><span class="line">                <span class="attribute">justify-content</span>: space-between;</span><br><span class="line">                <span class="attribute">padding</span>: <span class="number">16px</span>;</span><br><span class="line">                <span class="attribute">font-size</span>: <span class="number">17px</span>;</span><br><span class="line">                <span class="attribute">font-weight</span>: <span class="number">500</span>;</span><br><span class="line">                <span class="attribute">color</span>: <span class="number">#333</span>;</span><br><span class="line"></span><br><span class="line">                <span class="selector-tag">span</span> &#123;</span><br><span class="line">                    &amp;<span class="selector-pseudo">:last-child</span> &#123;</span><br><span class="line">                        <span class="attribute">color</span>: <span class="number">#a5a6ab</span>;</span><br><span class="line">                        <span class="attribute">font-size</span>: <span class="number">14px</span>;</span><br><span class="line">                        <span class="attribute">font-weight</span>: normal;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="selector-class">.comment-list</span> &#123;</span><br><span class="line">                <span class="attribute">margin-top</span>: <span class="number">3px</span>;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// .placeholder &#123;</span></span><br><span class="line">                <span class="comment">//   height: 0;</span></span><br><span class="line">                <span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">// .list-loading &#123;</span></span><br><span class="line">                <span class="comment">//   line-height: 49px;</span></span><br><span class="line">                <span class="comment">//   color: #969799;</span></span><br><span class="line">                <span class="comment">//   font-size: 12px;</span></span><br><span class="line">                <span class="comment">//   text-align: center;</span></span><br><span class="line">                <span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">// .no-more &#123;</span></span><br><span class="line">                <span class="comment">//   line-height: 49px;</span></span><br><span class="line">                <span class="comment">//   color: #969799;</span></span><br><span class="line">                <span class="comment">//   font-size: 14px;</span></span><br><span class="line">                <span class="comment">//   text-align: center;</span></span><br><span class="line">                <span class="comment">// &#125;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">:global &#123;</span><br><span class="line">    .comment-popup &#123;</span><br><span class="line">        .adm-popup-body &#123;</span><br><span class="line">            height: <span class="number">100%</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        &amp;-wrapper &#123;</span><br><span class="line">            <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">            <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">            <span class="attribute">background-color</span>: <span class="number">#fff</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="selector-class">.reply-popup</span> &#123;</span><br><span class="line">        <span class="selector-class">.adm-popup-body</span> &#123;</span><br><span class="line">            <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        &amp;-wrapper &#123;</span><br><span class="line">            <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">            <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">            <span class="attribute">background-color</span>: <span class="number">#fff</span>;</span><br><span class="line">            <span class="attribute">border-radius</span>: <span class="number">20px</span> <span class="number">20px</span> <span class="number">0px</span> <span class="number">0px</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>pages/Article/components/CommentItem/index.tsx</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> dayjs <span class="keyword">from</span> <span class="string">&#x27;dayjs&#x27;</span></span><br><span class="line"><span class="keyword">import</span> relativeTime <span class="keyword">from</span> <span class="string">&#x27;dayjs/plugin/relativeTime&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;dayjs/locale/zh-cn&#x27;</span></span><br><span class="line"><span class="keyword">import</span> classnames <span class="keyword">from</span> <span class="string">&#x27;classnames&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Icon <span class="keyword">from</span> <span class="string">&#x27;@/components/Icon&#x27;</span></span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&#x27;./index.module.scss&#x27;</span></span><br><span class="line">dayjs.extend(relativeTime)</span><br><span class="line">dayjs.locale(<span class="string">&#x27;zh-cn&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Props = &#123;</span><br><span class="line">    <span class="comment">// normal 普通 - 文章的评论</span></span><br><span class="line">    <span class="comment">// origin 回复评论的原始评论，也就是对哪个评论进行回复</span></span><br><span class="line">    <span class="comment">// reply 回复评论</span></span><br><span class="line">    <span class="keyword">type</span>?: <span class="string">&#x27;normal&#x27;</span> | <span class="string">&#x27;reply&#x27;</span> | <span class="string">&#x27;origin&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> CommentItem = <span class="function">(<span class="params">&#123;</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="regexp">//</span> normal 普通</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="regexp">//</span> origin 回复评论的原始评论</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="regexp">//</span> reply 回复评论</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">type</span> = <span class="string">&#x27;normal&#x27;</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">&#125;: Props</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 回复按钮</span></span><br><span class="line">    <span class="keyword">const</span> replyJSX =</span><br><span class="line">        <span class="keyword">type</span> === <span class="string">&#x27;normal&#x27;</span> ? (</span><br><span class="line">            <span class="xml"><span class="tag">&lt;<span class="name">span</span> <span class="attr">className</span>=<span class="string">&#x27;replay&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                0 回复</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Icon</span> <span class="attr">type</span>=<span class="string">&#x27;iconbtn_right&#x27;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line">        ) : <span class="literal">null</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;styles.root&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;avatar&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&#x27;http://geek.itheima.net/images/user_head.jpg&#x27;</span> <span class="attr">alt</span>=<span class="string">&#x27;&#x27;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;comment-info&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;comment-info-header&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">span</span> <span class="attr">className</span>=<span class="string">&#x27;name&#x27;</span>&gt;</span>黑马先锋<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    &#123;/* 文章评论、评论的回复 */&#125;</span></span><br><span class="line"><span class="xml">                    &#123;(type === &#x27;normal&#x27; || type === &#x27;reply&#x27;) &amp;&amp; (</span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">span</span> <span class="attr">className</span>=<span class="string">&#x27;thumbs-up&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                            10</span></span><br><span class="line"><span class="xml">                            <span class="tag">&lt;<span class="name">Icon</span> <span class="attr">type</span>=<span class="string">&#123;true</span> ? &#x27;<span class="attr">iconbtn_like_sel</span>&#x27; <span class="attr">:</span> &#x27;<span class="attr">iconbtn_like2</span>&#x27;&#125; /&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    )&#125;</span></span><br><span class="line"><span class="xml">                    &#123;/* 要回复的评论 */&#125;</span></span><br><span class="line"><span class="xml">                    &#123;type === &#x27;origin&#x27; &amp;&amp; <span class="tag">&lt;<span class="name">span</span> <span class="attr">className</span>=<span class="string">&#123;classnames(</span>&#x27;<span class="attr">follow</span>&#x27;, <span class="attr">true</span> ? &#x27;<span class="attr">followed</span>&#x27; <span class="attr">:</span> &#x27;&#x27;)&#125;&gt;</span>&#123;true ? &#x27;已关注&#x27; : &#x27;关注&#x27;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span>&#125;</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;comment-content&#x27;</span>&gt;</span>打破零评论<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;comment-footer&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    &#123;replyJSX&#125;</span></span><br><span class="line"><span class="xml">                    &#123;/* 非评论的回复 */&#125;</span></span><br><span class="line"><span class="xml">                    &#123;type !== &#x27;reply&#x27; &amp;&amp; <span class="tag">&lt;<span class="name">span</span> <span class="attr">className</span>=<span class="string">&#x27;comment-time&#x27;</span>&gt;</span>&#123;dayjs().from(&#x27;2021-01-01&#x27;)&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span>&#125;</span></span><br><span class="line"><span class="xml">                    &#123;/* 文章的评论 */&#125;</span></span><br><span class="line"><span class="xml">                    &#123;type === &#x27;origin&#x27; &amp;&amp; (</span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">span</span> <span class="attr">className</span>=<span class="string">&#x27;thumbs-up&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                            10</span></span><br><span class="line"><span class="xml">                            <span class="tag">&lt;<span class="name">Icon</span> <span class="attr">type</span>=<span class="string">&#123;true</span> ? &#x27;<span class="attr">iconbtn_like_sel</span>&#x27; <span class="attr">:</span> &#x27;<span class="attr">iconbtn_like2</span>&#x27;&#125; /&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    )&#125;</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> CommentItem</span><br></pre></td></tr></table></figure>

<p><code>pages/Article/components/CommentItem/index.module.scss</code></p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.root</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">5px</span> <span class="number">0</span> <span class="number">16px</span> <span class="number">16px</span>;</span><br><span class="line">    :global &#123;</span><br><span class="line">        .avatar &#123;</span><br><span class="line">            width: <span class="number">34px</span>;</span><br><span class="line">            <span class="attribute">height</span>: <span class="number">34px</span>;</span><br><span class="line">            <span class="attribute">margin-right</span>: <span class="number">12px</span>;</span><br><span class="line"></span><br><span class="line">            <span class="selector-tag">img</span> &#123;</span><br><span class="line">                <span class="attribute">width</span>: <span class="number">34px</span>;</span><br><span class="line">                <span class="attribute">height</span>: <span class="number">34px</span>;</span><br><span class="line">                <span class="attribute">border-radius</span>: <span class="number">50%</span>;</span><br><span class="line">                <span class="selector-tag">object</span>-fit: cover;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="selector-class">.comment-info</span> &#123;</span><br><span class="line">            <span class="attribute">flex</span>: <span class="number">1</span>;</span><br><span class="line">            <span class="attribute">padding-right</span>: <span class="number">16px</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="selector-class">.comment-info-header</span> &#123;</span><br><span class="line">            <span class="attribute">display</span>: flex;</span><br><span class="line">            <span class="attribute">align-items</span>: center;</span><br><span class="line">            <span class="attribute">justify-content</span>: space-between;</span><br><span class="line">            <span class="attribute">height</span>: <span class="number">34px</span>;</span><br><span class="line">            <span class="attribute">font-size</span>: <span class="number">15px</span>;</span><br><span class="line">            <span class="attribute">color</span>: <span class="number">#333</span>;</span><br><span class="line"></span><br><span class="line">            <span class="selector-class">.name</span> &#123;</span><br><span class="line">                <span class="attribute">font-weight</span>: <span class="number">500</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="selector-class">.thumbs-up</span> &#123;</span><br><span class="line">            <span class="attribute">font-size</span>: <span class="number">14px</span>;</span><br><span class="line"></span><br><span class="line">            <span class="selector-class">.icon</span> &#123;</span><br><span class="line">                <span class="attribute">margin-left</span>: <span class="number">8px</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="selector-class">.follow</span> &#123;</span><br><span class="line">            <span class="attribute">line-height</span>: <span class="number">29px</span>;</span><br><span class="line">            <span class="attribute">color</span>: <span class="number">#de644b</span>;</span><br><span class="line">            <span class="attribute">font-size</span>: <span class="number">15px</span>;</span><br><span class="line">            <span class="attribute">text-align</span>: center;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="selector-class">.followed</span> &#123;</span><br><span class="line">            <span class="attribute">width</span>: <span class="number">64px</span>;</span><br><span class="line">            <span class="attribute">height</span>: <span class="number">29px</span>;</span><br><span class="line">            <span class="attribute">border-radius</span>: <span class="number">15px</span>;</span><br><span class="line">            <span class="attribute">color</span>: <span class="number">#a5a6ab</span>;</span><br><span class="line">            <span class="attribute">background-color</span>: <span class="number">#f7f8fa</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="selector-class">.comment-content</span> &#123;</span><br><span class="line">            <span class="attribute">margin-bottom</span>: <span class="number">8px</span>;</span><br><span class="line">            <span class="attribute">line-height</span>: <span class="number">1.4</span>;</span><br><span class="line">            <span class="attribute">color</span>: <span class="number">#3a3948</span>;</span><br><span class="line">            <span class="attribute">font-size</span>: <span class="number">16px</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="selector-class">.comment-footer</span> &#123;</span><br><span class="line">            <span class="attribute">display</span>: flex;</span><br><span class="line">            <span class="attribute">align-items</span>: center;</span><br><span class="line">            <span class="attribute">position</span>: relative;</span><br><span class="line"></span><br><span class="line">            <span class="selector-class">.close</span> &#123;</span><br><span class="line">                <span class="attribute">position</span>: absolute;</span><br><span class="line">                <span class="attribute">right</span>: <span class="number">0</span>;</span><br><span class="line">                <span class="attribute">top</span>: <span class="number">50%</span>;</span><br><span class="line">                <span class="attribute">margin-top</span>: -<span class="number">7px</span>;</span><br><span class="line">                <span class="attribute">font-size</span>: <span class="number">14px</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="selector-class">.replay</span> &#123;</span><br><span class="line">            <span class="attribute">height</span>: <span class="number">25px</span>;</span><br><span class="line">            <span class="attribute">padding</span>: <span class="number">6px</span> <span class="number">8px</span>;</span><br><span class="line">            <span class="attribute">margin-right</span>: <span class="number">12px</span>;</span><br><span class="line">            <span class="attribute">border-radius</span>: <span class="number">15px</span>;</span><br><span class="line">            <span class="attribute">font-size</span>: <span class="number">12px</span>;</span><br><span class="line">            <span class="attribute">background-color</span>: <span class="number">#f7f8fa</span>;</span><br><span class="line"></span><br><span class="line">            <span class="selector-class">.icon</span> &#123;</span><br><span class="line">                <span class="attribute">position</span>: relative;</span><br><span class="line">                <span class="attribute">top</span>: -<span class="number">1px</span>;</span><br><span class="line">                <span class="attribute">width</span>: <span class="number">11px</span>;</span><br><span class="line">                <span class="attribute">height</span>: <span class="number">10px</span>;</span><br><span class="line">                <span class="attribute">margin-left</span>: <span class="number">6px</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="selector-class">.comment-time</span> &#123;</span><br><span class="line">            <span class="attribute">flex</span>: <span class="number">1</span>;</span><br><span class="line">            <span class="attribute">color</span>: <span class="number">#a5a6ab</span>;</span><br><span class="line">            <span class="attribute">font-size</span>: <span class="number">12px</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>pages/Article/components/CommentFooter/index.tsx</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Icon <span class="keyword">from</span> <span class="string">&#x27;@/components/Icon&#x27;</span></span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&#x27;./index.module.scss&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Props = &#123;</span><br><span class="line">    <span class="comment">// normal 普通评论</span></span><br><span class="line">    <span class="comment">// reply 回复评论</span></span><br><span class="line">    <span class="keyword">type</span>?: <span class="string">&#x27;normal&#x27;</span> | <span class="string">&#x27;reply&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> CommentFooter = <span class="function">(<span class="params">&#123; <span class="keyword">type</span> = <span class="string">&#x27;normal&#x27;</span> &#125;: Props</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;styles.root&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;input-btn&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Icon</span> <span class="attr">type</span>=<span class="string">&#x27;iconbianji&#x27;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">span</span>&gt;</span>抢沙发<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">            &#123;type === &#x27;normal&#x27; &amp;&amp; (</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;action-item&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">Icon</span> <span class="attr">type</span>=<span class="string">&#x27;iconbtn_comment&#x27;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">p</span>&gt;</span>评论<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        &#123;!!1 &amp;&amp; <span class="tag">&lt;<span class="name">span</span> <span class="attr">className</span>=<span class="string">&#x27;bage&#x27;</span>&gt;</span>&#123;1&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span>&#125;</span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;action-item&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">Icon</span> <span class="attr">type</span>=<span class="string">&#123;true</span> ? &#x27;<span class="attr">iconbtn_like_sel</span>&#x27; <span class="attr">:</span> &#x27;<span class="attr">iconbtn_like2</span>&#x27;&#125; /&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">p</span>&gt;</span>点赞<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;action-item&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">Icon</span> <span class="attr">type</span>=<span class="string">&#123;true</span> ? &#x27;<span class="attr">iconbtn_collect_sel</span>&#x27; <span class="attr">:</span> &#x27;<span class="attr">iconbtn_collect</span>&#x27;&#125; /&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">p</span>&gt;</span>收藏<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">            )&#125;</span><br><span class="line"></span><br><span class="line">            &#123;<span class="keyword">type</span> === <span class="string">&#x27;reply&#x27;</span> &amp;&amp; (</span><br><span class="line">                <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;action-item&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">Icon</span> <span class="attr">type</span>=<span class="string">&#123;true</span> ? &#x27;<span class="attr">iconbtn_like_sel</span>&#x27; <span class="attr">:</span> &#x27;<span class="attr">iconbtn_like2</span>&#x27;&#125; /&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">p</span>&gt;</span>点赞<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">            )&#125;</span><br><span class="line"></span><br><span class="line">            &lt;div className=<span class="string">&#x27;action-item&#x27;</span>&gt;</span><br><span class="line">                <span class="xml"><span class="tag">&lt;<span class="name">Icon</span> <span class="attr">type</span>=<span class="string">&#x27;iconbtn_share&#x27;</span> /&gt;</span></span></span><br><span class="line">                <span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>分享<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> CommentFooter</span><br></pre></td></tr></table></figure>

<p><code>pages/Article/components/CommentFooter/index.module.scss</code></p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@import</span> <span class="string">&#x27;@scss/hairline.scss&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.root</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">align-items</span>: center;</span><br><span class="line">    <span class="attribute">position</span>: fixed;</span><br><span class="line">    <span class="attribute">bottom</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">50px</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">16px</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#fff</span>;</span><br><span class="line">    <span class="keyword">@include</span> hairline(top, <span class="number">#f0f0f0</span>);</span><br><span class="line"></span><br><span class="line">    :global &#123;</span><br><span class="line">        .input-btn &#123;</span><br><span class="line">            flex: <span class="number">1</span>;</span><br><span class="line">            <span class="attribute">display</span>: flex;</span><br><span class="line">            <span class="attribute">align-items</span>: center;</span><br><span class="line">            <span class="attribute">height</span>: <span class="number">36px</span>;</span><br><span class="line">            <span class="attribute">padding-left</span>: <span class="number">10px</span>;</span><br><span class="line">            <span class="attribute">color</span>: <span class="number">#9ea1ae</span>;</span><br><span class="line">            <span class="attribute">font-size</span>: <span class="number">14px</span>;</span><br><span class="line">            <span class="attribute">background-color</span>: <span class="number">#f7f8fa</span>;</span><br><span class="line">            <span class="attribute">border-radius</span>: <span class="number">18px</span>;</span><br><span class="line"></span><br><span class="line">            <span class="selector-class">.icon</span> &#123;</span><br><span class="line">                <span class="attribute">margin-right</span>: <span class="number">4px</span>;</span><br><span class="line">                <span class="attribute">color</span>: <span class="number">#9ea1ae</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="selector-class">.action-item</span> &#123;</span><br><span class="line">            <span class="attribute">position</span>: relative;</span><br><span class="line">            <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">13px</span>;</span><br><span class="line">            <span class="attribute">text-align</span>: center;</span><br><span class="line">            <span class="attribute">color</span>: <span class="number">#595769</span>;</span><br><span class="line">            <span class="attribute">font-size</span>: <span class="number">12px</span>;</span><br><span class="line"></span><br><span class="line">            <span class="selector-class">.icon</span> &#123;</span><br><span class="line">                <span class="attribute">margin-bottom</span>: <span class="number">4px</span>;</span><br><span class="line">                <span class="attribute">font-size</span>: <span class="number">20px</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            &amp;<span class="selector-pseudo">:last-child</span> &#123;</span><br><span class="line">                <span class="attribute">padding-right</span>: <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="selector-class">.bage</span> &#123;</span><br><span class="line">                <span class="attribute">position</span>: absolute;</span><br><span class="line">                <span class="attribute">right</span>: <span class="number">8px</span>;</span><br><span class="line">                <span class="attribute">top</span>: -<span class="number">3px</span>;</span><br><span class="line">                <span class="attribute">padding</span>: <span class="number">1px</span> <span class="number">4px</span>;</span><br><span class="line">                <span class="attribute">border-radius</span>: <span class="number">6px</span>;</span><br><span class="line">                <span class="attribute">color</span>: <span class="number">#fff</span>;</span><br><span class="line">                <span class="attribute">background-color</span>: <span class="number">#fc6627</span>;</span><br><span class="line">                <span class="attribute">font-size</span>: <span class="number">12px</span>;</span><br><span class="line">                <span class="attribute">line-height</span>: <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="步骤-9"><a href="#步骤-9" class="headerlink" title="步骤"></a>步骤</h4><ol>
<li><p>将文章详情页面模板拷贝到 pages 目录中。</p>
</li>
<li><p>在 App 组件中配置文章详情页路由。</p>
</li>
<li><p>为每个文章列表项绑定点击事件。</p>
</li>
<li><p>点击时，根据文章 id，跳转到文章详情页对应的路由。</p>
</li>
</ol>
<h4 id="代码-12"><a href="#代码-12" class="headerlink" title="代码"></a>代码</h4><p><code>pages/Home/component/ArticleList/index.tsx</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 建议：在 `pages/Home/component/ArticleItem/index.tsx` 组件的根节点进行跳转</span></span><br><span class="line">&lt;div key=&#123;item.art_id&#125; className=<span class="string">&#x27;article-item&#x27;</span> onClick=&#123;<span class="function">() =&gt;</span> history.push(<span class="string">`/article/<span class="subst">$&#123;item.art_id&#125;</span>`</span>)&#125;&gt;</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">ArticleItem</span> <span class="attr">article</span>=<span class="string">&#123;item&#125;</span> /&gt;</span></span></span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<p><code>App.tsx</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Article <span class="keyword">from</span> <span class="string">&#x27;./pages/Article&#x27;</span></span><br><span class="line">;<span class="xml"><span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&#x27;/article/:id&#x27;</span> <span class="attr">component</span>=<span class="string">&#123;Article&#125;</span> /&gt;</span></span></span><br></pre></td></tr></table></figure>

<h3 id="Tab-栏切换记录滚动位置"><a href="#Tab-栏切换记录滚动位置" class="headerlink" title="Tab 栏切换记录滚动位置"></a>Tab 栏切换记录滚动位置</h3><p><code>src\pages\Home\index.tsx</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 通过 forceRender 属性，达到组件隐藏的时候不销毁结构</span></span><br><span class="line">&lt;Tabs.Tab forceRender title=&#123;item.name&#125; key=&#123;item.id&#125;&gt;&lt;/Tabs.Tab&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 可以测试组件是否被销毁了 `src/pages/Home/components/ArticleList/index.tsx`</span></span><br><span class="line">useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;卸载了&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;, [])</span><br></pre></td></tr></table></figure>

<h2 id="搜索联想建议"><a href="#搜索联想建议" class="headerlink" title="搜索联想建议"></a>搜索联想建议</h2><h3 id="静态结构"><a href="#静态结构" class="headerlink" title="静态结构"></a>静态结构</h3><h4 id="目标-17"><a href="#目标-17" class="headerlink" title="目标"></a>目标</h4><p>实现文章搜索页面的主要静态结构和样式。</p>
<h4 id="素材-3"><a href="#素材-3" class="headerlink" title="素材"></a>素材</h4><p><code>pages/Search/index.tsx</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> classnames <span class="keyword">from</span> <span class="string">&#x27;classnames&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useHistory &#125; <span class="keyword">from</span> <span class="string">&#x27;react-router&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; NavBar, Search &#125; <span class="keyword">from</span> <span class="string">&#x27;antd-mobile&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> Icon <span class="keyword">from</span> <span class="string">&#x27;@/components/Icon&#x27;</span></span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&#x27;./index.module.scss&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> SearchPage = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> history = useHistory()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;styles.root&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">NavBar</span> <span class="attr">className</span>=<span class="string">&#x27;navbar&#x27;</span> <span class="attr">onBack</span>=<span class="string">&#123;()</span> =&gt;</span> history.go(-1)&#125; right=&#123;<span class="tag">&lt;<span class="name">span</span> <span class="attr">className</span>=<span class="string">&#x27;search-text&#x27;</span>&gt;</span>搜索<span class="tag">&lt;/<span class="name">span</span>&gt;</span>&#125;&gt;</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Search</span> <span class="attr">placeholder</span>=<span class="string">&#x27;请输入关键字搜索&#x27;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">NavBar</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">            &#123;true &amp;&amp; (</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">div</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                    <span class="attr">className</span>=<span class="string">&#x27;history&#x27;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                    <span class="attr">style</span>=<span class="string">&#123;&#123;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                        <span class="attr">display:</span> <span class="attr">true</span> ? &#x27;<span class="attr">none</span>&#x27; <span class="attr">:</span> &#x27;<span class="attr">block</span>&#x27;,</span></span></span><br><span class="line"><span class="tag"><span class="xml">                    &#125;&#125;</span></span></span><br><span class="line"><span class="tag"><span class="xml">                &gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;history-header&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">span</span>&gt;</span>搜索历史<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">                            <span class="tag">&lt;<span class="name">Icon</span> <span class="attr">type</span>=<span class="string">&#x27;iconbtn_del&#x27;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                            清除全部</span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;history-list&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">span</span> <span class="attr">className</span>=<span class="string">&#x27;history-item&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                            <span class="tag">&lt;<span class="name">span</span> <span class="attr">className</span>=<span class="string">&#x27;text-overflow&#x27;</span>&gt;</span>黑马程序员<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">                            <span class="tag">&lt;<span class="name">Icon</span> <span class="attr">type</span>=<span class="string">&#x27;iconbtn_essay_close&#x27;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            )&#125;</span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;classnames(</span>&#x27;<span class="attr">search-result</span>&#x27;, <span class="attr">true</span> ? &#x27;<span class="attr">show</span>&#x27; <span class="attr">:</span> &#x27;&#x27;)&#125;&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;result-item&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">Icon</span> <span class="attr">className</span>=<span class="string">&#x27;icon-search&#x27;</span> <span class="attr">type</span>=<span class="string">&#x27;iconbtn_search&#x27;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;result-value text-overflow&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">span</span>&gt;</span>黑马<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        程序员</span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> SearchPage</span><br></pre></td></tr></table></figure>

<p><code>pages/Search/index.module.scss</code></p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@import</span> <span class="string">&#x27;@scss/hairline.scss&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.root</span> &#123;</span><br><span class="line">    :global &#123;</span><br><span class="line">        .navbar &#123;</span><br><span class="line">            --height: <span class="number">52px</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">@include</span> hairline-remove(bottom);</span><br><span class="line"></span><br><span class="line">            <span class="selector-class">.adm-nav-bar-title</span> &#123;</span><br><span class="line">                <span class="attribute">height</span>: <span class="number">36px</span>;</span><br><span class="line">                <span class="attribute">padding-left</span>: <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="selector-class">.adm-nav-bar-left</span>,</span><br><span class="line">            <span class="selector-class">.adm-nav-bar-right</span> &#123;</span><br><span class="line">                <span class="attribute">flex</span>: unset;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="selector-class">.adm-nav-bar-right</span> &#123;</span><br><span class="line">                <span class="attribute">font-size</span>: <span class="number">16px</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="selector-class">.adm-search</span> &#123;</span><br><span class="line">                <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">                --<span class="attribute">border-radius</span>: <span class="number">18px</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="selector-class">.adm-search-input-box</span> &#123;</span><br><span class="line">                <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">                <span class="attribute">border</span>: none;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="selector-class">.history</span> &#123;</span><br><span class="line">            <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">16px</span>;</span><br><span class="line">            <span class="selector-class">.history-header</span> &#123;</span><br><span class="line">                <span class="attribute">display</span>: flex;</span><br><span class="line">                <span class="attribute">justify-content</span>: space-between;</span><br><span class="line">                <span class="attribute">padding-top</span>: <span class="number">16px</span>;</span><br><span class="line">                <span class="attribute">padding-bottom</span>: <span class="number">19px</span>;</span><br><span class="line">                <span class="attribute">color</span>: <span class="number">#a5a6ab</span>;</span><br><span class="line"></span><br><span class="line">                <span class="selector-class">.icon</span> &#123;</span><br><span class="line">                    <span class="attribute">font-size</span>: <span class="number">16px</span>;</span><br><span class="line">                    <span class="attribute">margin-right</span>: <span class="number">6px</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="selector-class">.history-list</span> &#123;</span><br><span class="line">                <span class="attribute">color</span>: <span class="number">#333333</span>;</span><br><span class="line"></span><br><span class="line">                <span class="selector-class">.history-item</span> &#123;</span><br><span class="line">                    <span class="attribute">display</span>: flex;</span><br><span class="line">                    <span class="attribute">align-items</span>: center;</span><br><span class="line">                    <span class="attribute">position</span>: relative;</span><br><span class="line">                    <span class="attribute">padding</span>: <span class="number">12px</span> <span class="number">0</span>;</span><br><span class="line">                    <span class="attribute">font-size</span>: <span class="number">13px</span>;</span><br><span class="line">                    <span class="keyword">@include</span> hairline(bottom, <span class="number">#f0f0f0</span>);</span><br><span class="line"></span><br><span class="line">                    <span class="selector-tag">span</span> &#123;</span><br><span class="line">                        <span class="attribute">flex</span>: <span class="number">1</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="selector-class">.icon</span> &#123;</span><br><span class="line">                        <span class="attribute">color</span>: <span class="number">#999</span>;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    &amp;<span class="selector-pseudo">:first</span>-child &#123;</span><br><span class="line">                        <span class="attribute">padding-top</span>: <span class="number">0</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="selector-class">.divider</span> &#123;</span><br><span class="line">                    <span class="attribute">display</span>: inline-block;</span><br><span class="line">                    <span class="attribute">height</span>: <span class="number">16px</span>;</span><br><span class="line">                    <span class="attribute">width</span>: <span class="number">1px</span>;</span><br><span class="line">                    <span class="attribute">margin</span>: <span class="number">0</span> <span class="number">16px</span>;</span><br><span class="line">                    <span class="attribute">vertical-align</span>: middle;</span><br><span class="line">                    <span class="attribute">background-color</span>: <span class="number">#bfc2cb</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="selector-class">.search-result</span> &#123;</span><br><span class="line">            <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">20px</span>;</span><br><span class="line">            <span class="attribute">display</span>: none;</span><br><span class="line"></span><br><span class="line">            <span class="selector-class">.result-item</span> &#123;</span><br><span class="line">                <span class="attribute">position</span>: relative;</span><br><span class="line">                <span class="attribute">display</span>: flex;</span><br><span class="line">                <span class="attribute">align-items</span>: center;</span><br><span class="line">                <span class="attribute">height</span>: <span class="number">44px</span>;</span><br><span class="line">                <span class="attribute">padding</span>: <span class="number">10px</span> <span class="number">0</span>;</span><br><span class="line">                <span class="attribute">font-size</span>: <span class="number">14px</span>;</span><br><span class="line">                <span class="keyword">@include</span> hairline(bottom, <span class="number">#f0f0f0</span>);</span><br><span class="line"></span><br><span class="line">                <span class="selector-class">.icon</span> &#123;</span><br><span class="line">                    <span class="attribute">margin-right</span>: <span class="number">4px</span>;</span><br><span class="line">                    <span class="attribute">font-size</span>: <span class="number">12px</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="selector-class">.result-value</span> &#123;</span><br><span class="line">                    <span class="attribute">flex</span>: <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">                    <span class="selector-tag">span</span> &#123;</span><br><span class="line">                        <span class="attribute">color</span>: red;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="selector-class">.search-result</span><span class="selector-class">.show</span> &#123;</span><br><span class="line">            <span class="attribute">display</span>: block;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="selector-class">.text-overflow</span> &#123;</span><br><span class="line">            <span class="attribute">word-break</span>: break-all;</span><br><span class="line">            <span class="attribute">display</span>: -webkit-box;</span><br><span class="line">            <span class="attribute">overflow</span>: hidden;</span><br><span class="line">            <span class="attribute">text-overflow</span>: ellipsis;</span><br><span class="line">            -webkit-line-clamp: <span class="number">1</span>;</span><br><span class="line">            -webkit-box-orient: vertical;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="步骤-10"><a href="#步骤-10" class="headerlink" title="步骤"></a>步骤</h4><ol>
<li><code>Home/index.tsx</code>，为首页 Tab 栏右边的 ”放大镜“ 按钮添加点击事件，点击后跳转到搜索页。</li>
</ol>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Icon <span class="keyword">type</span>=<span class="string">&#x27;iconbtn_search&#x27;</span> onClick=&#123;<span class="function">() =&gt;</span> history.push(<span class="string">&#x27;/search&#x27;</span>)&#125; /&gt;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><code>App.jsx</code>，把 Search 模板粘贴到 pages 目录并配置路由。</li>
</ol>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Route path=<span class="string">&#x27;/search&#x27;</span> component=&#123;Search&#125; /&gt;</span><br></pre></td></tr></table></figure>

<h3 id="防抖处理"><a href="#防抖处理" class="headerlink" title="防抖处理"></a>防抖处理</h3><h4 id="目标-18"><a href="#目标-18" class="headerlink" title="目标"></a>目标</h4><p>收集数据并防抖。</p>
<h4 id="步骤-11"><a href="#步骤-11" class="headerlink" title="步骤"></a>步骤</h4><p><code>pages/Search/index.tsx</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState, useRef, useEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> classnames <span class="keyword">from</span> <span class="string">&#x27;classnames&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useHistory &#125; <span class="keyword">from</span> <span class="string">&#x27;react-router&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; NavBar, Search &#125; <span class="keyword">from</span> <span class="string">&#x27;antd-mobile&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Icon <span class="keyword">from</span> <span class="string">&#x27;@/components/Icon&#x27;</span></span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&#x27;./index.module.scss&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> SearchPage = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> timerRef = useRef(-<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">const</span> history = useHistory()</span><br><span class="line">    <span class="comment">// #1</span></span><br><span class="line">    <span class="keyword">const</span> [keyword, setKeyword] = useState(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="comment">// #2</span></span><br><span class="line">    <span class="keyword">const</span> handleChange = <span class="function">(<span class="params">v: <span class="built_in">string</span></span>) =&gt;</span> &#123;</span><br><span class="line">        setKeyword(v)</span><br><span class="line">        <span class="comment">// #3</span></span><br><span class="line">        <span class="built_in">clearTimeout</span>(timerRef.current)</span><br><span class="line">        <span class="comment">// #4</span></span><br><span class="line">        timerRef.current = <span class="built_in">window</span>.setTimeout(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// 防抖</span></span><br><span class="line">            <span class="built_in">console</span>.log(v)</span><br><span class="line">        &#125;, <span class="number">500</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// #5</span></span><br><span class="line">    useEffect(<span class="function">() =&gt;</span> <span class="function">() =&gt;</span> <span class="built_in">clearTimeout</span>(timerRef.current), [])</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;styles.root&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">NavBar</span> <span class="attr">className</span>=<span class="string">&#x27;navbar&#x27;</span> <span class="attr">onBack</span>=<span class="string">&#123;()</span> =&gt;</span> history.go(-1)&#125; right=&#123;<span class="tag">&lt;<span class="name">span</span> <span class="attr">className</span>=<span class="string">&#x27;search-text&#x27;</span>&gt;</span>搜索<span class="tag">&lt;/<span class="name">span</span>&gt;</span>&#125;&gt;</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Search</span> <span class="attr">placeholder</span>=<span class="string">&#x27;请输入关键字搜索&#x27;</span> <span class="attr">value</span>=<span class="string">&#123;keyword&#125;</span> <span class="attr">onChange</span>=<span class="string">&#123;handleChange&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">NavBar</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">            &#123;true &amp;&amp; (</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">div</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                    <span class="attr">className</span>=<span class="string">&#x27;history&#x27;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                    <span class="attr">style</span>=<span class="string">&#123;&#123;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                        <span class="attr">display:</span> <span class="attr">true</span> ? &#x27;<span class="attr">none</span>&#x27; <span class="attr">:</span> &#x27;<span class="attr">block</span>&#x27;,</span></span></span><br><span class="line"><span class="tag"><span class="xml">                    &#125;&#125;</span></span></span><br><span class="line"><span class="tag"><span class="xml">                &gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;history-header&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">span</span>&gt;</span>搜索历史<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">                            <span class="tag">&lt;<span class="name">Icon</span> <span class="attr">type</span>=<span class="string">&#x27;iconbtn_del&#x27;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                            清除全部</span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;history-list&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">span</span> <span class="attr">className</span>=<span class="string">&#x27;history-item&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                            <span class="tag">&lt;<span class="name">span</span> <span class="attr">className</span>=<span class="string">&#x27;text-overflow&#x27;</span>&gt;</span>黑马程序员<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">                            <span class="tag">&lt;<span class="name">Icon</span> <span class="attr">type</span>=<span class="string">&#x27;iconbtn_essay_close&#x27;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            )&#125;</span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;classnames(</span>&#x27;<span class="attr">search-result</span>&#x27;, <span class="attr">true</span> ? &#x27;<span class="attr">show</span>&#x27; <span class="attr">:</span> &#x27;&#x27;)&#125;&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;result-item&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">Icon</span> <span class="attr">className</span>=<span class="string">&#x27;icon-search&#x27;</span> <span class="attr">type</span>=<span class="string">&#x27;iconbtn_search&#x27;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;result-value text-overflow&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">span</span>&gt;</span>黑马<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        程序员</span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> SearchPage</span><br></pre></td></tr></table></figure>

<h3 id="aHooks"><a href="#aHooks" class="headerlink" title="aHooks"></a>aHooks</h3><h4 id="步骤-12"><a href="#步骤-12" class="headerlink" title="步骤"></a>步骤</h4><ol>
<li><p>安装 ahooks 包：<code>yarn add ahooks</code>。</p>
</li>
<li><p>导入 <code>useDebounceFn</code> hook。</p>
</li>
<li><p>创建防抖函数。</p>
</li>
<li><p>搜索框中输入内容时，调用防抖函数。</p>
</li>
</ol>
<h4 id="代码-13"><a href="#代码-13" class="headerlink" title="代码"></a>代码</h4><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useDebounceFn &#125; <span class="keyword">from</span> <span class="string">&#x27;ahooks&#x27;</span></span><br><span class="line"><span class="keyword">const</span> SearchPage = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> history = useHistory()</span><br><span class="line">    <span class="keyword">const</span> [keyword, setKeyword] = useState(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="keyword">const</span> &#123; <span class="attr">run</span>: getSuggest &#125; = useDebounceFn(</span><br><span class="line">        <span class="function"><span class="keyword">function</span> (<span class="params">v</span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(v)</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">wait</span>: <span class="number">500</span>,</span><br><span class="line">        &#125;</span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">const</span> handleChange = <span class="function">(<span class="params">v: <span class="built_in">string</span></span>) =&gt;</span> &#123;</span><br><span class="line">        setKeyword(v)</span><br><span class="line">        getSuggest(v)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="获取数据"><a href="#获取数据" class="headerlink" title="获取数据"></a>获取数据</h3><h4 id="目标-19"><a href="#目标-19" class="headerlink" title="目标"></a>目标</h4><p>将输入的关键发送到服务端，获取和该关键字匹配的建议数据。</p>
<h4 id="代码-14"><a href="#代码-14" class="headerlink" title="代码"></a>代码</h4><p>通过 Redux Action 来发送请求，获取结果数据后保存在 Redux Store 中。</p>
<p><code>types/data.d.ts</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> Suggestion = <span class="built_in">string</span>[]</span><br></pre></td></tr></table></figure>

<p><code>types/store.d.ts</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> SearchAction = &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;search/suggestion&#x27;</span></span><br><span class="line">    <span class="attr">payload</span>: Suggestion</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> RootAction = LoginAction | ProfileAction | HomeAction | SearchAction</span><br></pre></td></tr></table></figure>

<p><code>actions/search.ts</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ApiResponse, Suggestion &#125; <span class="keyword">from</span> <span class="string">&#x27;@/types/data&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; RootThunkAction &#125; <span class="keyword">from</span> <span class="string">&#x27;@/types/store&#x27;</span></span><br><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getSuggestion = (value: <span class="built_in">string</span>): <span class="function"><span class="params">RootThunkAction</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">async</span> (dispatch) =&gt; &#123;</span><br><span class="line">        <span class="keyword">const</span> res = <span class="keyword">await</span> request.get&lt;ApiResponse&lt;&#123; <span class="attr">options</span>: Suggestion &#125;&gt;&gt;(<span class="string">&#x27;/suggestion&#x27;</span>, &#123;</span><br><span class="line">            <span class="attr">params</span>: &#123;</span><br><span class="line">                <span class="attr">q</span>: value,</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="comment">// res.data.data.options =&gt; 可能是 [null]</span></span><br><span class="line">        dispatch(&#123; <span class="attr">type</span>: <span class="string">&#x27;search/suggestion&#x27;</span>, <span class="attr">payload</span>: res.data.data.options.filter(<span class="function">(<span class="params">item</span>) =&gt;</span> item !== <span class="literal">null</span>) &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>reducers/search.ts</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Suggestion &#125; <span class="keyword">from</span> <span class="string">&#x27;@/types/data&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; SearchAction &#125; <span class="keyword">from</span> <span class="string">&#x27;@/types/store&#x27;</span></span><br><span class="line"><span class="keyword">type</span> SearchState = &#123;</span><br><span class="line">    <span class="attr">suggestion</span>: Suggestion</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> initState: SearchState = &#123;</span><br><span class="line">    <span class="attr">suggestion</span>: [],</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">search</span>(<span class="params">state = initState, action: SearchAction</span>): <span class="title">SearchState</span> </span>&#123;</span><br><span class="line">    <span class="keyword">switch</span> (action.type) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;search/suggestion&#x27;</span>:</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                ...state,</span><br><span class="line">                <span class="attr">suggestion</span>: action.payload,</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="attr">default</span>:</span><br><span class="line">            <span class="keyword">return</span> state</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>reducers/index.ts</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; combineReducers &#125; <span class="keyword">from</span> <span class="string">&#x27;redux&#x27;</span></span><br><span class="line"><span class="keyword">import</span> login <span class="keyword">from</span> <span class="string">&#x27;./login&#x27;</span></span><br><span class="line"><span class="keyword">import</span> profile <span class="keyword">from</span> <span class="string">&#x27;./profile&#x27;</span></span><br><span class="line"><span class="keyword">import</span> home <span class="keyword">from</span> <span class="string">&#x27;./home&#x27;</span></span><br><span class="line"><span class="keyword">import</span> search <span class="keyword">from</span> <span class="string">&#x27;./search&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> combineReducers(&#123; login, profile, home, search &#125;)</span><br></pre></td></tr></table></figure>

<p><code>Search/index.tsx</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; <span class="attr">run</span>: getSuggest &#125; = useDebounceFn(</span><br><span class="line">    <span class="function"><span class="keyword">function</span> (<span class="params">v</span>) </span>&#123;</span><br><span class="line">        dispatch(getSuggestion(v))</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">wait</span>: <span class="number">500</span>,</span><br><span class="line">    &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h3 id="渲染数据-1"><a href="#渲染数据-1" class="headerlink" title="渲染数据"></a>渲染数据</h3><p><code>pages/Search/index.tsx</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; suggestion &#125; = useSelector(<span class="function">(<span class="params">state: RootState</span>) =&gt;</span> state.search)</span><br><span class="line"></span><br><span class="line">&lt;div className=&#123;classnames(<span class="string">&#x27;search-result&#x27;</span>, <span class="literal">true</span> ? <span class="string">&#x27;show&#x27;</span> : <span class="string">&#x27;&#x27;</span>)&#125;&gt;</span><br><span class="line">    &#123;suggestion.map(<span class="function">(<span class="params">item, index</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;result-item&#x27;</span> <span class="attr">key</span>=<span class="string">&#123;index&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Icon</span> <span class="attr">className</span>=<span class="string">&#x27;icon-search&#x27;</span> <span class="attr">type</span>=<span class="string">&#x27;iconbtn_search&#x27;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;result-value text-overflow&#x27;</span>&gt;</span>&#123;item&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">        )</span><br><span class="line">    &#125;)&#125;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<h3 id="高亮处理"><a href="#高亮处理" class="headerlink" title="高亮处理"></a>高亮处理</h3><ul>
<li>  基本操作。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> keyword = <span class="string">&#x27;a&#x27;</span></span><br><span class="line"><span class="keyword">let</span> str = <span class="string">&#x27;abcabc&#x27;</span></span><br><span class="line">str = str.replace(<span class="keyword">new</span> <span class="built_in">RegExp</span>(keyword, <span class="string">&#x27;gi&#x27;</span>), <span class="function">(<span class="params">match</span>) =&gt;</span> <span class="string">`&lt;span&gt;<span class="subst">$&#123;match&#125;</span>&lt;/span&gt;`</span>)</span><br><span class="line"><span class="built_in">console</span>.log(str)</span><br></pre></td></tr></table></figure>

<ul>
<li>  项目中使用，<a target="_blank" rel="noopener" href="https://zh-hans.reactjs.org/docs/dom-elements.html">参考文档</a>。</li>
</ul>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> highLight = <span class="function">(<span class="params">str: <span class="built_in">string</span></span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> str.replace(<span class="keyword">new</span> <span class="built_in">RegExp</span>(keyword, <span class="string">&#x27;gi&#x27;</span>), <span class="function">(<span class="params">match</span>) =&gt;</span> <span class="string">`&lt;span&gt;<span class="subst">$&#123;match&#125;</span>&lt;/span&gt;`</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;div</span><br><span class="line">    className=<span class="string">&#x27;result-value text-overflow&#x27;</span></span><br><span class="line">    dangerouslySetInnerHTML=&#123;&#123;</span><br><span class="line">        <span class="attr">__html</span>: highLight(item),</span><br><span class="line">    &#125;&#125;</span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure>

<p><font color=909090>🧐 扩展。</font></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> searchText = <span class="string">&#x27;c+&#x27;</span> <span class="comment">// 用户输入的内容</span></span><br><span class="line"><span class="keyword">let</span> regStr = searchText.replace(<span class="regexp">/([+?|*])/g</span>, <span class="string">&#x27;\\$1&#x27;</span>) <span class="comment">// $1 代表第一个分组</span></span><br><span class="line"><span class="keyword">let</span> text = <span class="string">&#x27;c++真好&#x27;</span> <span class="comment">// 后端返回的内容</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 需求：&lt;span class=&quot;active&quot;&gt;c+&lt;/span&gt;+真好</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> reg = <span class="keyword">new</span> <span class="built_in">RegExp</span>(regStr, <span class="string">&#x27;gi&#x27;</span>) <span class="comment">// 上面的 searchText 经过这里一处理，出事了，+ 是元字符，而不是 + 号本身</span></span><br><span class="line"><span class="keyword">const</span> result = text.replace(reg, <span class="string">`&lt;span class=&quot;active&quot;&gt;<span class="subst">$&#123;searchText&#125;</span>&lt;/span&gt;`</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(result) <span class="comment">// &lt;span class=&quot;active&quot;&gt;c+&lt;/span&gt;+真好</span></span><br></pre></td></tr></table></figure>

<h3 id="按需展示历史记录和联想建议"><a href="#按需展示历史记录和联想建议" class="headerlink" title="按需展示历史记录和联想建议"></a>按需展示历史记录和联想建议</h3><h4 id="目标-20"><a href="#目标-20" class="headerlink" title="目标"></a>目标</h4><p>实现在做搜索操作时只显示搜索建议列表；其他情况只显示搜索历史。</p>
<img src="/resource/images/image-20210908185453822.png" alt="image-20210908185453822" style="zoom:40%;" />

<p>实现思路：利用之前创建的 <code>isSearching</code> 状态，控制建议列表和搜索历史的显示、隐藏。</p>
<h4 id="步骤-13"><a href="#步骤-13" class="headerlink" title="步骤"></a>步骤</h4><ul>
<li>  提供 isSearching 状态控制联想建议的显示/隐藏。</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 是否显示搜索</span></span><br><span class="line"><span class="keyword">const</span> [isSearching, setIsSearching] = useState(<span class="literal">false</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li>  修改 isSearching 状态。</li>
</ul>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> handleChange = <span class="function">(<span class="params">v: <span class="built_in">string</span></span>) =&gt;</span> &#123;</span><br><span class="line">    setKeyword(e)</span><br><span class="line">    <span class="comment">// 有内容，发送请求并把搜索状态设置为 true</span></span><br><span class="line">    <span class="keyword">if</span> (v) &#123;</span><br><span class="line">        getSuggest(v)</span><br><span class="line">        setIsSearching(<span class="literal">true</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        setIsSearching(<span class="literal">false</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>  根据 isSearching 状态控制显示和隐藏。</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="comment">/* 历史记录 */</span></span><br><span class="line">&#125;</span><br><span class="line">;<span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;history&#x27;</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">display:</span> <span class="attr">isSearching</span> ? &#x27;<span class="attr">none</span>&#x27; <span class="attr">:</span> &#x27;<span class="attr">block</span>&#x27; &#125;&#125; /&gt;</span></span></span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/* 联想建议 */</span></span><br><span class="line">&#125;</span><br><span class="line">;<span class="xml"><span class="tag">&lt;<span class="name">div</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">    <span class="attr">className</span>=<span class="string">&#123;classnames(</span>&#x27;<span class="attr">search-result</span>&#x27;, &#123;</span></span></span><br><span class="line"><span class="tag"><span class="xml">        <span class="attr">show:</span> <span class="attr">isSearching</span>,</span></span></span><br><span class="line"><span class="tag"><span class="xml">    &#125;)&#125;</span></span></span><br><span class="line"><span class="tag"><span class="xml">/&gt;</span></span></span><br></pre></td></tr></table></figure>

<h3 id="内容为空时也清除联想建议"><a href="#内容为空时也清除联想建议" class="headerlink" title="内容为空时也清除联想建议"></a>内容为空时也清除联想建议</h3><p><code>types/store.d.ts</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> SearchAction =</span><br><span class="line">    | &#123;</span><br><span class="line">          <span class="attr">type</span>: <span class="string">&#x27;search/suggestion&#x27;</span></span><br><span class="line">          <span class="attr">payload</span>: Suggestion</span><br><span class="line">      &#125;</span><br><span class="line">    | &#123;</span><br><span class="line">          <span class="attr">type</span>: <span class="string">&#x27;search/clearSuggestion&#x27;</span></span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure>

<p><code>actions/search.ts</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">clearSuggestion</span>(<span class="params"></span>): <span class="title">SearchAction</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;search/clearSuggestion&#x27;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>reducers/search.ts</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Suggestion &#125; <span class="keyword">from</span> <span class="string">&#x27;@/types/data&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; SearchAction &#125; <span class="keyword">from</span> <span class="string">&#x27;@/types/store&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> SearchState = &#123;</span><br><span class="line">    <span class="attr">suggestion</span>: Suggestion</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> initState: SearchState = &#123;</span><br><span class="line">    <span class="attr">suggestion</span>: [],</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">search</span>(<span class="params">state = initState, action: SearchAction</span>): <span class="title">SearchState</span> </span>&#123;</span><br><span class="line">    <span class="keyword">switch</span> (action.type) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;search/suggestion&#x27;</span>:</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                ...state,</span><br><span class="line">                <span class="attr">suggestion</span>: action.payload,</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;search/clearSuggestion&#x27;</span>:</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                ...state,</span><br><span class="line">                <span class="attr">suggestion</span>: [],</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="attr">default</span>:</span><br><span class="line">            <span class="keyword">return</span> state</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>pages/Search/index.tsx</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> handleChange = <span class="function">(<span class="params">v: <span class="built_in">string</span></span>) =&gt;</span> &#123;</span><br><span class="line">    setKeyword(v)</span><br><span class="line">    <span class="keyword">if</span> (v) &#123;</span><br><span class="line">        getSuggest(v)</span><br><span class="line">        setIsSearching(<span class="literal">true</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        setIsSearching(<span class="literal">false</span>)</span><br><span class="line">        <span class="comment">// !清空联想建议的内容</span></span><br><span class="line">        dispatch(clearSuggestion())</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="一个-Bug"><a href="#一个-Bug" class="headerlink" title="一个 Bug"></a>一个 Bug</h3><p>wait: 2000，快速输入 a =&gt; 清除 =&gt; 输入 b，只会以最终的 b 作为参数发起一次请求。</p>
<p>wait: 100，快速输入 a =&gt; 清除 =&gt; 输入 b，一般时间间隔都会大于 100ms，所以发起了 2 次请求，但请求结果到达的顺序没有保证，并不一定先发请求，结果就一定先到达，所以往 redux 存储内容的顺序也就没有保证。</p>
<p>解决方式，请求之前关闭掉上一次正在发送的请求。</p>
<ol>
<li>创建 cancel 函数并导出，<code>store/actions/search.ts</code>。</li>
</ol>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// #1</span></span><br><span class="line"><span class="keyword">const</span> &#123; CancelToken &#125; = axios</span><br><span class="line"><span class="comment">// #3</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">let</span> cancel: Canceler | <span class="literal">null</span> = <span class="literal">null</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getSuggestion = (value: <span class="built_in">string</span>): <span class="function"><span class="params">RootThunkAction</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">async</span> (dispatch) =&gt; &#123;</span><br><span class="line">        <span class="keyword">const</span> res = <span class="keyword">await</span> request.get&lt;IResponse&lt;&#123; <span class="attr">options</span>: <span class="built_in">string</span>[] &#125;&gt;&gt;(<span class="string">&#x27;/suggestion&#x27;</span>, &#123;</span><br><span class="line">            <span class="attr">params</span>: &#123;</span><br><span class="line">                <span class="attr">q</span>: value,</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">// #2</span></span><br><span class="line">            <span class="attr">cancelToken</span>: <span class="keyword">new</span> CancelToken(<span class="function">(<span class="params">c</span>) =&gt;</span> &#123;</span><br><span class="line">                cancel = c</span><br><span class="line">            &#125;),</span><br><span class="line">        &#125;)</span><br><span class="line">        dispatch(&#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;SEARCH_SUGGESTION_SAVE&#x27;</span>,</span><br><span class="line">            <span class="attr">payload</span>: res.data.data.options.filter(<span class="function">(<span class="params">item</span>) =&gt;</span> item), <span class="comment">// 联想建议</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>调用 cancel 函数，<code>pages/Search/index.tsx</code>。</li>
</ol>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; <span class="attr">run</span>: getSuggest &#125; = useDebounceFn(</span><br><span class="line">    <span class="function"><span class="keyword">function</span> (<span class="params">v</span>) </span>&#123;</span><br><span class="line">        cancel &amp;&amp; cancel()</span><br><span class="line">        dispatch(getSuggestion(v))</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">wait</span>: <span class="number">100</span>,</span><br><span class="line">    &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>关闭请求统一错误处理，<code>utils/request.ts</code>。</li>
</ol>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">request.interceptors.response.use(</span><br><span class="line">    <span class="function"><span class="keyword">function</span> (<span class="params">response</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> response</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> (<span class="params">error: AxiosError&lt;&#123; message: <span class="built_in">string</span> &#125;&gt;</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// axios.isCancel(error)</span></span><br><span class="line">        <span class="keyword">if</span> (error.name === <span class="string">&#x27;CanceledError&#x27;</span>) &#123;</span><br><span class="line">            Toast.show(error.message)</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>如何关闭任何一个请求？</li>
</ol>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">let</span> cancel: Canceler | <span class="literal">null</span> = <span class="literal">null</span></span><br><span class="line">request.interceptors.request.use(</span><br><span class="line">    <span class="function"><span class="keyword">function</span> (<span class="params">config</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// #2</span></span><br><span class="line">        config.cancelToken = <span class="keyword">new</span> axios.CancelToken(<span class="function">(<span class="params">c</span>) =&gt;</span> (cancel = c))</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">        <span class="keyword">return</span> config</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error)</span><br><span class="line">    &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h2 id="搜索历史记录"><a href="#搜索历史记录" class="headerlink" title="搜索历史记录"></a>搜索历史记录</h2><h3 id="添加历史记录"><a href="#添加历史记录" class="headerlink" title="添加历史记录"></a>添加历史记录</h3><h4 id="目标-21"><a href="#目标-21" class="headerlink" title="目标"></a>目标</h4><p>点击顶部 ”搜索“ 按钮，或点击搜索建议列表中的一项，跳转到搜索详情页。</p>
<img src="/resource/images/image-20210909103450023.png" alt="image-20210909103450023" style="zoom:40%;" />

<h4 id="步骤-14"><a href="#步骤-14" class="headerlink" title="步骤"></a>步骤</h4><p><code>types/data.d.ts</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> Histories = <span class="built_in">string</span>[]</span><br></pre></td></tr></table></figure>

<p><code>types/store.d.ts</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> SearchAction =</span><br><span class="line">    | &#123;</span><br><span class="line">          <span class="attr">type</span>: <span class="string">&#x27;search/suggestion&#x27;</span></span><br><span class="line">          <span class="attr">payload</span>: Suggestion</span><br><span class="line">      &#125;</span><br><span class="line">    | &#123;</span><br><span class="line">          <span class="attr">type</span>: <span class="string">&#x27;search/clearSuggestion&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">    | &#123;</span><br><span class="line">          <span class="attr">type</span>: <span class="string">&#x27;search/saveHistories&#x27;</span></span><br><span class="line">          <span class="attr">payload</span>: <span class="built_in">string</span></span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure>

<p><code>actions/search.ts</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">addSearchList</span>(<span class="params">keyword: <span class="built_in">string</span></span>): <span class="title">SearchAction</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;search/saveHistories&#x27;</span>,</span><br><span class="line">        <span class="attr">payload</span>: keyword,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>reducers/search.ts</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Histories, Suggestion &#125; <span class="keyword">from</span> <span class="string">&#x27;@/types/data&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; SearchAction &#125; <span class="keyword">from</span> <span class="string">&#x27;@/types/store&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> SearchState = &#123;</span><br><span class="line">    <span class="attr">suggestion</span>: Suggestion</span><br><span class="line">    <span class="attr">histories</span>: Histories</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> initState: SearchState = &#123;</span><br><span class="line">    <span class="attr">suggestion</span>: [],</span><br><span class="line">    <span class="attr">histories</span>: [],</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">search</span>(<span class="params">state = initState, action: SearchAction</span>): <span class="title">SearchState</span> </span>&#123;</span><br><span class="line">    <span class="keyword">switch</span> (action.type) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;search/suggestion&#x27;</span>:</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                ...state,</span><br><span class="line">                <span class="attr">suggestion</span>: action.payload,</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;search/clearSuggestion&#x27;</span>:</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                ...state,</span><br><span class="line">                <span class="attr">suggestion</span>: [],</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;search/saveHistories&#x27;</span>: &#123;</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                ...state,</span><br><span class="line">                <span class="attr">histories</span>: [action.payload, ...state.histories],</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="attr">default</span>:</span><br><span class="line">            <span class="keyword">return</span> state</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>pages/Search/index.tsx</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 给搜索按钮和联想建议绑定 onSearch 事件</span></span><br><span class="line"><span class="keyword">const</span> onSearch = <span class="function">(<span class="params">key: <span class="built_in">string</span></span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!key) <span class="keyword">return</span></span><br><span class="line">    dispatch(addSearchList(key))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">NavBar</span></span></span><br><span class="line"><span class="tag">    <span class="attr">className</span>=<span class="string">&#x27;navbar&#x27;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">onBack</span>=<span class="string">&#123;()</span> =&gt;</span> history.go(-1)&#125;</span><br><span class="line">    right=&#123;</span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">className</span>=<span class="string">&#x27;search-text&#x27;</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> onSearch(keyword)&#125;&gt;</span><br><span class="line">        搜索</span><br><span class="line">        <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    &#125;</span><br><span class="line">&gt;</span><br><span class="line">    <span class="tag">&lt;<span class="name">Search</span></span></span><br><span class="line"><span class="tag">        <span class="attr">placeholder</span>=<span class="string">&#x27;请输入关键字搜索&#x27;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">value</span>=<span class="string">&#123;keyword&#125;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">onChange</span>=<span class="string">&#123;handleChange&#125;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">onSearch</span>=<span class="string">&#123;onSearch&#125;</span></span></span><br><span class="line"><span class="tag">    /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">NavBar</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span></span></span><br><span class="line"><span class="tag">    <span class="attr">className</span>=<span class="string">&#x27;result-value text-overflow&#x27;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">dangerouslySetInnerHTML</span>=<span class="string">&#123;&#123;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">__html:</span> <span class="attr">highLight</span>(<span class="attr">item</span>),</span></span><br><span class="line"><span class="tag">    &#125;&#125;</span></span><br><span class="line"><span class="tag">    <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> onSearch(item)&#125;</span><br><span class="line">&gt;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="去重前置功能"><a href="#去重前置功能" class="headerlink" title="去重前置功能"></a>去重前置功能</h3><p><code>types/store.d.ts</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> SearchAction =</span><br><span class="line">    | &#123;</span><br><span class="line">          <span class="attr">type</span>: <span class="string">&#x27;search/suggestion&#x27;</span></span><br><span class="line">          <span class="attr">payload</span>: Suggestion</span><br><span class="line">      &#125;</span><br><span class="line">    | &#123;</span><br><span class="line">          <span class="attr">type</span>: <span class="string">&#x27;search/clearSuggestion&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">    | &#123;</span><br><span class="line">          <span class="comment">// 上面的处理方式：action 接受一个 keyword，然后再交割 reduce 中进行处理（添加）</span></span><br><span class="line">          <span class="comment">// 现在的处理方式：action 接受一个 keyword，把处理好的 payload 直接交给 reduce</span></span><br><span class="line">          <span class="attr">type</span>: <span class="string">&#x27;search/saveHistories&#x27;</span></span><br><span class="line">          <span class="attr">payload</span>: <span class="built_in">string</span>[]</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure>

<p><code>reducers/search.ts</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="string">&#x27;search/saveHistories&#x27;</span>: &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        ...state,</span><br><span class="line">        <span class="comment">// histories: [action.payload, ...state.histories],</span></span><br><span class="line">        <span class="attr">histories</span>: action.payload,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>actions/search.ts</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">addSearchList</span>(<span class="params">keyword: <span class="built_in">string</span></span>): <span class="title">RootThunkAction</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function">(<span class="params">dispatch, getState</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> &#123; histories &#125; = getState().search</span><br><span class="line">        <span class="comment">// #1 先干掉</span></span><br><span class="line">        histories = histories.filter(<span class="function">(<span class="params">item</span>) =&gt;</span> item !== keyword)</span><br><span class="line">        <span class="keyword">if</span> (histories.length &gt;= <span class="number">10</span>) &#123;</span><br><span class="line">            histories.pop()</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// #2 再添加</span></span><br><span class="line">        histories.unshift(keyword)</span><br><span class="line">        dispatch(&#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;search/saveHistories&#x27;</span>,</span><br><span class="line">            <span class="attr">payload</span>: histories,</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="渲染删除清空"><a href="#渲染删除清空" class="headerlink" title="渲染删除清空"></a>渲染删除清空</h3><img src="/resource/images/image-20210909102100740.png" alt="image-20210909102100740" style="zoom:40%;" />

<p><code>actions/search.ts</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">removeSearchList</span>(<span class="params">keyword: <span class="built_in">string</span></span>): <span class="title">RootThunkAction</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function">(<span class="params">dispatch, getState</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> &#123; histories &#125; = getState().search</span><br><span class="line">        <span class="comment">// 判断 keyword 在 hisrories 中是否存在，如果存在，删除</span></span><br><span class="line">        histories = histories.filter(<span class="function">(<span class="params">item</span>) =&gt;</span> item !== keyword)</span><br><span class="line">        dispatch(&#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;search/saveHistories&#x27;</span>,</span><br><span class="line">            <span class="attr">payload</span>: histories,</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">clearHistory</span>(<span class="params"></span>): <span class="title">SearchAction</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 两种思路：一种是保存一个空，一种是单独准备一个 search/clearHistories 进行情况的操作</span></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;search/saveHistories&#x27;</span>,</span><br><span class="line">        <span class="attr">payload</span>: [],</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>pages/Search/index.tsx</code>，渲染、删除。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;div className=<span class="string">&#x27;history-list&#x27;</span>&gt;</span><br><span class="line">    <span class="comment">// 渲染</span></span><br><span class="line">    &#123;histories.map(<span class="function">(<span class="params">item, index</span>) =&gt;</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">span</span> <span class="attr">className</span>=<span class="string">&#x27;history-item&#x27;</span> <span class="attr">key</span>=<span class="string">&#123;index&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">span</span> <span class="attr">className</span>=<span class="string">&#x27;text-overflow&#x27;</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> onSearch(item)&#125;&gt;</span></span><br><span class="line"><span class="xml">                &#123;item&#125;</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">            // 删除</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Icon</span> <span class="attr">type</span>=<span class="string">&#x27;iconbtn_essay_close&#x27;</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> dispatch(removeSearchList(item))&#125; /&gt;</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line">    ))&#125;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<p>清空。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> onClearHistory = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    Dialog.confirm(&#123;</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&#x27;温馨提示&#x27;</span>,</span><br><span class="line">        <span class="attr">content</span>: <span class="string">&#x27;你确定要清空记录吗？&#x27;</span>,</span><br><span class="line">        <span class="attr">onConfirm</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            dispatch(clearHistories())</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;div</span><br><span class="line">    className=<span class="string">&#x27;history&#x27;</span></span><br><span class="line">    style=&#123;&#123;</span><br><span class="line">        <span class="attr">display</span>: isSearching ? <span class="string">&#x27;none&#x27;</span> : <span class="string">&#x27;block&#x27;</span>,</span><br><span class="line">    &#125;&#125;</span><br><span class="line">&gt;</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;history-header&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">span</span>&gt;</span>搜索历史<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">        // 清空</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">onClick</span>=<span class="string">&#123;onClearHistory&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Icon</span> <span class="attr">type</span>=<span class="string">&#x27;iconbtn_del&#x27;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">            清除全部</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<h3 id="历史记录的持久化"><a href="#历史记录的持久化" class="headerlink" title="历史记录的持久化"></a>历史记录的持久化</h3><h4 id="目标-22"><a href="#目标-22" class="headerlink" title="目标"></a>目标</h4><p>将每次输入的搜索关键字记录下来，再动态渲染到界面上，实现思路：</p>
<ul>
<li><p>  在成功搜索后，将关键字存入 Redux 和 LocalStorage 中。</p>
</li>
<li><p>  从 Redux 中获取所有关键字，并渲染到界面。</p>
</li>
</ul>
<h4 id="步骤-15"><a href="#步骤-15" class="headerlink" title="步骤"></a>步骤</h4><ul>
<li>  <code>utils/storage.ts</code></li>
</ul>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> SEARCH_HIS_KEY = <span class="string">&#x27;SEARCH_HIS_KEY&#x27;</span></span><br><span class="line"><span class="comment">// 取</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getLocalHistories = (): <span class="function"><span class="params">Histories</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">JSON</span>.parse(<span class="built_in">localStorage</span>.getItem(SEARCH_HIS_KEY) || <span class="string">&#x27;[]&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 存</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> setLocalHisories = (histories: Histories): <span class="function"><span class="params">void</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">localStorage</span>.setItem(SEARCH_HIS_KEY, <span class="built_in">JSON</span>.stringify(histories))</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 删</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> removeLocalHistories = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">localStorage</span>.removeItem(SEARCH_HIS_KEY)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>  <code>reducers/search.ts</code></li>
</ul>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Histories, Suggestion &#125; <span class="keyword">from</span> <span class="string">&#x27;@/types/data&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; SearchAction &#125; <span class="keyword">from</span> <span class="string">&#x27;@/types/store&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; getLocalHistories, setLocalHisories &#125; <span class="keyword">from</span> <span class="string">&#x27;@/utils/storage&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> SearchState = &#123;</span><br><span class="line">    <span class="attr">suggestion</span>: Suggestion</span><br><span class="line">    <span class="attr">histories</span>: Histories</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> initState: SearchState = &#123;</span><br><span class="line">    <span class="attr">suggestion</span>: [],</span><br><span class="line">    <span class="comment">// #2</span></span><br><span class="line">    <span class="attr">histories</span>: getLocalHistories(),</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">search</span>(<span class="params">state = initState, action: SearchAction</span>): <span class="title">SearchState</span> </span>&#123;</span><br><span class="line">    <span class="keyword">switch</span> (action.type) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;search/suggestion&#x27;</span>:</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                ...state,</span><br><span class="line">                <span class="attr">suggestion</span>: action.payload,</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;search/clearSuggestion&#x27;</span>:</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                ...state,</span><br><span class="line">                <span class="attr">suggestion</span>: [],</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;search/saveHistories&#x27;</span>: &#123;</span><br><span class="line">            <span class="comment">// #1</span></span><br><span class="line">            setLocalHisories(action.payload)</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                ...state,</span><br><span class="line">                <span class="attr">histories</span>: action.payload,</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="attr">default</span>:</span><br><span class="line">            <span class="keyword">return</span> state</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="展示搜索结果"><a href="#展示搜索结果" class="headerlink" title="展示搜索结果"></a>展示搜索结果</h2><h3 id="静态结构和样式"><a href="#静态结构和样式" class="headerlink" title="静态结构和样式"></a>静态结构和样式</h3><h4 id="目标-23"><a href="#目标-23" class="headerlink" title="目标"></a>目标</h4><p>实现搜索结果页的静态结构和样式。</p>
<img src="/resource/images/image-20210909105543672.png" alt="image-20210909105543672" style="zoom:40%;" />

<h4 id="素材-4"><a href="#素材-4" class="headerlink" title="素材"></a>素材</h4><p><code>pages/Search/Result/index.tsx</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useHistory &#125; <span class="keyword">from</span> <span class="string">&#x27;react-router-dom&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; NavBar &#125; <span class="keyword">from</span> <span class="string">&#x27;antd-mobile&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&#x27;./index.module.scss&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Result = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> history = useHistory()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;styles.root&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">NavBar</span> <span class="attr">onBack</span>=<span class="string">&#123;()</span> =&gt;</span> history.go(-1)&#125;&gt;搜索结果<span class="tag">&lt;/<span class="name">NavBar</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;article-list&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;article-item&#x27;</span>&gt;</span>文章列表<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Result</span><br></pre></td></tr></table></figure>

<p><code>pages/Search/Result/index.module.scss</code></p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.root</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">flex-direction</span>: column;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line"></span><br><span class="line">    :global &#123;</span><br><span class="line">        .article-list &#123;</span><br><span class="line">            flex: <span class="number">1</span>;</span><br><span class="line">            <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">16px</span>;</span><br><span class="line">            <span class="attribute">overflow-y</span>: scroll;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="步骤-16"><a href="#步骤-16" class="headerlink" title="步骤"></a>步骤</h4><ol>
<li><p>将资源包中对应的样式文件，拷贝到 <code>pages/Search</code>目录下。</p>
</li>
<li><p>配置路由。</p>
</li>
</ol>
<p><code>App.tsx</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SearchResult <span class="keyword">from</span> <span class="string">&#x27;./pages/Search/Result&#x27;</span></span><br><span class="line"><span class="comment">// 注意这儿要加 exact 啦</span></span><br><span class="line">&lt;Route exact path=<span class="string">&#x27;/search&#x27;</span> component=&#123;Search&#125; /&gt;</span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&#x27;/search/result&#x27;</span> <span class="attr">component</span>=<span class="string">&#123;SearchResult&#125;</span> /&gt;</span></span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>搜索的时候需要跳转。</li>
</ol>
<p><code>pages/Search/index.tsx</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> onSearch = <span class="function">(<span class="params">key: <span class="built_in">string</span></span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!key) <span class="keyword">return</span></span><br><span class="line">    dispatch(addSearchList(key))</span><br><span class="line">    history.push(<span class="string">&#x27;/search/result?key=&#x27;</span> + key)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="获取查询参数"><a href="#获取查询参数" class="headerlink" title="获取查询参数"></a>获取查询参数</h3><p><code>pages/Search/Result/index.tsx</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useHistory, useLocation &#125; <span class="keyword">from</span> <span class="string">&#x27;react-router-dom&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; NavBar &#125; <span class="keyword">from</span> <span class="string">&#x27;antd-mobile&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&#x27;./index.module.scss&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Result = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> history = useHistory()</span><br><span class="line">    <span class="keyword">const</span> location = useLocation()</span><br><span class="line">    <span class="comment">// location.search =&gt; ?key=a</span></span><br><span class="line">    <span class="keyword">const</span> search = <span class="keyword">new</span> URLSearchParams(location.search)</span><br><span class="line">    <span class="keyword">const</span> value = search.get(<span class="string">&#x27;key&#x27;</span>)!</span><br><span class="line">    <span class="built_in">console</span>.log(value)</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;styles.root&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">NavBar</span> <span class="attr">onBack</span>=<span class="string">&#123;()</span> =&gt;</span> history.go(-1)&#125;&gt;搜索结果<span class="tag">&lt;/<span class="name">NavBar</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;article-list&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;article-item&#x27;</span>&gt;</span>文章列表<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Result</span><br></pre></td></tr></table></figure>

<p>URLSearchParams 的另一种用法。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> search = <span class="keyword">new</span> URLSearchParams()</span><br><span class="line">search.append(<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;ifer&#x27;</span>)</span><br><span class="line">search.append(<span class="string">&#x27;age&#x27;</span>, <span class="string">&#x27;18&#x27;</span>)</span><br><span class="line"><span class="built_in">console</span>.log(search + <span class="string">&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>处理参数：当数据带有 + 号的时候会有问题，例如 <code>key=age 1+8我</code>，得到的结果是 <code>age 1 8我</code>。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 解决办法</span></span><br><span class="line"><span class="comment">// 传参时对参数进行编码</span></span><br><span class="line"><span class="keyword">const</span> r = <span class="built_in">encodeURIComponent</span>(<span class="string">&#x27;age 1+8我&#x27;</span>)</span><br><span class="line"><span class="comment">// 接参时对参数进行解码</span></span><br><span class="line"><span class="built_in">decodeURIComponent</span>(r)</span><br></pre></td></tr></table></figure>

<p><code>pages/Search/index.tsx</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> onSearch = <span class="function">(<span class="params">key: <span class="built_in">string</span></span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!key) <span class="keyword">return</span></span><br><span class="line">    dispatch(addSearchList(key))</span><br><span class="line">    history.push(<span class="string">&#x27;/search/result?key=&#x27;</span> + <span class="built_in">encodeURIComponent</span>(key))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>pages/Search/Result/index.tsx</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> search = <span class="keyword">new</span> URLSearchParams(location.search)</span><br><span class="line"><span class="keyword">const</span> keyword = <span class="built_in">decodeURIComponent</span>(search.get(<span class="string">&#x27;key&#x27;</span>)!)</span><br></pre></td></tr></table></figure>

<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 了解，不推荐</span></span><br><span class="line"><span class="keyword">const</span> search = <span class="built_in">decodeURI</span>(location.search.replace(<span class="string">&#x27;?key=&#x27;</span>, <span class="string">&#x27;&#x27;</span>))</span><br></pre></td></tr></table></figure>

<h3 id="请求搜索结果"><a href="#请求搜索结果" class="headerlink" title="请求搜索结果"></a>请求搜索结果</h3><h4 id="目标-24"><a href="#目标-24" class="headerlink" title="目标"></a>目标</h4><p>获取从搜索页面传入的参数后，调用后端接口获取搜索详情。</p>
<h4 id="步骤-17"><a href="#步骤-17" class="headerlink" title="步骤"></a>步骤</h4><ol>
<li>获取通过 URL 地址传入到搜索详情页的查询字符串参数 <code>q</code>。</li>
</ol>
<p><code>types/data.d.ts</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> SearchResult = &#123;</span><br><span class="line">    <span class="attr">page</span>: <span class="built_in">number</span></span><br><span class="line">    <span class="attr">per_page</span>: <span class="built_in">number</span></span><br><span class="line">    <span class="attr">total_count</span>: <span class="built_in">number</span></span><br><span class="line">    <span class="attr">results</span>: Article[]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>types/store.d.ts</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> SearchAction =</span><br><span class="line">    | &#123;</span><br><span class="line">          <span class="attr">type</span>: <span class="string">&#x27;search/suggestion&#x27;</span></span><br><span class="line">          <span class="attr">payload</span>: Suggestion</span><br><span class="line">      &#125;</span><br><span class="line">    | &#123;</span><br><span class="line">          <span class="attr">type</span>: <span class="string">&#x27;search/clearSuggestion&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">    | &#123;</span><br><span class="line">          <span class="attr">type</span>: <span class="string">&#x27;search/saveHistories&#x27;</span></span><br><span class="line">          <span class="attr">payload</span>: <span class="built_in">string</span>[]</span><br><span class="line">      &#125;</span><br><span class="line">    | &#123;</span><br><span class="line">          <span class="attr">type</span>: <span class="string">&#x27;search/saveHistoriesResult&#x27;</span></span><br><span class="line">          <span class="attr">payload</span>: SearchResult</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>在 <code>store/actions/search.ts</code> 中编写 Action Creator。</li>
</ol>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">getSearchResults</span>(<span class="params">keyword: <span class="built_in">string</span>, page: <span class="built_in">number</span> = <span class="number">1</span>, per_page = <span class="number">10</span></span>): <span class="title">RootThunkAction</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">async</span> (dispatch) =&gt; &#123;</span><br><span class="line">        <span class="keyword">const</span> res = <span class="keyword">await</span> request.get&lt;ApiResponse&lt;SearchResult&gt;&gt;(<span class="string">&#x27;/search&#x27;</span>, &#123;</span><br><span class="line">            <span class="attr">params</span>: &#123;</span><br><span class="line">                <span class="attr">q</span>: keyword,</span><br><span class="line">                page,</span><br><span class="line">                per_page,</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;)</span><br><span class="line">        dispatch(&#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;search/saveHistoriesResult&#x27;</span>,</span><br><span class="line">            <span class="attr">payload</span>: res.data.data,</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>在 <code>store/reducers/search.ts</code> 中添加保存搜索详情数据的 Reducer 逻辑。</li>
</ol>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Histories, SearchResult, Suggestion &#125; <span class="keyword">from</span> <span class="string">&#x27;@/types/data&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; SearchAction &#125; <span class="keyword">from</span> <span class="string">&#x27;@/types/store&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; getLocalHistories, setLocalHisories &#125; <span class="keyword">from</span> <span class="string">&#x27;@/utils/storage&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> SearchState = &#123;</span><br><span class="line">    <span class="attr">suggestion</span>: Suggestion</span><br><span class="line">    <span class="attr">histories</span>: Histories</span><br><span class="line">    <span class="comment">// #1</span></span><br><span class="line">    <span class="attr">searchResult</span>: SearchResult</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> initState: SearchState = &#123;</span><br><span class="line">    <span class="attr">suggestion</span>: [],</span><br><span class="line">    <span class="attr">histories</span>: getLocalHistories(),</span><br><span class="line">    <span class="comment">// #2</span></span><br><span class="line">    <span class="attr">searchResult</span>: &#123;&#125; <span class="keyword">as</span> SearchResult,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">search</span>(<span class="params">state = initState, action: SearchAction</span>): <span class="title">SearchState</span> </span>&#123;</span><br><span class="line">    <span class="keyword">switch</span> (action.type) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;search/suggestion&#x27;</span>:</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                ...state,</span><br><span class="line">                <span class="attr">suggestion</span>: action.payload,</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;search/clearSuggestion&#x27;</span>:</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                ...state,</span><br><span class="line">                <span class="attr">suggestion</span>: [],</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;search/saveHistories&#x27;</span>: &#123;</span><br><span class="line">            <span class="comment">// #1</span></span><br><span class="line">            setLocalHisories(action.payload)</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                ...state,</span><br><span class="line">                <span class="attr">histories</span>: action.payload,</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// #3</span></span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;search/saveHistoriesResult&#x27;</span>:</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                ...state,</span><br><span class="line">                <span class="attr">searchResult</span>: action.payload,</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="attr">default</span>:</span><br><span class="line">            <span class="keyword">return</span> state</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="渲染搜索结果"><a href="#渲染搜索结果" class="headerlink" title="渲染搜索结果"></a>渲染搜索结果</h3><p><code>pages/Search/Result/index.tsx</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useDispatch, useSelector &#125; <span class="keyword">from</span> <span class="string">&#x27;react-redux&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useHistory, useLocation &#125; <span class="keyword">from</span> <span class="string">&#x27;react-router-dom&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; NavBar &#125; <span class="keyword">from</span> <span class="string">&#x27;antd-mobile&#x27;</span></span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&#x27;./index.module.scss&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; getSearchResults &#125; <span class="keyword">from</span> <span class="string">&#x27;@/store/actions/search&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; RootState &#125; <span class="keyword">from</span> <span class="string">&#x27;@/types/store&#x27;</span></span><br><span class="line"><span class="keyword">import</span> ArticleItem <span class="keyword">from</span> <span class="string">&#x27;@/pages/Home/components/ArticleItem&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Result = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> history = useHistory()</span><br><span class="line">    <span class="keyword">const</span> location = useLocation()</span><br><span class="line">    <span class="keyword">const</span> dispatch = useDispatch()</span><br><span class="line">    <span class="keyword">const</span> search = <span class="keyword">new</span> URLSearchParams(location.search)</span><br><span class="line">    <span class="keyword">const</span> keyword = search.get(<span class="string">&#x27;key&#x27;</span>)!</span><br><span class="line">    <span class="comment">// #2</span></span><br><span class="line">    <span class="keyword">const</span> &#123;</span><br><span class="line">        <span class="attr">searchResult</span>: &#123; results = [] &#125;,</span><br><span class="line">    &#125; = useSelector(<span class="function">(<span class="params">state: RootState</span>) =&gt;</span> state.search)</span><br><span class="line">    <span class="comment">// #1</span></span><br><span class="line">    useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        dispatch(getSearchResults(keyword))</span><br><span class="line">    &#125;, [dispatch, keyword])</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;styles.root&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">NavBar</span> <span class="attr">onBack</span>=<span class="string">&#123;()</span> =&gt;</span> history.go(-1)&#125;&gt;搜索结果<span class="tag">&lt;/<span class="name">NavBar</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;article-list&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                &#123;/* #3 */&#125;</span></span><br><span class="line"><span class="xml">                &#123;results.map((item) =&gt; (</span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;article-item&#x27;</span> <span class="attr">key</span>=<span class="string">&#123;item.art_id&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">ArticleItem</span> <span class="attr">article</span>=<span class="string">&#123;item&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                ))&#125;</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Result</span><br></pre></td></tr></table></figure>

<h3 id="图片-403-问题"><a href="#图片-403-问题" class="headerlink" title="图片 403 问题"></a>图片 403 问题</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;referrer&quot;</span> <span class="attr">content</span>=<span class="string">&quot;no-referrer&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="加载更多数据"><a href="#加载更多数据" class="headerlink" title="加载更多数据"></a>加载更多数据</h3><p><code>pages/Search/Result/index.tsx</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useEffect, useRef, useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useDispatch, useSelector &#125; <span class="keyword">from</span> <span class="string">&#x27;react-redux&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useHistory, useLocation &#125; <span class="keyword">from</span> <span class="string">&#x27;react-router-dom&#x27;</span></span><br><span class="line"><span class="comment">// #1</span></span><br><span class="line"><span class="keyword">import</span> &#123; NavBar, InfiniteScroll &#125; <span class="keyword">from</span> <span class="string">&#x27;antd-mobile&#x27;</span></span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&#x27;./index.module.scss&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; getSearchResults &#125; <span class="keyword">from</span> <span class="string">&#x27;@/store/actions/search&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; RootState &#125; <span class="keyword">from</span> <span class="string">&#x27;@/types/store&#x27;</span></span><br><span class="line"><span class="keyword">import</span> ArticleItem <span class="keyword">from</span> <span class="string">&#x27;@/pages/Home/components/ArticleItem&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Result = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> history = useHistory()</span><br><span class="line">    <span class="keyword">const</span> location = useLocation()</span><br><span class="line">    <span class="keyword">const</span> dispatch = useDispatch()</span><br><span class="line">    <span class="keyword">const</span> search = <span class="keyword">new</span> URLSearchParams(location.search)</span><br><span class="line">    <span class="keyword">const</span> keyword = search.get(<span class="string">&#x27;key&#x27;</span>)!</span><br><span class="line">    <span class="comment">/* const &#123;</span></span><br><span class="line"><span class="comment">        searchResult: &#123; results = [], total_count = 1 &#125;,</span></span><br><span class="line"><span class="comment">    &#125; = useSelector((state: RootState) =&gt; state.search)</span></span><br><span class="line"><span class="comment">    const hasMore = results.length &lt; total_count */</span></span><br><span class="line">    <span class="keyword">const</span> &#123;</span><br><span class="line">        <span class="attr">searchResult</span>: &#123; results = [] &#125;,</span><br><span class="line">    &#125; = useSelector(<span class="function">(<span class="params">state: RootState</span>) =&gt;</span> state.search)</span><br><span class="line">    <span class="comment">// #3</span></span><br><span class="line">    <span class="keyword">const</span> hasMore = results.length &lt; <span class="number">100</span></span><br><span class="line">    <span class="comment">// #4</span></span><br><span class="line">    <span class="keyword">const</span> pageRef = useRef(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">const</span> bBarRef = useRef(<span class="literal">true</span>)</span><br><span class="line">    <span class="comment">// #5</span></span><br><span class="line">    <span class="keyword">const</span> loadMore = <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">        <span class="comment">// #6 节流</span></span><br><span class="line">        <span class="keyword">if</span> (bBarRef.current) &#123;</span><br><span class="line">            bBarRef.current = <span class="literal">false</span></span><br><span class="line">            <span class="keyword">await</span> dispatch(getSearchResults(keyword, pageRef.current))</span><br><span class="line">            pageRef.current++</span><br><span class="line">            bBarRef.current = <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// !务必注释</span></span><br><span class="line">    <span class="comment">/* useEffect(() =&gt; &#123;</span></span><br><span class="line"><span class="comment">        dispatch(getSearchResults(keyword))</span></span><br><span class="line"><span class="comment">    &#125;, [dispatch, keyword]) */</span></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;styles.root&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">NavBar</span> <span class="attr">onBack</span>=<span class="string">&#123;()</span> =&gt;</span> history.go(-1)&#125;&gt;搜索结果<span class="tag">&lt;/<span class="name">NavBar</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;article-list&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                &#123;results.map((item) =&gt; (</span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;article-item&#x27;</span> <span class="attr">key</span>=<span class="string">&#123;item.art_id&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">ArticleItem</span> <span class="attr">article</span>=<span class="string">&#123;item&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                ))&#125;</span></span><br><span class="line"><span class="xml">                &#123;/* #2: 注意放的位置，丢外面会导致不会被内容撑下去，永远在可视区 */&#125;</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">InfiniteScroll</span> <span class="attr">hasMore</span>=<span class="string">&#123;hasMore&#125;</span> <span class="attr">loadMore</span>=<span class="string">&#123;loadMore&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Result</span><br></pre></td></tr></table></figure>

<p><code>reducers/search.ts</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Histories, SearchResult, Suggestion &#125; <span class="keyword">from</span> <span class="string">&#x27;@/types/data&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; SearchAction &#125; <span class="keyword">from</span> <span class="string">&#x27;@/types/store&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; getLocalHistories, setLocalHisories &#125; <span class="keyword">from</span> <span class="string">&#x27;@/utils/storage&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> SearchState = &#123;</span><br><span class="line">    <span class="attr">suggestion</span>: Suggestion</span><br><span class="line">    <span class="attr">histories</span>: Histories</span><br><span class="line">    <span class="attr">searchResult</span>: SearchResult</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> initState: SearchState = &#123;</span><br><span class="line">    <span class="attr">suggestion</span>: [],</span><br><span class="line">    <span class="attr">histories</span>: getLocalHistories(),</span><br><span class="line">    <span class="attr">searchResult</span>: &#123;&#125; <span class="keyword">as</span> SearchResult,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">search</span>(<span class="params">state = initState, action: SearchAction</span>): <span class="title">SearchState</span> </span>&#123;</span><br><span class="line">    <span class="keyword">switch</span> (action.type) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;search/suggestion&#x27;</span>:</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                ...state,</span><br><span class="line">                <span class="attr">suggestion</span>: action.payload,</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;search/clearSuggestion&#x27;</span>:</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                ...state,</span><br><span class="line">                <span class="attr">suggestion</span>: [],</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;search/saveHistories&#x27;</span>: &#123;</span><br><span class="line">            setLocalHisories(action.payload)</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                ...state,</span><br><span class="line">                <span class="attr">histories</span>: action.payload,</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// #mark</span></span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;search/saveHistoriesResult&#x27;</span>:</span><br><span class="line">            <span class="keyword">const</span> old = state.searchResult.results || []</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                ...state,</span><br><span class="line">                <span class="attr">searchResult</span>: &#123;</span><br><span class="line">                    ...state.searchResult,</span><br><span class="line">                    <span class="attr">results</span>: [...old, ...action.payload.results],</span><br><span class="line">                &#125;,</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="attr">default</span>:</span><br><span class="line">            <span class="keyword">return</span> state</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Bug：先搜索关键字 ‘a’，出来结果，返回，再进行搜索 ‘xxxx’，发现上次的结果还在。</p>
<p><font color=e32d40><strong>解决：进入或销毁组件时清空 Redux 中的数据。</strong></font></p>
<h3 id="跳转到详情"><a href="#跳转到详情" class="headerlink" title="跳转到详情"></a>跳转到详情</h3><h4 id="目标-25"><a href="#目标-25" class="headerlink" title="目标"></a>目标</h4><p>将请求到的搜索详情数据渲染到界面上。</p>
<h4 id="步骤-18"><a href="#步骤-18" class="headerlink" title="步骤"></a>步骤</h4><p><code>pages/Home/components/ArticleList/index.tsx</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 注释掉 .article-item 的点击</span></span><br><span class="line">&#123;</span><br><span class="line">    articles.map(<span class="function">(<span class="params">item</span>) =&gt;</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">key</span>=<span class="string">&#123;item.art_id&#125;</span> <span class="attr">className</span>=<span class="string">&#x27;article-item&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">ArticleItem</span> <span class="attr">article</span>=<span class="string">&#123;item&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    ))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>把点击事件绑定到 <code>pages/Home/components/ArticleItem/index.tsx</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;div className=&#123;styles.root&#125; onClick=&#123;<span class="function">() =&gt;</span> history.push(<span class="string">`/article/<span class="subst">$&#123;art_id&#125;</span>`</span>)&#125;&gt;&lt;/div&gt;</span><br></pre></td></tr></table></figure>

    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2021/12/24/react-base-course17/" rel="prev" title="17_极客园 H5">
      <i class="fa fa-chevron-left"></i> 17_极客园 H5
    </a></div>
      <div class="post-nav-item">
    <a href="/2022/01/08/react-base-course19/" rel="next" title="19_极客园 H5">
      19_极客园 H5 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BB%8A%E6%97%A5%E7%9B%AE%E6%A0%87"><span class="nav-number">1.</span> <span class="nav-text">今日目标</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B8%B2%E6%9F%93%E6%88%91%E7%9A%84%E9%A2%91%E9%81%93"><span class="nav-number">2.</span> <span class="nav-text">渲染我的频道</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%A1%B5%E9%9D%A2%E7%BB%93%E6%9E%84"><span class="nav-number">2.1.</span> <span class="nav-text">页面结构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Tabs-%E7%BB%84%E4%BB%B6"><span class="nav-number">2.2.</span> <span class="nav-text">Tabs 组件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E9%A2%91%E9%81%93%E5%88%97%E8%A1%A8%E6%95%B0%E6%8D%AE"><span class="nav-number">2.3.</span> <span class="nav-text">获取频道列表数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AD%98%E5%82%A8%E5%88%B0-Redux"><span class="nav-number">2.4.</span> <span class="nav-text">存储到 Redux</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B8%B2%E6%9F%93%E6%95%B0%E6%8D%AE"><span class="nav-number">2.5.</span> <span class="nav-text">渲染数据</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B8%B2%E6%9F%93%E9%A2%91%E9%81%93%E7%AE%A1%E7%90%86"><span class="nav-number">3.</span> <span class="nav-text">渲染频道管理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BC%B9%E5%B1%82%E6%98%BE%E7%A4%BA%E9%9A%90%E8%97%8F"><span class="nav-number">3.1.</span> <span class="nav-text">弹层显示隐藏</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%9B%AE%E6%A0%87"><span class="nav-number">3.1.1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%B4%A0%E6%9D%90"><span class="nav-number">3.1.2.</span> <span class="nav-text">素材</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A4"><span class="nav-number">3.1.3.</span> <span class="nav-text">步骤</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81"><span class="nav-number">3.1.4.</span> <span class="nav-text">代码</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B8%B2%E6%9F%93%E6%88%91%E7%9A%84%E9%A2%91%E9%81%93-1"><span class="nav-number">3.2.</span> <span class="nav-text">渲染我的频道</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%9B%AE%E6%A0%87-1"><span class="nav-number">3.2.1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A4-1"><span class="nav-number">3.2.2.</span> <span class="nav-text">步骤</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E6%89%80%E6%9C%89%E9%A2%91%E9%81%93"><span class="nav-number">3.3.</span> <span class="nav-text">获取所有频道</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%9B%AE%E6%A0%87-2"><span class="nav-number">3.3.1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81-1"><span class="nav-number">3.3.2.</span> <span class="nav-text">代码</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B8%B2%E6%9F%93%E9%A2%91%E9%81%93%E6%8E%A8%E8%8D%90"><span class="nav-number">3.4.</span> <span class="nav-text">渲染频道推荐</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%9B%AE%E6%A0%87-3"><span class="nav-number">3.4.1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81-2"><span class="nav-number">3.4.2.</span> <span class="nav-text">代码</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%88%91%E7%9A%84%E9%A2%91%E9%81%93%E9%80%BB%E8%BE%91"><span class="nav-number">3.5.</span> <span class="nav-text">我的频道逻辑</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%86%E6%9E%90"><span class="nav-number">3.5.1.</span> <span class="nav-text">分析</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81-3"><span class="nav-number">3.5.2.</span> <span class="nav-text">代码</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%A2%91%E9%81%93%E7%AE%A1%E7%90%86%E4%BA%A4%E4%BA%92"><span class="nav-number">4.</span> <span class="nav-text">频道管理交互</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%82%B9%E5%87%BB%E6%88%91%E7%9A%84%E9%A2%91%E9%81%93%E9%AB%98%E4%BA%AE"><span class="nav-number">4.1.</span> <span class="nav-text">点击我的频道高亮</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%9B%AE%E6%A0%87-4"><span class="nav-number">4.1.1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%86%E6%9E%90-1"><span class="nav-number">4.1.2.</span> <span class="nav-text">分析</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81-4"><span class="nav-number">4.1.3.</span> <span class="nav-text">代码</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%84%E7%90%86-Tabs-%E7%9A%84%E9%AB%98%E4%BA%AE"><span class="nav-number">4.2.</span> <span class="nav-text">处理 Tabs 的高亮</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%9B%AE%E6%A0%87-5"><span class="nav-number">4.2.1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A4-2"><span class="nav-number">4.2.2.</span> <span class="nav-text">步骤</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A0%B8%E5%BF%83%E4%BB%A3%E7%A0%81"><span class="nav-number">4.2.3.</span> <span class="nav-text">核心代码</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%96%E8%BE%91%E7%8A%B6%E6%80%81%E7%9A%84%E5%A4%84%E7%90%86"><span class="nav-number">4.3.</span> <span class="nav-text">编辑状态的处理</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%9B%AE%E6%A0%87-6"><span class="nav-number">4.3.1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A4-3"><span class="nav-number">4.3.2.</span> <span class="nav-text">步骤</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81-5"><span class="nav-number">4.3.3.</span> <span class="nav-text">代码</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%A0%E9%99%A4%E9%A2%91%E9%81%93"><span class="nav-number">4.4.</span> <span class="nav-text">删除频道</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%9B%AE%E6%A0%87-7"><span class="nav-number">4.4.1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%86%E6%9E%90-2"><span class="nav-number">4.4.2.</span> <span class="nav-text">分析</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A4-4"><span class="nav-number">4.4.3.</span> <span class="nav-text">步骤</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81-6"><span class="nav-number">4.4.4.</span> <span class="nav-text">代码</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BC%98%E5%8C%96"><span class="nav-number">4.4.5.</span> <span class="nav-text">优化</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B7%BB%E5%8A%A0%E9%A2%91%E9%81%93"><span class="nav-number">4.5.</span> <span class="nav-text">添加频道</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%9B%AE%E6%A0%87-8"><span class="nav-number">4.5.1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81-7"><span class="nav-number">4.5.2.</span> <span class="nav-text">代码</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%96%87%E7%AB%A0%E5%88%97%E8%A1%A8%E5%A4%84%E7%90%86"><span class="nav-number">5.</span> <span class="nav-text">文章列表处理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E7%BB%93%E6%9E%84"><span class="nav-number">5.1.</span> <span class="nav-text">基本结构</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%9B%AE%E6%A0%87-9"><span class="nav-number">5.1.1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%B4%A0%E6%9D%90-1"><span class="nav-number">5.1.2.</span> <span class="nav-text">素材</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A4-5"><span class="nav-number">5.1.3.</span> <span class="nav-text">步骤</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81-8"><span class="nav-number">5.1.4.</span> <span class="nav-text">代码</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E6%96%87%E7%AB%A0%E5%88%97%E8%A1%A8%E6%95%B0%E6%8D%AE"><span class="nav-number">5.2.</span> <span class="nav-text">获取文章列表数据</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%9B%AE%E6%A0%87-10"><span class="nav-number">5.2.1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A4-6"><span class="nav-number">5.2.2.</span> <span class="nav-text">步骤</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81-9"><span class="nav-number">5.2.3.</span> <span class="nav-text">代码</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B0%86%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8%E5%88%B0-Redux-%E4%B8%AD"><span class="nav-number">5.3.</span> <span class="nav-text">将数据存储到 Redux 中</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%9B%AE%E6%A0%87-11"><span class="nav-number">5.3.1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%86%E6%9E%90-3"><span class="nav-number">5.3.2.</span> <span class="nav-text">分析</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81-10"><span class="nav-number">5.3.3.</span> <span class="nav-text">代码</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B8%B2%E6%9F%93%E6%96%87%E7%AB%A0%E5%88%97%E8%A1%A8"><span class="nav-number">5.4.</span> <span class="nav-text">渲染文章列表</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%9B%AE%E6%A0%87-12"><span class="nav-number">5.4.1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A4-7"><span class="nav-number">5.4.2.</span> <span class="nav-text">步骤</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A6%E5%BA%95%E5%8A%A0%E8%BD%BD%E6%9B%B4%E5%A4%9A"><span class="nav-number">5.5.</span> <span class="nav-text">触底加载更多</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%9B%AE%E6%A0%87-13"><span class="nav-number">5.5.1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81-11"><span class="nav-number">5.5.2.</span> <span class="nav-text">代码</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%8B%E6%8B%89%E5%88%B7%E6%96%B0"><span class="nav-number">5.6.</span> <span class="nav-text">下拉刷新</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%9B%AE%E6%A0%87-14"><span class="nav-number">5.6.1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%86%E6%9E%90-4"><span class="nav-number">5.6.2.</span> <span class="nav-text">分析</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#IntersectionObserver"><span class="nav-number">5.7.</span> <span class="nav-text">IntersectionObserver</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9B%BE%E7%89%87%E6%87%92%E5%8A%A0%E8%BD%BD%E7%9A%84%E5%B0%81%E8%A3%85"><span class="nav-number">5.8.</span> <span class="nav-text">图片懒加载的封装</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%9B%AE%E6%A0%87-15"><span class="nav-number">5.8.1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A4-8"><span class="nav-number">5.8.2.</span> <span class="nav-text">步骤</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%82%B9%E5%87%BB%E6%96%87%E7%AB%A0%E9%A1%B9%E8%B7%B3%E8%BD%AC%E5%88%B0%E8%AF%A6%E6%83%85"><span class="nav-number">5.9.</span> <span class="nav-text">点击文章项跳转到详情</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%9B%AE%E6%A0%87-16"><span class="nav-number">5.9.1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%B4%A0%E6%9D%90-2"><span class="nav-number">5.9.2.</span> <span class="nav-text">素材</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A4-9"><span class="nav-number">5.9.3.</span> <span class="nav-text">步骤</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81-12"><span class="nav-number">5.9.4.</span> <span class="nav-text">代码</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Tab-%E6%A0%8F%E5%88%87%E6%8D%A2%E8%AE%B0%E5%BD%95%E6%BB%9A%E5%8A%A8%E4%BD%8D%E7%BD%AE"><span class="nav-number">5.10.</span> <span class="nav-text">Tab 栏切换记录滚动位置</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%90%9C%E7%B4%A2%E8%81%94%E6%83%B3%E5%BB%BA%E8%AE%AE"><span class="nav-number">6.</span> <span class="nav-text">搜索联想建议</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9D%99%E6%80%81%E7%BB%93%E6%9E%84"><span class="nav-number">6.1.</span> <span class="nav-text">静态结构</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%9B%AE%E6%A0%87-17"><span class="nav-number">6.1.1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%B4%A0%E6%9D%90-3"><span class="nav-number">6.1.2.</span> <span class="nav-text">素材</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A4-10"><span class="nav-number">6.1.3.</span> <span class="nav-text">步骤</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%98%B2%E6%8A%96%E5%A4%84%E7%90%86"><span class="nav-number">6.2.</span> <span class="nav-text">防抖处理</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%9B%AE%E6%A0%87-18"><span class="nav-number">6.2.1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A4-11"><span class="nav-number">6.2.2.</span> <span class="nav-text">步骤</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#aHooks"><span class="nav-number">6.3.</span> <span class="nav-text">aHooks</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A4-12"><span class="nav-number">6.3.1.</span> <span class="nav-text">步骤</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81-13"><span class="nav-number">6.3.2.</span> <span class="nav-text">代码</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E6%95%B0%E6%8D%AE"><span class="nav-number">6.4.</span> <span class="nav-text">获取数据</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%9B%AE%E6%A0%87-19"><span class="nav-number">6.4.1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81-14"><span class="nav-number">6.4.2.</span> <span class="nav-text">代码</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B8%B2%E6%9F%93%E6%95%B0%E6%8D%AE-1"><span class="nav-number">6.5.</span> <span class="nav-text">渲染数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%AB%98%E4%BA%AE%E5%A4%84%E7%90%86"><span class="nav-number">6.6.</span> <span class="nav-text">高亮处理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8C%89%E9%9C%80%E5%B1%95%E7%A4%BA%E5%8E%86%E5%8F%B2%E8%AE%B0%E5%BD%95%E5%92%8C%E8%81%94%E6%83%B3%E5%BB%BA%E8%AE%AE"><span class="nav-number">6.7.</span> <span class="nav-text">按需展示历史记录和联想建议</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%9B%AE%E6%A0%87-20"><span class="nav-number">6.7.1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A4-13"><span class="nav-number">6.7.2.</span> <span class="nav-text">步骤</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%86%85%E5%AE%B9%E4%B8%BA%E7%A9%BA%E6%97%B6%E4%B9%9F%E6%B8%85%E9%99%A4%E8%81%94%E6%83%B3%E5%BB%BA%E8%AE%AE"><span class="nav-number">6.8.</span> <span class="nav-text">内容为空时也清除联想建议</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%80%E4%B8%AA-Bug"><span class="nav-number">6.9.</span> <span class="nav-text">一个 Bug</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%90%9C%E7%B4%A2%E5%8E%86%E5%8F%B2%E8%AE%B0%E5%BD%95"><span class="nav-number">7.</span> <span class="nav-text">搜索历史记录</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B7%BB%E5%8A%A0%E5%8E%86%E5%8F%B2%E8%AE%B0%E5%BD%95"><span class="nav-number">7.1.</span> <span class="nav-text">添加历史记录</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%9B%AE%E6%A0%87-21"><span class="nav-number">7.1.1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A4-14"><span class="nav-number">7.1.2.</span> <span class="nav-text">步骤</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8E%BB%E9%87%8D%E5%89%8D%E7%BD%AE%E5%8A%9F%E8%83%BD"><span class="nav-number">7.2.</span> <span class="nav-text">去重前置功能</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B8%B2%E6%9F%93%E5%88%A0%E9%99%A4%E6%B8%85%E7%A9%BA"><span class="nav-number">7.3.</span> <span class="nav-text">渲染删除清空</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8E%86%E5%8F%B2%E8%AE%B0%E5%BD%95%E7%9A%84%E6%8C%81%E4%B9%85%E5%8C%96"><span class="nav-number">7.4.</span> <span class="nav-text">历史记录的持久化</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%9B%AE%E6%A0%87-22"><span class="nav-number">7.4.1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A4-15"><span class="nav-number">7.4.2.</span> <span class="nav-text">步骤</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B1%95%E7%A4%BA%E6%90%9C%E7%B4%A2%E7%BB%93%E6%9E%9C"><span class="nav-number">8.</span> <span class="nav-text">展示搜索结果</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9D%99%E6%80%81%E7%BB%93%E6%9E%84%E5%92%8C%E6%A0%B7%E5%BC%8F"><span class="nav-number">8.1.</span> <span class="nav-text">静态结构和样式</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%9B%AE%E6%A0%87-23"><span class="nav-number">8.1.1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%B4%A0%E6%9D%90-4"><span class="nav-number">8.1.2.</span> <span class="nav-text">素材</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A4-16"><span class="nav-number">8.1.3.</span> <span class="nav-text">步骤</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E6%9F%A5%E8%AF%A2%E5%8F%82%E6%95%B0"><span class="nav-number">8.2.</span> <span class="nav-text">获取查询参数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AF%B7%E6%B1%82%E6%90%9C%E7%B4%A2%E7%BB%93%E6%9E%9C"><span class="nav-number">8.3.</span> <span class="nav-text">请求搜索结果</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%9B%AE%E6%A0%87-24"><span class="nav-number">8.3.1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A4-17"><span class="nav-number">8.3.2.</span> <span class="nav-text">步骤</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B8%B2%E6%9F%93%E6%90%9C%E7%B4%A2%E7%BB%93%E6%9E%9C"><span class="nav-number">8.4.</span> <span class="nav-text">渲染搜索结果</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9B%BE%E7%89%87-403-%E9%97%AE%E9%A2%98"><span class="nav-number">8.5.</span> <span class="nav-text">图片 403 问题</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8A%A0%E8%BD%BD%E6%9B%B4%E5%A4%9A%E6%95%B0%E6%8D%AE"><span class="nav-number">8.6.</span> <span class="nav-text">加载更多数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%B7%B3%E8%BD%AC%E5%88%B0%E8%AF%A6%E6%83%85"><span class="nav-number">8.7.</span> <span class="nav-text">跳转到详情</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%9B%AE%E6%A0%87-25"><span class="nav-number">8.7.1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A4-18"><span class="nav-number">8.7.2.</span> <span class="nav-text">步骤</span></a></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Ifer"
      src="/images/49337922.png">
  <p class="site-author-name" itemprop="name">Ifer</p>
  <div class="site-description" itemprop="description">React 全家桶 <span style='position:relative;top:-2px;'>✍</span></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">73</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://www.bilibili.com/video/BV1iW4y1k7Ci?spm_id_from=333.337.search-card.all.click" title="😚 → https:&#x2F;&#x2F;www.bilibili.com&#x2F;video&#x2F;BV1iW4y1k7Ci?spm_id_from&#x3D;333.337.search-card.all.click" rel="noopener" target="_blank"><i class="a fa-fw"></i>😚</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.zhihu.com/people/weixiantx" title="😙 → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;weixiantx" rel="noopener" target="_blank"><i class="a fa-fw"></i>😙</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Ifer</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
