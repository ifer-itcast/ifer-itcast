<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.ico">
  <link rel="mask-icon" href="/images/favicon.ico" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"mac"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="今日目标✔ 掌握个人中心功能的开发。 ✔ 掌握 WebSocket 的使用。">
<meta property="og:type" content="article">
<meta property="og:title" content="17_极客园 H5">
<meta property="og:url" content="http://example.com/2021/12/24/react-base-course17/index.html">
<meta property="og:site_name" content="危险">
<meta property="og:description" content="今日目标✔ 掌握个人中心功能的开发。 ✔ 掌握 WebSocket 的使用。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/resource/images/image-20210903111508949.png">
<meta property="og:image" content="http://example.com/resource/images/image-20201121170006970.png">
<meta property="og:image" content="http://example.com/resource/images/image-20210904085509862.png">
<meta property="article:published_time" content="2021-12-24T08:30:14.000Z">
<meta property="article:modified_time" content="2022-02-24T16:01:33.008Z">
<meta property="article:author" content="Ifer">
<meta property="article:tag" content="React,Redux,Mobx,Saga,Dva,Umi,AntD,TS">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/resource/images/image-20210903111508949.png">

<link rel="canonical" href="http://example.com/2021/12/24/react-base-course17/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>17_极客园 H5 | 危险</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">危险</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">为之则易，不为则难</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/12/24/react-base-course17/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/49337922.png">
      <meta itemprop="name" content="Ifer">
      <meta itemprop="description" content="React 全家桶 <span style='position:relative;top:-2px;'>✍</span>">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="危险">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          17_极客园 H5
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-12-24 16:30:14" itemprop="dateCreated datePublished" datetime="2021-12-24T16:30:14+08:00">2021-12-24</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-02-25 00:01:33" itemprop="dateModified" datetime="2022-02-25T00:01:33+08:00">2022-02-25</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="今日目标"><a href="#今日目标" class="headerlink" title="今日目标"></a>今日目标</h2><p>✔ 掌握个人中心功能的开发。</p>
<p>✔ 掌握 WebSocket 的使用。</p>
<span id="more"></span>

<h2 id="布局页面结构"><a href="#布局页面结构" class="headerlink" title="布局页面结构"></a>布局页面结构</h2><h3 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h3><p>能够使用准备好的模板搭建布局页面结构。</p>
<h3 id="素材"><a href="#素材" class="headerlink" title="素材"></a>素材</h3><p><code>pages/Layout/index.module.scss</code></p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@import</span> <span class="string">&#x27;@scss/hairline.scss&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.root</span> &#123;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line"></span><br><span class="line">    :global &#123;</span><br><span class="line">        // 底部 tabbar 的样式</span><br><span class="line">        .tab-bar &#123;</span><br><span class="line">            @include hairline(top, <span class="number">#f0f0f0</span>);</span><br><span class="line">            <span class="attribute">position</span>: fixed;</span><br><span class="line">            <span class="attribute">z-index</span>: <span class="number">1</span>;</span><br><span class="line">            <span class="attribute">bottom</span>: <span class="number">0</span>;</span><br><span class="line">            <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">            <span class="attribute">height</span>: <span class="number">46px</span>;</span><br><span class="line">            <span class="attribute">background-color</span>: <span class="number">#f7f8fa</span>;</span><br><span class="line"></span><br><span class="line">            <span class="selector-class">.icon</span> &#123;</span><br><span class="line">                <span class="attribute">color</span>: <span class="number">#fc6627</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>pages/Layout/index.tsx</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&#x27;./index.module.scss&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Layout = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;styles.root&#125;</span>&gt;</span>&#123;/* 使用 antd 的 TabBar 组件，并指定类名 tab-bar */&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Layout</span><br></pre></td></tr></table></figure>

<h3 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h3><ol>
<li><p>使用 antd-mobile 的 TabBar 组件创建底部标签栏。</p>
</li>
<li><p>样式在素材中已经准备好。</p>
</li>
</ol>
<h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><p><code>pages/Layout/index.tsx</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&#x27;./index.module.scss&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; TabBar &#125; <span class="keyword">from</span> <span class="string">&#x27;antd-mobile&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Icon <span class="keyword">from</span> <span class="string">&#x27;@/components/Icon&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> tabs = [</span><br><span class="line">    &#123; <span class="attr">path</span>: <span class="string">&#x27;/home&#x27;</span>, <span class="attr">icon</span>: <span class="string">&#x27;iconbtn_home&#x27;</span>, <span class="attr">text</span>: <span class="string">&#x27;首页&#x27;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">path</span>: <span class="string">&#x27;/home/question&#x27;</span>, <span class="attr">icon</span>: <span class="string">&#x27;iconbtn_qa&#x27;</span>, <span class="attr">text</span>: <span class="string">&#x27;问答&#x27;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">path</span>: <span class="string">&#x27;/home/video&#x27;</span>, <span class="attr">icon</span>: <span class="string">&#x27;iconbtn_video&#x27;</span>, <span class="attr">text</span>: <span class="string">&#x27;视频&#x27;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">path</span>: <span class="string">&#x27;/home/profile&#x27;</span>, <span class="attr">icon</span>: <span class="string">&#x27;iconbtn_mine&#x27;</span>, <span class="attr">text</span>: <span class="string">&#x27;我的&#x27;</span> &#125;,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">Layout</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;styles.root&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">TabBar</span> <span class="attr">className</span>=<span class="string">&#x27;tab-bar&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                &#123;tabs.map((item) =&gt; (</span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">TabBar.Item</span> <span class="attr">key</span>=<span class="string">&#123;item.path&#125;</span> <span class="attr">icon</span>=<span class="string">&#123;</span>&lt;<span class="attr">Icon</span> <span class="attr">type</span>=<span class="string">&#123;item.icon&#125;</span> /&gt;</span>&#125; title=&#123;item.text&#125; /&gt;</span></span><br><span class="line"><span class="xml">                ))&#125;</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">TabBar</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="路由切换功能"><a href="#路由切换功能" class="headerlink" title="路由切换功能"></a>路由切换功能</h2><ol>
<li>注册 onChange 事件，实现路由的跳转。</li>
</ol>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">Layout</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> history = useHistory()</span><br><span class="line">    <span class="comment">// #2: 注意 pages/Layout/index.tsx，后缀一定是 .tsx</span></span><br><span class="line">    <span class="keyword">const</span> changeRoute = <span class="function">(<span class="params">path: <span class="built_in">string</span></span>) =&gt;</span> &#123;</span><br><span class="line">        history.push(path)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;styles.root&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">            &#123;/* #1 */&#125;</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">TabBar</span> <span class="attr">className</span>=<span class="string">&#x27;tab-bar&#x27;</span> <span class="attr">onChange</span>=<span class="string">&#123;changeRoute&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                &#123;tabs.map((item) =&gt; (</span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">TabBar.Item</span> <span class="attr">key</span>=<span class="string">&#123;item.path&#125;</span> <span class="attr">icon</span>=<span class="string">&#123;</span>&lt;<span class="attr">Icon</span> <span class="attr">type</span>=<span class="string">&#123;item.icon&#125;</span> /&gt;</span>&#125; title=&#123;item.text&#125; /&gt;</span></span><br><span class="line"><span class="xml">                ))&#125;</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">TabBar</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>点击高亮效果。</li>
</ol>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;TabBar.Item key=&#123;item.path&#125; icon=&#123;<span class="function">(<span class="params">active: <span class="built_in">boolean</span></span>) =&gt;</span> <span class="xml"><span class="tag">&lt;<span class="name">Icon</span> <span class="attr">type</span>=<span class="string">&#123;active</span> ? `$&#123;<span class="attr">item.icon</span>&#125;<span class="attr">_sel</span>` <span class="attr">:</span> <span class="attr">item.icon</span>&#125; /&gt;</span></span>&#125; title=&#123;item.text&#125; /&gt;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>解决刷新时默认高亮的问题。</li>
</ol>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;TabBar className=<span class="string">&#x27;tab-bar&#x27;</span> onChange=&#123;changeRoute&#125; activeKey=&#123;location.pathname&#125;&gt;&lt;/TabBar&gt;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>完整代码。</li>
</ol>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&#x27;./index.module.scss&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; TabBar &#125; <span class="keyword">from</span> <span class="string">&#x27;antd-mobile&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Icon <span class="keyword">from</span> <span class="string">&#x27;@/components/Icon&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useHistory, useLocation &#125; <span class="keyword">from</span> <span class="string">&#x27;react-router-dom&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> tabs = [</span><br><span class="line">    &#123; <span class="attr">path</span>: <span class="string">&#x27;/home&#x27;</span>, <span class="attr">icon</span>: <span class="string">&#x27;iconbtn_home&#x27;</span>, <span class="attr">text</span>: <span class="string">&#x27;首页&#x27;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">path</span>: <span class="string">&#x27;/home/question&#x27;</span>, <span class="attr">icon</span>: <span class="string">&#x27;iconbtn_qa&#x27;</span>, <span class="attr">text</span>: <span class="string">&#x27;问答&#x27;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">path</span>: <span class="string">&#x27;/home/video&#x27;</span>, <span class="attr">icon</span>: <span class="string">&#x27;iconbtn_video&#x27;</span>, <span class="attr">text</span>: <span class="string">&#x27;视频&#x27;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">path</span>: <span class="string">&#x27;/home/profile&#x27;</span>, <span class="attr">icon</span>: <span class="string">&#x27;iconbtn_mine&#x27;</span>, <span class="attr">text</span>: <span class="string">&#x27;我的&#x27;</span> &#125;,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">Layout</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> history = useHistory()</span><br><span class="line">    <span class="keyword">const</span> location = useLocation()</span><br><span class="line">    <span class="keyword">const</span> changeRoute = <span class="function">(<span class="params">path: <span class="built_in">string</span></span>) =&gt;</span> &#123;</span><br><span class="line">        history.push(path)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;styles.root&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">TabBar</span> <span class="attr">className</span>=<span class="string">&#x27;tab-bar&#x27;</span> <span class="attr">onChange</span>=<span class="string">&#123;changeRoute&#125;</span> <span class="attr">activeKey</span>=<span class="string">&#123;location.pathname&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                &#123;tabs.map((item) =&gt; (</span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">TabBar.Item</span> <span class="attr">key</span>=<span class="string">&#123;item.path&#125;</span> <span class="attr">icon</span>=<span class="string">&#123;(active:</span> <span class="attr">boolean</span>) =&gt;</span> <span class="tag">&lt;<span class="name">Icon</span> <span class="attr">type</span>=<span class="string">&#123;active</span> ? `$&#123;<span class="attr">item.icon</span>&#125;<span class="attr">_sel</span>` <span class="attr">:</span> <span class="attr">item.icon</span>&#125; /&gt;</span>&#125; title=&#123;item.text&#125; /&gt;</span></span><br><span class="line"><span class="xml">                ))&#125;</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">TabBar</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="配置二级路由"><a href="#配置二级路由" class="headerlink" title="配置二级路由"></a>配置二级路由</h2><h3 id="目标-1"><a href="#目标-1" class="headerlink" title="目标"></a>目标</h3><p>能够点击 Tab 栏实现二级路由切换的效果。</p>
<h3 id="素材-1"><a href="#素材-1" class="headerlink" title="素材"></a>素材</h3><h4 id="Home"><a href="#Home" class="headerlink" title="Home"></a>Home</h4><p><code>pages/Home/index.tsx</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&#x27;./index.module.scss&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Home = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;styles.root&#125;</span>&gt;</span>Home<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Home</span><br></pre></td></tr></table></figure>

<p><code>pages/Home/index.module.scss</code></p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.root</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Question"><a href="#Question" class="headerlink" title="Question"></a>Question</h4><p><code>pages/Question/index.tsx</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; NavBar &#125; <span class="keyword">from</span> <span class="string">&#x27;antd-mobile&#x27;</span></span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&#x27;./index.module.scss&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Question = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;styles.root&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">NavBar</span>&gt;</span>问答<span class="tag">&lt;/<span class="name">NavBar</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;question-list&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;question-item&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;left&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">h3</span>&gt;</span>作为 IT 行业的过来人，你有什么话想对后辈说的？<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;info&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                            <span class="tag">&lt;<span class="name">span</span>&gt;</span>赞同 1000+<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">                            <span class="tag">&lt;<span class="name">span</span>&gt;</span>评论 500+<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">                            <span class="tag">&lt;<span class="name">span</span>&gt;</span>1小时前<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;right&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&#x27;https://pic1.zhimg.com/80/v2-8e77b2771314f674cccba5581560d333_xl.jpg?source=4e949a73&#x27;</span> <span class="attr">alt</span>=<span class="string">&#x27;&#x27;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;question-item&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;left&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">h3</span>&gt;</span>作为 IT 行业的过来人，你有什么话想对后辈说的？<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;info&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                            <span class="tag">&lt;<span class="name">span</span>&gt;</span>赞同 1000+<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">                            <span class="tag">&lt;<span class="name">span</span>&gt;</span>评论 500+<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">                            <span class="tag">&lt;<span class="name">span</span>&gt;</span>1小时前<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;right&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&#x27;https://pic1.zhimg.com/80/v2-8e77b2771314f674cccba5581560d333_xl.jpg?source=4e949a73&#x27;</span> <span class="attr">alt</span>=<span class="string">&#x27;&#x27;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;question-item&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;left&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">h3</span>&gt;</span>作为 IT 行业的过来人，你有什么话想对后辈说的？<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;info&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                            <span class="tag">&lt;<span class="name">span</span>&gt;</span>赞同 1000+<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">                            <span class="tag">&lt;<span class="name">span</span>&gt;</span>评论 500+<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">                            <span class="tag">&lt;<span class="name">span</span>&gt;</span>1小时前<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;right&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&#x27;https://pic1.zhimg.com/80/v2-8e77b2771314f674cccba5581560d333_xl.jpg?source=4e949a73&#x27;</span> <span class="attr">alt</span>=<span class="string">&#x27;&#x27;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;question-item&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;left&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">h3</span>&gt;</span>作为 IT 行业的过来人，你有什么话想对后辈说的？<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;info&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                            <span class="tag">&lt;<span class="name">span</span>&gt;</span>赞同 1000+<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">                            <span class="tag">&lt;<span class="name">span</span>&gt;</span>评论 500+<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">                            <span class="tag">&lt;<span class="name">span</span>&gt;</span>1小时前<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;right&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&#x27;https://pic1.zhimg.com/80/v2-8e77b2771314f674cccba5581560d333_xl.jpg?source=4e949a73&#x27;</span> <span class="attr">alt</span>=<span class="string">&#x27;&#x27;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;question-item&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;left&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">h3</span>&gt;</span>作为 IT 行业的过来人，你有什么话想对后辈说的？<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;info&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                            <span class="tag">&lt;<span class="name">span</span>&gt;</span>赞同 1000+<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">                            <span class="tag">&lt;<span class="name">span</span>&gt;</span>评论 500+<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">                            <span class="tag">&lt;<span class="name">span</span>&gt;</span>1小时前<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;right&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&#x27;https://pic1.zhimg.com/80/v2-8e77b2771314f674cccba5581560d333_xl.jpg?source=4e949a73&#x27;</span> <span class="attr">alt</span>=<span class="string">&#x27;&#x27;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Question</span><br></pre></td></tr></table></figure>

<p><code>pages/Question/index.module.scss</code></p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@import</span> <span class="string">&#x27;@scss/hairline.scss&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.root</span> &#123;</span><br><span class="line">    :global &#123;</span><br><span class="line">        .question-list &#123;</span><br><span class="line">            padding: <span class="number">0</span> <span class="number">16px</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="selector-class">.question-item</span> &#123;</span><br><span class="line">            <span class="attribute">position</span>: relative;</span><br><span class="line">            <span class="attribute">display</span>: flex;</span><br><span class="line">            <span class="attribute">padding</span>: <span class="number">16px</span> <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">@include</span> hairline(bottom, <span class="number">#f0f0f0</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="selector-class">.left</span> &#123;</span><br><span class="line">            <span class="attribute">padding-right</span>: <span class="number">16px</span>;</span><br><span class="line"></span><br><span class="line">            <span class="selector-tag">h3</span> &#123;</span><br><span class="line">                <span class="attribute">margin-bottom</span>: <span class="number">16px</span>;</span><br><span class="line">                <span class="attribute">line-height</span>: <span class="number">1.4</span>;</span><br><span class="line">                <span class="attribute">font-size</span>: <span class="number">16px</span>;</span><br><span class="line">                <span class="attribute">font-weight</span>: normal;</span><br><span class="line"></span><br><span class="line">                <span class="attribute">display</span>: -webkit-box;</span><br><span class="line">                <span class="attribute">overflow</span>: hidden;</span><br><span class="line">                <span class="attribute">text-overflow</span>: ellipsis;</span><br><span class="line">                -webkit-line-clamp: <span class="number">2</span>;</span><br><span class="line">                -webkit-box-orient: vertical;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="selector-class">.info</span> &#123;</span><br><span class="line">                <span class="attribute">font-size</span>: <span class="number">12px</span>;</span><br><span class="line">                <span class="attribute">color</span>: <span class="number">#999</span>;</span><br><span class="line"></span><br><span class="line">                <span class="selector-tag">span</span> &#123;</span><br><span class="line">                    <span class="attribute">margin-right</span>: <span class="number">10px</span>;</span><br><span class="line">                    &amp;<span class="selector-pseudo">:last-child</span> &#123;</span><br><span class="line">                        <span class="attribute">margin-right</span>: <span class="number">0</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="selector-class">.right</span> &#123;</span><br><span class="line">            <span class="attribute">width</span>: <span class="number">114px</span>;</span><br><span class="line">            <span class="attribute">height</span>: <span class="number">78px</span>;</span><br><span class="line"></span><br><span class="line">            <span class="selector-tag">img</span> &#123;</span><br><span class="line">                <span class="attribute">width</span>: <span class="number">114px</span>;</span><br><span class="line">                <span class="attribute">height</span>: <span class="number">78px</span>;</span><br><span class="line">                <span class="attribute">border-radius</span>: <span class="number">4px</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Video"><a href="#Video" class="headerlink" title="Video"></a>Video</h4><p><code>pages/Video/index.tsx</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; NavBar &#125; <span class="keyword">from</span> <span class="string">&#x27;antd-mobile&#x27;</span></span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&#x27;./index.module.scss&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Video = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;styles.root&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">NavBar</span>&gt;</span>视频<span class="tag">&lt;/<span class="name">NavBar</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;video-list&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;video-item&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">h3</span> <span class="attr">className</span>=<span class="string">&#x27;title&#x27;</span>&gt;</span>格力电器将继续发展手机业务，并将向全产业覆盖！<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;play&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">video</span> <span class="attr">src</span>=<span class="string">&#x27;https://ips.ifeng.com/video19.ifeng.com/video09/2021/05/26/p6803231351488126976-102-8-161249.mp4?reqtype=tsl&amp;vid=2c791e3b-444e-4578-83e3-f4808228ae3b&amp;uid=0puFR4&amp;from=v_Free&amp;pver=vHTML5Player_v2.0.0&amp;sver=&amp;se=&amp;cat=&amp;ptype=&amp;platform=pc&amp;sourceType=h5&amp;dt=1622096387396&amp;gid=6a4poXmsep1E&amp;sign=39f76885daca6503ebf90acbfffc1ff1&amp;tm=1622096387396&#x27;</span>&gt;</span><span class="tag">&lt;/<span class="name">video</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">span</span>&gt;</span>1563次播放<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;video-item&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">h3</span> <span class="attr">className</span>=<span class="string">&#x27;title&#x27;</span>&gt;</span>你用上5G了吗？我国5G手机终端达3.1亿 占全球比例超80％<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;play&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">video</span> <span class="attr">src</span>=<span class="string">&#x27;https://ips.ifeng.com/video19.ifeng.com/video09/2021/05/26/p6803268684325330944-102-8-184104.mp4?reqtype=tsl&amp;vid=ec74b1e4-d1fa-488b-aaf5-71984ca7d13e&amp;uid=1Vun5L&amp;from=v_Free&amp;pver=vHTML5Player_v2.0.0&amp;sver=&amp;se=&amp;cat=&amp;ptype=&amp;platform=pc&amp;sourceType=h5&amp;dt=1622096310639&amp;gid=fg3vsXmseXFv&amp;sign=38e7c790561e1fd1b57e61a1cbd8031c&amp;tm=1622096310639&#x27;</span>&gt;</span><span class="tag">&lt;/<span class="name">video</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">span</span>&gt;</span>1563次播放<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Video</span><br></pre></td></tr></table></figure>

<p><code>pages/Video/index.module.scss</code></p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@import</span> <span class="string">&#x27;@scss/hairline.scss&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.root</span> &#123;</span><br><span class="line">    :global &#123;</span><br><span class="line">        .video-list &#123;</span><br><span class="line">            padding: <span class="number">0</span> <span class="number">16px</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="selector-class">.video-item</span> &#123;</span><br><span class="line">            <span class="attribute">position</span>: relative;</span><br><span class="line">            <span class="attribute">padding</span>: <span class="number">10px</span> <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">@include</span> hairline(bottom, <span class="number">#f0f0f0</span>);</span><br><span class="line"></span><br><span class="line">            <span class="selector-tag">span</span> &#123;</span><br><span class="line">                <span class="attribute">font-size</span>: <span class="number">12px</span>;</span><br><span class="line">                <span class="attribute">color</span>: <span class="number">#999</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="selector-class">.title</span> &#123;</span><br><span class="line">            <span class="attribute">line-height</span>: <span class="number">1.4</span>;</span><br><span class="line">            <span class="attribute">font-size</span>: <span class="number">16px</span>;</span><br><span class="line">            <span class="attribute">font-weight</span>: normal;</span><br><span class="line">            <span class="attribute">padding-bottom</span>: <span class="number">5px</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="selector-tag">video</span> &#123;</span><br><span class="line">            <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">            <span class="attribute">border-radius</span>: <span class="number">4px</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Profile"><a href="#Profile" class="headerlink" title="Profile"></a>Profile</h4><p><code>pages/Profile/index.tsx</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&#x27;./index.module.scss&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Profile = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;styles.root&#125;</span>&gt;</span>Profile<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Profile</span><br></pre></td></tr></table></figure>

<p><code>pages/Profile/index.module.scss</code></p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.root</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="步骤-1"><a href="#步骤-1" class="headerlink" title="步骤"></a>步骤</h3><ol>
<li><p>粘贴素材中【布局页面模板】文件夹中的 Home、Question、Video、Profile 到项目的 pages 目录。</p>
</li>
<li><p><code>pages/Layout/index.tsx</code> 文件中配置路由出口。</p>
</li>
</ol>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&#x27;./index.module.scss&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; TabBar &#125; <span class="keyword">from</span> <span class="string">&#x27;antd-mobile&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Icon <span class="keyword">from</span> <span class="string">&#x27;@/components/Icon&#x27;</span></span><br><span class="line"><span class="comment">// !#1</span></span><br><span class="line"><span class="keyword">import</span> &#123; useHistory, useLocation, Switch, Route &#125; <span class="keyword">from</span> <span class="string">&#x27;react-router-dom&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Home <span class="keyword">from</span> <span class="string">&#x27;@/pages/Home&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Question <span class="keyword">from</span> <span class="string">&#x27;@/pages/Question&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Video <span class="keyword">from</span> <span class="string">&#x27;@/pages/Video&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Profile <span class="keyword">from</span> <span class="string">&#x27;@/pages/Profile&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> tabs = [</span><br><span class="line">    &#123; <span class="attr">path</span>: <span class="string">&#x27;/home&#x27;</span>, <span class="attr">icon</span>: <span class="string">&#x27;iconbtn_home&#x27;</span>, <span class="attr">text</span>: <span class="string">&#x27;首页&#x27;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">path</span>: <span class="string">&#x27;/home/question&#x27;</span>, <span class="attr">icon</span>: <span class="string">&#x27;iconbtn_qa&#x27;</span>, <span class="attr">text</span>: <span class="string">&#x27;问答&#x27;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">path</span>: <span class="string">&#x27;/home/video&#x27;</span>, <span class="attr">icon</span>: <span class="string">&#x27;iconbtn_video&#x27;</span>, <span class="attr">text</span>: <span class="string">&#x27;视频&#x27;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">path</span>: <span class="string">&#x27;/home/profile&#x27;</span>, <span class="attr">icon</span>: <span class="string">&#x27;iconbtn_mine&#x27;</span>, <span class="attr">text</span>: <span class="string">&#x27;我的&#x27;</span> &#125;,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">Layout</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> history = useHistory()</span><br><span class="line">    <span class="keyword">const</span> location = useLocation()</span><br><span class="line">    <span class="keyword">const</span> changeRoute = <span class="function">(<span class="params">path: <span class="built_in">string</span></span>) =&gt;</span> &#123;</span><br><span class="line">        history.push(path)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;styles.root&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">            &#123;/* //!#2: 注意 Home 组件不要忘记加 exact */&#125;</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Switch</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&#x27;/home&#x27;</span> <span class="attr">exact</span> <span class="attr">component</span>=<span class="string">&#123;Home&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&#x27;/home/question&#x27;</span> <span class="attr">exact</span> <span class="attr">component</span>=<span class="string">&#123;Question&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&#x27;/home/video&#x27;</span> <span class="attr">exact</span> <span class="attr">component</span>=<span class="string">&#123;Video&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&#x27;/home/profile&#x27;</span> <span class="attr">exact</span> <span class="attr">component</span>=<span class="string">&#123;Profile&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">Switch</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">TabBar</span> <span class="attr">className</span>=<span class="string">&#x27;tab-bar&#x27;</span> <span class="attr">onChange</span>=<span class="string">&#123;changeRoute&#125;</span> <span class="attr">activeKey</span>=<span class="string">&#123;location.pathname&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                &#123;tabs.map((item) =&gt; (</span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">TabBar.Item</span> <span class="attr">key</span>=<span class="string">&#123;item.path&#125;</span> <span class="attr">icon</span>=<span class="string">&#123;(active:</span> <span class="attr">boolean</span>) =&gt;</span> <span class="tag">&lt;<span class="name">Icon</span> <span class="attr">type</span>=<span class="string">&#123;active</span> ? `$&#123;<span class="attr">item.icon</span>&#125;<span class="attr">_sel</span>` <span class="attr">:</span> <span class="attr">item.icon</span>&#125; /&gt;</span>&#125; title=&#123;item.text&#125; /&gt;</span></span><br><span class="line"><span class="xml">                ))&#125;</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">TabBar</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="渲染个人中心"><a href="#渲染个人中心" class="headerlink" title="渲染个人中心"></a>渲染个人中心</h2><h3 id="结构与样式"><a href="#结构与样式" class="headerlink" title="结构与样式"></a>结构与样式</h3><h4 id="目标-2"><a href="#目标-2" class="headerlink" title="目标"></a>目标</h4><p>能够根据模板搭建个人中心页面结构。</p>
<h4 id="步骤-2"><a href="#步骤-2" class="headerlink" title="步骤"></a>步骤</h4><p><code>pages/Profile/index.tsx</code>，直接粘贴下面结构与样式。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Link, useHistory &#125; <span class="keyword">from</span> <span class="string">&#x27;react-router-dom&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> Icon <span class="keyword">from</span> <span class="string">&#x27;@/components/Icon&#x27;</span></span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&#x27;./index.module.scss&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Profile = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> history = useHistory()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;styles.root&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;profile&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                &#123;/* 个人信息 */&#125;</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;user-info&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;avatar&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&#123;</span>&#x27;<span class="attr">http:</span>//<span class="attr">toutiao.itheima.net</span>/<span class="attr">images</span>/<span class="attr">user_head.jpg</span>&#x27;&#125; <span class="attr">alt</span>=<span class="string">&#x27;&#x27;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;user-name&#x27;</span>&gt;</span>黑马先锋<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">&#x27;/profile/edit&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        个人信息 <span class="tag">&lt;<span class="name">Icon</span> <span class="attr">type</span>=<span class="string">&#x27;iconbtn_right&#x27;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">                &#123;/* 今日阅读 */&#125;</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;read-info&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">Icon</span> <span class="attr">type</span>=<span class="string">&#x27;iconbtn_readingtime&#x27;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                    今日阅读</span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">span</span>&gt;</span>10<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    分钟</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">                &#123;/* 动态 - 对应的这一行 */&#125;</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;count-list&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;count-item&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">p</span>&gt;</span>1<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">p</span>&gt;</span>动态<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;count-item&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">p</span>&gt;</span>9<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">p</span>&gt;</span>关注<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;count-item&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">p</span>&gt;</span>99<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">p</span>&gt;</span>粉丝<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;count-item&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">p</span>&gt;</span>200<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">p</span>&gt;</span>被赞<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">                &#123;/* 消息通知 - 对应的这一行 */&#125;</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;user-links&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;link-item&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">Icon</span> <span class="attr">type</span>=<span class="string">&#x27;iconbtn_mymessages&#x27;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">div</span>&gt;</span>消息通知<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;link-item&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">Icon</span> <span class="attr">type</span>=<span class="string">&#x27;iconbtn_mycollect&#x27;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">div</span>&gt;</span>收藏<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;link-item&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">Icon</span> <span class="attr">type</span>=<span class="string">&#x27;iconbtn_history1&#x27;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">div</span>&gt;</span>浏览历史<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;link-item&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">Icon</span> <span class="attr">type</span>=<span class="string">&#x27;iconbtn_myworks&#x27;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">div</span>&gt;</span>我的作品<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            &#123;/* 更多服务 */&#125;</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;more-service&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">h3</span>&gt;</span>更多服务<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;service-list&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;service-item&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">Icon</span> <span class="attr">type</span>=<span class="string">&#x27;iconbtn_feedback&#x27;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">div</span>&gt;</span>用户反馈<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;service-item&#x27;</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> history.push(&#x27;/chat&#x27;)&#125;&gt;</span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">Icon</span> <span class="attr">type</span>=<span class="string">&#x27;iconbtn_xiaozhitongxue&#x27;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">div</span>&gt;</span>小智同学<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Profile</span><br></pre></td></tr></table></figure>

<p><code>pages/Profile/index.module.scss</code></p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.root</span> &#123;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#f8f8f8</span>;</span><br><span class="line"></span><br><span class="line">    :global &#123;</span><br><span class="line">        .profile &#123;</span><br><span class="line">            height: <span class="number">299px</span>;</span><br><span class="line">            <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">15px</span>;</span><br><span class="line">            <span class="attribute">border-bottom-left-radius</span>: <span class="number">500px</span> <span class="number">120px</span>;</span><br><span class="line">            <span class="attribute">border-bottom-right-radius</span>: <span class="number">500px</span> <span class="number">120px</span>;</span><br><span class="line">            <span class="attribute">background</span>: linear-gradient(<span class="number">318deg</span>, <span class="number">#b2b5db</span> <span class="number">2%</span>, <span class="number">#565482</span> <span class="number">85%</span>, <span class="number">#494675</span> <span class="number">97%</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="selector-class">.user-info</span> &#123;</span><br><span class="line">            <span class="attribute">display</span>: flex;</span><br><span class="line">            <span class="attribute">align-items</span>: center;</span><br><span class="line">            <span class="attribute">padding</span>: <span class="number">40px</span> <span class="number">0</span> <span class="number">15px</span>;</span><br><span class="line"></span><br><span class="line">            <span class="selector-class">.user-name</span> &#123;</span><br><span class="line">                <span class="attribute">flex</span>: <span class="number">1</span>;</span><br><span class="line">                <span class="attribute">margin-left</span>: <span class="number">18px</span>;</span><br><span class="line">                <span class="attribute">font-size</span>: <span class="number">24px</span>;</span><br><span class="line">                <span class="attribute">font-weight</span>: <span class="number">400</span>;</span><br><span class="line">                <span class="attribute">color</span>: <span class="number">#fff</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="selector-tag">a</span> &#123;</span><br><span class="line">                <span class="attribute">line-height</span>: <span class="number">16px</span>;</span><br><span class="line">                <span class="attribute">color</span>: <span class="number">#fff</span>;</span><br><span class="line">                <span class="attribute">font-size</span>: <span class="number">12px</span>;</span><br><span class="line">                <span class="attribute">text-decoration</span>: none;</span><br><span class="line"></span><br><span class="line">                &amp;<span class="selector-pseudo">:visited</span> &#123;</span><br><span class="line">                    <span class="attribute">color</span>: <span class="number">#fff</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="selector-class">.icon</span> &#123;</span><br><span class="line">                <span class="attribute">width</span>: <span class="number">9px</span>;</span><br><span class="line">                <span class="attribute">height</span>: <span class="number">16px</span>;</span><br><span class="line">                <span class="attribute">vertical-align</span>: middle;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="selector-class">.avatar</span> &#123;</span><br><span class="line">            <span class="attribute">width</span>: <span class="number">50px</span>;</span><br><span class="line">            <span class="attribute">height</span>: <span class="number">50px</span>;</span><br><span class="line">            <span class="attribute">border</span>: <span class="number">3px</span> solid rgba(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0.16</span>);</span><br><span class="line">            <span class="attribute">border-radius</span>: <span class="number">50%</span>;</span><br><span class="line">            <span class="attribute">overflow</span>: hidden;</span><br><span class="line"></span><br><span class="line">            <span class="selector-tag">img</span> &#123;</span><br><span class="line">                <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">                <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">                <span class="selector-tag">object</span>-fit: cover;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="selector-class">.read-info</span> &#123;</span><br><span class="line">            <span class="attribute">display</span>: flex;</span><br><span class="line">            <span class="attribute">align-items</span>: center;</span><br><span class="line">            <span class="attribute">width</span>: fit-content;</span><br><span class="line">            <span class="attribute">height</span>: <span class="number">30px</span>;</span><br><span class="line">            <span class="attribute">padding</span>: <span class="number">5px</span> <span class="number">8px</span> <span class="number">5px</span> <span class="number">5px</span>;</span><br><span class="line">            <span class="attribute">border-radius</span>: <span class="number">15px</span>;</span><br><span class="line">            <span class="attribute">font-size</span>: <span class="number">12px</span>;</span><br><span class="line">            <span class="attribute">color</span>: <span class="number">#f7f8fa</span>;</span><br><span class="line">            <span class="attribute">background</span>: linear-gradient(<span class="number">319deg</span>, <span class="number">#585089</span> <span class="number">0%</span>, <span class="number">#2c2a6b</span> <span class="number">98%</span>);</span><br><span class="line"></span><br><span class="line">            <span class="selector-class">.icon</span> &#123;</span><br><span class="line">                <span class="attribute">margin-right</span>: <span class="number">5px</span>;</span><br><span class="line">                <span class="attribute">font-size</span>: <span class="number">20px</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="selector-tag">span</span> &#123;</span><br><span class="line">                <span class="attribute">display</span>: inline-block;</span><br><span class="line">                <span class="attribute">margin</span>: <span class="number">0</span> <span class="number">3px</span>;</span><br><span class="line">                <span class="attribute">font-size</span>: <span class="number">18px</span>;</span><br><span class="line">                <span class="attribute">font-weight</span>: bold;</span><br><span class="line">                <span class="attribute">color</span>: <span class="number">#ffbc3d</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="selector-class">.count-list</span> &#123;</span><br><span class="line">            <span class="attribute">display</span>: flex;</span><br><span class="line">            <span class="attribute">justify-content</span>: space-between;</span><br><span class="line">            <span class="attribute">padding</span>: <span class="number">20px</span> <span class="number">0</span> <span class="number">15px</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">            <span class="selector-class">.count-item</span> &#123;</span><br><span class="line">                <span class="attribute">flex</span>: <span class="number">1</span>;</span><br><span class="line">                <span class="attribute">text-align</span>: center;</span><br><span class="line">                <span class="attribute">font-size</span>: <span class="number">13px</span>;</span><br><span class="line">                <span class="attribute">color</span>: <span class="number">#fff</span>;</span><br><span class="line"></span><br><span class="line">                <span class="selector-tag">p</span> &#123;</span><br><span class="line">                    &amp;<span class="selector-pseudo">:first</span>-child &#123;</span><br><span class="line">                        <span class="attribute">height</span>: <span class="number">14px</span>;</span><br><span class="line">                        <span class="attribute">margin-bottom</span>: <span class="number">6px</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="selector-class">.user-links</span> &#123;</span><br><span class="line">            <span class="attribute">display</span>: flex;</span><br><span class="line"></span><br><span class="line">            <span class="attribute">padding</span>: <span class="number">20px</span> <span class="number">0</span>;</span><br><span class="line">            <span class="attribute">font-size</span>: <span class="number">12px</span>;</span><br><span class="line">            <span class="attribute">text-align</span>: center;</span><br><span class="line">            <span class="attribute">background-color</span>: <span class="number">#fff</span>;</span><br><span class="line">            <span class="attribute">border-radius</span>: <span class="number">10px</span>;</span><br><span class="line">            <span class="attribute">color</span>: <span class="number">#333</span>;</span><br><span class="line"></span><br><span class="line">            <span class="selector-class">.link-item</span> &#123;</span><br><span class="line">                <span class="attribute">flex</span>: <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="selector-class">.icon</span> &#123;</span><br><span class="line">                <span class="attribute">margin-bottom</span>: <span class="number">11px</span>;</span><br><span class="line">                <span class="attribute">font-size</span>: <span class="number">23px</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="selector-class">.more-service</span> &#123;</span><br><span class="line">            <span class="comment">// height: 120px;</span></span><br><span class="line">            <span class="attribute">margin</span>: <span class="number">11px</span> <span class="number">16px</span> <span class="number">0</span> <span class="number">16px</span>;</span><br><span class="line">            <span class="attribute">border-radius</span>: <span class="number">10px</span>;</span><br><span class="line">            <span class="attribute">background-color</span>: <span class="number">#fff</span>;</span><br><span class="line"></span><br><span class="line">            <span class="selector-tag">h3</span> &#123;</span><br><span class="line">                <span class="attribute">padding</span>: <span class="number">15px</span>;</span><br><span class="line">                <span class="attribute">font-size</span>: <span class="number">17px</span>;</span><br><span class="line">                <span class="attribute">color</span>: <span class="number">#333</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="selector-class">.service-list</span> &#123;</span><br><span class="line">                <span class="attribute">display</span>: flex;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="selector-class">.service-item</span> &#123;</span><br><span class="line">                <span class="attribute">width</span>: <span class="number">25%</span>;</span><br><span class="line">                <span class="attribute">padding-bottom</span>: <span class="number">20px</span>;</span><br><span class="line">                <span class="attribute">text-align</span>: center;</span><br><span class="line">                <span class="attribute">font-size</span>: <span class="number">13px</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="selector-class">.icon</span> &#123;</span><br><span class="line">                <span class="attribute">margin-bottom</span>: <span class="number">11px</span>;</span><br><span class="line">                <span class="attribute">font-size</span>: <span class="number">22px</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="获取用户信息"><a href="#获取用户信息" class="headerlink" title="获取用户信息"></a>获取用户信息</h3><h4 id="目标-3"><a href="#目标-3" class="headerlink" title="目标"></a>目标</h4><p>完成获取用户信息的功能。</p>
<h4 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h4><ol>
<li><p>先按照接口的返回数据，准备 TS 类型。</p>
</li>
<li><p>然后，在发送请求时，指定该请求的返回值类型。</p>
</li>
<li><p>在接下来的操作中，如果需要用到接口的数据，都会有类型提示了。</p>
</li>
</ol>
<p><code>types/data.d.ts</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> User = &#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="built_in">string</span></span><br><span class="line">    <span class="attr">name</span>: <span class="built_in">string</span></span><br><span class="line">    <span class="attr">photo</span>: <span class="built_in">string</span></span><br><span class="line">    <span class="attr">art_count</span>: <span class="built_in">number</span></span><br><span class="line">    <span class="attr">follow_count</span>: <span class="built_in">number</span></span><br><span class="line">    <span class="attr">fans_count</span>: <span class="built_in">number</span></span><br><span class="line">    <span class="attr">like_count</span>: <span class="built_in">number</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="步骤-3"><a href="#步骤-3" class="headerlink" title="步骤"></a>步骤</h4><ol>
<li>定义 action。</li>
</ol>
<p><code>actions/profile.ts</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ApiResponse, User &#125; <span class="keyword">from</span> <span class="string">&#x27;@/types/data&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; RootThunkAction &#125; <span class="keyword">from</span> <span class="string">&#x27;@/types/store&#x27;</span></span><br><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">getUser</span>(<span class="params"></span>): <span class="title">RootThunkAction</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">async</span> (dispatch) =&gt; &#123;</span><br><span class="line">        <span class="keyword">const</span> res = <span class="keyword">await</span> request.get&lt;ApiResponse&lt;User&gt;&gt;(<span class="string">&#x27;/user&#x27;</span>)</span><br><span class="line">        <span class="built_in">console</span>.log(res)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>触发 action。</li>
</ol>
<p><code>pages/Profile/index.tsx</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; Link, useHistory &#125; <span class="keyword">from</span> <span class="string">&#x27;react-router-dom&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useDispatch &#125; <span class="keyword">from</span> <span class="string">&#x27;react-redux&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Icon <span class="keyword">from</span> <span class="string">&#x27;@/components/Icon&#x27;</span></span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&#x27;./index.module.scss&#x27;</span></span><br><span class="line"><span class="comment">// !#1</span></span><br><span class="line"><span class="keyword">import</span> &#123; getUser &#125; <span class="keyword">from</span> <span class="string">&#x27;@/store/actions/profile&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Profile = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> history = useHistory()</span><br><span class="line">    <span class="keyword">const</span> dispatch = useDispatch()</span><br><span class="line">    <span class="comment">// !#2</span></span><br><span class="line">    useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        dispatch(getUser())</span><br><span class="line">    &#125;, [dispatch])</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Profile</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>配置请求拦截器统一携带 Token。</li>
</ol>
<p><code>utils/request.ts</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">request.interceptors.request.use(</span><br><span class="line">    <span class="function"><span class="keyword">function</span> (<span class="params">config</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">const</span> token = getToken().token</span><br><span class="line">        <span class="keyword">if</span> (token) &#123;</span><br><span class="line">            config.headers!.Authorization = <span class="string">`Bearer <span class="subst">$&#123;token&#125;</span>`</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> config</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error)</span><br><span class="line">    &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h3 id="存储用户信息到-Redux"><a href="#存储用户信息到-Redux" class="headerlink" title="存储用户信息到 Redux"></a>存储用户信息到 Redux</h3><h4 id="目标-4"><a href="#目标-4" class="headerlink" title="目标"></a>目标</h4><p>能够将用户信息保存到 Redux 中。</p>
<h4 id="代码-1"><a href="#代码-1" class="headerlink" title="代码"></a>代码</h4><ol>
<li>准备保存状态到 Redux 的 action 类型。</li>
</ol>
<p><code>types/store.d.ts</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;@/store&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; ThunkAction &#125; <span class="keyword">from</span> <span class="string">&#x27;redux-thunk&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; Token &#125; <span class="keyword">from</span> <span class="string">&#x27;./data&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 各个默认的 action</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> LoginAction = &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;login/login&#x27;</span></span><br><span class="line">    <span class="attr">payload</span>: Token</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// #1</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> ProfileAction = &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;profile/getUser&#x27;</span></span><br><span class="line">    <span class="attr">payload</span>: User</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// store 的 state 的类型</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> RootState = ReturnType&lt;<span class="keyword">typeof</span> store.getState&gt;</span><br><span class="line"><span class="comment">// 所有的 action 的类型</span></span><br><span class="line"><span class="comment">// #2</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> RootAction = LoginAction | ProfileAction</span><br><span class="line"><span class="comment">// thunkAction 类型</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> RootThunkAction = ThunkAction&lt;<span class="built_in">void</span>, RootState, unknown, RootAction&gt;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>在获取个人信息的 action 中将用户信息存储到 Redux 中。</li>
</ol>
<p><code>actions/profile.ts</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ApiResponse, User &#125; <span class="keyword">from</span> <span class="string">&#x27;@/types/data&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; RootThunkAction &#125; <span class="keyword">from</span> <span class="string">&#x27;@/types/store&#x27;</span></span><br><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">getUser</span>(<span class="params"></span>): <span class="title">RootThunkAction</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">async</span> (dispatch) =&gt; &#123;</span><br><span class="line">        <span class="keyword">const</span> res = <span class="keyword">await</span> request.get&lt;ApiResponse&lt;User&gt;&gt;(<span class="string">&#x27;/user&#x27;</span>)</span><br><span class="line">        <span class="keyword">const</span> &#123; data &#125; = res.data</span><br><span class="line">        dispatch(&#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;profile/getUser&#x27;</span>,</span><br><span class="line">            <span class="attr">payload</span>: data,</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>创建 <code>reducers/profile.ts</code>，并完成存储用户信息的功能。</li>
</ol>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; User &#125; <span class="keyword">from</span> <span class="string">&#x27;@/types/data&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; ProfileAction &#125; <span class="keyword">from</span> <span class="string">&#x27;@/types/store&#x27;</span></span><br><span class="line"><span class="keyword">type</span> ProfileState = &#123; <span class="attr">user</span>: User &#125;</span><br><span class="line"><span class="keyword">const</span> initState = &#123; <span class="attr">user</span>: &#123;&#125; &#125; <span class="keyword">as</span> ProfileState <span class="comment">// 建议再加一个 `user: &#123;&#125;`，防止后面报错</span></span><br><span class="line"><span class="comment">// const initState: ProfileState = &#123; user: &#123;&#125; &#125; as ProfileState // 建议再加一个 `user: &#123;&#125;`，防止后面报错</span></span><br><span class="line"><span class="comment">// const initState: ProfileState = &#123; user: &#123;&#125; as User &#125; // 也 ok</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> profile = (state = initState, <span class="attr">action</span>: ProfileAction): <span class="function"><span class="params">ProfileState</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">switch</span> (action.type) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;profile/getUser&#x27;</span>:</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                ...state,</span><br><span class="line">                <span class="attr">user</span>: action.payload,</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="attr">default</span>:</span><br><span class="line">            <span class="keyword">return</span> state</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> profile</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>合并 profileReducer 到 rootReducer。</li>
</ol>
<p><code>reducers/index.ts</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; combineReducers &#125; <span class="keyword">from</span> <span class="string">&#x27;redux&#x27;</span></span><br><span class="line"><span class="keyword">import</span> login <span class="keyword">from</span> <span class="string">&#x27;./login&#x27;</span></span><br><span class="line"><span class="keyword">import</span> profile <span class="keyword">from</span> <span class="string">&#x27;./profile&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> combineReducers(&#123; login, profile &#125;)</span><br></pre></td></tr></table></figure>

<h3 id="渲染用户信息"><a href="#渲染用户信息" class="headerlink" title="渲染用户信息"></a>渲染用户信息</h3><h4 id="目标-5"><a href="#目标-5" class="headerlink" title="目标"></a>目标</h4><p>能够展示用户信息到界面。</p>
<h4 id="步骤-4"><a href="#步骤-4" class="headerlink" title="步骤"></a>步骤</h4><ol>
<li><p>导入 useSelector。</p>
</li>
<li><p>调用 useSelector 获取 user 状态。</p>
</li>
<li><p>从 user 对象中解构出用户数据并展示在页面中。</p>
</li>
</ol>
<h4 id="代码-2"><a href="#代码-2" class="headerlink" title="代码"></a>代码</h4><p><code>pages/Profile/index.tsx</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; Link, useHistory &#125; <span class="keyword">from</span> <span class="string">&#x27;react-router-dom&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useDispatch, useSelector &#125; <span class="keyword">from</span> <span class="string">&#x27;react-redux&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Icon <span class="keyword">from</span> <span class="string">&#x27;@/components/Icon&#x27;</span></span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&#x27;./index.module.scss&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; getUser &#125; <span class="keyword">from</span> <span class="string">&#x27;@/store/actions/profile&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; RootState &#125; <span class="keyword">from</span> <span class="string">&#x27;@/types/store&#x27;</span></span><br><span class="line"><span class="keyword">const</span> Profile = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> history = useHistory()</span><br><span class="line">    <span class="keyword">const</span> dispatch = useDispatch()</span><br><span class="line">    <span class="keyword">const</span> user = useSelector(<span class="function">(<span class="params">state: RootState</span>) =&gt;</span> state.profile.user)</span><br><span class="line">    useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        dispatch(getUser())</span><br><span class="line">    &#125;, [dispatch])</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;styles.root&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;profile&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                &#123;/* 个人信息 */&#125;</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;user-info&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;avatar&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&#123;user.photo&#125;</span> <span class="attr">alt</span>=<span class="string">&#x27;&#x27;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;user-name&#x27;</span>&gt;</span>&#123;user.name&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">&#x27;/profile/edit&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        个人信息 <span class="tag">&lt;<span class="name">Icon</span> <span class="attr">type</span>=<span class="string">&#x27;iconbtn_right&#x27;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">                &#123;/* 今日阅读 */&#125;</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;read-info&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">Icon</span> <span class="attr">type</span>=<span class="string">&#x27;iconbtn_readingtime&#x27;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                    今日阅读</span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">span</span>&gt;</span>10<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    分钟</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">                &#123;/* 动态 - 对应的这一行 */&#125;</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;count-list&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;count-item&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;user.art_count&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">p</span>&gt;</span>动态<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;count-item&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;user.follow_count&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">p</span>&gt;</span>关注<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;count-item&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;user.fans_count&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">p</span>&gt;</span>粉丝<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;count-item&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;user.like_count&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">p</span>&gt;</span>被赞<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">                &#123;/* 消息通知 - 对应的这一行 */&#125;</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;user-links&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;link-item&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">Icon</span> <span class="attr">type</span>=<span class="string">&#x27;iconbtn_mymessages&#x27;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">div</span>&gt;</span>消息通知<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;link-item&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">Icon</span> <span class="attr">type</span>=<span class="string">&#x27;iconbtn_mycollect&#x27;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">div</span>&gt;</span>收藏<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;link-item&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">Icon</span> <span class="attr">type</span>=<span class="string">&#x27;iconbtn_history1&#x27;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">div</span>&gt;</span>浏览历史<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;link-item&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">Icon</span> <span class="attr">type</span>=<span class="string">&#x27;iconbtn_myworks&#x27;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">div</span>&gt;</span>我的作品<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            &#123;/* 更多服务 */&#125;</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;more-service&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">h3</span>&gt;</span>更多服务<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;service-list&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;service-item&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">Icon</span> <span class="attr">type</span>=<span class="string">&#x27;iconbtn_feedback&#x27;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">div</span>&gt;</span>用户反馈<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;service-item&#x27;</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> history.push(&#x27;/chat&#x27;)&#125;&gt;</span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">Icon</span> <span class="attr">type</span>=<span class="string">&#x27;iconbtn_xiaozhitongxue&#x27;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">div</span>&gt;</span>小智同学<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Profile</span><br></pre></td></tr></table></figure>

<h2 id="渲染个人信息"><a href="#渲染个人信息" class="headerlink" title="渲染个人信息"></a>渲染个人信息</h2><h3 id="页面结构"><a href="#页面结构" class="headerlink" title="页面结构"></a>页面结构</h3><h4 id="素材-2"><a href="#素材-2" class="headerlink" title="素材"></a>素材</h4><p>将【个人中心模板】中的 Edit 文件夹拷贝到 Profile 项目的目录中。</p>
<p><code>pages/Profile/Edit/index.tsx</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Button, List, DatePicker, NavBar &#125; <span class="keyword">from</span> <span class="string">&#x27;antd-mobile&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useHistory &#125; <span class="keyword">from</span> <span class="string">&#x27;react-router-dom&#x27;</span></span><br><span class="line"><span class="keyword">import</span> classNames <span class="keyword">from</span> <span class="string">&#x27;classnames&#x27;</span></span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&#x27;./index.module.scss&#x27;</span></span><br><span class="line"><span class="keyword">const</span> Item = List.Item</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ProfileEdit = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> history = useHistory()</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;styles.root&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;content&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                &#123;/* 标题 */&#125;</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">NavBar</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                    <span class="attr">style</span>=<span class="string">&#123;&#123;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                        &#x27;<span class="attr">--border-bottom</span>&#x27;<span class="attr">:</span> &#x27;<span class="attr">1px</span> <span class="attr">solid</span> #<span class="attr">F0F0F0</span>&#x27;,</span></span></span><br><span class="line"><span class="tag"><span class="xml">                    &#125;&#125;</span></span></span><br><span class="line"><span class="tag"><span class="xml">                    <span class="attr">onBack</span>=<span class="string">&#123;()</span> =&gt;</span> history.go(-1)&#125;</span></span><br><span class="line"><span class="xml">                &gt;</span></span><br><span class="line"><span class="xml">                    个人信息</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">NavBar</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;wrapper&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    &#123;/* 列表 */&#125;</span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">List</span> <span class="attr">className</span>=<span class="string">&#x27;profile-list&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        &#123;/* 列表项 */&#125;</span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">Item</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                            <span class="attr">extra</span>=<span class="string">&#123;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                                &lt;<span class="attr">span</span> <span class="attr">className</span>=<span class="string">&#x27;avatar-wrapper&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                                    <span class="tag">&lt;<span class="name">img</span> <span class="attr">width</span>=<span class="string">&#123;24&#125;</span> <span class="attr">height</span>=<span class="string">&#123;24&#125;</span> <span class="attr">src</span>=<span class="string">&#123;</span>&#x27;<span class="attr">http:</span>//<span class="attr">toutiao.itheima.net</span>/<span class="attr">images</span>/<span class="attr">user_head.jpg</span>&#x27;&#125; <span class="attr">alt</span>=<span class="string">&#x27;&#x27;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                                <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">                            &#125;</span></span><br><span class="line"><span class="xml">                            arrow</span></span><br><span class="line"><span class="xml">                        &gt;</span></span><br><span class="line"><span class="xml">                            头像</span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;/<span class="name">Item</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">Item</span> <span class="attr">arrow</span> <span class="attr">extra</span>=<span class="string">&#123;</span>&#x27;黑马先锋&#x27;&#125;&gt;</span></span></span><br><span class="line"><span class="xml">                            昵称</span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;/<span class="name">Item</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">Item</span> <span class="attr">arrow</span> <span class="attr">extra</span>=<span class="string">&#123;</span>&lt;<span class="attr">span</span> <span class="attr">className</span>=<span class="string">&#123;classNames(</span>&#x27;<span class="attr">intro</span>&#x27;, &#x27;<span class="attr">normal</span>&#x27;)&#125;&gt;</span>&#123;&#x27;未填写&#x27;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span>&#125;&gt;</span></span><br><span class="line"><span class="xml">                            简介</span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;/<span class="name">Item</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">List</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">List</span> <span class="attr">className</span>=<span class="string">&#x27;profile-list&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">Item</span> <span class="attr">arrow</span> <span class="attr">extra</span>=<span class="string">&#123;</span>&#x27;男&#x27;&#125;&gt;</span></span></span><br><span class="line"><span class="xml">                            性别</span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;/<span class="name">Item</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">Item</span> <span class="attr">arrow</span> <span class="attr">extra</span>=<span class="string">&#123;</span>&#x27;<span class="attr">1999-9-9</span>&#x27;&#125;&gt;</span></span></span><br><span class="line"><span class="xml">                            生日</span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;/<span class="name">Item</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">List</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">DatePicker</span> <span class="attr">visible</span>=<span class="string">&#123;false&#125;</span> <span class="attr">value</span>=<span class="string">&#123;new</span> <span class="attr">Date</span>()&#125; <span class="attr">title</span>=<span class="string">&#x27;选择年月日&#x27;</span> <span class="attr">min</span>=<span class="string">&#123;new</span> <span class="attr">Date</span>(<span class="attr">1900</span>, <span class="attr">0</span>, <span class="attr">1</span>, <span class="attr">0</span>, <span class="attr">0</span>, <span class="attr">0</span>)&#125; <span class="attr">max</span>=<span class="string">&#123;new</span> <span class="attr">Date</span>()&#125; /&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;logout&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">Button</span> <span class="attr">className</span>=<span class="string">&#x27;btn&#x27;</span>&gt;</span>退出登录<span class="tag">&lt;/<span class="name">Button</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> ProfileEdit</span><br></pre></td></tr></table></figure>

<p><code>pages/Profile/Edit/index.module.scss</code></p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.root</span> &#123;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line"></span><br><span class="line">    :global &#123;</span><br><span class="line">        .content &#123;</span><br><span class="line">            position: relative;</span><br><span class="line">            <span class="attribute">z-index</span>: <span class="number">1</span>;</span><br><span class="line">            <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="selector-class">.wrapper</span> &#123;</span><br><span class="line">            <span class="attribute">background-color</span>: <span class="number">#f7f8fa</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="selector-class">.profile-list</span> &#123;</span><br><span class="line">            <span class="attribute">font-size</span>: <span class="number">14px</span>;</span><br><span class="line"></span><br><span class="line">            <span class="selector-class">.adm-list-item</span> &#123;</span><br><span class="line">                <span class="attribute">padding-left</span>: <span class="number">17px</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="selector-class">.adm-list-item-content-extra</span> &#123;</span><br><span class="line">                <span class="attribute">padding-right</span>: <span class="number">13px</span>;</span><br><span class="line">                <span class="attribute">color</span>: <span class="number">#3a3948</span>;</span><br><span class="line"></span><br><span class="line">                <span class="selector-class">.avatar-wrapper</span> &#123;</span><br><span class="line">                    <span class="attribute">display</span>: inline-block;</span><br><span class="line">                    <span class="attribute">border-radius</span>: <span class="number">50%</span>;</span><br><span class="line">                    <span class="attribute">overflow</span>: hidden;</span><br><span class="line">                    <span class="attribute">vertical-align</span>: middle;</span><br><span class="line"></span><br><span class="line">                    <span class="selector-tag">img</span> &#123;</span><br><span class="line">                        <span class="attribute">display</span>: block;</span><br><span class="line">                        <span class="selector-tag">object</span>-fit: cover;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="selector-class">.intro</span> &#123;</span><br><span class="line">                    <span class="attribute">color</span>: <span class="number">#c8c9cc</span>;</span><br><span class="line"></span><br><span class="line">                    &amp;<span class="selector-class">.normal</span> &#123;</span><br><span class="line">                        <span class="attribute">color</span>: <span class="number">#3a3948</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="selector-class">.adm-list-item-content-arrow</span> &#123;</span><br><span class="line">                <span class="attribute">padding-left</span>: <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            &amp;<span class="selector-pseudo">:nth-child</span>(<span class="number">2</span>) &#123;</span><br><span class="line">                <span class="attribute">margin-top</span>: <span class="number">12px</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="selector-class">.logout</span> &#123;</span><br><span class="line">            <span class="attribute">position</span>: absolute;</span><br><span class="line">            <span class="attribute">bottom</span>: <span class="number">60px</span>;</span><br><span class="line">            <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">            <span class="attribute">height</span>: <span class="number">44px</span>;</span><br><span class="line">            <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">16px</span>;</span><br><span class="line"></span><br><span class="line">            <span class="selector-class">.btn</span> &#123;</span><br><span class="line">                <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">                <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">                <span class="attribute">border-radius</span>: <span class="number">4px</span>;</span><br><span class="line">                <span class="attribute">color</span>: <span class="number">#fff</span>;</span><br><span class="line">                <span class="attribute">font-size</span>: <span class="number">16px</span>;</span><br><span class="line">                <span class="attribute">background</span>: linear-gradient(<span class="number">315deg</span>, <span class="number">#fe4f4f</span>, <span class="number">#fc6627</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// popup 不在当前组件结构中，因此，只能设置全局样式</span></span><br><span class="line">:global &#123;</span><br><span class="line">    .adm-picker-popup-body &#123;</span><br><span class="line">        .adm-picker-popup-header &#123;</span><br><span class="line">            background-size: <span class="number">0</span>;</span><br><span class="line">            &amp;<span class="selector-pseudo">::after</span> &#123;</span><br><span class="line">                <span class="attribute">display</span>: none <span class="meta">!important</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="selector-class">.adm-picker-header</span> &#123;</span><br><span class="line">        <span class="selector-class">.adm-picker-header-button</span> &#123;</span><br><span class="line">            <span class="attribute">font-size</span>: <span class="number">14px</span>;</span><br><span class="line">            <span class="attribute">color</span>: <span class="number">#969799</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="selector-class">.adm-picker-header-button</span><span class="selector-pseudo">:nth-last-child</span>(<span class="number">1</span>) &#123;</span><br><span class="line">            <span class="attribute">color</span>: <span class="number">#fc6627</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="步骤-5"><a href="#步骤-5" class="headerlink" title="步骤"></a>步骤</h4><ol>
<li>在 <code>App.tsx</code> 中配置个人信息页面的路由。</li>
</ol>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Route path=<span class="string">&#x27;/profile/edit&#x27;</span> component=&#123;ProfileEdit&#125; /&gt;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><code>App.scss</code> 中调整下字体大小。</li>
</ol>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.app</span> &#123;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="selector-class">.adm-list-default</span> &#123;</span><br><span class="line">        <span class="attribute">border</span>: none;</span><br><span class="line">        <span class="attribute">font-size</span>: <span class="number">16px</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="selector-class">.adm-nav-bar-title</span> &#123;</span><br><span class="line">        <span class="attribute">font-size</span>: <span class="number">17px</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="selector-class">.adm-nav-bar-back-arrow</span> &#123;</span><br><span class="line">        <span class="attribute">font-size</span>: <span class="number">17px</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="获取并渲染"><a href="#获取并渲染" class="headerlink" title="获取并渲染"></a>获取并渲染</h3><ol>
<li>在 <code>types/data.d.ts</code> 中，根据接口准备好返回数据类型。</li>
</ol>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> UserProfile = &#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="built_in">string</span></span><br><span class="line">    <span class="attr">photo</span>: <span class="built_in">string</span></span><br><span class="line">    <span class="attr">name</span>: <span class="built_in">string</span></span><br><span class="line">    <span class="attr">mobile</span>: <span class="built_in">string</span></span><br><span class="line">    <span class="attr">gender</span>: <span class="built_in">number</span></span><br><span class="line">    <span class="attr">birthday</span>: <span class="built_in">string</span></span><br><span class="line">    <span class="attr">intro</span>: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>在 <code>types/store.d.ts</code> 中创建相应的 Redux action 类型。</li>
</ol>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;@/store&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; ThunkAction &#125; <span class="keyword">from</span> <span class="string">&#x27;redux-thunk&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; Token &#125; <span class="keyword">from</span> <span class="string">&#x27;./data&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> LoginAction = &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;login/login&#x27;</span></span><br><span class="line">    <span class="attr">payload</span>: Token</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// #mark</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> ProfileAction =</span><br><span class="line">    | &#123;</span><br><span class="line">          <span class="attr">type</span>: <span class="string">&#x27;profile/getUser&#x27;</span></span><br><span class="line">          <span class="attr">payload</span>: User</span><br><span class="line">      &#125;</span><br><span class="line">    | &#123;</span><br><span class="line">          <span class="attr">type</span>: <span class="string">&#x27;profile/getUserProfile&#x27;</span></span><br><span class="line">          <span class="attr">payload</span>: UserProfile</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> RootState = ReturnType&lt;<span class="keyword">typeof</span> store.getState&gt;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> RootAction = LoginAction | ProfileAction</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> RootThunkAction = ThunkAction&lt;<span class="built_in">void</span>, RootState, unknown, RootAction&gt;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>在 <code>actions/profile.ts</code> 中，创建获取编辑时的个人信息的 action 并进行 dispatch。</li>
</ol>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getUserProfile = (): <span class="function"><span class="params">RootThunkAction</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">async</span> (dispatch) =&gt; &#123;</span><br><span class="line">        <span class="keyword">const</span> res = <span class="keyword">await</span> request.get&lt;ApiResponse&lt;UserProfile&gt;&gt;(<span class="string">&#x27;/user/profile&#x27;</span>)</span><br><span class="line">        dispatch(&#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;profile/getUserProfile&#x27;</span>,</span><br><span class="line">            <span class="attr">payload</span>: res.data.data,</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>在 reducers 中处理该 action，并将状态存储到 Redux 中。</li>
</ol>
<p><code>reducers/profile.ts</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// #1</span></span><br><span class="line"><span class="keyword">import</span> &#123; User, UserProfile &#125; <span class="keyword">from</span> <span class="string">&#x27;@/types/data&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; ProfileAction &#125; <span class="keyword">from</span> <span class="string">&#x27;@/types/store&#x27;</span></span><br><span class="line"><span class="comment">// #2</span></span><br><span class="line"><span class="keyword">type</span> ProfileState = &#123; <span class="attr">user</span>: User; userProfile: UserProfile &#125;</span><br><span class="line"><span class="comment">// #3</span></span><br><span class="line"><span class="keyword">const</span> initState = &#123; <span class="attr">user</span>: &#123;&#125;, <span class="attr">userProfile</span>: &#123;&#125; &#125; <span class="keyword">as</span> ProfileState</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> profile = (state = initState, <span class="attr">action</span>: ProfileAction): <span class="function"><span class="params">ProfileState</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">switch</span> (action.type) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;profile/getUser&#x27;</span>:</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                ...state,</span><br><span class="line">                <span class="attr">user</span>: action.payload,</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="comment">// #4</span></span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;profile/getUserProfile&#x27;</span>:</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                ...state,</span><br><span class="line">                <span class="attr">userProfile</span>: action.payload,</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="attr">default</span>:</span><br><span class="line">            <span class="keyword">return</span> state</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> profile</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>在 <code>Profile/Edit/index.tsx</code> 获取信息并渲染。</li>
</ol>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; Button, List, DatePicker, NavBar &#125; <span class="keyword">from</span> <span class="string">&#x27;antd-mobile&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useHistory &#125; <span class="keyword">from</span> <span class="string">&#x27;react-router-dom&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useDispatch, useSelector &#125; <span class="keyword">from</span> <span class="string">&#x27;react-redux&#x27;</span></span><br><span class="line"><span class="keyword">import</span> classNames <span class="keyword">from</span> <span class="string">&#x27;classnames&#x27;</span></span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&#x27;./index.module.scss&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; getUserProfile &#125; <span class="keyword">from</span> <span class="string">&#x27;@/store/actions/profile&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; RootState &#125; <span class="keyword">from</span> <span class="string">&#x27;@/types/store&#x27;</span></span><br><span class="line"><span class="keyword">const</span> Item = List.Item</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ProfileEdit = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> history = useHistory()</span><br><span class="line">    <span class="keyword">const</span> dispatch = useDispatch()</span><br><span class="line">    <span class="keyword">const</span> &#123; userProfile &#125; = useSelector(<span class="function">(<span class="params">state: RootState</span>) =&gt;</span> state.profile)</span><br><span class="line">    useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        dispatch(getUserProfile())</span><br><span class="line">    &#125;, [dispatch])</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;styles.root&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;content&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                &#123;/* 标题 */&#125;</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">NavBar</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                    <span class="attr">style</span>=<span class="string">&#123;&#123;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                        &#x27;<span class="attr">--border-bottom</span>&#x27;<span class="attr">:</span> &#x27;<span class="attr">1px</span> <span class="attr">solid</span> #<span class="attr">F0F0F0</span>&#x27;,</span></span></span><br><span class="line"><span class="tag"><span class="xml">                    &#125;&#125;</span></span></span><br><span class="line"><span class="tag"><span class="xml">                    <span class="attr">onBack</span>=<span class="string">&#123;()</span> =&gt;</span> history.go(-1)&#125;</span></span><br><span class="line"><span class="xml">                &gt;</span></span><br><span class="line"><span class="xml">                    个人信息</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">NavBar</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;wrapper&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    &#123;/* 列表 */&#125;</span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">List</span> <span class="attr">className</span>=<span class="string">&#x27;profile-list&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        &#123;/* 列表项 */&#125;</span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">Item</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                            <span class="attr">extra</span>=<span class="string">&#123;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                                &lt;<span class="attr">span</span> <span class="attr">className</span>=<span class="string">&#x27;avatar-wrapper&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                                    <span class="tag">&lt;<span class="name">img</span> <span class="attr">width</span>=<span class="string">&#123;24&#125;</span> <span class="attr">height</span>=<span class="string">&#123;24&#125;</span> <span class="attr">src</span>=<span class="string">&#123;userProfile.photo&#125;</span> <span class="attr">alt</span>=<span class="string">&#x27;&#x27;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                                <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">                            &#125;</span></span><br><span class="line"><span class="xml">                            arrow</span></span><br><span class="line"><span class="xml">                        &gt;</span></span><br><span class="line"><span class="xml">                            头像</span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;/<span class="name">Item</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">span</span> <span class="attr">arrow</span> <span class="attr">extra</span>=<span class="string">&#123;userProfile.name&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                            昵称</span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;/<span class="name">Item</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">Item</span> <span class="attr">arrow</span> <span class="attr">extra</span>=<span class="string">&#123;</span>&lt;<span class="attr">span</span> <span class="attr">className</span>=<span class="string">&#123;classNames(</span>&#x27;<span class="attr">intro</span>&#x27;, <span class="attr">userProfile.intro</span> &amp;&amp; &#x27;<span class="attr">normal</span>&#x27;)&#125;&gt;</span>&#123;userProfile.intro || &#x27;未填写&#x27;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span>&#125;&gt;</span></span><br><span class="line"><span class="xml">                            简介</span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;/<span class="name">Item</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">List</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">List</span> <span class="attr">className</span>=<span class="string">&#x27;profile-list&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">Item</span> <span class="attr">arrow</span> <span class="attr">extra</span>=<span class="string">&#123;userProfile.gender</span> === <span class="string">0</span> ? &#x27;男&#x27; <span class="attr">:</span> &#x27;女&#x27;&#125;&gt;</span></span></span><br><span class="line"><span class="xml">                            性别</span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;/<span class="name">Item</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">Item</span> <span class="attr">arrow</span> <span class="attr">extra</span>=<span class="string">&#123;userProfile.birthday&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                            生日</span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;/<span class="name">Item</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">List</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">DatePicker</span> <span class="attr">visible</span>=<span class="string">&#123;false&#125;</span> <span class="attr">value</span>=<span class="string">&#123;new</span> <span class="attr">Date</span>()&#125; <span class="attr">title</span>=<span class="string">&#x27;选择年月日&#x27;</span> <span class="attr">min</span>=<span class="string">&#123;new</span> <span class="attr">Date</span>(<span class="attr">1900</span>, <span class="attr">0</span>, <span class="attr">1</span>, <span class="attr">0</span>, <span class="attr">0</span>, <span class="attr">0</span>)&#125; <span class="attr">max</span>=<span class="string">&#123;new</span> <span class="attr">Date</span>()&#125; /&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;logout&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">Button</span> <span class="attr">className</span>=<span class="string">&#x27;btn&#x27;</span>&gt;</span>退出登录<span class="tag">&lt;/<span class="name">Button</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> ProfileEdit</span><br></pre></td></tr></table></figure>

<h2 id="自定义-Hook"><a href="#自定义-Hook" class="headerlink" title="自定义 Hook"></a>自定义 Hook</h2><h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><h4 id="目标-6"><a href="#目标-6" class="headerlink" title="目标"></a>目标</h4><p>能够知道什么是自定义 Hooks。</p>
<h4 id="内容"><a href="#内容" class="headerlink" title="内容"></a>内容</h4><ul>
<li><p>  除了使用 React 提供的 Hooks 之外，开发者还可以创建自己的 Hooks，也就是自定义 Hooks。</p>
</li>
<li><p>  问题：为什么要创建自定义 Hooks？</p>
</li>
<li><p>  回答：实现状态逻辑复用，也就是将与状态相关的逻辑代码封装到一个函数中，哪个地方用到了，哪个地方调用即可。</p>
</li>
<li><p>自定义 Hooks 的特点如下。</p>
<p>  a，名称必须以 <code>use</code> 开头。</p>
<p>  b，和内置的 React Hooks 一样，自定义 Hooks 也是一个函数。</p>
</li>
</ul>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建自定义 Hooks 函数</span></span><br><span class="line"><span class="keyword">const</span> useXxx = <span class="function">(<span class="params">params</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 需要复用的状态逻辑代码</span></span><br><span class="line">    <span class="keyword">return</span> xxx</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用自定义 Hooks 函数</span></span><br><span class="line"><span class="keyword">const</span> Hello = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> xxx = useXxx(...)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><font color=909090>🤔 自定义 Hooks 就是一个函数，可以完全按照对函数的理解，来理解自定义 Hooks，参数和返回值都可以可选的，可以提供也可以不提供，根据实际需求来实现即可。</font></p>
<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><ul>
<li><p>  自定义 Hooks 是函数吗？</p>
</li>
<li><p>  自定义 Hooks 的名称有什么约束？</p>
</li>
</ul>
<h3 id="useInitState"><a href="#useInitState" class="headerlink" title="useInitState"></a>useInitState</h3><h4 id="目标-7"><a href="#目标-7" class="headerlink" title="目标"></a>目标</h4><p>能够通过封装自定义 Hook 实现进入页面就获取数据的功能。</p>
<h4 id="内容-1"><a href="#内容-1" class="headerlink" title="内容"></a>内容</h4><p>函数封装的基本思想：将相同的逻辑直接拷贝到函数中，不同的逻辑通过函数参数传入，外部需要用到的数据，就通过函数返回值返回。</p>
<ul>
<li><p>  分发的 action 函数不同，获取的状态不同。</p>
</li>
<li><p>  所以，只需要把这两点作为自定义 Hook 的参数即可，最后把状态返回。</p>
</li>
</ul>
<p><code>utils/hooks.ts</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useDispatch, useSelector &#125; <span class="keyword">from</span> <span class="string">&#x27;react-redux&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">useInitState</span>(<span class="params">action: <span class="built_in">any</span>, stateName: <span class="built_in">any</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> dispatch = useDispatch()</span><br><span class="line">    useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        dispatch(action())</span><br><span class="line">    &#125;, [dispatch, action])</span><br><span class="line">    <span class="keyword">const</span> state = useSelector(<span class="function">(<span class="params">state: <span class="built_in">any</span></span>) =&gt;</span> state[stateName])</span><br><span class="line">    <span class="keyword">return</span> state</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>pages/Profile/Edit.tsx</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> ProfileEdit = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> history = useHistory()</span><br><span class="line">    <span class="comment">/* const dispatch = useDispatch()</span></span><br><span class="line"><span class="comment">    const &#123; userProfile &#125; = useSelector((state: RootState) =&gt; state.profile)</span></span><br><span class="line"><span class="comment">    useEffect(() =&gt; &#123;</span></span><br><span class="line"><span class="comment">        dispatch(getUserProfile())</span></span><br><span class="line"><span class="comment">    &#125;, [dispatch]) */</span></span><br><span class="line">    <span class="keyword">const</span> &#123; userProfile &#125; = useInitState(getUserProfile, <span class="string">&#x27;profile&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> ProfileEdit</span><br></pre></td></tr></table></figure>

<h3 id="useInitState-类型"><a href="#useInitState-类型" class="headerlink" title="useInitState 类型"></a>useInitState 类型</h3><h4 id="目标-8"><a href="#目标-8" class="headerlink" title="目标"></a>目标</h4><p>能够为实现的自定义 Hook 添加类型。</p>
<h4 id="分析-1"><a href="#分析-1" class="headerlink" title="分析"></a>分析</h4><p>对于 useInitState 这个自定义 Hook 来说，只需要为参数指定类型即可。</p>
<ul>
<li><p>参数 action。</p>
<p>  就是一个函数，所以，直接指定为最简单的函数类型即可。</p>
</li>
<li><p>参数 stateName。</p>
<p>  a，stateName 表示从 Redux 状态中取出的状态名称，比如，<code>&#39;profile&#39;</code>。</p>
<p>  b，所以，stateName 应该是 RootState 中的所有状态名称中的任意一个。</p>
<p>  c，但是，具体是哪一个不确定，只有在使用该函数时才能确定下来。</p>
<p>  d，问题：如果一个类型不确定，应该是什么 TS 中的什么类型来实现？</p>
</li>
</ul>
<h4 id="代码-3"><a href="#代码-3" class="headerlink" title="代码"></a>代码</h4><p><code>utils/hooks.ts</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; RootState &#125; <span class="keyword">from</span> <span class="string">&#x27;@/types/store&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useDispatch, useSelector &#125; <span class="keyword">from</span> <span class="string">&#x27;react-redux&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">useInitState</span>(<span class="params">action: () =&gt; <span class="built_in">void</span>, stateName: <span class="string">&#x27;login&#x27;</span> | <span class="string">&#x27;profile&#x27;</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> dispatch = useDispatch()</span><br><span class="line">    useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        dispatch(action())</span><br><span class="line">    &#125;, [dispatch, action])</span><br><span class="line">    <span class="keyword">const</span> state = useSelector(<span class="function">(<span class="params">state: RootState</span>) =&gt;</span> state[stateName])</span><br><span class="line">    <span class="keyword">return</span> state</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>问题：<code>pages/Profile/Edit/index.tsx</code> 中会有错误。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 这里 TS 并没有根据传递的 profile 参数识别出来返回值，useInitState 的返回值可能是 Token | ProfileState</span></span><br><span class="line"><span class="keyword">const</span> &#123; userProfile &#125; = useInitState(getUserProfile, <span class="string">&#x27;profile&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>解决如下。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; RootState &#125; <span class="keyword">from</span> <span class="string">&#x27;@/types/store&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useDispatch, useSelector &#125; <span class="keyword">from</span> <span class="string">&#x27;react-redux&#x27;</span></span><br><span class="line"><span class="comment">// T 就来自于 RootState 中的某个 key，让 T 和 RootState 产生了关系</span></span><br><span class="line"><span class="comment">// 还有一个好处就是，即便 RootState 中的内容变多了，这里也是自动适配的</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">useInitState</span>&lt;<span class="title">T</span> <span class="title">extends</span> <span class="title">keyof</span> <span class="title">RootState</span>&gt;(<span class="params">action: () =&gt; <span class="built_in">void</span>, stateName: T</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> dispatch = useDispatch()</span><br><span class="line">    useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        dispatch(action())</span><br><span class="line">    &#125;, [dispatch, action])</span><br><span class="line">    <span class="keyword">const</span> state = useSelector(<span class="function">(<span class="params">state: RootState</span>) =&gt;</span> state[stateName])</span><br><span class="line">    <span class="keyword">return</span> state</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>src/pages/Profile/index.tsx</code> 也可以改写如下。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useInitState &#125; <span class="keyword">from</span> <span class="string">&#x27;@/utils/hooks&#x27;</span></span><br><span class="line"><span class="keyword">const</span> Profile = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> history = useHistory()</span><br><span class="line">    <span class="comment">/* const dispatch = useDispatch()</span></span><br><span class="line"><span class="comment">    const user = useSelector((state: RootState) =&gt; state.profile.user)</span></span><br><span class="line"><span class="comment">    useEffect(() =&gt; &#123;</span></span><br><span class="line"><span class="comment">        dispatch(getUser())</span></span><br><span class="line"><span class="comment">    &#125;, [dispatch]) */</span></span><br><span class="line">    <span class="keyword">const</span> &#123; user &#125; = useInitState(getUser, <span class="string">&#x27;profile&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="修改昵称和简介"><a href="#修改昵称和简介" class="headerlink" title="修改昵称和简介"></a>修改昵称和简介</h2><h3 id="显示弹层"><a href="#显示弹层" class="headerlink" title="显示弹层"></a>显示弹层</h3><ol>
<li>准备弹层。</li>
</ol>
<p><code>src/pages/Profile/Edit/index.tsx</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;Popup visible=&#123;<span class="literal">true</span>&#125; position=<span class="string">&#x27;right&#x27;</span>&gt;</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">height:</span> <span class="attr">400</span>, <span class="attr">width:</span> &#x27;<span class="attr">80vw</span>&#x27; &#125;&#125;&gt;</span>xxx<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/Popup&gt;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>准备状态，用于控制弹层的显示。</li>
</ol>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> InputState = &#123;</span><br><span class="line">    <span class="attr">visible</span>: <span class="built_in">boolean</span></span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;&#x27;</span> | <span class="string">&#x27;name&#x27;</span> | <span class="string">&#x27;intro&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> [showInput, setShowInput] = useState&lt;InputState&gt;(&#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    <span class="attr">visible</span>: <span class="literal">false</span>,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>点击昵称和简介的时候，需要弹层并设置 type。</li>
</ol>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;Item</span><br><span class="line">    arrow</span><br><span class="line">    extra=&#123;userProfile.name&#125;</span><br><span class="line">    onClick=&#123;<span class="function">() =&gt;</span></span><br><span class="line">        setShowInput(&#123;</span><br><span class="line">            <span class="attr">visible</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;name&#x27;</span>,</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&gt;</span><br><span class="line">    昵称</span><br><span class="line">&lt;/Item&gt;</span><br></pre></td></tr></table></figure>

<h3 id="准备-EditInput-组件"><a href="#准备-EditInput-组件" class="headerlink" title="准备 EditInput 组件"></a>准备 EditInput 组件</h3><h4 id="目标-9"><a href="#目标-9" class="headerlink" title="目标"></a>目标</h4><p>准备 EditInput 组件，点击返回的时候隐藏弹层。</p>
<h4 id="准备-EditInput-组件-1"><a href="#准备-EditInput-组件-1" class="headerlink" title="准备 EditInput 组件"></a>准备 EditInput 组件</h4><p><code>src/pages/Profile/Edit/EditInput/index.tsx</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Input, NavBar &#125; <span class="keyword">from</span> <span class="string">&#x27;antd-mobile&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&#x27;./index.module.scss&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> EditInput = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;styles.root&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">NavBar</span> <span class="attr">className</span>=<span class="string">&#x27;navbar&#x27;</span> <span class="attr">right</span>=<span class="string">&#123;</span>&lt;<span class="attr">span</span> <span class="attr">className</span>=<span class="string">&#x27;commit-btn&#x27;</span>&gt;</span>提交<span class="tag">&lt;/<span class="name">span</span>&gt;</span>&#125;&gt;</span></span><br><span class="line"><span class="xml">                编辑昵称</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">NavBar</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;edit-input-content&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">h3</span>&gt;</span>昵称<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;input-wrap&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">Input</span> <span class="attr">placeholder</span>=<span class="string">&#x27;请输入&#x27;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> EditInput</span><br></pre></td></tr></table></figure>

<p><code>src/pages/Profile/Edit/EditInput/index.module.scss</code></p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.root</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">375px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#f7f8fa</span>;</span><br><span class="line"></span><br><span class="line">    :global &#123;</span><br><span class="line">        .navbar &#123;</span><br><span class="line">            background-color: transparent;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="selector-class">.commit-btn</span> &#123;</span><br><span class="line">            <span class="attribute">color</span>: <span class="number">#fc6627</span>;</span><br><span class="line">            <span class="attribute">font-size</span>: <span class="number">17px</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="selector-class">.edit-input-content</span> &#123;</span><br><span class="line">            <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">16px</span>;</span><br><span class="line"></span><br><span class="line">            <span class="selector-tag">h3</span> &#123;</span><br><span class="line">                <span class="attribute">padding</span>: <span class="number">15px</span> <span class="number">0</span>;</span><br><span class="line">                <span class="attribute">font-size</span>: <span class="number">17px</span>;</span><br><span class="line">                <span class="attribute">color</span>: <span class="number">#333</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="selector-class">.input-wrap</span> &#123;</span><br><span class="line">                <span class="attribute">height</span>: <span class="number">44px</span>;</span><br><span class="line">                <span class="attribute">padding-left</span>: <span class="number">16px</span>;</span><br><span class="line"></span><br><span class="line">                <span class="attribute">background-color</span>: <span class="number">#fff</span>;</span><br><span class="line"></span><br><span class="line">                <span class="selector-tag">input</span> &#123;</span><br><span class="line">                    <span class="attribute">height</span>: <span class="number">44px</span>;</span><br><span class="line">                    <span class="attribute">font-size</span>: <span class="number">14px</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="selector-class">.textarea</span> &#123;</span><br><span class="line">                --<span class="attribute">font-size</span>: <span class="number">14px</span>;</span><br><span class="line">                <span class="attribute">padding</span>: <span class="number">16px</span>;</span><br><span class="line">                <span class="attribute">padding-bottom</span>: <span class="number">8px</span>;</span><br><span class="line">                <span class="attribute">border-radius</span>: <span class="number">4px</span>;</span><br><span class="line">                <span class="attribute">background-color</span>: <span class="number">#fff</span>;</span><br><span class="line"></span><br><span class="line">                <span class="selector-class">.adm-text-area-count</span> &#123;</span><br><span class="line">                    <span class="attribute">font-size</span>: <span class="number">12px</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="点击返回隐藏弹层"><a href="#点击返回隐藏弹层" class="headerlink" title="点击返回隐藏弹层"></a>点击返回隐藏弹层</h4><p><code>src/pages/Profile/Edit/index.tsx</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> hideInput = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    setShowInput(&#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="attr">visible</span>: <span class="literal">false</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">;<span class="xml"><span class="tag">&lt;<span class="name">EditInput</span> <span class="attr">hideInput</span>=<span class="string">&#123;hideInput&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">EditInput</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p><code>src/pages/Profile/Edit/EditInput/index.tsx</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Input, NavBar &#125; <span class="keyword">from</span> <span class="string">&#x27;antd-mobile&#x27;</span></span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&#x27;./index.module.scss&#x27;</span></span><br><span class="line"><span class="keyword">type</span> Props = &#123;</span><br><span class="line">    <span class="attr">hideInput</span>: <span class="function">() =&gt;</span> <span class="built_in">void</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> EditInput = <span class="function">(<span class="params">&#123; hideInput &#125;: Props</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;styles.root&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">NavBar</span> <span class="attr">className</span>=<span class="string">&#x27;navbar&#x27;</span> <span class="attr">right</span>=<span class="string">&#123;</span>&lt;<span class="attr">span</span> <span class="attr">className</span>=<span class="string">&#x27;commit-btn&#x27;</span>&gt;</span>提交<span class="tag">&lt;/<span class="name">span</span>&gt;</span>&#125; onBack=&#123;hideInput&#125;&gt;</span></span><br><span class="line"><span class="xml">                编辑昵称</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">NavBar</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;edit-input-content&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">h3</span>&gt;</span>昵称<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;input-wrap&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">Input</span> <span class="attr">placeholder</span>=<span class="string">&#x27;请输入&#x27;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> EditInput</span><br></pre></td></tr></table></figure>

<h3 id="修改标题文字"><a href="#修改标题文字" class="headerlink" title="修改标题文字"></a>修改标题文字</h3><ol>
<li>传递 type 属性。</li>
</ol>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;EditInput hideInput=&#123;hideInput&#125; <span class="keyword">type</span>=&#123;showInput.type&#125; /&gt;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>根据 type 控制内容的展示。</li>
</ol>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Input, NavBar, TextArea &#125; <span class="keyword">from</span> <span class="string">&#x27;antd-mobile&#x27;</span></span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&#x27;./index.module.scss&#x27;</span></span><br><span class="line"><span class="keyword">type</span> Props = &#123;</span><br><span class="line">    <span class="attr">hideInput</span>: <span class="function">() =&gt;</span> <span class="built_in">void</span></span><br><span class="line">    <span class="comment">// #1</span></span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;&#x27;</span> | <span class="string">&#x27;name&#x27;</span> | <span class="string">&#x27;intro&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// #2</span></span><br><span class="line"><span class="keyword">const</span> EditInput = <span class="function">(<span class="params">&#123; hideInput, <span class="keyword">type</span> &#125;: Props</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;styles.root&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">NavBar</span> <span class="attr">className</span>=<span class="string">&#x27;navbar&#x27;</span> <span class="attr">right</span>=<span class="string">&#123;</span>&lt;<span class="attr">span</span> <span class="attr">className</span>=<span class="string">&#x27;commit-btn&#x27;</span>&gt;</span>提交<span class="tag">&lt;/<span class="name">span</span>&gt;</span>&#125; onBack=&#123;hideInput&#125;&gt;</span></span><br><span class="line"><span class="xml">                &#123;/* #3 */&#125;</span></span><br><span class="line"><span class="xml">                编辑&#123;type === &#x27;name&#x27; ? &#x27;昵称&#x27; : &#x27;简介&#x27;&#125;</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">NavBar</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;edit-input-content&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                &#123;/* #4 */&#125;</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">h3</span>&gt;</span>&#123;type === &#x27;name&#x27; ? &#x27;昵称&#x27; : &#x27;简介&#x27;&#125;<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">                &#123;/* #5 */&#125;</span></span><br><span class="line"><span class="xml">                &#123;type === &#x27;name&#x27; ? (</span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;input-wrap&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">Input</span> <span class="attr">placeholder</span>=<span class="string">&#x27;请输入&#x27;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                ) : (</span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">TextArea</span> <span class="attr">className</span>=<span class="string">&#x27;textarea&#x27;</span> <span class="attr">placeholder</span>=<span class="string">&#x27;请输入简介&#x27;</span> <span class="attr">showCount</span> <span class="attr">maxLength</span>=<span class="string">&#123;99&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                )&#125;</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> EditInput</span><br></pre></td></tr></table></figure>

<h3 id="数据回显"><a href="#数据回显" class="headerlink" title="数据回显"></a>数据回显</h3><h4 id="目标-10"><a href="#目标-10" class="headerlink" title="目标"></a>目标</h4><p>能够在弹出层文本框中展示昵称或者简介。</p>
<h4 id="代码-4"><a href="#代码-4" class="headerlink" title="代码"></a>代码</h4><p><code>Edit/EditInput/index.tsx</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; RootState &#125; <span class="keyword">from</span> <span class="string">&#x27;@/types/store&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; Input, NavBar, TextArea &#125; <span class="keyword">from</span> <span class="string">&#x27;antd-mobile&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useSelector &#125; <span class="keyword">from</span> <span class="string">&#x27;react-redux&#x27;</span></span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&#x27;./index.module.scss&#x27;</span></span><br><span class="line"><span class="keyword">type</span> Props = &#123;</span><br><span class="line">    <span class="attr">hideInput</span>: <span class="function">() =&gt;</span> <span class="built_in">void</span></span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;&#x27;</span> | <span class="string">&#x27;name&#x27;</span> | <span class="string">&#x27;intro&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> EditInput = <span class="function">(<span class="params">&#123; hideInput, <span class="keyword">type</span> &#125;: Props</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// #1</span></span><br><span class="line">    <span class="keyword">const</span> &#123; userProfile &#125; = useSelector(<span class="function">(<span class="params">state: RootState</span>) =&gt;</span> state.profile)</span><br><span class="line">    <span class="comment">// #2</span></span><br><span class="line">    <span class="keyword">const</span> [value, setValue] = useState(<span class="keyword">type</span> === <span class="string">&#x27;name&#x27;</span> ? userProfile.name : userProfile.intro)</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;styles.root&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">NavBar</span> <span class="attr">className</span>=<span class="string">&#x27;navbar&#x27;</span> <span class="attr">right</span>=<span class="string">&#123;</span>&lt;<span class="attr">span</span> <span class="attr">className</span>=<span class="string">&#x27;commit-btn&#x27;</span>&gt;</span>提交<span class="tag">&lt;/<span class="name">span</span>&gt;</span>&#125; onBack=&#123;hideInput&#125;&gt;</span></span><br><span class="line"><span class="xml">                编辑&#123;type === &#x27;name&#x27; ? &#x27;昵称&#x27; : &#x27;简介&#x27;&#125;</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">NavBar</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;edit-input-content&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">h3</span>&gt;</span>&#123;type === &#x27;name&#x27; ? &#x27;昵称&#x27; : &#x27;简介&#x27;&#125;<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">                &#123;/* #3 */&#125;</span></span><br><span class="line"><span class="xml">                &#123;type === &#x27;name&#x27; ? (</span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;input-wrap&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">Input</span> <span class="attr">placeholder</span>=<span class="string">&#x27;请输入昵称&#x27;</span> <span class="attr">value</span>=<span class="string">&#123;value&#125;</span> <span class="attr">onChange</span>=<span class="string">&#123;(v)</span> =&gt;</span> setValue(v)&#125; maxLength=&#123;11&#125; /&gt;</span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                ) : (</span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">TextArea</span> <span class="attr">className</span>=<span class="string">&#x27;textarea&#x27;</span> <span class="attr">placeholder</span>=<span class="string">&#x27;请输入简介&#x27;</span> <span class="attr">showCount</span> <span class="attr">maxLength</span>=<span class="string">&#123;99&#125;</span> <span class="attr">value</span>=<span class="string">&#123;value&#125;</span> <span class="attr">onChange</span>=<span class="string">&#123;(v)</span> =&gt;</span> setValue(v)&#125; /&gt;</span></span><br><span class="line"><span class="xml">                )&#125;</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> EditInput</span><br></pre></td></tr></table></figure>

<h3 id="修复回显-Bug"><a href="#修复回显-Bug" class="headerlink" title="修复回显 Bug"></a>修复回显 Bug</h3><ul>
<li><p>  默认情况，关闭弹层之后，EditInput 组件并没有销毁，导致 useState 中的初始值永远是最初获取的那一次。</p>
</li>
<li><p>  通过 <code>destroyOnClose</code> 可以保证关闭弹层时销毁组件。</p>
</li>
</ul>
<p><code>pages/Profile/Edit/index.tsx</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;Popup visible=&#123;showInput.visible&#125; position=<span class="string">&#x27;right&#x27;</span> onMaskClick=&#123;<span class="function">() =&gt;</span> setShowInput(&#123; <span class="attr">type</span>: <span class="string">&#x27;&#x27;</span>, <span class="attr">visible</span>: <span class="literal">false</span> &#125;)&#125; destroyOnClose&gt;</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">EditInput</span> <span class="attr">hideInput</span>=<span class="string">&#123;hideInput&#125;</span> <span class="attr">type</span>=<span class="string">&#123;showInput.type&#125;</span> /&gt;</span></span></span><br><span class="line">&lt;/Popup&gt;</span><br></pre></td></tr></table></figure>

<h3 id="自动获取光标"><a href="#自动获取光标" class="headerlink" title="自动获取光标"></a>自动获取光标</h3><p><code>pages/Profile/Edit/EditInput/index.tsx</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState, useRef, useEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; RootState &#125; <span class="keyword">from</span> <span class="string">&#x27;@/types/store&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; Input, NavBar, TextArea &#125; <span class="keyword">from</span> <span class="string">&#x27;antd-mobile&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useSelector &#125; <span class="keyword">from</span> <span class="string">&#x27;react-redux&#x27;</span></span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&#x27;./index.module.scss&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; InputRef &#125; <span class="keyword">from</span> <span class="string">&#x27;antd-mobile/es/components/input&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; TextAreaRef &#125; <span class="keyword">from</span> <span class="string">&#x27;antd-mobile/es/components/text-area&#x27;</span></span><br><span class="line"><span class="keyword">type</span> Props = &#123;</span><br><span class="line">    <span class="attr">hideInput</span>: <span class="function">() =&gt;</span> <span class="built_in">void</span></span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;&#x27;</span> | <span class="string">&#x27;name&#x27;</span> | <span class="string">&#x27;intro&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> EditInput = <span class="function">(<span class="params">&#123; hideInput, <span class="keyword">type</span> &#125;: Props</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; userProfile &#125; = useSelector(<span class="function">(<span class="params">state: RootState</span>) =&gt;</span> state.profile)</span><br><span class="line">    <span class="keyword">const</span> [value, setValue] = useState(<span class="keyword">type</span> === <span class="string">&#x27;name&#x27;</span> ? userProfile.name : userProfile.intro)</span><br><span class="line">    <span class="comment">// #1</span></span><br><span class="line">    <span class="keyword">const</span> inputRef = useRef&lt;InputRef&gt;(<span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">const</span> textRef = useRef&lt;TextAreaRef&gt;(<span class="literal">null</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// #3</span></span><br><span class="line">    useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">type</span> === <span class="string">&#x27;name&#x27;</span>) &#123;</span><br><span class="line">            inputRef.current?.focus()</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            textRef.current?.focus()</span><br><span class="line">            <span class="comment">// 设置光标到特定的位置</span></span><br><span class="line">            <span class="built_in">document</span>.querySelector(<span class="string">&#x27;textarea&#x27;</span>)?.setSelectionRange(-<span class="number">1</span>, -<span class="number">1</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, [<span class="keyword">type</span>])</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;styles.root&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">NavBar</span> <span class="attr">className</span>=<span class="string">&#x27;navbar&#x27;</span> <span class="attr">right</span>=<span class="string">&#123;</span>&lt;<span class="attr">span</span> <span class="attr">className</span>=<span class="string">&#x27;commit-btn&#x27;</span>&gt;</span>提交<span class="tag">&lt;/<span class="name">span</span>&gt;</span>&#125; onBack=&#123;hideInput&#125;&gt;</span></span><br><span class="line"><span class="xml">                编辑&#123;type === &#x27;name&#x27; ? &#x27;昵称&#x27; : &#x27;简介&#x27;&#125;</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">NavBar</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;edit-input-content&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">h3</span>&gt;</span>&#123;type === &#x27;name&#x27; ? &#x27;昵称&#x27; : &#x27;简介&#x27;&#125;<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line"><span class="xml">                &#123;/* #2 */&#125;</span></span><br><span class="line"><span class="xml">                &#123;type === &#x27;name&#x27; ? (</span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;input-wrap&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">Input</span> <span class="attr">placeholder</span>=<span class="string">&#x27;请输入昵称&#x27;</span> <span class="attr">value</span>=<span class="string">&#123;value&#125;</span> <span class="attr">onChange</span>=<span class="string">&#123;(v)</span> =&gt;</span> setValue(v)&#125; maxLength=&#123;11&#125; ref=&#123;inputRef&#125; /&gt;</span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                ) : (</span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">TextArea</span> <span class="attr">className</span>=<span class="string">&#x27;textarea&#x27;</span> <span class="attr">placeholder</span>=<span class="string">&#x27;请输入简介&#x27;</span> <span class="attr">showCount</span> <span class="attr">maxLength</span>=<span class="string">&#123;99&#125;</span> <span class="attr">value</span>=<span class="string">&#123;value&#125;</span> <span class="attr">onChange</span>=<span class="string">&#123;(v)</span> =&gt;</span> setValue(v)&#125; ref=&#123;textRef&#125; /&gt;</span></span><br><span class="line"><span class="xml">                )&#125;</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> EditInput</span><br></pre></td></tr></table></figure>

<p><code>setSelectionRange</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Hello World&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> oInput = <span class="built_in">document</span>.querySelector(<span class="string">&#x27;input&#x27;</span>)</span></span><br><span class="line"><span class="javascript">    oInput.focus()</span></span><br><span class="line"><span class="javascript">    <span class="comment">// oInput.setSelectionRange(0, oInput.value.length) // 选中所有</span></span></span><br><span class="line"><span class="javascript">    <span class="comment">// oInput.setSelectionRange(0, -1) // 第二个参数为负数，此时表示从 0 选到最后</span></span></span><br><span class="line"><span class="javascript">    oInput.setSelectionRange(-<span class="number">1</span>, -<span class="number">1</span>) <span class="comment">// 从最后选到最后</span></span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="回传给父组件"><a href="#回传给父组件" class="headerlink" title="回传给父组件"></a>回传给父组件</h3><h4 id="目标-11"><a href="#目标-11" class="headerlink" title="目标"></a>目标</h4><p>能够在点击提交时拿到输入的信息并回传给父组件。</p>
<h4 id="分析-2"><a href="#分析-2" class="headerlink" title="分析"></a>分析</h4><p>用户个人信息的状态是在 Edit 父组件中拿到的，所以修改用户个人信息也应该由 Edit 父组件发起，因此，需要将修改后的昵称回传给 Edit 父组件。</p>
<h4 id="步骤-6"><a href="#步骤-6" class="headerlink" title="步骤"></a>步骤</h4><ol>
<li><p>在 Edit 组件定义 onUpdate 函数并传递给 EditInput 组件。</p>
</li>
<li><p>在 EditInput 组件中为提交按钮绑定点击事件并调用传递过来的 onUpdate 函数。</p>
</li>
<li><p>在 Edit 组件中根据 onUpdate 形参做相应的处理。</p>
</li>
</ol>
<h4 id="代码-5"><a href="#代码-5" class="headerlink" title="代码"></a>代码</h4><p><code>Edit/index.tsx</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> onUpdate = <span class="function">(<span class="params">key: <span class="built_in">string</span>, value: <span class="built_in">string</span></span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(key, value)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">;<span class="xml"><span class="tag">&lt;<span class="name">EditInput</span> <span class="attr">hideInput</span>=<span class="string">&#123;hideInput&#125;</span> <span class="attr">type</span>=<span class="string">&#123;showInput.type&#125;</span> <span class="attr">onUpdate</span>=<span class="string">&#123;onUpdate&#125;</span> /&gt;</span></span></span><br></pre></td></tr></table></figure>

<p><code>Edit/EditInput/index.tsx</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState, useRef, useEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; RootState &#125; <span class="keyword">from</span> <span class="string">&#x27;@/types/store&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; Input, NavBar, TextArea &#125; <span class="keyword">from</span> <span class="string">&#x27;antd-mobile&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useSelector &#125; <span class="keyword">from</span> <span class="string">&#x27;react-redux&#x27;</span></span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&#x27;./index.module.scss&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; InputRef &#125; <span class="keyword">from</span> <span class="string">&#x27;antd-mobile/es/components/input&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; TextAreaRef &#125; <span class="keyword">from</span> <span class="string">&#x27;antd-mobile/es/components/text-area&#x27;</span></span><br><span class="line"><span class="keyword">type</span> Props = &#123;</span><br><span class="line">    <span class="attr">hideInput</span>: <span class="function">() =&gt;</span> <span class="built_in">void</span></span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;&#x27;</span> | <span class="string">&#x27;name&#x27;</span> | <span class="string">&#x27;intro&#x27;</span></span><br><span class="line">    <span class="comment">// #1</span></span><br><span class="line">    <span class="attr">onUpdate</span>: <span class="function">(<span class="params">key: <span class="built_in">string</span>, value: <span class="built_in">string</span></span>) =&gt;</span> <span class="built_in">void</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// #2</span></span><br><span class="line"><span class="keyword">const</span> EditInput = <span class="function">(<span class="params">&#123; hideInput, <span class="keyword">type</span>, onUpdate &#125;: Props</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; userProfile &#125; = useSelector(<span class="function">(<span class="params">state: RootState</span>) =&gt;</span> state.profile)</span><br><span class="line">    <span class="keyword">const</span> [value, setValue] = useState(<span class="keyword">type</span> === <span class="string">&#x27;name&#x27;</span> ? userProfile.name : userProfile.intro)</span><br><span class="line">    <span class="keyword">const</span> inputRef = useRef&lt;InputRef&gt;(<span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">const</span> textRef = useRef&lt;TextAreaRef&gt;(<span class="literal">null</span>)</span><br><span class="line"></span><br><span class="line">    useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">type</span> === <span class="string">&#x27;name&#x27;</span>) &#123;</span><br><span class="line">            inputRef.current?.focus()</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            textRef.current?.focus()</span><br><span class="line">            <span class="built_in">document</span>.querySelector(<span class="string">&#x27;textarea&#x27;</span>)?.setSelectionRange(-<span class="number">1</span>, -<span class="number">1</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, [<span class="keyword">type</span>])</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;styles.root&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">NavBar</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">className</span>=<span class="string">&#x27;navbar&#x27;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">right</span>=<span class="string">&#123;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                    // #<span class="attr">3</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                    &lt;<span class="attr">span</span> <span class="attr">className</span>=<span class="string">&#x27;commit-btn&#x27;</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> onUpdate(type, value)&#125;&gt;</span></span><br><span class="line"><span class="xml">                        提交</span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">                &#125;</span></span><br><span class="line"><span class="xml">                onBack=&#123;hideInput&#125;</span></span><br><span class="line"><span class="xml">            &gt;</span></span><br><span class="line"><span class="xml">                编辑&#123;type === &#x27;name&#x27; ? &#x27;昵称&#x27; : &#x27;简介&#x27;&#125;</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">NavBar</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;edit-input-content&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">h3</span>&gt;</span>&#123;type === &#x27;name&#x27; ? &#x27;昵称&#x27; : &#x27;简介&#x27;&#125;<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line"><span class="xml">                &#123;type === &#x27;name&#x27; ? (</span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;input-wrap&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">Input</span> <span class="attr">placeholder</span>=<span class="string">&#x27;请输入昵称&#x27;</span> <span class="attr">value</span>=<span class="string">&#123;value&#125;</span> <span class="attr">onChange</span>=<span class="string">&#123;(v)</span> =&gt;</span> setValue(v)&#125; maxLength=&#123;11&#125; ref=&#123;inputRef&#125; /&gt;</span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                ) : (</span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">TextArea</span> <span class="attr">className</span>=<span class="string">&#x27;textarea&#x27;</span> <span class="attr">placeholder</span>=<span class="string">&#x27;请输入简介&#x27;</span> <span class="attr">showCount</span> <span class="attr">maxLength</span>=<span class="string">&#123;99&#125;</span> <span class="attr">value</span>=<span class="string">&#123;value&#125;</span> <span class="attr">onChange</span>=<span class="string">&#123;(v)</span> =&gt;</span> setValue(v)&#125; ref=&#123;textRef&#125; /&gt;</span></span><br><span class="line"><span class="xml">                )&#125;</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> EditInput</span><br></pre></td></tr></table></figure>

<h3 id="发送请求修改"><a href="#发送请求修改" class="headerlink" title="发送请求修改"></a>发送请求修改</h3><p><code>actions/profile.ts</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">updateUserProfile</span>(<span class="params">key: <span class="built_in">string</span>, value: <span class="built_in">string</span></span>): <span class="title">RootThunkAction</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">async</span> (dispatch) =&gt; &#123;</span><br><span class="line">        <span class="keyword">await</span> request.patch(<span class="string">&#x27;/user/profile&#x27;</span>, &#123;</span><br><span class="line">            [key]: value,</span><br><span class="line">        &#125;)</span><br><span class="line">        dispatch(getUserProfile())</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>pages/Profile/Edit/index.tsx</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> onUpdate = <span class="keyword">async</span> (key: <span class="built_in">string</span>, <span class="attr">value</span>: <span class="built_in">string</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">await</span> dispatch(updateUserProfile(key, value))</span><br><span class="line">    Toast.show(&#123; <span class="attr">icon</span>: <span class="string">&#x27;success&#x27;</span>, <span class="attr">content</span>: <span class="string">&#x27;修改成功&#x27;</span> &#125;)</span><br><span class="line">    hideInput()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="修改头像和性别"><a href="#修改头像和性别" class="headerlink" title="修改头像和性别"></a>修改头像和性别</h2><h3 id="弹框控制"><a href="#弹框控制" class="headerlink" title="弹框控制"></a>弹框控制</h3><h4 id="准备素材"><a href="#准备素材" class="headerlink" title="准备素材"></a>准备素材</h4><p><code>src/pages/Profile/Edit/EditList/index.tsx</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&#x27;./index.module.scss&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> EditList = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;styles.root&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;list-item&#x27;</span>&gt;</span>男<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;list-item&#x27;</span>&gt;</span>女<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;list-item&#x27;</span>&gt;</span>取消<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> EditList</span><br></pre></td></tr></table></figure>

<p><code>src/pages/Profile/Edit/EditList/index.module.scss</code></p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.root</span> &#123;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">8px</span> <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#fff</span>;</span><br><span class="line"></span><br><span class="line">    :global &#123;</span><br><span class="line">        .list-item &#123;</span><br><span class="line">            height: <span class="number">50px</span>;</span><br><span class="line">            <span class="attribute">line-height</span>: <span class="number">50px</span>;</span><br><span class="line">            <span class="attribute">text-align</span>: center;</span><br><span class="line">            <span class="attribute">font-size</span>: <span class="number">16px</span>;</span><br><span class="line">            <span class="attribute">color</span>: <span class="number">#333</span>;</span><br><span class="line"></span><br><span class="line">            &amp;<span class="selector-pseudo">:active</span> &#123;</span><br><span class="line">                <span class="attribute">background-color</span>: <span class="number">#f2f3f5</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            &amp;<span class="selector-pseudo">:last-child</span> &#123;</span><br><span class="line">                <span class="attribute">color</span>: <span class="number">#a5a6ab</span>;</span><br><span class="line"></span><br><span class="line">                &amp;<span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">                    <span class="attribute">content</span>: <span class="string">&#x27; &#x27;</span>;</span><br><span class="line">                    <span class="attribute">display</span>: block;</span><br><span class="line">                    <span class="attribute">height</span>: <span class="number">8px</span>;</span><br><span class="line">                    <span class="comment">// width: 100%;</span></span><br><span class="line">                    <span class="attribute">background-color</span>: <span class="number">#f7f8fa</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="准备弹出层"><a href="#准备弹出层" class="headerlink" title="准备弹出层"></a>准备弹出层</h4><h5 id="目标-12"><a href="#目标-12" class="headerlink" title="目标"></a>目标</h5><p>能够显示修改性别弹出层。</p>
<h5 id="步骤-7"><a href="#步骤-7" class="headerlink" title="步骤"></a>步骤</h5><ol>
<li><p>将准备好的修改性别的模板拷贝到 Edit 目录中。</p>
</li>
<li><p>导入修改性别组件，在 Popup 组件中渲染。</p>
</li>
</ol>
<h5 id="代码-6"><a href="#代码-6" class="headerlink" title="代码"></a>代码</h5><p><code>Edit/index.tsx</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> EditList <span class="keyword">from</span> <span class="string">&#x27;./EditList&#x27;</span></span><br><span class="line">;<span class="xml"><span class="tag">&lt;<span class="name">Popup</span> <span class="attr">visible</span>=<span class="string">&#123;true&#125;</span> <span class="attr">position</span>=<span class="string">&#x27;bottom&#x27;</span> <span class="attr">destroyOnClose</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">EditList</span> /&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">Popup</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<h4 id="显示与隐藏"><a href="#显示与隐藏" class="headerlink" title="显示与隐藏"></a>显示与隐藏</h4><h5 id="目标-13"><a href="#目标-13" class="headerlink" title="目标"></a>目标</h5><p>能搞控制修改性别弹出层的展示或隐藏。</p>
<h5 id="分析-3"><a href="#分析-3" class="headerlink" title="分析"></a>分析</h5><p>修改性别和修改头像的弹出层内容几乎是一样的，因此，也可以复用同一个弹出层组件。因此，接下来要从<strong>复用</strong>的角度，设计修改性别弹出层的逻辑（可以参考刚刚实现的修改昵称和简介）。</p>
<h5 id="步骤-8"><a href="#步骤-8" class="headerlink" title="步骤"></a>步骤</h5><ol>
<li><p>准备用于控制修改性别弹出层的状态。</p>
</li>
<li><p>为性别添加点击事件，在点击事件中修改状态进行展示。</p>
</li>
<li><p>创建隐藏弹出层的控制函数，在点击遮罩时关闭弹出层，并传递给 EditList 组件。</p>
</li>
<li><p>为 EditList 组件添加 props 类型，并接收隐藏函数。</p>
</li>
<li><p>为取消按钮添加点击事件来触发隐藏弹出层。</p>
</li>
</ol>
<h5 id="代码-7"><a href="#代码-7" class="headerlink" title="代码"></a>代码</h5><p><code>pages/Profile/Edit/index.tsx</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; Button, List, DatePicker, NavBar, Popup, Toast &#125; <span class="keyword">from</span> <span class="string">&#x27;antd-mobile&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useHistory &#125; <span class="keyword">from</span> <span class="string">&#x27;react-router-dom&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useDispatch &#125; <span class="keyword">from</span> <span class="string">&#x27;react-redux&#x27;</span></span><br><span class="line"><span class="keyword">import</span> classNames <span class="keyword">from</span> <span class="string">&#x27;classnames&#x27;</span></span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&#x27;./index.module.scss&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; getUserProfile, updateUserProfile &#125; <span class="keyword">from</span> <span class="string">&#x27;@/store/actions/profile&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useInitState &#125; <span class="keyword">from</span> <span class="string">&#x27;@/utils/hooks&#x27;</span></span><br><span class="line"><span class="keyword">import</span> EditInput <span class="keyword">from</span> <span class="string">&#x27;./EditInput&#x27;</span></span><br><span class="line"><span class="keyword">import</span> EditList <span class="keyword">from</span> <span class="string">&#x27;./EditList&#x27;</span></span><br><span class="line"><span class="keyword">const</span> Item = List.Item</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> InputState = &#123;</span><br><span class="line">    <span class="attr">visible</span>: <span class="built_in">boolean</span></span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;&#x27;</span> | <span class="string">&#x27;name&#x27;</span> | <span class="string">&#x27;intro&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// #1</span></span><br><span class="line"><span class="keyword">type</span> ListState = &#123;</span><br><span class="line">    <span class="attr">visible</span>: <span class="built_in">boolean</span></span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;&#x27;</span> | <span class="string">&#x27;gender&#x27;</span> | <span class="string">&#x27;photo&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ProfileEdit = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> history = useHistory()</span><br><span class="line">    <span class="keyword">const</span> dispatch = useDispatch()</span><br><span class="line">    <span class="keyword">const</span> &#123; userProfile &#125; = useInitState(getUserProfile, <span class="string">&#x27;profile&#x27;</span>)</span><br><span class="line">    <span class="keyword">const</span> [showInput, setShowInput] = useState&lt;InputState&gt;(&#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="attr">visible</span>: <span class="literal">false</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">// #2</span></span><br><span class="line">    <span class="keyword">const</span> [showList, setShowList] = useState&lt;ListState&gt;(&#123;</span><br><span class="line">        <span class="attr">visible</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">const</span> hideInput = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        setShowInput(&#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="attr">visible</span>: <span class="literal">false</span>,</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// #3</span></span><br><span class="line">    <span class="keyword">const</span> hideList = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        setShowList(&#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="attr">visible</span>: <span class="literal">false</span>,</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> onUpdate = <span class="keyword">async</span> (key: <span class="built_in">string</span>, <span class="attr">value</span>: <span class="built_in">string</span>) =&gt; &#123;</span><br><span class="line">        <span class="keyword">await</span> dispatch(updateUserProfile(key, value))</span><br><span class="line">        Toast.show(&#123; <span class="attr">icon</span>: <span class="string">&#x27;success&#x27;</span>, <span class="attr">content</span>: <span class="string">&#x27;修改成功&#x27;</span> &#125;)</span><br><span class="line">        hideInput()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;styles.root&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;content&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                &#123;/* 标题 */&#125;</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">NavBar</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                    <span class="attr">style</span>=<span class="string">&#123;&#123;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                        &#x27;<span class="attr">--border-bottom</span>&#x27;<span class="attr">:</span> &#x27;<span class="attr">1px</span> <span class="attr">solid</span> #<span class="attr">F0F0F0</span>&#x27;,</span></span></span><br><span class="line"><span class="tag"><span class="xml">                    &#125;&#125;</span></span></span><br><span class="line"><span class="tag"><span class="xml">                    <span class="attr">onBack</span>=<span class="string">&#123;()</span> =&gt;</span> history.go(-1)&#125;</span></span><br><span class="line"><span class="xml">                &gt;</span></span><br><span class="line"><span class="xml">                    个人信息</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">NavBar</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;wrapper&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    &#123;/* 列表 */&#125;</span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">List</span> <span class="attr">className</span>=<span class="string">&#x27;profile-list&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        &#123;/* 列表项 */&#125;</span></span><br><span class="line"><span class="xml">                        &#123;/* #5 */&#125;</span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">Item</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                            <span class="attr">extra</span>=<span class="string">&#123;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                                &lt;<span class="attr">span</span> <span class="attr">className</span>=<span class="string">&#x27;avatar-wrapper&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                                    <span class="tag">&lt;<span class="name">img</span> <span class="attr">width</span>=<span class="string">&#123;24&#125;</span> <span class="attr">height</span>=<span class="string">&#123;24&#125;</span> <span class="attr">src</span>=<span class="string">&#123;userProfile.photo&#125;</span> <span class="attr">alt</span>=<span class="string">&#x27;&#x27;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                                <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">                            &#125;</span></span><br><span class="line"><span class="xml">                            arrow</span></span><br><span class="line"><span class="xml">                            onClick=&#123;() =&gt;</span></span><br><span class="line"><span class="xml">                                setShowList(&#123;</span></span><br><span class="line"><span class="xml">                                    visible: true,</span></span><br><span class="line"><span class="xml">                                    type: &#x27;photo&#x27;,</span></span><br><span class="line"><span class="xml">                                &#125;)</span></span><br><span class="line"><span class="xml">                            &#125;</span></span><br><span class="line"><span class="xml">                        &gt;</span></span><br><span class="line"><span class="xml">                            头像</span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;/<span class="name">Item</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">Item</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                            <span class="attr">arrow</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                            <span class="attr">extra</span>=<span class="string">&#123;userProfile.name&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                            <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span></span></span><br><span class="line"><span class="xml">                                setShowInput(&#123;</span></span><br><span class="line"><span class="xml">                                    visible: true,</span></span><br><span class="line"><span class="xml">                                    type: &#x27;name&#x27;,</span></span><br><span class="line"><span class="xml">                                &#125;)</span></span><br><span class="line"><span class="xml">                            &#125;</span></span><br><span class="line"><span class="xml">                        &gt;</span></span><br><span class="line"><span class="xml">                            昵称</span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;/<span class="name">Item</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">Item</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                            <span class="attr">arrow</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                            <span class="attr">extra</span>=<span class="string">&#123;</span>&lt;<span class="attr">span</span> <span class="attr">className</span>=<span class="string">&#123;classNames(</span>&#x27;<span class="attr">intro</span>&#x27;, <span class="attr">userProfile.intro</span> &amp;&amp; &#x27;<span class="attr">normal</span>&#x27;)&#125;&gt;</span>&#123;userProfile.intro || &#x27;未填写&#x27;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span>&#125;</span></span><br><span class="line"><span class="xml">                            onClick=&#123;() =&gt;</span></span><br><span class="line"><span class="xml">                                setShowInput(&#123;</span></span><br><span class="line"><span class="xml">                                    visible: true,</span></span><br><span class="line"><span class="xml">                                    type: &#x27;intro&#x27;,</span></span><br><span class="line"><span class="xml">                                &#125;)</span></span><br><span class="line"><span class="xml">                            &#125;</span></span><br><span class="line"><span class="xml">                        &gt;</span></span><br><span class="line"><span class="xml">                            简介</span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;/<span class="name">Item</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">List</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">List</span> <span class="attr">className</span>=<span class="string">&#x27;profile-list&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        &#123;/* #6 */&#125;</span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">Item</span> <span class="attr">arrow</span> <span class="attr">extra</span>=<span class="string">&#123;userProfile.gender</span> === <span class="string">0</span> ? &#x27;男&#x27; <span class="attr">:</span> &#x27;女&#x27;&#125; <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> setShowList(&#123; visible: true, type: &#x27;gender&#x27; &#125;)&#125;&gt;</span></span><br><span class="line"><span class="xml">                            性别</span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;/<span class="name">Item</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">Item</span> <span class="attr">arrow</span> <span class="attr">extra</span>=<span class="string">&#123;userProfile.birthday&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                            生日</span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;/<span class="name">Item</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">List</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">DatePicker</span> <span class="attr">visible</span>=<span class="string">&#123;false&#125;</span> <span class="attr">value</span>=<span class="string">&#123;new</span> <span class="attr">Date</span>()&#125; <span class="attr">title</span>=<span class="string">&#x27;选择年月日&#x27;</span> <span class="attr">min</span>=<span class="string">&#123;new</span> <span class="attr">Date</span>(<span class="attr">1900</span>, <span class="attr">0</span>, <span class="attr">1</span>, <span class="attr">0</span>, <span class="attr">0</span>, <span class="attr">0</span>)&#125; <span class="attr">max</span>=<span class="string">&#123;new</span> <span class="attr">Date</span>()&#125; /&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;logout&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">Button</span> <span class="attr">className</span>=<span class="string">&#x27;btn&#x27;</span>&gt;</span>退出登录<span class="tag">&lt;/<span class="name">Button</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Popup</span> <span class="attr">visible</span>=<span class="string">&#123;showInput.visible&#125;</span> <span class="attr">position</span>=<span class="string">&#x27;right&#x27;</span> <span class="attr">onMaskClick</span>=<span class="string">&#123;()</span> =&gt;</span> setShowInput(&#123; type: &#x27;&#x27;, visible: false &#125;)&#125; destroyOnClose&gt;</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">EditInput</span> <span class="attr">hideInput</span>=<span class="string">&#123;hideInput&#125;</span> <span class="attr">type</span>=<span class="string">&#123;showInput.type&#125;</span> <span class="attr">onUpdate</span>=<span class="string">&#123;onUpdate&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">Popup</span>&gt;</span></span></span><br><span class="line"><span class="xml">            &#123;/* #4 */&#125;</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Popup</span> <span class="attr">visible</span>=<span class="string">&#123;showList.visible&#125;</span> <span class="attr">position</span>=<span class="string">&#x27;bottom&#x27;</span> <span class="attr">destroyOnClose</span> <span class="attr">onMaskClick</span>=<span class="string">&#123;hideList&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                &#123;/* #7 */&#125;</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">EditList</span> <span class="attr">onClose</span>=<span class="string">&#123;hideList&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">Popup</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> ProfileEdit</span><br></pre></td></tr></table></figure>

<p><code>pages/Profile/Edit/EditList/index.tsx</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&#x27;./index.module.scss&#x27;</span></span><br><span class="line"><span class="keyword">type</span> Props = &#123;</span><br><span class="line">    <span class="attr">onClose</span>: <span class="function">() =&gt;</span> <span class="built_in">void</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> EditList = <span class="function">(<span class="params">&#123; onClose &#125;: Props</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;styles.root&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;list-item&#x27;</span>&gt;</span>男<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;list-item&#x27;</span>&gt;</span>女<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;list-item&#x27;</span> <span class="attr">onClick</span>=<span class="string">&#123;onClose&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                取消</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> EditList</span><br></pre></td></tr></table></figure>

<h4 id="内容的回显"><a href="#内容的回显" class="headerlink" title="内容的回显"></a>内容的回显</h4><ol>
<li>父组件把 type 传给子组件。</li>
</ol>
<p><code>src/pages/Profile/Edit/index.tsx</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;EditList hideList=&#123;hideList&#125; <span class="keyword">type</span>=&#123;showList.type&#125;&gt;&lt;/EditList&gt;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>子组件根据 type 属性控制需要显示的内容。</li>
</ol>
<p><code>src/pages/Profile/Edit/EditList/index.tsx</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&#x27;./index.module.scss&#x27;</span></span><br><span class="line"><span class="keyword">type</span> Props = &#123;</span><br><span class="line">    <span class="attr">onClose</span>: <span class="function">() =&gt;</span> <span class="built_in">void</span></span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;&#x27;</span> | <span class="string">&#x27;gender&#x27;</span> | <span class="string">&#x27;photo&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> genderList = [</span><br><span class="line">    &#123; <span class="attr">title</span>: <span class="string">&#x27;男&#x27;</span>, <span class="attr">value</span>: <span class="string">&#x27;0&#x27;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">title</span>: <span class="string">&#x27;女&#x27;</span>, <span class="attr">value</span>: <span class="string">&#x27;1&#x27;</span> &#125;,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> photoList = [</span><br><span class="line">    &#123; <span class="attr">title</span>: <span class="string">&#x27;拍照&#x27;</span>, <span class="attr">value</span>: <span class="string">&#x27;&#x27;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">title</span>: <span class="string">&#x27;本地选择&#x27;</span>, <span class="attr">value</span>: <span class="string">&#x27;&#x27;</span> &#125;,</span><br><span class="line">]</span><br><span class="line"><span class="keyword">const</span> EditList = <span class="function">(<span class="params">&#123; onClose, <span class="keyword">type</span> &#125;: Props</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> list = <span class="keyword">type</span> === <span class="string">&#x27;gender&#x27;</span> ? genderList : photoList</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;styles.root&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">            &#123;list.map((item) =&gt; (</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">key</span>=<span class="string">&#123;item.title&#125;</span> <span class="attr">className</span>=<span class="string">&#x27;list-item&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    &#123;item.title&#125;</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            ))&#125;</span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;list-item&#x27;</span> <span class="attr">onClick</span>=<span class="string">&#123;onClose&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                取消</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> EditList</span><br></pre></td></tr></table></figure>

<h3 id="修改性别"><a href="#修改性别" class="headerlink" title="修改性别"></a>修改性别</h3><ol>
<li>父组件把 onUpdate 传递给子组件。</li>
</ol>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> onUpdate = <span class="keyword">async</span> (key: <span class="built_in">string</span>, <span class="attr">value</span>: <span class="built_in">string</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">await</span> dispatch(updateUserProfile(key, value))</span><br><span class="line">    Toast.show(&#123; <span class="attr">icon</span>: <span class="string">&#x27;success&#x27;</span>, <span class="attr">content</span>: <span class="string">&#x27;修改成功&#x27;</span> &#125;)</span><br><span class="line">    hideInput()</span><br><span class="line">    hideList()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;EditList onClose=&#123;hideList&#125; <span class="keyword">type</span>=&#123;showList.type&#125; onUpdate=&#123;onUpdate&#125; /&gt;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>子组件注册点击事件并调用 onUpdate。</li>
</ol>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&#x27;./index.module.scss&#x27;</span></span><br><span class="line"><span class="keyword">type</span> Props = &#123;</span><br><span class="line">    <span class="attr">onClose</span>: <span class="function">() =&gt;</span> <span class="built_in">void</span></span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;&#x27;</span> | <span class="string">&#x27;gender&#x27;</span> | <span class="string">&#x27;photo&#x27;</span></span><br><span class="line">    <span class="comment">// #1</span></span><br><span class="line">    <span class="attr">onUpdate</span>: <span class="function">(<span class="params">key: <span class="built_in">string</span>, value: <span class="built_in">string</span></span>) =&gt;</span> <span class="built_in">void</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> genderList = [</span><br><span class="line">    &#123; <span class="attr">title</span>: <span class="string">&#x27;男&#x27;</span>, <span class="attr">value</span>: <span class="string">&#x27;0&#x27;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">title</span>: <span class="string">&#x27;女&#x27;</span>, <span class="attr">value</span>: <span class="string">&#x27;1&#x27;</span> &#125;,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> photoList = [</span><br><span class="line">    &#123; <span class="attr">title</span>: <span class="string">&#x27;拍照&#x27;</span>, <span class="attr">value</span>: <span class="string">&#x27;&#x27;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">title</span>: <span class="string">&#x27;本地选择&#x27;</span>, <span class="attr">value</span>: <span class="string">&#x27;&#x27;</span> &#125;,</span><br><span class="line">]</span><br><span class="line"><span class="comment">// #2</span></span><br><span class="line"><span class="keyword">const</span> EditList = <span class="function">(<span class="params">&#123; onClose, <span class="keyword">type</span>, onUpdate &#125;: Props</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> list = <span class="keyword">type</span> === <span class="string">&#x27;gender&#x27;</span> ? genderList : photoList</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;styles.root&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">            &#123;/* #3 onClick */&#125;</span></span><br><span class="line"><span class="xml">            &#123;list.map((item) =&gt; (</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">key</span>=<span class="string">&#123;item.title&#125;</span> <span class="attr">className</span>=<span class="string">&#x27;list-item&#x27;</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> onUpdate(type, item.value)&#125;&gt;</span></span><br><span class="line"><span class="xml">                    &#123;item.title&#125;</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            ))&#125;</span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;list-item&#x27;</span> <span class="attr">onClick</span>=<span class="string">&#123;onClose&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                取消</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> EditList</span><br></pre></td></tr></table></figure>

<h3 id="修改头像"><a href="#修改头像" class="headerlink" title="修改头像"></a>修改头像</h3><h4 id="弹窗选择图片"><a href="#弹窗选择图片" class="headerlink" title="弹窗选择图片"></a>弹窗选择图片</h4><h5 id="目标-14"><a href="#目标-14" class="headerlink" title="目标"></a>目标</h5><p>能够在点击拍照或本地选择时弹窗选择图片。</p>
<h5 id="代码-8"><a href="#代码-8" class="headerlink" title="代码"></a>代码</h5><p><code>pages/Profile/Edit/index.tsx</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState, useRef &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; Button, List, DatePicker, NavBar, Popup, Toast &#125; <span class="keyword">from</span> <span class="string">&#x27;antd-mobile&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useHistory &#125; <span class="keyword">from</span> <span class="string">&#x27;react-router-dom&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useDispatch &#125; <span class="keyword">from</span> <span class="string">&#x27;react-redux&#x27;</span></span><br><span class="line"><span class="keyword">import</span> classNames <span class="keyword">from</span> <span class="string">&#x27;classnames&#x27;</span></span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&#x27;./index.module.scss&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; getUserProfile, updateUserProfile &#125; <span class="keyword">from</span> <span class="string">&#x27;@/store/actions/profile&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useInitState &#125; <span class="keyword">from</span> <span class="string">&#x27;@/utils/hooks&#x27;</span></span><br><span class="line"><span class="keyword">import</span> EditInput <span class="keyword">from</span> <span class="string">&#x27;./EditInput&#x27;</span></span><br><span class="line"><span class="keyword">import</span> EditList <span class="keyword">from</span> <span class="string">&#x27;./EditList&#x27;</span></span><br><span class="line"><span class="keyword">const</span> Item = List.Item</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> InputState = &#123;</span><br><span class="line">    <span class="attr">visible</span>: <span class="built_in">boolean</span></span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;&#x27;</span> | <span class="string">&#x27;name&#x27;</span> | <span class="string">&#x27;intro&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> ListState = &#123;</span><br><span class="line">    <span class="attr">visible</span>: <span class="built_in">boolean</span></span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;&#x27;</span> | <span class="string">&#x27;gender&#x27;</span> | <span class="string">&#x27;photo&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ProfileEdit = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> history = useHistory()</span><br><span class="line">    <span class="keyword">const</span> dispatch = useDispatch()</span><br><span class="line">    <span class="keyword">const</span> &#123; userProfile &#125; = useInitState(getUserProfile, <span class="string">&#x27;profile&#x27;</span>)</span><br><span class="line">    <span class="keyword">const</span> [showInput, setShowInput] = useState&lt;InputState&gt;(&#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="attr">visible</span>: <span class="literal">false</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">const</span> [showList, setShowList] = useState&lt;ListState&gt;(&#123;</span><br><span class="line">        <span class="attr">visible</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">const</span> hideInput = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        setShowInput(&#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="attr">visible</span>: <span class="literal">false</span>,</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> hideList = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        setShowList(&#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="attr">visible</span>: <span class="literal">false</span>,</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// #3</span></span><br><span class="line">    <span class="keyword">const</span> fileRef = useRef&lt;HTMLInputElement&gt;(<span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">const</span> onUpdate = <span class="keyword">async</span> (key: <span class="built_in">string</span>, <span class="attr">value</span>: <span class="built_in">string</span>) =&gt; &#123;</span><br><span class="line">        <span class="comment">// #1 修改头像</span></span><br><span class="line">        <span class="keyword">if</span> (key === <span class="string">&#x27;photo&#x27;</span>) &#123;</span><br><span class="line">            fileRef.current!.click()</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">await</span> dispatch(updateUserProfile(key, value))</span><br><span class="line">        Toast.show(&#123; <span class="attr">icon</span>: <span class="string">&#x27;success&#x27;</span>, <span class="attr">content</span>: <span class="string">&#x27;修改成功&#x27;</span> &#125;)</span><br><span class="line">        hideInput()</span><br><span class="line">        hideList()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;styles.root&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;content&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                &#123;/* 标题 */&#125;</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">NavBar</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                    <span class="attr">style</span>=<span class="string">&#123;&#123;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                        &#x27;<span class="attr">--border-bottom</span>&#x27;<span class="attr">:</span> &#x27;<span class="attr">1px</span> <span class="attr">solid</span> #<span class="attr">F0F0F0</span>&#x27;,</span></span></span><br><span class="line"><span class="tag"><span class="xml">                    &#125;&#125;</span></span></span><br><span class="line"><span class="tag"><span class="xml">                    <span class="attr">onBack</span>=<span class="string">&#123;()</span> =&gt;</span> history.go(-1)&#125;</span></span><br><span class="line"><span class="xml">                &gt;</span></span><br><span class="line"><span class="xml">                    个人信息</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">NavBar</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;wrapper&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    &#123;/* 列表 */&#125;</span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">List</span> <span class="attr">className</span>=<span class="string">&#x27;profile-list&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        &#123;/* 列表项 */&#125;</span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">Item</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                            <span class="attr">extra</span>=<span class="string">&#123;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                                &lt;<span class="attr">span</span> <span class="attr">className</span>=<span class="string">&#x27;avatar-wrapper&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                                    <span class="tag">&lt;<span class="name">img</span> <span class="attr">width</span>=<span class="string">&#123;24&#125;</span> <span class="attr">height</span>=<span class="string">&#123;24&#125;</span> <span class="attr">src</span>=<span class="string">&#123;userProfile.photo&#125;</span> <span class="attr">alt</span>=<span class="string">&#x27;&#x27;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                                <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">                            &#125;</span></span><br><span class="line"><span class="xml">                            arrow</span></span><br><span class="line"><span class="xml">                            onClick=&#123;() =&gt;</span></span><br><span class="line"><span class="xml">                                setShowList(&#123;</span></span><br><span class="line"><span class="xml">                                    visible: true,</span></span><br><span class="line"><span class="xml">                                    type: &#x27;photo&#x27;,</span></span><br><span class="line"><span class="xml">                                &#125;)</span></span><br><span class="line"><span class="xml">                            &#125;</span></span><br><span class="line"><span class="xml">                        &gt;</span></span><br><span class="line"><span class="xml">                            头像</span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;/<span class="name">Item</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">Item</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                            <span class="attr">arrow</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                            <span class="attr">extra</span>=<span class="string">&#123;userProfile.name&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                            <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span></span></span><br><span class="line"><span class="xml">                                setShowInput(&#123;</span></span><br><span class="line"><span class="xml">                                    visible: true,</span></span><br><span class="line"><span class="xml">                                    type: &#x27;name&#x27;,</span></span><br><span class="line"><span class="xml">                                &#125;)</span></span><br><span class="line"><span class="xml">                            &#125;</span></span><br><span class="line"><span class="xml">                        &gt;</span></span><br><span class="line"><span class="xml">                            昵称</span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;/<span class="name">Item</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">Item</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                            <span class="attr">arrow</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                            <span class="attr">extra</span>=<span class="string">&#123;</span>&lt;<span class="attr">span</span> <span class="attr">className</span>=<span class="string">&#123;classNames(</span>&#x27;<span class="attr">intro</span>&#x27;, <span class="attr">userProfile.intro</span> &amp;&amp; &#x27;<span class="attr">normal</span>&#x27;)&#125;&gt;</span>&#123;userProfile.intro || &#x27;未填写&#x27;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span>&#125;</span></span><br><span class="line"><span class="xml">                            onClick=&#123;() =&gt;</span></span><br><span class="line"><span class="xml">                                setShowInput(&#123;</span></span><br><span class="line"><span class="xml">                                    visible: true,</span></span><br><span class="line"><span class="xml">                                    type: &#x27;intro&#x27;,</span></span><br><span class="line"><span class="xml">                                &#125;)</span></span><br><span class="line"><span class="xml">                            &#125;</span></span><br><span class="line"><span class="xml">                        &gt;</span></span><br><span class="line"><span class="xml">                            简介</span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;/<span class="name">Item</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">List</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">List</span> <span class="attr">className</span>=<span class="string">&#x27;profile-list&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">Item</span> <span class="attr">arrow</span> <span class="attr">extra</span>=<span class="string">&#123;userProfile.gender</span> === <span class="string">0</span> ? &#x27;男&#x27; <span class="attr">:</span> &#x27;女&#x27;&#125; <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> setShowList(&#123; visible: true, type: &#x27;gender&#x27; &#125;)&#125;&gt;</span></span><br><span class="line"><span class="xml">                            性别</span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;/<span class="name">Item</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">Item</span> <span class="attr">arrow</span> <span class="attr">extra</span>=<span class="string">&#123;userProfile.birthday&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                            生日</span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;/<span class="name">Item</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">List</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">DatePicker</span> <span class="attr">visible</span>=<span class="string">&#123;false&#125;</span> <span class="attr">value</span>=<span class="string">&#123;new</span> <span class="attr">Date</span>()&#125; <span class="attr">title</span>=<span class="string">&#x27;选择年月日&#x27;</span> <span class="attr">min</span>=<span class="string">&#123;new</span> <span class="attr">Date</span>(<span class="attr">1900</span>, <span class="attr">0</span>, <span class="attr">1</span>, <span class="attr">0</span>, <span class="attr">0</span>, <span class="attr">0</span>)&#125; <span class="attr">max</span>=<span class="string">&#123;new</span> <span class="attr">Date</span>()&#125; /&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;logout&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">Button</span> <span class="attr">className</span>=<span class="string">&#x27;btn&#x27;</span>&gt;</span>退出登录<span class="tag">&lt;/<span class="name">Button</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            &#123;/* #2 */&#125;</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&#x27;file&#x27;</span> <span class="attr">hidden</span> <span class="attr">ref</span>=<span class="string">&#123;fileRef&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Popup</span> <span class="attr">visible</span>=<span class="string">&#123;showInput.visible&#125;</span> <span class="attr">position</span>=<span class="string">&#x27;right&#x27;</span> <span class="attr">onMaskClick</span>=<span class="string">&#123;()</span> =&gt;</span> setShowInput(&#123; type: &#x27;&#x27;, visible: false &#125;)&#125; destroyOnClose&gt;</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">EditInput</span> <span class="attr">hideInput</span>=<span class="string">&#123;hideInput&#125;</span> <span class="attr">type</span>=<span class="string">&#123;showInput.type&#125;</span> <span class="attr">onUpdate</span>=<span class="string">&#123;onUpdate&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">Popup</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Popup</span> <span class="attr">visible</span>=<span class="string">&#123;showList.visible&#125;</span> <span class="attr">position</span>=<span class="string">&#x27;bottom&#x27;</span> <span class="attr">destroyOnClose</span> <span class="attr">onMaskClick</span>=<span class="string">&#123;hideList&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">EditList</span> <span class="attr">onClose</span>=<span class="string">&#123;hideList&#125;</span> <span class="attr">type</span>=<span class="string">&#123;showList.type&#125;</span> <span class="attr">onUpdate</span>=<span class="string">&#123;onUpdate&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">Popup</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> ProfileEdit</span><br></pre></td></tr></table></figure>

<h4 id="获取选择的头像"><a href="#获取选择的头像" class="headerlink" title="获取选择的头像"></a>获取选择的头像</h4><h5 id="目标-15"><a href="#目标-15" class="headerlink" title="目标"></a>目标</h5><p>能够组装修改头像需要的数据。</p>
<h5 id="步骤-9"><a href="#步骤-9" class="headerlink" title="步骤"></a>步骤</h5><ol>
<li><p>创建函数，监听 <code>input[type=file]</code> 选择文件的变化 change。</p>
</li>
<li><p>在函数中，创建 FormData 对象。</p>
</li>
<li><p>根据接口，拿到接口需要规定的参数名，并将选择的文件添加到 FormData 对象中。</p>
</li>
</ol>
<h5 id="代码-9"><a href="#代码-9" class="headerlink" title="代码"></a>代码</h5><p><code>pages/Profile/Edit/index.tsx</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// e =&gt; 移上 e</span></span><br><span class="line"><span class="keyword">const</span> onChangePhoto = <span class="function">(<span class="params">e: React.ChangeEvent&lt;HTMLInputElement&gt;</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> file = e.target.files![<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">const</span> fd = <span class="keyword">new</span> FormData()</span><br><span class="line">    fd.append(<span class="string">&#x27;photo&#x27;</span>, file)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;input <span class="keyword">type</span>=<span class="string">&#x27;file&#x27;</span> hidden ref=&#123;fileRef&#125; onChange=&#123;onChangePhoto&#125; /&gt;</span><br></pre></td></tr></table></figure>

<h4 id="更新头像"><a href="#更新头像" class="headerlink" title="更新头像"></a>更新头像</h4><h5 id="目标-16"><a href="#目标-16" class="headerlink" title="目标"></a>目标</h5><p>能够实现更新头像。</p>
<h5 id="步骤-10"><a href="#步骤-10" class="headerlink" title="步骤"></a>步骤</h5><ol>
<li><p>在 Edit 组件中，分发修改头像的 action，传入 FormData 对象，并关闭弹出层。</p>
</li>
<li><p>在 actions 中，创建修改头像的 action，接收到传递过来的 FormData 对象。</p>
</li>
<li><p>发送请求，更新用户头像。</p>
</li>
<li><p>分发 action 重新渲染。</p>
</li>
</ol>
<h5 id="代码-10"><a href="#代码-10" class="headerlink" title="代码"></a>代码</h5><p><code>actions/profile.ts</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">updateUserPhoto</span>(<span class="params">fd: FormData</span>): <span class="title">RootThunkAction</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">async</span> (dispatch) =&gt; &#123;</span><br><span class="line">        <span class="keyword">await</span> request.patch(<span class="string">&#x27;/user/photo&#x27;</span>, fd)</span><br><span class="line">        dispatch(getUserProfile())</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>pages/Profile/Edit/index.tsx</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> onChangePhoto = <span class="keyword">async</span> (e: React.ChangeEvent&lt;HTMLInputElement&gt;) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> file = e.target.files![<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">const</span> fd = <span class="keyword">new</span> FormData()</span><br><span class="line">    fd.append(<span class="string">&#x27;photo&#x27;</span>, file)</span><br><span class="line">    <span class="comment">// #1</span></span><br><span class="line">    <span class="keyword">await</span> dispatch(updateUserPhoto(fd))</span><br><span class="line">    <span class="comment">// #2</span></span><br><span class="line">    Toast.show(&#123;</span><br><span class="line">        <span class="attr">icon</span>: <span class="string">&#x27;success&#x27;</span>,</span><br><span class="line">        <span class="attr">content</span>: <span class="string">&#x27;修改头像成功&#x27;</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">// #3</span></span><br><span class="line">    hideList()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="修改生日"><a href="#修改生日" class="headerlink" title="修改生日"></a>修改生日</h3><p><code>pages/Profile/Edit/index.tsx</code></p>
<ol>
<li>创建状态 showBirthday 用来控制日期选择器的展示或隐藏。</li>
</ol>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> [showBirthday, setShowBirthday] = useState(<span class="literal">false</span>)</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>将 showBirthday 设置为日期选择器的 visible 属性。</li>
</ol>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;DatePicker visible=&#123;showBirthday&#125; title=<span class="string">&#x27;选择年月日&#x27;</span> /&gt;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>给生日绑定点击事件，在点击事件中修改 showBirthday 值为 true 来展示日期选择器。</li>
</ol>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> onBirthdayShow = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    setShowBirthday(<span class="literal">true</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;Item arrow extra=&#123;userProfile.birthday&#125; onClick=&#123;onBirthdayShow&#125;&gt;</span><br><span class="line">    生日</span><br><span class="line">&lt;/Item&gt;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>为日期选择器设置 value，值为用户的生日值。</li>
</ol>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;DatePicker visible=&#123;showBirthday&#125; title=<span class="string">&#x27;选择年月日&#x27;</span> value=&#123;<span class="keyword">new</span> <span class="built_in">Date</span>(userProfile.birthday)&#125; /&gt;</span><br></pre></td></tr></table></figure>

<p>有可能 value 没有生效，需要指定 min 属性。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;DatePicker visible=&#123;showBirthday&#125; title=<span class="string">&#x27;选择年月日&#x27;</span> value=&#123;<span class="keyword">new</span> <span class="built_in">Date</span>(userProfile.birthday)&#125; min=&#123;<span class="keyword">new</span> <span class="built_in">Date</span>(<span class="string">&#x27;1900-01-01&#x27;</span>)&#125; max=&#123;<span class="keyword">new</span> <span class="built_in">Date</span>()&#125; /&gt;</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>监听日期组件的 onCancel 事件，隐藏日期选择器。</li>
</ol>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;DatePicker visible=&#123;showBirthday&#125; title=<span class="string">&#x27;选择年月日&#x27;</span> onCancel=&#123;onBirthdayHide&#125; value=&#123;<span class="keyword">new</span> <span class="built_in">Date</span>(userProfile.birthday)&#125; min=&#123;<span class="keyword">new</span> <span class="built_in">Date</span>(<span class="string">&#x27;1900-01-01&#x27;</span>)&#125; max=&#123;<span class="keyword">new</span> <span class="built_in">Date</span>()&#125; /&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> onBirthdayHide = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    setShowBirthday(<span class="literal">false</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="6">
<li>修改功能。</li>
</ol>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;DatePicker</span><br><span class="line">    visible=&#123;showBirthday&#125;</span><br><span class="line">    title=<span class="string">&#x27;选择年月日&#x27;</span></span><br><span class="line">    onCancel=&#123;onBirthdayHide&#125;</span><br><span class="line">    value=&#123;<span class="keyword">new</span> <span class="built_in">Date</span>(userProfile.birthday)&#125;</span><br><span class="line">    min=&#123;<span class="keyword">new</span> <span class="built_in">Date</span>(<span class="string">&#x27;1900-01-01&#x27;</span>)&#125;</span><br><span class="line">    max=&#123;<span class="keyword">new</span> <span class="built_in">Date</span>()&#125;</span><br><span class="line">    onConfirm=&#123;<span class="function">(<span class="params">val</span>) =&gt;</span> &#123;</span><br><span class="line">        onUpdate(<span class="string">&#x27;birthday&#x27;</span>, dayjs(val).format(<span class="string">&#x27;YYYY-MM-DD&#x27;</span>))</span><br><span class="line">    &#125;&#125;</span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure>

<h2 id="退出登录功能"><a href="#退出登录功能" class="headerlink" title="退出登录功能"></a>退出登录功能</h2><h3 id="弹窗确认"><a href="#弹窗确认" class="headerlink" title="弹窗确认"></a>弹窗确认</h3><h4 id="目标-17"><a href="#目标-17" class="headerlink" title="目标"></a>目标</h4><p>能够点击退出按钮时弹窗确认是否退出。</p>
<h4 id="分析-4"><a href="#分析-4" class="headerlink" title="分析"></a>分析</h4><p>不需要自定义样式的情况下，使用 <code>Dialog.confirm</code> 来弹窗确认即可。如果需要自定义弹窗按钮的样式，需要使用 <code>Dialog.show</code> 基础方法来实现。</p>
<h4 id="步骤-11"><a href="#步骤-11" class="headerlink" title="步骤"></a>步骤</h4><ol>
<li><p>为退出登录按钮绑定点击事件。</p>
</li>
<li><p>在点击事件中，使用 Dialog 弹窗让用户确认是否退出登录。</p>
</li>
</ol>
<h4 id="代码-11"><a href="#代码-11" class="headerlink" title="代码"></a>代码</h4><p><code>pages/Profile/Edit/index.tsx</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> logoutFn = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    Dialog.show(&#123;</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&#x27;温馨提示&#x27;</span>,</span><br><span class="line">        <span class="attr">content</span>: <span class="string">&#x27;你确定要退出吗？&#x27;</span>,</span><br><span class="line">        <span class="attr">closeOnAction</span>: <span class="literal">true</span>, <span class="comment">// 触发操作后自动关闭</span></span><br><span class="line">        <span class="attr">actions</span>: [</span><br><span class="line">            [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">key</span>: <span class="string">&#x27;cancel&#x27;</span>,</span><br><span class="line">                    <span class="attr">text</span>: <span class="string">&#x27;取消&#x27;</span>,</span><br><span class="line">                    <span class="attr">style</span>: &#123;</span><br><span class="line">                        <span class="attr">color</span>: <span class="string">&#x27;blue&#x27;</span>,</span><br><span class="line">                    &#125;,</span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">key</span>: <span class="string">&#x27;confirm&#x27;</span>,</span><br><span class="line">                    <span class="attr">text</span>: <span class="string">&#x27;确定&#x27;</span>,</span><br><span class="line">                    <span class="attr">danger</span>: <span class="literal">true</span>,</span><br><span class="line">                    <span class="attr">bold</span>: <span class="literal">true</span>,</span><br><span class="line">                    <span class="attr">onClick</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">                        <span class="comment">// 1. 清除 Token，包含了本地的和 Redux 中的</span></span><br><span class="line">                        dispatch(logout())</span><br><span class="line">                        <span class="comment">// 2. 跳转到登录</span></span><br><span class="line">                        history.replace(<span class="string">&#x27;/login&#x27;</span>)</span><br><span class="line">                        <span class="comment">// 3. 给一个提示消息</span></span><br><span class="line">                        Toast.show(&#123;</span><br><span class="line">                            <span class="attr">icon</span>: <span class="string">&#x27;success&#x27;</span>,</span><br><span class="line">                            <span class="attr">content</span>: <span class="string">&#x27;退出成功&#x27;</span>,</span><br><span class="line">                        &#125;)</span><br><span class="line">                    &#125;,</span><br><span class="line">                &#125;,</span><br><span class="line">            ],</span><br><span class="line">        ],</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="功能完成"><a href="#功能完成" class="headerlink" title="功能完成"></a>功能完成</h3><h4 id="目标-18"><a href="#目标-18" class="headerlink" title="目标"></a>目标</h4><p>能够实现退出功能。</p>
<h4 id="步骤-12"><a href="#步骤-12" class="headerlink" title="步骤"></a>步骤</h4><ol>
<li><p>为退出按钮，绑定点击事件，在点击事件中分发退出 action。</p>
</li>
<li><p>在 <code>types/store.d.ts</code> 中，创建退出登录的 action 类型。</p>
</li>
</ol>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> LoginAction =</span><br><span class="line">    | &#123;</span><br><span class="line">          <span class="attr">type</span>: <span class="string">&#x27;login/login&#x27;</span></span><br><span class="line">          <span class="attr">payload</span>: Token</span><br><span class="line">      &#125;</span><br><span class="line">    | &#123;</span><br><span class="line">          <span class="attr">type</span>: <span class="string">&#x27;login/logout&#x27;</span></span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>在 <code>actions/login.ts</code> 中，创建退出 action 并清理 token。</li>
</ol>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">logout</span>(<span class="params"></span>): <span class="title">LoginAction</span> </span>&#123;</span><br><span class="line">    removeToken()</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;login/logout&#x27;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>在 <code>reducers/login.ts</code> 中，处理退出 action 清空 token。</li>
</ol>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Token &#125; <span class="keyword">from</span> <span class="string">&#x27;@/types/data&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; LoginAction &#125; <span class="keyword">from</span> <span class="string">&#x27;@/types/store&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; getToken &#125; <span class="keyword">from</span> <span class="string">&#x27;@/utils/storage&#x27;</span></span><br><span class="line"><span class="keyword">const</span> initState: Token = getToken()</span><br><span class="line"><span class="keyword">const</span> login = <span class="function">(<span class="params">state = initState, action: LoginAction</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (action.type === <span class="string">&#x27;login/login&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> action.payload</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// !mark</span></span><br><span class="line">    <span class="keyword">if</span> (action.type === <span class="string">&#x27;login/logout&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="attr">token</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="attr">refresh_token</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> state</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> login</span><br></pre></td></tr></table></figure>

<h2 id="界面访问控制"><a href="#界面访问控制" class="headerlink" title="界面访问控制"></a>界面访问控制</h2><h3 id="鉴权组件封装"><a href="#鉴权组件封装" class="headerlink" title="鉴权组件封装"></a>鉴权组件封装</h3><h4 id="目标-19"><a href="#目标-19" class="headerlink" title="目标"></a>目标</h4><p>能够封装鉴权路由组件实现登录访问控制功能，<a target="_blank" rel="noopener" href="https://v5.reactrouter.com/web/example/auth-workflow">链接</a>。</p>
<h4 id="步骤-13"><a href="#步骤-13" class="headerlink" title="步骤"></a>步骤</h4><ol>
<li><p>在 components 目录中创建 PrivateRoute 路由组件。</p>
</li>
<li><p>在 PrivateRoute 组件中，实现路由的登录访问控制逻辑。</p>
</li>
<li><p>未登录时，重定向到登录页面，并传递要访问的路由地址。</p>
</li>
<li><p>登录时，直接渲染要访问的路由。</p>
</li>
</ol>
<h4 id="代码-12"><a href="#代码-12" class="headerlink" title="代码"></a>代码</h4><p><code>components/PrivateRoute/index.tsx</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; hasToken &#125; <span class="keyword">from</span> <span class="string">&#x27;@/utils/storage&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; Route, Redirect, RouteProps &#125; <span class="keyword">from</span> <span class="string">&#x27;react-router-dom&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">PrivateRoute</span>(<span class="params">&#123; children, ...rest &#125;: RouteProps</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">Route</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">            &#123;<span class="attr">...rest</span>&#125;</span></span></span><br><span class="line"><span class="tag"><span class="xml">            <span class="attr">render</span>=<span class="string">&#123;(&#123;</span> <span class="attr">location</span> &#125;) =&gt;</span></span></span><br><span class="line"><span class="xml">                hasToken() ? (</span></span><br><span class="line"><span class="xml">                    children</span></span><br><span class="line"><span class="xml">                ) : (</span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">Redirect</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                        <span class="attr">to</span>=<span class="string">&#123;&#123;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                            <span class="attr">pathname:</span> &#x27;/<span class="attr">login</span>&#x27;,</span></span></span><br><span class="line"><span class="tag"><span class="xml">                            <span class="attr">state:</span> &#123; <span class="attr">from:</span> <span class="attr">location.pathname</span> &#125;,</span></span></span><br><span class="line"><span class="tag"><span class="xml">                        &#125;&#125;</span></span></span><br><span class="line"><span class="tag"><span class="xml">                    /&gt;</span></span></span><br><span class="line"><span class="xml">                )</span></span><br><span class="line"><span class="xml">            &#125;</span></span><br><span class="line"><span class="xml">        /&gt;</span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>App.tsx</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;PrivateRoute path=<span class="string">&#x27;/profile/edit&#x27;</span>&gt;</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">ProfileEdit</span> /&gt;</span></span></span><br><span class="line">&lt;/PrivateRoute&gt;</span><br></pre></td></tr></table></figure>

<p><code>pages/Layout/index.tsx</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;PrivateRoute path=<span class="string">&#x27;/home/profile&#x27;</span> exact&gt;</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">Profile</span> /&gt;</span></span></span><br><span class="line">&lt;/PrivateRoute&gt;</span><br></pre></td></tr></table></figure>

<h3 id="登录成功跳转到原页面"><a href="#登录成功跳转到原页面" class="headerlink" title="登录成功跳转到原页面"></a>登录成功跳转到原页面</h3><h4 id="目标-20"><a href="#目标-20" class="headerlink" title="目标"></a>目标</h4><p>能够在登录时根据重定向路径跳转到相应页面。</p>
<h4 id="步骤-14"><a href="#步骤-14" class="headerlink" title="步骤"></a>步骤</h4><ol>
<li><p>在 Login 组件中导入 useLocation 来获取路由重定向时传入的 state。</p>
</li>
<li><p>调用 useLocation hook 时，指定 state 的类型。</p>
</li>
<li><p>登录完成跳转页面时，判断 state 是否存在。</p>
</li>
<li><p>如果存在，跳转到 state 指定的页面。</p>
</li>
<li><p>如果不存在，默认跳转到首页。</p>
</li>
</ol>
<h4 id="代码-13"><a href="#代码-13" class="headerlink" title="代码"></a>代码</h4><p><code>pages/Login/index.tsx</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 记得定义参数的类型</span></span><br><span class="line"><span class="keyword">const</span> location = useLocation&lt;&#123; <span class="attr">from</span>: <span class="built_in">string</span> &#125;&gt;()</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> onFinish = <span class="keyword">async</span> (values: LoginForm) =&gt; &#123;</span><br><span class="line">    <span class="keyword">await</span> dispatch(login(values))</span><br><span class="line">    Toast.show(&#123;</span><br><span class="line">        <span class="attr">content</span>: <span class="string">&#x27;登录成功&#x27;</span>,</span><br><span class="line">        <span class="attr">icon</span>: <span class="string">&#x27;success&#x27;</span>,</span><br><span class="line">        <span class="attr">duration</span>: <span class="number">600</span>,</span><br><span class="line">        <span class="function"><span class="title">afterClose</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">            <span class="comment">// history.push(&#x27;/home&#x27;)</span></span><br><span class="line">            history.replace(location.state ? location.state.from : <span class="string">&#x27;/home&#x27;</span>)</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="刷新-Token"><a href="#刷新-Token" class="headerlink" title="刷新 Token"></a>刷新 Token</h2><h3 id="概述-1"><a href="#概述-1" class="headerlink" title="概述"></a>概述</h3><h4 id="目标-21"><a href="#目标-21" class="headerlink" title="目标"></a>目标</h4><p>能够理解什么是无感刷新 Token。</p>
<h4 id="分析-5"><a href="#分析-5" class="headerlink" title="分析"></a>分析</h4><p>一般情况下，我们用到的移动端的 App（比如，微信）只要登录过一次，一般就不需要再次重新登录，除非很长时间没有使用过 App，这是如何做到的呢？这就用到我们要讲的无感刷新 Token 了。</p>
<p>我们知道，登录时会拿到一个登录成功的标识 Token（身份令牌），有了这个令牌就可以进行登录后的操作了，比如，获取个人资料、修改个人信息等等。</p>
<p>但是，为了安全，登录标识 Token 一般都是有有效期的，比如，咱们的极客园项目中 Token 的有效期是 2 个小时，如果不进行额外的处理，2 小时以后，就得再次登录才可以，但是，这种用户体验不好，特别是移动端（不管是 App 还是 H5）。</p>
<p>相对来说，更好的用户体验是前面提到的微信的那种方式，它的原理简单来说是这样的，在登录时，同时拿到两个 Token。</p>
<ol>
<li><p>登录成功的令牌：<code>Token</code>。</p>
</li>
<li><p>刷新 Token 的令牌：<code>refresh_token</code>。</p>
</li>
</ol>
<p>刷新 Token 的令牌用来：在 Token 过期后，换取新的 Token（续费），从而实现“永久登录”效果，这就是所谓的：<strong>无感刷新 token</strong>。</p>
<img src="/resource/images/image-20210903111508949.png"/>

<p>思想总结如下。</p>
<ul>
<li><p>  无 Token，直接跳到登录页。</p>
</li>
<li><p>  有 Token，则用 Refresh Token 换新 Token：换成功则用新 Token 重发原先的请求，没换成功则跳到登录页。</p>
</li>
</ul>
<h3 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h3><h4 id="目标-22"><a href="#目标-22" class="headerlink" title="目标"></a>目标</h4><p>能够实现无感刷新 Token 实现自动登录。</p>
<h4 id="分析-6"><a href="#分析-6" class="headerlink" title="分析"></a>分析</h4><p>概述：在登录超时或者 Token 失效时，也就是服务器接口返回 401，通过 refresh_token 换取新的 Token。</p>
<p>过程如下（以获取个人资料数据为例）：</p>
<ol>
<li><p>发送请求获取个人资料数据。</p>
</li>
<li><p>接口返回 401，也就是 Token 失效了。</p>
</li>
<li><p>在响应拦截器中统一处理，换取新的 Token。</p>
</li>
<li><p>将新的 Token 存储到本地缓存中。</p>
</li>
<li><p>继续发送获取个人资料的请求，完成数据获取，关键点。</p>
</li>
<li><p>如果整个过程中出现了任意异常，一般来说就是 refresh_token 也过期了，换取 Token 失败，此时，要进行错误处理，也就是： 清除 Token，跳转到登录页面。</p>
</li>
</ol>
<p>axios 请求拦截过程说明：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1 axios.get()</span><br><span class="line">2 请求拦截器</span><br><span class="line">3 响应代码</span><br><span class="line">4 响应拦截器</span><br><span class="line"></span><br><span class="line">以上 4 个步骤的执行顺序：</span><br><span class="line"></span><br><span class="line">【1 axios.get()】 --&gt; 【2 请求拦截器】&gt;&gt;&gt; 服务器处理 &gt;&gt;&gt; 【4 响应拦截器】 --&gt; 【3 响应代码】</span><br></pre></td></tr></table></figure>

<h4 id="步骤-15"><a href="#步骤-15" class="headerlink" title="步骤"></a>步骤</h4><ol>
<li><p>使用 try-catch 处理异常，出现异常时，清除 token，清空 Redux token，跳转到登录页面。</p>
</li>
<li><p>判断本地存储中，是否有 <code>refresh_token</code>。</p>
</li>
<li><p>如果没有，直接跳转到登录页面，让用户登录即可。</p>
</li>
<li><p>如果有，就使用 <code>refresh_token</code> 来通过 <strong>axios</strong> 发送请求，换取新的 token。</p>
</li>
<li><p>将新获取到的 Token 存储到本地缓存中和 Redux 中。</p>
</li>
<li><p>继续发送原来的请求。</p>
</li>
</ol>
<h4 id="代码-14"><a href="#代码-14" class="headerlink" title="代码"></a>代码</h4><p><code>utils/request.ts</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">request.interceptors.response.use(</span><br><span class="line">    <span class="function"><span class="keyword">function</span> (<span class="params">response</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> response</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="keyword">function</span> (<span class="params">error: AxiosError&lt;&#123; message: <span class="built_in">string</span> &#125;&gt;</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!error.response) &#123;</span><br><span class="line">            <span class="comment">// Network Error</span></span><br><span class="line">            Toast.show(<span class="string">&#x27;网络繁忙，请稍后重试&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (error.response.status === <span class="number">401</span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> token = getToken()</span><br><span class="line">            <span class="comment">// #1 没有刷新 refresh_token</span></span><br><span class="line">            <span class="keyword">if</span> (!token.refresh_token) &#123;</span><br><span class="line">                history.replace(<span class="string">&#x27;/login&#x27;</span>, &#123;</span><br><span class="line">                    <span class="attr">from</span>: history.location.pathname,</span><br><span class="line">                &#125;)</span><br><span class="line">                Toast.show(<span class="string">&#x27;登录信息过期&#x27;</span>)</span><br><span class="line">                <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// #2 使用 refresh_token 换取新 token</span></span><br><span class="line">            <span class="comment">// ...</span></span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error)</span><br><span class="line">        &#125;</span><br><span class="line">        Toast.show(error.response.data.message)</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error)</span><br><span class="line">    &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p><code>utils/history.js</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createBrowserHistory &#125; <span class="keyword">from</span> <span class="string">&#x27;history&#x27;</span></span><br><span class="line"><span class="keyword">const</span> history = createBrowserHistory()</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> history</span><br></pre></td></tr></table></figure>

<p><code>src/App.tsx</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> history <span class="keyword">from</span> <span class="string">&#x27;./utils/history&#x27;</span></span><br><span class="line">;<span class="xml"><span class="tag">&lt;<span class="name">Router</span> <span class="attr">history</span>=<span class="string">&#123;history&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">Router</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p><code>actions/login.ts</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 改造了一下，方便复用</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">saveToken</span>(<span class="params">token: Token</span>): <span class="title">LoginAction</span> </span>&#123;</span><br><span class="line">    setToken(token)</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;login/login&#x27;</span>,</span><br><span class="line">        <span class="attr">payload</span>: token,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> login = (values: LoginForm): <span class="function"><span class="params">RootThunkAction</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">async</span> (dispatch) =&gt; &#123;</span><br><span class="line">        <span class="keyword">const</span> res = <span class="keyword">await</span> request.post&lt;ApiResponse&lt;Token&gt;&gt;(<span class="string">&#x27;/authorizations&#x27;</span>, values)</span><br><span class="line">        <span class="comment">/* dispatch(&#123;</span></span><br><span class="line"><span class="comment">            type: &#x27;login/login&#x27;,</span></span><br><span class="line"><span class="comment">            payload: res.data.data,</span></span><br><span class="line"><span class="comment">        &#125;)</span></span><br><span class="line"><span class="comment">        // !存到本地</span></span><br><span class="line"><span class="comment">        setToken(res.data.data) */</span></span><br><span class="line">        dispatch(saveToken(res.data.data))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>utils/request.ts</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">request.interceptors.response.use(</span><br><span class="line">    <span class="function"><span class="keyword">function</span> (<span class="params">response</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> response</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> (<span class="params">error: AxiosError&lt;&#123; message: <span class="built_in">string</span> &#125;&gt;</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!error.response) &#123;</span><br><span class="line">            <span class="comment">// Network Error</span></span><br><span class="line">            Toast.show(<span class="string">&#x27;网络繁忙，请稍后重试&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (error.response.status === <span class="number">401</span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> token = getToken()</span><br><span class="line">            <span class="comment">// !#1 没有刷新 refresh_token</span></span><br><span class="line">            <span class="keyword">if</span> (!token.refresh_token) &#123;</span><br><span class="line">                history.replace(<span class="string">&#x27;/login&#x27;</span>, &#123;</span><br><span class="line">                    <span class="attr">from</span>: history.location.pathname,</span><br><span class="line">                &#125;)</span><br><span class="line">                Toast.show(<span class="string">&#x27;登录信息过期&#x27;</span>)</span><br><span class="line">                <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// !#2 使用 refresh_token 换取新 token</span></span><br><span class="line">            <span class="comment">// axios.put(&#x27;/authorizations&#x27;, null, &#123; headers: &#123;&#125; &#125;)</span></span><br><span class="line">            <span class="keyword">const</span> res = <span class="keyword">await</span> axios.request&lt;ApiResponse&lt;&#123; <span class="attr">token</span>: <span class="built_in">string</span> &#125;&gt;&gt;(&#123;</span><br><span class="line">                <span class="attr">method</span>: <span class="string">&#x27;put&#x27;</span>,</span><br><span class="line">                <span class="attr">url</span>: <span class="string">&#x27;/authorizations&#x27;</span>,</span><br><span class="line">                baseURL,</span><br><span class="line">                <span class="attr">headers</span>: &#123;</span><br><span class="line">                    <span class="attr">Authorization</span>: <span class="string">`Bearer <span class="subst">$&#123;token.refresh_token&#125;</span>`</span>,</span><br><span class="line">                &#125;,</span><br><span class="line">            &#125;)</span><br><span class="line">            <span class="comment">// !#3 存储到本地和 Redux</span></span><br><span class="line">            store.dispatch(</span><br><span class="line">                saveToken(&#123;</span><br><span class="line">                    <span class="attr">token</span>: res.data.data.token,</span><br><span class="line">                    <span class="attr">refresh_token</span>: token.refresh_token,</span><br><span class="line">                &#125;)</span><br><span class="line">            )</span><br><span class="line">            <span class="comment">// !#4 重新发请求</span></span><br><span class="line">            <span class="keyword">return</span> request.request(error.config)</span><br><span class="line">        &#125;</span><br><span class="line">        Toast.show(error.response.data.message)</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error)</span><br><span class="line">    &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>刷新 Token 失败的处理。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">request.interceptors.response.use(</span><br><span class="line">    <span class="function"><span class="keyword">function</span> (<span class="params">response</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> response</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> (<span class="params">error: AxiosError&lt;&#123; message: <span class="built_in">string</span> &#125;&gt;</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!error.response) &#123;</span><br><span class="line">            <span class="comment">// Network Error</span></span><br><span class="line">            Toast.show(<span class="string">&#x27;网络繁忙，请稍后重试&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (error.response.status === <span class="number">401</span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> token = getToken()</span><br><span class="line">            <span class="comment">// !#1 没有刷新 refresh_token</span></span><br><span class="line">            <span class="keyword">if</span> (!token.refresh_token) &#123;</span><br><span class="line">                history.replace(<span class="string">&#x27;/login&#x27;</span>, &#123;</span><br><span class="line">                    <span class="attr">from</span>: history.location.pathname,</span><br><span class="line">                &#125;)</span><br><span class="line">                Toast.show(<span class="string">&#x27;登录信息过期&#x27;</span>)</span><br><span class="line">                <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// !#2 使用 refresh_token 换取新 token</span></span><br><span class="line">                <span class="comment">// axios.put(&#x27;/authorizations&#x27;, null, &#123; headers: &#123;&#125; &#125;)</span></span><br><span class="line">                <span class="keyword">const</span> res = <span class="keyword">await</span> axios.request&lt;ApiResponse&lt;&#123; <span class="attr">token</span>: <span class="built_in">string</span> &#125;&gt;&gt;(&#123;</span><br><span class="line">                    <span class="attr">method</span>: <span class="string">&#x27;put&#x27;</span>,</span><br><span class="line">                    <span class="attr">url</span>: <span class="string">&#x27;/authorizations&#x27;</span>,</span><br><span class="line">                    baseURL,</span><br><span class="line">                    <span class="attr">headers</span>: &#123;</span><br><span class="line">                        <span class="attr">Authorization</span>: <span class="string">`Bearer <span class="subst">$&#123;token.refresh_token&#125;</span>`</span>,</span><br><span class="line">                    &#125;,</span><br><span class="line">                &#125;)</span><br><span class="line">                <span class="comment">// !#3 存储到本地和 Redux</span></span><br><span class="line">                store.dispatch(</span><br><span class="line">                    saveToken(&#123;</span><br><span class="line">                        <span class="attr">token</span>: res.data.data.token,</span><br><span class="line">                        <span class="attr">refresh_token</span>: token.refresh_token,</span><br><span class="line">                    &#125;)</span><br><span class="line">                )</span><br><span class="line">                <span class="comment">// !#4 重新发请求</span></span><br><span class="line">                <span class="keyword">return</span> request.request(error.config)</span><br><span class="line">            &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">                <span class="comment">// 刷新 Token 失败</span></span><br><span class="line">                history.replace(<span class="string">&#x27;/login&#x27;</span>, &#123;</span><br><span class="line">                    <span class="attr">from</span>: history.location.pathname,</span><br><span class="line">                &#125;)</span><br><span class="line">                Toast.show(<span class="string">&#x27;登录信息失败&#x27;</span>)</span><br><span class="line">                <span class="comment">// store.dispatch(saveToken(&#123; token: &#x27;&#x27;, refresh_token: &#x27;&#x27; &#125;))</span></span><br><span class="line">                store.dispatch(logout())</span><br><span class="line">                <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        Toast.show(error.response.data.message)</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error)</span><br><span class="line">    &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h2 id="小智同学聊天"><a href="#小智同学聊天" class="headerlink" title="小智同学聊天"></a>小智同学聊天</h2><h3 id="WebSocket"><a href="#WebSocket" class="headerlink" title="WebSocket"></a>WebSocket</h3><h4 id="为什么需要"><a href="#为什么需要" class="headerlink" title="为什么需要"></a>为什么需要</h4><p>初次接触 WebSocket 的人，都会问同样的问题：我们已经有了 HTTP 协议，为什么还需要另一个协议？它能带来什么好处？</p>
<p>答案很简单，因为 HTTP 协议有一个缺陷：通信只能由客户端发起。http 基于请求响应实现。</p>
<p>举例来说，我们想了解今天的天气，只能是客户端向服务器发出请求，服务器返回查询结果。HTTP 协议做不到服务器主动向客户端推送信息。</p>
<p>这种单向请求的特点，注定了如果服务器有连续的状态变化，客户端要获知就非常麻烦。我们只能使用<a target="_blank" rel="noopener" href="https://www.pubnub.com/blog/2014-12-01-http-long-polling/">“轮询”</a>：每隔一段时候，就发出一个询问，了解服务器有没有新的信息。最典型的场景就是聊天室。</p>
<p>轮询的效率低，非常浪费资源（因为必须不停连接，或者 HTTP 连接始终打开）。因此，工程师们一直在思考，有没有更好的方法。WebSocket 就是这样发明的。</p>
<h4 id="基本介绍"><a href="#基本介绍" class="headerlink" title="基本介绍"></a>基本介绍</h4><p>WebSocket 是一种数据通信协议，类似于我们常见的 http 协议，在 2008 年诞生，2011 年成为国际标准。所有浏览器都已经支持了。</p>
<p>它的最大特点就是，服务器可以主动向客户端推送信息，客户端也可以主动向服务器发送信息，是真正的双向平等对话，属于<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Push_technology">服务器推送技术</a>的一种。</p>
<p>典型的 websocket 应用场景：客服、聊天室、广播、点餐通知等等。</p>
<p><img src="/resource/images/image-20201121170006970.png" alt="image-20201121170006970"></p>
<h3 id="静态结构"><a href="#静态结构" class="headerlink" title="静态结构"></a>静态结构</h3><p><code>pages/Profile/Chat/index.tsx</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Icon <span class="keyword">from</span> <span class="string">&#x27;@/components/Icon&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; NavBar, Input &#125; <span class="keyword">from</span> <span class="string">&#x27;antd-mobile&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useHistory &#125; <span class="keyword">from</span> <span class="string">&#x27;react-router-dom&#x27;</span></span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&#x27;./index.module.scss&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Chat = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> history = useHistory()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;styles.root&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">            &#123;/* 顶部导航栏 */&#125;</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">NavBar</span> <span class="attr">className</span>=<span class="string">&#x27;fixed-header&#x27;</span> <span class="attr">onBack</span>=<span class="string">&#123;()</span> =&gt;</span> history.go(-1)&#125;&gt;</span></span><br><span class="line"><span class="xml">                小智同学</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">NavBar</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">            &#123;/* 聊天记录列表 */&#125;</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;chat-list&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                &#123;/* 机器人的消息 */&#125;</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;chat-item&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">Icon</span> <span class="attr">type</span>=<span class="string">&#x27;iconbtn_xiaozhitongxue&#x27;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;message&#x27;</span>&gt;</span>你好！<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">                &#123;/* 用户的消息 */&#125;</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;chat-item user&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&#123;</span>&#x27;<span class="attr">http:</span>//<span class="attr">toutiao.itheima.net</span>/<span class="attr">images</span>/<span class="attr">user_head.jpg</span>&#x27;&#125; <span class="attr">alt</span>=<span class="string">&#x27;&#x27;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;message&#x27;</span>&gt;</span>你好？<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">            &#123;/* 底部消息输入框 */&#125;</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;input-footer&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Input</span> <span class="attr">className</span>=<span class="string">&#x27;no-border&#x27;</span> <span class="attr">placeholder</span>=<span class="string">&#x27;请描述您的问题&#x27;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Icon</span> <span class="attr">type</span>=<span class="string">&#x27;iconbianji&#x27;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Chat</span><br></pre></td></tr></table></figure>

<p><code>pages/Profile/Chat/index.module.scss</code></p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@import</span> <span class="string">&#x27;~@scss/hairline.scss&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.root</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: fixed;</span><br><span class="line">    <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">bottom</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">right</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">46px</span> <span class="number">0</span> <span class="number">50px</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    :global &#123;</span><br><span class="line">        .fixed-header &#123;</span><br><span class="line">            position: fixed;</span><br><span class="line">            <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">            <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">            <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="selector-class">.chat-list</span> &#123;</span><br><span class="line">            <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">            <span class="attribute">overflow-y</span>: scroll;</span><br><span class="line">            <span class="attribute">padding</span>: <span class="number">15px</span> <span class="number">16px</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="selector-class">.chat-item</span> &#123;</span><br><span class="line">            <span class="attribute">display</span>: flex;</span><br><span class="line">            <span class="attribute">margin-bottom</span>: <span class="number">12px</span>;</span><br><span class="line"></span><br><span class="line">            <span class="selector-tag">img</span> &#123;</span><br><span class="line">                <span class="attribute">width</span>: <span class="number">32px</span>;</span><br><span class="line">                <span class="attribute">height</span>: <span class="number">32px</span>;</span><br><span class="line">                <span class="attribute">border-radius</span>: <span class="number">50%</span>;</span><br><span class="line">                <span class="selector-tag">object</span>-fit: cover;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="selector-class">.icon</span> &#123;</span><br><span class="line">                <span class="attribute">width</span>: <span class="number">32px</span>;</span><br><span class="line">                <span class="attribute">height</span>: <span class="number">32px</span>;</span><br><span class="line">                <span class="attribute">margin-right</span>: <span class="number">8px</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="selector-class">.message</span> &#123;</span><br><span class="line">                <span class="attribute">max-width</span>: <span class="number">254px</span>;</span><br><span class="line">                <span class="attribute">padding</span>: <span class="number">12px</span> <span class="number">8px</span>;</span><br><span class="line">                <span class="attribute">line-height</span>: <span class="number">1.4</span>;</span><br><span class="line">                <span class="attribute">border-radius</span>: <span class="number">5px</span>;</span><br><span class="line">                <span class="attribute">font-size</span>: <span class="number">14px</span>;</span><br><span class="line">                <span class="attribute">background-color</span>: <span class="number">#f7f8fa</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="selector-class">.user</span> &#123;</span><br><span class="line">            <span class="attribute">flex-direction</span>: row-reverse;</span><br><span class="line"></span><br><span class="line">            <span class="selector-class">.icon</span>,</span><br><span class="line">            <span class="selector-tag">img</span> &#123;</span><br><span class="line">                <span class="attribute">margin-right</span>: <span class="number">0</span>;</span><br><span class="line">                <span class="attribute">margin-left</span>: <span class="number">8px</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="selector-class">.input-footer</span> &#123;</span><br><span class="line">            <span class="attribute">position</span>: fixed;</span><br><span class="line">            <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">            <span class="attribute">right</span>: <span class="number">0</span>;</span><br><span class="line">            <span class="attribute">bottom</span>: <span class="number">0</span>;</span><br><span class="line">            <span class="attribute">height</span>: <span class="number">50px</span>;</span><br><span class="line">            <span class="attribute">padding</span>: <span class="number">7px</span> <span class="number">16px</span>;</span><br><span class="line"></span><br><span class="line">            <span class="selector-class">.input</span> &#123;</span><br><span class="line">                <span class="attribute">height</span>: <span class="number">36px</span>;</span><br><span class="line">                <span class="attribute">min-height</span>: <span class="number">0</span>;</span><br><span class="line">                <span class="attribute">padding-left</span>: <span class="number">27px</span>;</span><br><span class="line">                <span class="attribute">border-radius</span>: <span class="number">18px</span>;</span><br><span class="line">                <span class="attribute">background-color</span>: <span class="number">#f7f8fa</span>;</span><br><span class="line">                <span class="attribute">font-size</span>: <span class="number">14px</span>;</span><br><span class="line">                &amp;<span class="selector-pseudo">::placeholder</span> &#123;</span><br><span class="line">                    <span class="attribute">font-size</span>: <span class="number">14px</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="selector-class">.no-border</span> &#123;</span><br><span class="line">                <span class="keyword">@include</span> hairline-remove(bottom);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="selector-class">.icon</span> &#123;</span><br><span class="line">                <span class="attribute">position</span>: absolute;</span><br><span class="line">                <span class="attribute">top</span>: <span class="number">50%</span>;</span><br><span class="line">                <span class="attribute">margin-top</span>: -<span class="number">6.5px</span>;</span><br><span class="line">                <span class="attribute">margin-left</span>: <span class="number">10px</span>;</span><br><span class="line">                <span class="attribute">font-size</span>: <span class="number">13px</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>App.tsx</code> 中配置路由出口。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;PrivateRoute path=<span class="string">&#x27;/chat&#x27;</span>&gt;</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">Chat</span> /&gt;</span></span></span><br><span class="line">&lt;/PrivateRoute&gt;</span><br></pre></td></tr></table></figure>

<h3 id="渲染聊天记录"><a href="#渲染聊天记录" class="headerlink" title="渲染聊天记录"></a>渲染聊天记录</h3><ol>
<li>声明一个数组状态。</li>
</ol>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> [messageList, setMessageList] = useState&lt;&#123; <span class="attr">type</span>: <span class="string">&#x27;robot&#x27;</span> | <span class="string">&#x27;user&#x27;</span>; text: <span class="built_in">string</span> &#125;[]&gt;([</span><br><span class="line">    &#123; <span class="attr">type</span>: <span class="string">&#x27;robot&#x27;</span>, <span class="attr">text</span>: <span class="string">&#x27;亲爱的用户您好，小智同学为您服务。&#x27;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">type</span>: <span class="string">&#x27;user&#x27;</span>, <span class="attr">text</span>: <span class="string">&#x27;你好&#x27;</span> &#125;,</span><br><span class="line">])</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>从 Redux 中获取当前用户基本信息。</li>
</ol>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 用户渲染用户头像</span></span><br><span class="line"><span class="keyword">const</span> &#123; user &#125; = useInitState(getUser, <span class="string">&#x27;profile&#x27;</span>)</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>根据数组数据，动态渲染聊天记录列表。</li>
</ol>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Icon <span class="keyword">from</span> <span class="string">&#x27;@/components/Icon&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; NavBar, Input &#125; <span class="keyword">from</span> <span class="string">&#x27;antd-mobile&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useHistory &#125; <span class="keyword">from</span> <span class="string">&#x27;react-router-dom&#x27;</span></span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&#x27;./index.module.scss&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useInitState &#125; <span class="keyword">from</span> <span class="string">&#x27;@/utils/hooks&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; getUser &#125; <span class="keyword">from</span> <span class="string">&#x27;@/store/actions/profile&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Chat = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> history = useHistory()</span><br><span class="line">    <span class="comment">// #1</span></span><br><span class="line">    <span class="keyword">const</span> [messageList] = useState&lt;&#123; <span class="attr">type</span>: <span class="string">&#x27;robot&#x27;</span> | <span class="string">&#x27;user&#x27;</span>; text: <span class="built_in">string</span> &#125;[]&gt;([</span><br><span class="line">        &#123; <span class="attr">type</span>: <span class="string">&#x27;robot&#x27;</span>, <span class="attr">text</span>: <span class="string">&#x27;亲爱的用户您好，小智同学为您服务。&#x27;</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">type</span>: <span class="string">&#x27;user&#x27;</span>, <span class="attr">text</span>: <span class="string">&#x27;你好&#x27;</span> &#125;,</span><br><span class="line">    ])</span><br><span class="line">    <span class="comment">// #2</span></span><br><span class="line">    <span class="keyword">const</span> &#123; user &#125; = useInitState(getUser, <span class="string">&#x27;profile&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;styles.root&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">            &#123;/* 顶部导航栏 */&#125;</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">NavBar</span> <span class="attr">className</span>=<span class="string">&#x27;fixed-header&#x27;</span> <span class="attr">onBack</span>=<span class="string">&#123;()</span> =&gt;</span> history.go(-1)&#125;&gt;</span></span><br><span class="line"><span class="xml">                小智同学</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">NavBar</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;chat-list&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                &#123;/* #3 */&#125;</span></span><br><span class="line"><span class="xml">                &#123;messageList.map((msg, index) =&gt; &#123;</span></span><br><span class="line"><span class="xml">                    if (msg.type === &#x27;robot&#x27;) &#123;</span></span><br><span class="line"><span class="xml">                        // 机器</span></span><br><span class="line"><span class="xml">                        return (</span></span><br><span class="line"><span class="xml">                            <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;chat-item&#x27;</span> <span class="attr">key</span>=<span class="string">&#123;index&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                                <span class="tag">&lt;<span class="name">Icon</span> <span class="attr">type</span>=<span class="string">&#x27;iconbtn_xiaozhitongxue&#x27;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                                <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;message&#x27;</span>&gt;</span>&#123;msg.text&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        )</span></span><br><span class="line"><span class="xml">                    &#125; else &#123;</span></span><br><span class="line"><span class="xml">                        // 用户</span></span><br><span class="line"><span class="xml">                        return (</span></span><br><span class="line"><span class="xml">                            <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;chat-item user&#x27;</span> <span class="attr">key</span>=<span class="string">&#123;index&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                                <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&#123;user.photo&#125;</span> <span class="attr">alt</span>=<span class="string">&#x27;&#x27;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                                <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;message&#x27;</span>&gt;</span>&#123;msg.text&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        )</span></span><br><span class="line"><span class="xml">                    &#125;</span></span><br><span class="line"><span class="xml">                &#125;)&#125;</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            &#123;/* 底部消息输入框 */&#125;</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;input-footer&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Input</span> <span class="attr">className</span>=<span class="string">&#x27;no-border&#x27;</span> <span class="attr">placeholder</span>=<span class="string">&#x27;请描述您的问题&#x27;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Icon</span> <span class="attr">type</span>=<span class="string">&#x27;iconbianji&#x27;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Chat</span><br></pre></td></tr></table></figure>

<img src="/resource/images/image-20210904085509862.png" alt="image-20210904085509862" style="zoom:50%;" />

<h3 id="建立连接"><a href="#建立连接" class="headerlink" title="建立连接"></a>建立连接</h3><h4 id="目标-23"><a href="#目标-23" class="headerlink" title="目标"></a>目标</h4><p>使用 socket.io 客户端与服务器建立 WebSocket 长连接，<a target="_blank" rel="noopener" href="https://socket.io/docs/v4/client-api/">文档</a>。</p>
<h4 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h4><ol>
<li><p>安装包：<code>yarn add socket.io-client</code> 只安装客户端要使用到的包。</p>
</li>
<li><p>和服务器进行连接。</p>
</li>
</ol>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io <span class="keyword">from</span> <span class="string">&#x27;socket.io-client&#x27;</span></span><br><span class="line"><span class="comment">// 和服务器建立链接</span></span><br><span class="line"><span class="keyword">const</span> client = io(<span class="string">&#x27;地址&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">query</span>: &#123;</span><br><span class="line">        <span class="attr">token</span>: 用户token,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">transports</span>: [<span class="string">&#x27;websocket&#x27;</span>],</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>和服务器进行通讯。</li>
</ol>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">client.on(<span class="string">&#x27;connect&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 当和服务器建立连接成功触发</span></span><br><span class="line">&#125;)</span><br><span class="line">client.on(<span class="string">&#x27;message&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 接收到服务器的消息触发</span></span><br><span class="line">&#125;)</span><br><span class="line">client.on(<span class="string">&#x27;disconnect&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 和服务器断开链接触发</span></span><br><span class="line">&#125;)</span><br><span class="line">client.emit(<span class="string">&#x27;message&#x27;</span>, 值) <span class="comment">// 主动给服务器发送消息</span></span><br><span class="line">client.close() <span class="comment">// 主动关闭和服务器的链接</span></span><br></pre></td></tr></table></figure>

<h4 id="具体操作"><a href="#具体操作" class="headerlink" title="具体操作"></a>具体操作</h4><p>本项目聊天客服的后端接口，使用的是基于 WebSocket 协议的 socket.io 接口，我们可以使用专门的 socket.io 客户端库，就能轻松建立起连接并进行互相通信。</p>
<p>借助 <code>useEffect</code>，在进入页面时调用客户端库建立 socket.io 连接</p>
<ol>
<li>安装 socket.io 客户端库：<code>socket.io-client</code></li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add socket.io-client</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>在进入机器人客服页面时，创建 socket.io 客户端</li>
</ol>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState, useEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Icon <span class="keyword">from</span> <span class="string">&#x27;@/components/Icon&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; NavBar, Input &#125; <span class="keyword">from</span> <span class="string">&#x27;antd-mobile&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useHistory &#125; <span class="keyword">from</span> <span class="string">&#x27;react-router-dom&#x27;</span></span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&#x27;./index.module.scss&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useInitState &#125; <span class="keyword">from</span> <span class="string">&#x27;@/utils/hooks&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; getUser &#125; <span class="keyword">from</span> <span class="string">&#x27;@/store/actions/profile&#x27;</span></span><br><span class="line"><span class="comment">// #1</span></span><br><span class="line"><span class="keyword">import</span> io <span class="keyword">from</span> <span class="string">&#x27;socket.io-client&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; getToken &#125; <span class="keyword">from</span> <span class="string">&#x27;@/utils/storage&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Chat = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> history = useHistory()</span><br><span class="line">    <span class="keyword">const</span> [messageList, setMessageList] = useState&lt;&#123; <span class="attr">type</span>: <span class="string">&#x27;robot&#x27;</span> | <span class="string">&#x27;user&#x27;</span>; text: <span class="built_in">string</span> &#125;[]&gt;([</span><br><span class="line">        &#123; <span class="attr">type</span>: <span class="string">&#x27;robot&#x27;</span>, <span class="attr">text</span>: <span class="string">&#x27;亲爱的用户您好，小智同学为您服务。&#x27;</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">type</span>: <span class="string">&#x27;user&#x27;</span>, <span class="attr">text</span>: <span class="string">&#x27;你好&#x27;</span> &#125;,</span><br><span class="line">    ])</span><br><span class="line">    <span class="keyword">const</span> &#123; user &#125; = useInitState(getUser, <span class="string">&#x27;profile&#x27;</span>)</span><br><span class="line">    <span class="comment">// #2</span></span><br><span class="line">    useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> client = io(<span class="string">&#x27;http://toutiao.itheima.net&#x27;</span>, &#123;</span><br><span class="line">            <span class="attr">transports</span>: [<span class="string">&#x27;websocket&#x27;</span>],</span><br><span class="line">            <span class="attr">query</span>: &#123;</span><br><span class="line">                <span class="attr">token</span>: getToken().token,</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;)</span><br><span class="line">        client.on(<span class="string">&#x27;connect&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// 向聊天记录中添加一条消息</span></span><br><span class="line">            setMessageList(<span class="function">(<span class="params">messageList</span>) =&gt;</span> [...messageList, &#123; <span class="attr">type</span>: <span class="string">&#x27;robot&#x27;</span>, <span class="attr">text</span>: <span class="string">&#x27;主人，我现在恭候着您的提问。&#x27;</span> &#125;])</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">            client.close()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, [])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="发送消息"><a href="#发送消息" class="headerlink" title="发送消息"></a>发送消息</h3><h4 id="目标-24"><a href="#目标-24" class="headerlink" title="目标"></a>目标</h4><p>将输入框内容通过 socket.io 发送到服务端。</p>
<h4 id="步骤-16"><a href="#步骤-16" class="headerlink" title="步骤"></a>步骤</h4><p>实现思路：使用 socket.io 实例的 <code>emit()</code> 方法发送信息。</p>
<ol>
<li>声明一个状态，并绑定消息输入框。</li>
</ol>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> [message, setMessage] = useState(<span class="string">&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Input className=<span class="string">&#x27;no-border&#x27;</span> placeholder=<span class="string">&#x27;请描述您的问题&#x27;</span> value=&#123;message&#125; onChange=&#123;<span class="function">(<span class="params">v</span>) =&gt;</span> setMessage(v)&#125; /&gt;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>为消息输入框添加键盘事件，在输入回车时发送消息。</li>
</ol>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// #2</span></span><br><span class="line">&lt;Input className=<span class="string">&#x27;no-border&#x27;</span> placeholder=<span class="string">&#x27;请描述您的问题&#x27;</span> value=&#123;message&#125; onChange=&#123;<span class="function">(<span class="params">v</span>) =&gt;</span> setMessage(v)&#125; onKeyUp=&#123;onSendMessage&#125; /&gt;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>完整代码。</li>
</ol>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState, useEffect, useRef &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Icon <span class="keyword">from</span> <span class="string">&#x27;@/components/Icon&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; NavBar, Input &#125; <span class="keyword">from</span> <span class="string">&#x27;antd-mobile&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useHistory &#125; <span class="keyword">from</span> <span class="string">&#x27;react-router-dom&#x27;</span></span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&#x27;./index.module.scss&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useInitState &#125; <span class="keyword">from</span> <span class="string">&#x27;@/utils/hooks&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; getUser &#125; <span class="keyword">from</span> <span class="string">&#x27;@/store/actions/profile&#x27;</span></span><br><span class="line"><span class="keyword">import</span> io, &#123; Socket &#125; <span class="keyword">from</span> <span class="string">&#x27;socket.io-client&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; getToken &#125; <span class="keyword">from</span> <span class="string">&#x27;@/utils/storage&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Chat = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> history = useHistory()</span><br><span class="line">    <span class="keyword">const</span> [messageList, setMessageList] = useState&lt;&#123; <span class="attr">type</span>: <span class="string">&#x27;robot&#x27;</span> | <span class="string">&#x27;user&#x27;</span>; text: <span class="built_in">string</span> &#125;[]&gt;([</span><br><span class="line">        &#123; <span class="attr">type</span>: <span class="string">&#x27;robot&#x27;</span>, <span class="attr">text</span>: <span class="string">&#x27;亲爱的用户您好，小智同学为您服务。&#x27;</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">type</span>: <span class="string">&#x27;user&#x27;</span>, <span class="attr">text</span>: <span class="string">&#x27;你好&#x27;</span> &#125;,</span><br><span class="line">    ])</span><br><span class="line">    <span class="comment">// #1</span></span><br><span class="line">    <span class="keyword">const</span> [message, setMessage] = useState(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="comment">// #4: 注意当初始值是 null 的时候，不允许对 clientRef.current 赋值另外一个类型数据，解决办法如下。</span></span><br><span class="line">    <span class="keyword">const</span> clientRef = useRef&lt;Socket | <span class="literal">null</span>&gt;(<span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">const</span> &#123; user &#125; = useInitState(getUser, <span class="string">&#x27;profile&#x27;</span>)</span><br><span class="line">    <span class="comment">// #3</span></span><br><span class="line">    <span class="keyword">const</span> onSendMessage = <span class="function">(<span class="params">e: React.KeyboardEvent&lt;HTMLInputElement&gt;</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (e.key === <span class="string">&#x27;Enter&#x27;</span>) &#123;</span><br><span class="line">            <span class="comment">// #6: 向服务端推送一条消息</span></span><br><span class="line">            clientRef.current?.emit(<span class="string">&#x27;message&#x27;</span>, &#123;</span><br><span class="line">                <span class="attr">msg</span>: message,</span><br><span class="line">                <span class="attr">timestamp</span>: <span class="built_in">Date</span>.now(),</span><br><span class="line">            &#125;)</span><br><span class="line">            <span class="comment">// 并展示到页面上</span></span><br><span class="line">            setMessageList(<span class="function">(<span class="params">messageList</span>) =&gt;</span> [...messageList, &#123; <span class="attr">type</span>: <span class="string">&#x27;user&#x27;</span>, <span class="attr">text</span>: message &#125;])</span><br><span class="line">            setMessage(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> client = io(<span class="string">&#x27;http://toutiao.itheima.net&#x27;</span>, &#123;</span><br><span class="line">            <span class="attr">transports</span>: [<span class="string">&#x27;websocket&#x27;</span>],</span><br><span class="line">            <span class="attr">query</span>: &#123;</span><br><span class="line">                <span class="attr">token</span>: getToken().token,</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="comment">// #5</span></span><br><span class="line">        clientRef.current = client</span><br><span class="line">        client.on(<span class="string">&#x27;connect&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// 向聊天记录中添加一条消息</span></span><br><span class="line">            setMessageList(<span class="function">(<span class="params">messageList</span>) =&gt;</span> [...messageList, &#123; <span class="attr">type</span>: <span class="string">&#x27;robot&#x27;</span>, <span class="attr">text</span>: <span class="string">&#x27;我现在恭候着您的提问。&#x27;</span> &#125;])</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">            client.close()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, [])</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;styles.root&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">            &#123;/* 顶部导航栏 */&#125;</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">NavBar</span> <span class="attr">className</span>=<span class="string">&#x27;fixed-header&#x27;</span> <span class="attr">onBack</span>=<span class="string">&#123;()</span> =&gt;</span> history.go(-1)&#125;&gt;</span></span><br><span class="line"><span class="xml">                小智同学</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">NavBar</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;chat-list&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                &#123;messageList.map((msg, index) =&gt; &#123;</span></span><br><span class="line"><span class="xml">                    if (msg.type === &#x27;robot&#x27;) &#123;</span></span><br><span class="line"><span class="xml">                        // 机器</span></span><br><span class="line"><span class="xml">                        return (</span></span><br><span class="line"><span class="xml">                            <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;chat-item&#x27;</span> <span class="attr">key</span>=<span class="string">&#123;index&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                                <span class="tag">&lt;<span class="name">Icon</span> <span class="attr">type</span>=<span class="string">&#x27;iconbtn_xiaozhitongxue&#x27;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                                <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;message&#x27;</span>&gt;</span>&#123;msg.text&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        )</span></span><br><span class="line"><span class="xml">                    &#125; else &#123;</span></span><br><span class="line"><span class="xml">                        // 用户</span></span><br><span class="line"><span class="xml">                        return (</span></span><br><span class="line"><span class="xml">                            <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;chat-item user&#x27;</span> <span class="attr">key</span>=<span class="string">&#123;index&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                                <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&#123;user.photo&#125;</span> <span class="attr">alt</span>=<span class="string">&#x27;&#x27;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                                <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;message&#x27;</span>&gt;</span>&#123;msg.text&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        )</span></span><br><span class="line"><span class="xml">                    &#125;</span></span><br><span class="line"><span class="xml">                &#125;)&#125;</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            &#123;/* 底部消息输入框 */&#125;</span></span><br><span class="line"><span class="xml">            &#123;/* #2 */&#125;</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;input-footer&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Input</span> <span class="attr">className</span>=<span class="string">&#x27;no-border&#x27;</span> <span class="attr">placeholder</span>=<span class="string">&#x27;请描述您的问题&#x27;</span> <span class="attr">value</span>=<span class="string">&#123;message&#125;</span> <span class="attr">onChange</span>=<span class="string">&#123;(v)</span> =&gt;</span> setMessage(v)&#125; onKeyUp=&#123;onSendMessage&#125; /&gt;</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Icon</span> <span class="attr">type</span>=<span class="string">&#x27;iconbianji&#x27;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Chat</span><br></pre></td></tr></table></figure>

<h3 id="接收消息"><a href="#接收消息" class="headerlink" title="接收消息"></a>接收消息</h3><ol>
<li><p>通过 socket.io 监听回复的消息，并添加到聊天列表中。</p>
</li>
<li><p>且当消息较多出现滚动条时，有后续新消息的话总将滚动条滚动到最底部。</p>
</li>
<li><p>使用 socket.io 实例的 <code>message</code> 事件接收信息，在聊天列表数据变化时，操作列表容器元素来设置滚动量。</p>
</li>
</ol>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> client = io(<span class="string">&#x27;http://toutiao.itheima.net&#x27;</span>, &#123;</span><br><span class="line">        <span class="attr">transports</span>: [<span class="string">&#x27;websocket&#x27;</span>],</span><br><span class="line">        <span class="attr">query</span>: &#123;</span><br><span class="line">            <span class="attr">token</span>: getToken().token,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;)</span><br><span class="line">    clientRef.current = client</span><br><span class="line">    client.on(<span class="string">&#x27;connect&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 向聊天记录中添加一条消息</span></span><br><span class="line">        setMessageList(<span class="function">(<span class="params">messageList</span>) =&gt;</span> [...messageList, &#123; <span class="attr">type</span>: <span class="string">&#x27;robot&#x27;</span>, <span class="attr">text</span>: <span class="string">&#x27;我现在恭候着您的提问。&#x27;</span> &#125;])</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">// 在 socket.io 实例的 `message` 事件中，将接收到的消息添加到聊天列表</span></span><br><span class="line">    client.on(<span class="string">&#x27;message&#x27;</span>, <span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 向聊天记录中添加机器人回复的消息</span></span><br><span class="line">        setMessageList(<span class="function">(<span class="params">messageList</span>) =&gt;</span> [...messageList, &#123; <span class="attr">type</span>: <span class="string">&#x27;robot&#x27;</span>, <span class="attr">text</span>: data.msg &#125;])</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        client.close()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;, [])</span><br></pre></td></tr></table></figure>

<h3 id="计算滚动位置"><a href="#计算滚动位置" class="headerlink" title="计算滚动位置"></a>计算滚动位置</h3><ol>
<li>声明一个 ref 并设置到聊天列表的容器元素上。</li>
</ol>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> chatListRef = useRef&lt;HTMLDivElement&gt;(<span class="literal">null</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;div className=<span class="string">&quot;chat-list&quot;</span> ref=&#123;chatListRef&#125;&gt;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>通过 <code>useEffect</code> 监听聊天数据变化，对聊天容器元素的 scrollTop 进行设置。</li>
</ol>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 监听聊天数据的变化，改变聊天容器元素的 scrollTop 值让页面滚到最底部</span></span><br><span class="line">useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> current = chatListRef.current!</span><br><span class="line">    current.scrollTop = current.scrollHeight</span><br><span class="line">    <span class="comment">// current.scrollTop = current.scrollHeight - current.offsetHeight</span></span><br><span class="line">&#125;, [messageList])</span><br></pre></td></tr></table></figure>

    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2021/12/24/react-base-course16/" rel="prev" title="16_极客园 H5">
      <i class="fa fa-chevron-left"></i> 16_极客园 H5
    </a></div>
      <div class="post-nav-item">
    <a href="/2022/01/07/react-base-course18/" rel="next" title="18_极客园 H5">
      18_极客园 H5 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BB%8A%E6%97%A5%E7%9B%AE%E6%A0%87"><span class="nav-number">1.</span> <span class="nav-text">今日目标</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B8%83%E5%B1%80%E9%A1%B5%E9%9D%A2%E7%BB%93%E6%9E%84"><span class="nav-number">2.</span> <span class="nav-text">布局页面结构</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9B%AE%E6%A0%87"><span class="nav-number">2.1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%B4%A0%E6%9D%90"><span class="nav-number">2.2.</span> <span class="nav-text">素材</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A4"><span class="nav-number">2.3.</span> <span class="nav-text">步骤</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81"><span class="nav-number">2.4.</span> <span class="nav-text">代码</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%B7%AF%E7%94%B1%E5%88%87%E6%8D%A2%E5%8A%9F%E8%83%BD"><span class="nav-number">3.</span> <span class="nav-text">路由切换功能</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E4%BA%8C%E7%BA%A7%E8%B7%AF%E7%94%B1"><span class="nav-number">4.</span> <span class="nav-text">配置二级路由</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9B%AE%E6%A0%87-1"><span class="nav-number">4.1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%B4%A0%E6%9D%90-1"><span class="nav-number">4.2.</span> <span class="nav-text">素材</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Home"><span class="nav-number">4.2.1.</span> <span class="nav-text">Home</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Question"><span class="nav-number">4.2.2.</span> <span class="nav-text">Question</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Video"><span class="nav-number">4.2.3.</span> <span class="nav-text">Video</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Profile"><span class="nav-number">4.2.4.</span> <span class="nav-text">Profile</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A4-1"><span class="nav-number">4.3.</span> <span class="nav-text">步骤</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B8%B2%E6%9F%93%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83"><span class="nav-number">5.</span> <span class="nav-text">渲染个人中心</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%93%E6%9E%84%E4%B8%8E%E6%A0%B7%E5%BC%8F"><span class="nav-number">5.1.</span> <span class="nav-text">结构与样式</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%9B%AE%E6%A0%87-2"><span class="nav-number">5.1.1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A4-2"><span class="nav-number">5.1.2.</span> <span class="nav-text">步骤</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF"><span class="nav-number">5.2.</span> <span class="nav-text">获取用户信息</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%9B%AE%E6%A0%87-3"><span class="nav-number">5.2.1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%86%E6%9E%90"><span class="nav-number">5.2.2.</span> <span class="nav-text">分析</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A4-3"><span class="nav-number">5.2.3.</span> <span class="nav-text">步骤</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AD%98%E5%82%A8%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF%E5%88%B0-Redux"><span class="nav-number">5.3.</span> <span class="nav-text">存储用户信息到 Redux</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%9B%AE%E6%A0%87-4"><span class="nav-number">5.3.1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81-1"><span class="nav-number">5.3.2.</span> <span class="nav-text">代码</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B8%B2%E6%9F%93%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF"><span class="nav-number">5.4.</span> <span class="nav-text">渲染用户信息</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%9B%AE%E6%A0%87-5"><span class="nav-number">5.4.1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A4-4"><span class="nav-number">5.4.2.</span> <span class="nav-text">步骤</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81-2"><span class="nav-number">5.4.3.</span> <span class="nav-text">代码</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B8%B2%E6%9F%93%E4%B8%AA%E4%BA%BA%E4%BF%A1%E6%81%AF"><span class="nav-number">6.</span> <span class="nav-text">渲染个人信息</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%A1%B5%E9%9D%A2%E7%BB%93%E6%9E%84"><span class="nav-number">6.1.</span> <span class="nav-text">页面结构</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%B4%A0%E6%9D%90-2"><span class="nav-number">6.1.1.</span> <span class="nav-text">素材</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A4-5"><span class="nav-number">6.1.2.</span> <span class="nav-text">步骤</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E5%B9%B6%E6%B8%B2%E6%9F%93"><span class="nav-number">6.2.</span> <span class="nav-text">获取并渲染</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89-Hook"><span class="nav-number">7.</span> <span class="nav-text">自定义 Hook</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A6%82%E8%BF%B0"><span class="nav-number">7.1.</span> <span class="nav-text">概述</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%9B%AE%E6%A0%87-6"><span class="nav-number">7.1.1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%86%85%E5%AE%B9"><span class="nav-number">7.1.2.</span> <span class="nav-text">内容</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%80%BB%E7%BB%93"><span class="nav-number">7.1.3.</span> <span class="nav-text">总结</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#useInitState"><span class="nav-number">7.2.</span> <span class="nav-text">useInitState</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%9B%AE%E6%A0%87-7"><span class="nav-number">7.2.1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%86%85%E5%AE%B9-1"><span class="nav-number">7.2.2.</span> <span class="nav-text">内容</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#useInitState-%E7%B1%BB%E5%9E%8B"><span class="nav-number">7.3.</span> <span class="nav-text">useInitState 类型</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%9B%AE%E6%A0%87-8"><span class="nav-number">7.3.1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%86%E6%9E%90-1"><span class="nav-number">7.3.2.</span> <span class="nav-text">分析</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81-3"><span class="nav-number">7.3.3.</span> <span class="nav-text">代码</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9%E6%98%B5%E7%A7%B0%E5%92%8C%E7%AE%80%E4%BB%8B"><span class="nav-number">8.</span> <span class="nav-text">修改昵称和简介</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%98%BE%E7%A4%BA%E5%BC%B9%E5%B1%82"><span class="nav-number">8.1.</span> <span class="nav-text">显示弹层</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%87%86%E5%A4%87-EditInput-%E7%BB%84%E4%BB%B6"><span class="nav-number">8.2.</span> <span class="nav-text">准备 EditInput 组件</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%9B%AE%E6%A0%87-9"><span class="nav-number">8.2.1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%87%86%E5%A4%87-EditInput-%E7%BB%84%E4%BB%B6-1"><span class="nav-number">8.2.2.</span> <span class="nav-text">准备 EditInput 组件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%82%B9%E5%87%BB%E8%BF%94%E5%9B%9E%E9%9A%90%E8%97%8F%E5%BC%B9%E5%B1%82"><span class="nav-number">8.2.3.</span> <span class="nav-text">点击返回隐藏弹层</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9%E6%A0%87%E9%A2%98%E6%96%87%E5%AD%97"><span class="nav-number">8.3.</span> <span class="nav-text">修改标题文字</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%9B%9E%E6%98%BE"><span class="nav-number">8.4.</span> <span class="nav-text">数据回显</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%9B%AE%E6%A0%87-10"><span class="nav-number">8.4.1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81-4"><span class="nav-number">8.4.2.</span> <span class="nav-text">代码</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BF%AE%E5%A4%8D%E5%9B%9E%E6%98%BE-Bug"><span class="nav-number">8.5.</span> <span class="nav-text">修复回显 Bug</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%87%AA%E5%8A%A8%E8%8E%B7%E5%8F%96%E5%85%89%E6%A0%87"><span class="nav-number">8.6.</span> <span class="nav-text">自动获取光标</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9B%9E%E4%BC%A0%E7%BB%99%E7%88%B6%E7%BB%84%E4%BB%B6"><span class="nav-number">8.7.</span> <span class="nav-text">回传给父组件</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%9B%AE%E6%A0%87-11"><span class="nav-number">8.7.1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%86%E6%9E%90-2"><span class="nav-number">8.7.2.</span> <span class="nav-text">分析</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A4-6"><span class="nav-number">8.7.3.</span> <span class="nav-text">步骤</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81-5"><span class="nav-number">8.7.4.</span> <span class="nav-text">代码</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%91%E9%80%81%E8%AF%B7%E6%B1%82%E4%BF%AE%E6%94%B9"><span class="nav-number">8.8.</span> <span class="nav-text">发送请求修改</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9%E5%A4%B4%E5%83%8F%E5%92%8C%E6%80%A7%E5%88%AB"><span class="nav-number">9.</span> <span class="nav-text">修改头像和性别</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BC%B9%E6%A1%86%E6%8E%A7%E5%88%B6"><span class="nav-number">9.1.</span> <span class="nav-text">弹框控制</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%87%86%E5%A4%87%E7%B4%A0%E6%9D%90"><span class="nav-number">9.1.1.</span> <span class="nav-text">准备素材</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%87%86%E5%A4%87%E5%BC%B9%E5%87%BA%E5%B1%82"><span class="nav-number">9.1.2.</span> <span class="nav-text">准备弹出层</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%9B%AE%E6%A0%87-12"><span class="nav-number">9.1.2.1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A4-7"><span class="nav-number">9.1.2.2.</span> <span class="nav-text">步骤</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81-6"><span class="nav-number">9.1.2.3.</span> <span class="nav-text">代码</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%98%BE%E7%A4%BA%E4%B8%8E%E9%9A%90%E8%97%8F"><span class="nav-number">9.1.3.</span> <span class="nav-text">显示与隐藏</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%9B%AE%E6%A0%87-13"><span class="nav-number">9.1.3.1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%88%86%E6%9E%90-3"><span class="nav-number">9.1.3.2.</span> <span class="nav-text">分析</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A4-8"><span class="nav-number">9.1.3.3.</span> <span class="nav-text">步骤</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81-7"><span class="nav-number">9.1.3.4.</span> <span class="nav-text">代码</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%86%85%E5%AE%B9%E7%9A%84%E5%9B%9E%E6%98%BE"><span class="nav-number">9.1.4.</span> <span class="nav-text">内容的回显</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9%E6%80%A7%E5%88%AB"><span class="nav-number">9.2.</span> <span class="nav-text">修改性别</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9%E5%A4%B4%E5%83%8F"><span class="nav-number">9.3.</span> <span class="nav-text">修改头像</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BC%B9%E7%AA%97%E9%80%89%E6%8B%A9%E5%9B%BE%E7%89%87"><span class="nav-number">9.3.1.</span> <span class="nav-text">弹窗选择图片</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%9B%AE%E6%A0%87-14"><span class="nav-number">9.3.1.1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81-8"><span class="nav-number">9.3.1.2.</span> <span class="nav-text">代码</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E9%80%89%E6%8B%A9%E7%9A%84%E5%A4%B4%E5%83%8F"><span class="nav-number">9.3.2.</span> <span class="nav-text">获取选择的头像</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%9B%AE%E6%A0%87-15"><span class="nav-number">9.3.2.1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A4-9"><span class="nav-number">9.3.2.2.</span> <span class="nav-text">步骤</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81-9"><span class="nav-number">9.3.2.3.</span> <span class="nav-text">代码</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9B%B4%E6%96%B0%E5%A4%B4%E5%83%8F"><span class="nav-number">9.3.3.</span> <span class="nav-text">更新头像</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%9B%AE%E6%A0%87-16"><span class="nav-number">9.3.3.1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A4-10"><span class="nav-number">9.3.3.2.</span> <span class="nav-text">步骤</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81-10"><span class="nav-number">9.3.3.3.</span> <span class="nav-text">代码</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9%E7%94%9F%E6%97%A5"><span class="nav-number">9.4.</span> <span class="nav-text">修改生日</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%80%80%E5%87%BA%E7%99%BB%E5%BD%95%E5%8A%9F%E8%83%BD"><span class="nav-number">10.</span> <span class="nav-text">退出登录功能</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BC%B9%E7%AA%97%E7%A1%AE%E8%AE%A4"><span class="nav-number">10.1.</span> <span class="nav-text">弹窗确认</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%9B%AE%E6%A0%87-17"><span class="nav-number">10.1.1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%86%E6%9E%90-4"><span class="nav-number">10.1.2.</span> <span class="nav-text">分析</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A4-11"><span class="nav-number">10.1.3.</span> <span class="nav-text">步骤</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81-11"><span class="nav-number">10.1.4.</span> <span class="nav-text">代码</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8A%9F%E8%83%BD%E5%AE%8C%E6%88%90"><span class="nav-number">10.2.</span> <span class="nav-text">功能完成</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%9B%AE%E6%A0%87-18"><span class="nav-number">10.2.1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A4-12"><span class="nav-number">10.2.2.</span> <span class="nav-text">步骤</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%95%8C%E9%9D%A2%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6"><span class="nav-number">11.</span> <span class="nav-text">界面访问控制</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%89%B4%E6%9D%83%E7%BB%84%E4%BB%B6%E5%B0%81%E8%A3%85"><span class="nav-number">11.1.</span> <span class="nav-text">鉴权组件封装</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%9B%AE%E6%A0%87-19"><span class="nav-number">11.1.1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A4-13"><span class="nav-number">11.1.2.</span> <span class="nav-text">步骤</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81-12"><span class="nav-number">11.1.3.</span> <span class="nav-text">代码</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%99%BB%E5%BD%95%E6%88%90%E5%8A%9F%E8%B7%B3%E8%BD%AC%E5%88%B0%E5%8E%9F%E9%A1%B5%E9%9D%A2"><span class="nav-number">11.2.</span> <span class="nav-text">登录成功跳转到原页面</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%9B%AE%E6%A0%87-20"><span class="nav-number">11.2.1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A4-14"><span class="nav-number">11.2.2.</span> <span class="nav-text">步骤</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81-13"><span class="nav-number">11.2.3.</span> <span class="nav-text">代码</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%B7%E6%96%B0-Token"><span class="nav-number">12.</span> <span class="nav-text">刷新 Token</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A6%82%E8%BF%B0-1"><span class="nav-number">12.1.</span> <span class="nav-text">概述</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%9B%AE%E6%A0%87-21"><span class="nav-number">12.1.1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%86%E6%9E%90-5"><span class="nav-number">12.1.2.</span> <span class="nav-text">分析</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0"><span class="nav-number">12.2.</span> <span class="nav-text">实现</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%9B%AE%E6%A0%87-22"><span class="nav-number">12.2.1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%86%E6%9E%90-6"><span class="nav-number">12.2.2.</span> <span class="nav-text">分析</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A4-15"><span class="nav-number">12.2.3.</span> <span class="nav-text">步骤</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81-14"><span class="nav-number">12.2.4.</span> <span class="nav-text">代码</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B0%8F%E6%99%BA%E5%90%8C%E5%AD%A6%E8%81%8A%E5%A4%A9"><span class="nav-number">13.</span> <span class="nav-text">小智同学聊天</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#WebSocket"><span class="nav-number">13.1.</span> <span class="nav-text">WebSocket</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81"><span class="nav-number">13.1.1.</span> <span class="nav-text">为什么需要</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E4%BB%8B%E7%BB%8D"><span class="nav-number">13.1.2.</span> <span class="nav-text">基本介绍</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9D%99%E6%80%81%E7%BB%93%E6%9E%84"><span class="nav-number">13.2.</span> <span class="nav-text">静态结构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B8%B2%E6%9F%93%E8%81%8A%E5%A4%A9%E8%AE%B0%E5%BD%95"><span class="nav-number">13.3.</span> <span class="nav-text">渲染聊天记录</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BB%BA%E7%AB%8B%E8%BF%9E%E6%8E%A5"><span class="nav-number">13.4.</span> <span class="nav-text">建立连接</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%9B%AE%E6%A0%87-23"><span class="nav-number">13.4.1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="nav-number">13.4.2.</span> <span class="nav-text">基本使用</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%85%B7%E4%BD%93%E6%93%8D%E4%BD%9C"><span class="nav-number">13.4.3.</span> <span class="nav-text">具体操作</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%91%E9%80%81%E6%B6%88%E6%81%AF"><span class="nav-number">13.5.</span> <span class="nav-text">发送消息</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%9B%AE%E6%A0%87-24"><span class="nav-number">13.5.1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A4-16"><span class="nav-number">13.5.2.</span> <span class="nav-text">步骤</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8E%A5%E6%94%B6%E6%B6%88%E6%81%AF"><span class="nav-number">13.6.</span> <span class="nav-text">接收消息</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AE%A1%E7%AE%97%E6%BB%9A%E5%8A%A8%E4%BD%8D%E7%BD%AE"><span class="nav-number">13.7.</span> <span class="nav-text">计算滚动位置</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Ifer"
      src="/images/49337922.png">
  <p class="site-author-name" itemprop="name">Ifer</p>
  <div class="site-description" itemprop="description">React 全家桶 <span style='position:relative;top:-2px;'>✍</span></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">72</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://www.bilibili.com/video/BV1iW4y1k7Ci?spm_id_from=333.337.search-card.all.click" title="😚 → https:&#x2F;&#x2F;www.bilibili.com&#x2F;video&#x2F;BV1iW4y1k7Ci?spm_id_from&#x3D;333.337.search-card.all.click" rel="noopener" target="_blank"><i class="a fa-fw"></i>😚</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.zhihu.com/people/weixiantx" title="😙 → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;weixiantx" rel="noopener" target="_blank"><i class="a fa-fw"></i>😙</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Ifer</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
