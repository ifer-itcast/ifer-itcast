<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.ico">
  <link rel="mask-icon" href="/images/favicon.ico" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"mac"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="é¡¹ç›®ç›®æ ‡âœ” æŒæ¡é€šè¿‡åŸç”Ÿè¯­æ³•å¼€å‘å°ç¨‹åºé¡¹ç›®çš„æ€è·¯ã€‚ âœ” æŒæ¡é¡¹ç›®å…¬å‘Šã€ç”¨æˆ·ã€æˆ¿å±‹ã€æŠ¥ä¿®ã€è®¿å®¢ç­‰ç®¡ç†æ¨¡å—çš„å¼€å‘ã€‚">
<meta property="og:type" content="article">
<meta property="og:title" content="03_å°ç¨‹åºäº«+é¡¹ç›®">
<meta property="og:url" content="http://example.com/2023/02/21/xcx-course03/index.html">
<meta property="og:site_name" content="å±é™©">
<meta property="og:description" content="é¡¹ç›®ç›®æ ‡âœ” æŒæ¡é€šè¿‡åŸç”Ÿè¯­æ³•å¼€å‘å°ç¨‹åºé¡¹ç›®çš„æ€è·¯ã€‚ âœ” æŒæ¡é¡¹ç›®å…¬å‘Šã€ç”¨æˆ·ã€æˆ¿å±‹ã€æŠ¥ä¿®ã€è®¿å®¢ç­‰ç®¡ç†æ¨¡å—çš„å¼€å‘ã€‚">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/resource/images/wxacode.79d8452b.png">
<meta property="og:image" content="http://example.com/resource/images/picture_1.ddad61b2.jpg">
<meta property="og:image" content="http://example.com/resource/images/Snipaste_2023-03-03_16-09-30.png">
<meta property="og:image" content="http://example.com/resource/images/Snipaste_2023-03-04_09-07-41.png">
<meta property="article:published_time" content="2023-02-21T00:34:45.000Z">
<meta property="article:modified_time" content="2023-05-11T07:42:51.584Z">
<meta property="article:author" content="Ifer">
<meta property="article:tag" content="React,Redux,Mobx,Saga,Dva,Umi,AntD,TS">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/resource/images/wxacode.79d8452b.png">

<link rel="canonical" href="http://example.com/2023/02/21/xcx-course03/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>03_å°ç¨‹åºäº«+é¡¹ç›® | å±é™©</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ ">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">å±é™©</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">ä¸ºä¹‹åˆ™æ˜“ï¼Œä¸ä¸ºåˆ™éš¾</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>é¦–é¡µ</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>å½’æ¡£</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>æœç´¢
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="æœç´¢..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/02/21/xcx-course03/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/49337922.png">
      <meta itemprop="name" content="Ifer">
      <meta itemprop="description" content="React å…¨å®¶æ¡¶ <span style='position:relative;top:-2px;'>âœ</span>">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="å±é™©">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          03_å°ç¨‹åºäº«+é¡¹ç›®
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2023-02-21 08:34:45" itemprop="dateCreated datePublished" datetime="2023-02-21T08:34:45+08:00">2023-02-21</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2023-05-11 15:42:51" itemprop="dateModified" datetime="2023-05-11T15:42:51+08:00">2023-05-11</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="é¡¹ç›®ç›®æ ‡"><a href="#é¡¹ç›®ç›®æ ‡" class="headerlink" title="é¡¹ç›®ç›®æ ‡"></a>é¡¹ç›®ç›®æ ‡</h2><p>âœ” æŒæ¡é€šè¿‡åŸç”Ÿè¯­æ³•å¼€å‘å°ç¨‹åºé¡¹ç›®çš„æ€è·¯ã€‚</p>
<p>âœ” æŒæ¡é¡¹ç›®å…¬å‘Šã€ç”¨æˆ·ã€æˆ¿å±‹ã€æŠ¥ä¿®ã€è®¿å®¢ç­‰ç®¡ç†æ¨¡å—çš„å¼€å‘ã€‚</p>
<span id="more"></span>

<h2 id="å¼€å‘å‡†å¤‡"><a href="#å¼€å‘å‡†å¤‡" class="headerlink" title="å¼€å‘å‡†å¤‡"></a>å¼€å‘å‡†å¤‡</h2><h3 id="é¡¹ç›®ä»‹ç»"><a href="#é¡¹ç›®ä»‹ç»" class="headerlink" title="é¡¹ç›®ä»‹ç»"></a>é¡¹ç›®ä»‹ç»</h3><p>äº«+ç¤¾åŒºæ˜¯ä¸€ä¸ªç”Ÿæ´»ç±»çš„å°ç¨‹åºé¡¹ç›®ï¼Œä¸»è¦æœåŠ¡äºå°åŒºä¸šä¸»ï¼Œä¸ºå…¶æä¾›ç”Ÿæ´»å®¶ç”µæŠ¥ä¿®ã€è®¿å®¢é—¨ç¦é€šè¡Œçš„çš„åŠŸèƒ½ï¼Œè¯¥é¡¹ç›®ä¸»è¦åŒ…å«æˆ¿å±‹ç®¡ç†ã€æŠ¥ä¿®ç®¡ç†ã€è®¿å®¢ç®¡ç†ã€ç”¨æˆ·ç®¡ç†ã€é€šçŸ¥ç®¡ç†ç­‰åŠŸèƒ½æ¨¡å—ï¼ŒæŠ€æœ¯æ ˆä»¥åŸç”Ÿå°ç¨‹åºæŠ€æœ¯ä¸ºä¸»é…åˆäº† Vant ç»„ä»¶åº“ã€‚</p>
<p><a target="_blank" rel="noopener" href="https://www.apifox.cn/apidoc/shared-8d66c345-7a9a-4844-9a5a-1201852f6faa/doc-1492243">æŸ¥çœ‹æ¥å£æ–‡æ¡£</a></p>
<p>æ‰«ç ä½“éªŒ</p>
<img src="/resource/images/wxacode.79d8452b.png"/>

<h3 id="å¯åŠ¨é¡¹ç›®"><a href="#å¯åŠ¨é¡¹ç›®" class="headerlink" title="å¯åŠ¨é¡¹ç›®"></a>å¯åŠ¨é¡¹ç›®</h3><p>äº«+ç¤¾åŒºå°ç¨‹åºé¡¹ç›®é™æ€é¡µé¢å·²ç»å®Œæˆï¼Œæˆ‘ä»¬çš„ä»»åŠ¡æ˜¯è”è°ƒæ¥å£å¤„ç†ä¸šåŠ¡é€»è¾‘ï¼Œä»¥ä¸‹æ˜¯ä»£ç ä»“åº“åœ°å€ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># gitHub ä»“åº“</span></span><br><span class="line"><span class="comment"># git clone -b template https://github.com/lotjol/enjoy-plus.git</span></span><br><span class="line"><span class="comment"># æˆ– gitee ä»“åº“</span></span><br><span class="line">git <span class="built_in">clone</span> -b template https://gitee.com/lotjol/enjoy-plus.git</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿®æ”¹åˆ†æ”¯åç§°</span></span><br><span class="line">git branch -m template master</span><br></pre></td></tr></table></figure>

<h4 id="æ‹‰å–ä»£ç "><a href="#æ‹‰å–ä»£ç " class="headerlink" title="æ‹‰å–ä»£ç "></a>æ‹‰å–ä»£ç </h4><p>é€šè¿‡ git clone æ‹‰å–ä»£ç æ—¶é»˜è®¤ä¼šå°†è¿œä»“åº“åœ°å€æŒ‡å‘äº†æˆ‘çš„çš„ä»“åº“ï¼Œä¼šå¯¼è‡´åŒå­¦ä»¬ push ä»£ç æ—¶å¤±è´¥ï¼Œå¦‚æœåœ¨ä¼ä¸šä¸­çš„æƒ…å†µä¸‹ï¼Œéœ€è¦è”ç³»è´Ÿè´£äººå°†ä½ æ·»åŠ ä¸ºå›¢é˜Ÿå¼€å‘è€…è·å–æƒé™ã€‚</p>
<p>åœ¨è¯¾å ‚ä¸Šè€å¸ˆå°±ä¸ä¸€ä¸€æ·»åŠ å¤§å®¶æˆä¸ºå¼€å‘è€…äº†ï¼ŒåŒå­¦ä»¬è‡ªå·²å»ºä¸€ä¸ªè¿œç¨‹ä»“åº“ï¼Œç„¶åä¿®æ”¹ä»£ç çš„è¿œç¨‹ä»“åº“åœ°å€ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># git remote add origin &#x27;è¿™é‡Œæ˜¯ä½ çš„è¿œç¨‹ä»“åº“åœ°å€&#x27;</span></span><br><span class="line">git remote set-url origin <span class="string">&#x27;è¿™é‡Œæ˜¯ä½ çš„è¿œç¨‹ä»“åº“åœ°å€&#x27;</span></span><br></pre></td></tr></table></figure>

<p>ğŸ¤” æç¤ºï¼šåœ¨ä¼ä¸šä¸­åšå¼€å‘æ—¶ä¸éœ€è¦ä¹Ÿä¸å…è®¸æŠŠä»£ç æ”¾åˆ°ä¸ªäººä»“åº“ä¸‹çš„ï¼Œåˆ‡è®°åˆ‡è®°ï¼ï¼ï¼</p>
<h4 id="è¿è¡Œä»£ç "><a href="#è¿è¡Œä»£ç " class="headerlink" title="è¿è¡Œä»£ç "></a>è¿è¡Œä»£ç </h4><p>æ‰“å¼€å°ç¨‹åºå¼€å‘è€…å·¥å…·åé€‰æ‹©å¯¼å…¥å°ç¨‹åºé¡¹ç›®ï¼Œç„¶åå¯¼å…¥åˆšåˆšæ‹‰å–ä¸‹æ¥çš„ä»£ç ï¼Œè¿˜è¦æŠŠ AppID æ›´æ¢æˆåŒå­¦ä½å„è‡ªçš„ã€‚</p>
<p>ğŸ¤” æç¤ºï¼šå¦‚æœåˆ°ä¼ä¸šé‡Œåšå¼€å‘æ—¶ï¼Œè¿™é‡Œçš„ AppID è¦ä½¿ç”¨å…¬å¸ç”³è¯·å¥½çš„ï¼Œç„¶åè”ç³»å›¢é˜Ÿè´Ÿè´£äººæŠŠä½ æ·»åŠ æˆä¸ºå¼€å‘è€…ã€‚</p>
<img src="/resource/images/picture_1.ddad61b2.jpg"/>

<h4 id="ç†Ÿæ‚‰ç¯å¢ƒ"><a href="#ç†Ÿæ‚‰ç¯å¢ƒ" class="headerlink" title="ç†Ÿæ‚‰ç¯å¢ƒ"></a>ç†Ÿæ‚‰ç¯å¢ƒ</h4><p>å®‰è£…é¡¹ç›®çš„ä¾èµ–ï¼Œå½“å‰éœ€è¦å®‰è£…çš„ä¾èµ–æ˜¯ eslint å’Œ prettier ä»¥åŠ Vantã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install</span><br></pre></td></tr></table></figure>

<p>é‡ç‚¹æ³¨æ„çš„æ˜¯ project.config.js ä¸­çš„å‡ ä¸ªé…ç½®ã€‚</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="comment">// #1 æ‰‹åŠ¨æŒ‡å®šæ ¹ç›®å½•</span></span><br><span class="line">    <span class="attr">&quot;miniprogramRoot&quot;</span>: <span class="string">&quot;miniprogram/&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;setting&quot;</span>: &#123;</span><br><span class="line">        <span class="comment">// #2 æ”¯æŒ Sass</span></span><br><span class="line">        <span class="attr">&quot;useCompilerPlugins&quot;</span>: [<span class="string">&quot;sass&quot;</span>],</span><br><span class="line">        <span class="comment">// #3 å¼€å¯æ‰‹åŠ¨æ„å»º NPM çš„è·¯å¾„</span></span><br><span class="line">        <span class="attr">&quot;packNpmManually&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">&quot;packNpmRelationList&quot;</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// #4 package.json çš„ä½ç½®</span></span><br><span class="line">                <span class="attr">&quot;packageJsonPath&quot;</span>: <span class="string">&quot;./package.json&quot;</span>,</span><br><span class="line">                <span class="comment">// #5 æ„å»ºåçš„ä»£ç ä½ç½®</span></span><br><span class="line">                <span class="attr">&quot;miniprogramNpmDistDir&quot;</span>: <span class="string">&quot;./miniprogram&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="VSCode"><a href="#VSCode" class="headerlink" title="VSCode"></a>VSCode</h4><p>VSCode åœ¨ç¼–å†™ä»£ç æ–¹é¢æ¯”å¾®ä¿¡å°ç¨‹åºæ›´åŠ æ–¹ä¾¿ï¼Œä¹Ÿæ›´åŠ ç¬¦åˆå¤§å®¶çš„å¼€å‘ä¹ æƒ¯ï¼Œå’±ä»¬åœ¨å¼€å‘å°ç¨‹åºæ—¶å¯ä»¥ç»“åˆè¿™ä¸¤æ¬¾å·¥å…·ï¼Œæˆ‘ä»¬ç¼–å†™ä»£ç ä½¿ç”¨ VSCodeï¼Œé¢„è§ˆã€è°ƒè¯•ã€å‘å¸ƒç­‰ä½¿ç”¨å°ç¨‹åºå¼€å‘è€…å·¥å…·ã€‚</p>
<p>åœ¨ VSCode ä¸­æ— æ³•åŸç”Ÿæ”¯æŒ .wxml æ–‡ä»¶çš„è¯­æ³•é«˜äº®åŠæç¤ºï¼Œéœ€è¦å®‰è£…ä¸€ä¸ªæ’ä»¶: WXML - Language Serviceã€‚</p>
<p>ğŸ¤” æç¤ºï¼šå®Œå…¨ä½¿ç”¨å°ç¨‹åºå¼€å‘è€…å·¥å…·ä¹Ÿæ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œåªæ˜¯ç»“åˆ VSCode ç¼–å†™ä»£ç ä¼šæ›´æ–¹ä¾¿ä¸€äº›ã€‚</p>
<h2 id="å·¥å…·æ–¹æ³•"><a href="#å·¥å…·æ–¹æ³•" class="headerlink" title="å·¥å…·æ–¹æ³•"></a>å·¥å…·æ–¹æ³•</h2><h3 id="æ¶ˆæ¯åé¦ˆ"><a href="#æ¶ˆæ¯åé¦ˆ" class="headerlink" title="æ¶ˆæ¯åé¦ˆ"></a>æ¶ˆæ¯åé¦ˆ</h3><p>åœ¨å¼€å‘è¿‡ç¨‹ä¸­éœ€è¦å‘ç”¨æˆ·åé¦ˆæ¶ˆæ¯çš„åœºæ™¯æœ‰å¾ˆå¤šï¼Œå¦‚æ£€éªŒæ¥å£è°ƒç”¨çš„ç»“æœï¼Œè¡¨å•éªŒè¯çš„æç¤ºæ¶ˆæ¯ç­‰ï¼Œä¸ºæ­¤æˆ‘ä»¬æ¥å¯¹API <code>wx.showToast()</code> è¿›è¡Œç®€å•çš„å°è£…ï¼Œæ–¹ä¾¿å¼€å‘ä¸­è°ƒç”¨ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºåˆ†æ”¯</span></span><br><span class="line">git checkout -b feat-utils</span><br></pre></td></tr></table></figure>

<h4 id="åŸºç¡€å°è£…"><a href="#åŸºç¡€å°è£…" class="headerlink" title="åŸºç¡€å°è£…"></a>åŸºç¡€å°è£…</h4><p>æ–°å»º <code>utils/utils.js</code> æ–‡ä»¶ï¼Œç„¶ååœ¨è¿™é‡Œå®Œæˆå…·ä½“çš„å°è£…é€»è¾‘ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å·¥å…·æ–¹æ³•</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> utils = &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å°è£… wx.showToast</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param <span class="type">&#123;string&#125;</span> </span>title æ¶ˆæ¯æç¤ºçš„å†…å®¹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="title">toast</span>(<span class="params">title = <span class="string">&#x27;æ•°æ®åŠ è½½å¤±è´¥...&#x27;</span></span>)</span> &#123;</span><br><span class="line">        wx.showToast(&#123;</span><br><span class="line">            title,</span><br><span class="line">            <span class="attr">mask</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">icon</span>: <span class="string">&#x27;none&#x27;</span>,</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ‰©å±• wx å…¨å±€å¯¹è±¡ï¼Œåˆ‡è®°ä¸è¦ä¸åŸç”¨ api é‡å</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">wx.utils = utils</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ¨¡å—åŒ–å¯¼å‡º</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> utils</span><br></pre></td></tr></table></figure>

<p>ä¸Šè¿°ä»£ç ä¸­å°†å®šä¹‰äº†ä¸€ä¸ªå¯¹è±¡ utilsï¼Œåœ¨è¿™ä¸ªå¯¹è±¡ä¸‹å¯ä»¥æ‰©å±•å¼€å‘ä¸­ç»å¸¸ç”¨åˆ°çš„æ–¹æ³•ï¼Œç„¶åå°† utils æŒ‚è½½åˆ°å…¨å±€å¯¹è±¡ wx ä¸Šï¼Œæ–¹ä¾¿å…¨å±€è°ƒç”¨ uitls ä¸­çš„æ–¹æ³•ã€‚</p>
<p>ğŸ¤” æç¤ºï¼šä¸Šè¿°ä»£ç ä¸­ export default utils çš„ä½œç”¨æ˜¯é™¤äº†é€šè¿‡ wx å…¨å±€å¯å¼•ç”¨å¤–ï¼Œä¹Ÿå¯ä»¥å½“æ¨¡å—å¯¼å…¥ä½¿ç”¨ã€‚</p>
<h4 id="å±€éƒ¨åŠ è½½"><a href="#å±€éƒ¨åŠ è½½" class="headerlink" title="å±€éƒ¨åŠ è½½"></a>å±€éƒ¨åŠ è½½</h4><p>åœ¨éœ€è¦ä½¿ç”¨ utils çš„åœºæ™¯ä¸‹å¯¼å…¥ <code>utils/utils</code> æ¨¡å—ï¼Œ <code>miniprogram/pages/index/index.js</code> ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¯¼å…¥ utils/utils æ¨¡å—</span></span><br><span class="line"><span class="keyword">import</span> utils <span class="keyword">from</span> <span class="string">&#x27;../../utils/utils&#x27;</span></span><br><span class="line">Page(&#123;</span><br><span class="line">    <span class="function"><span class="title">onLoad</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// ä¸ä¼ å‚çš„æ–¹å¼</span></span><br><span class="line">        <span class="comment">// utils.toast()</span></span><br><span class="line">        <span class="comment">// ä¼ å…¥æç¤ºæ–‡å­—</span></span><br><span class="line">        <span class="comment">// utils.toast(&#x27;ç”¨æˆ·ååªèƒ½ç”¨ä¸­æ–‡å­—ç¬¦ï¼&#x27;)</span></span><br><span class="line">        wx.utils.toast(<span class="string">&#x27;ç”¨æˆ·ååªèƒ½ç”¨ä¸­æ–‡å­—ç¬¦ï¼&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="å…¨å±€åŠ è½½"><a href="#å…¨å±€åŠ è½½" class="headerlink" title="å…¨å±€åŠ è½½"></a>å…¨å±€åŠ è½½</h4><p>æ¥ä¸‹æ¥åœ¨å…¥å£æ–‡ä»¶ <code>app.js</code> ä¸­åŠ è½½ <code>uitls/utils</code> å·¥å…·åº“ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åŠ è½½ utils/uitls.js</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./utils/utils&#x27;</span></span><br><span class="line">App(&#123;</span><br><span class="line">    <span class="attr">globalData</span>: &#123;&#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>æœ€ååœ¨é¡µé¢ä¸­è°ƒç”¨ <code>wx.utils.toast</code> è¿›è¡Œæµ‹è¯•ï¼Œ <code>pages/index/index</code> ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Page(&#123;</span><br><span class="line">    <span class="attr">data</span>: &#123;&#125;,</span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="title">onLoad</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// ä¸ä¼ å‚çš„æ–¹å¼</span></span><br><span class="line">        wx.utils.toast()</span><br><span class="line">        <span class="comment">// ä¼ å…¥æç¤ºæ–‡å­—</span></span><br><span class="line">        wx.utils.toast(<span class="string">&#x27;ç”¨æˆ·ååªèƒ½ä¸­æ–‡å­—ç¬¦ï¼&#x27;</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>æäº¤ä»£ç ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹å½“å‰è¢«ä¿®æ”¹çš„æ–‡ä»¶</span></span><br><span class="line">git status</span><br><span class="line"><span class="comment"># æš‚å­˜æ–‡ä»¶</span></span><br><span class="line">git add .</span><br><span class="line"><span class="comment"># æäº¤åˆ°æœ¬åœ°</span></span><br><span class="line">git commit -m <span class="string">&#x27;feat(utils): å°è£…å·¥å…·æ–¹æ³•&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="ç½‘ç»œè¯·æ±‚"><a href="#ç½‘ç»œè¯·æ±‚" class="headerlink" title="ç½‘ç»œè¯·æ±‚"></a>ç½‘ç»œè¯·æ±‚</h3><p>å°ç¨‹åºä¸­ç»å¤§éƒ¨åˆ†çš„ API éƒ½æ”¯æŒè¿”å› Promiseï¼Œä¹Ÿæœ‰å‡ ä¸ª API ä¸æ”¯æŒè¿”å› Promiseï¼Œå…¶ä¸­å°±åŒ…å« wx.requestï¼Œå¼€å‘ä¸­éœ€è¦è‡ªè¡Œå¯¹ wx.request è¿›è¡Œå°è£…ä¹Ÿå¯ä»¥ä½¿ç”¨ç¬¬ä¸‰æ–¹çš„å°è£…å¥½çš„æ¨¡å—ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ£€æŸ¥æœ‰æ²¡æœ‰æœªæäº¤çš„ä»£ç </span></span><br><span class="line">git status</span><br></pre></td></tr></table></figure>

<h4 id="å®‰è£…-wechat-http"><a href="#å®‰è£…-wechat-http" class="headerlink" title="å®‰è£… wechat-http"></a>å®‰è£… wechat-http</h4><p>æœ¬é¡¹ç›®æ¨èä½¿ç”¨å’±ä»¬è€å¸ˆå°è£…çš„ä¸€ä¸ª npm æ¨¡å— <a target="_blank" rel="noopener" href="https://www.npmjs.com/package/wechat-http">wechat-http</a>ï¼Œæˆ‘ä»¬å…ˆæ¥å®‰è£…ï¼Œç„¶åä»‹ç»å®ƒçš„ä½¿ç”¨æ–¹æ³•ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># npm install wechat-http --registry=https://registry.npmjs.org</span></span><br><span class="line">npm install wechat-http</span><br></pre></td></tr></table></figure>

<p>ğŸ¤” æç¤ºï¼šå®‰è£…å®Œæ¯•åè¿˜è¦è®°å¾—å¿…é¡»è¦æ„å»ºåæ‰å¯ä»¥ä½¿ç”¨ npm çš„æ¨¡å—ã€‚</p>
<p>æ¥ä¸‹æ¥ä»‹ç» wechat-http æ¨¡å—çš„ä½¿ç”¨ï¼Œå…¶ç”¨æ³•ä¸ axios ç±»ä¼¼ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¯¼å…¥ http æ¨¡å—</span></span><br><span class="line"><span class="keyword">import</span> http <span class="keyword">from</span> <span class="string">&#x27;wechat-http&#x27;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>http.baseURL é…ç½®æ¥å£åŸºç¡€è·¯å¾„ã€‚</p>
</li>
<li><p>http.get ä»¥ GET æ–¹æ³•å‘èµ·è¯·æ±‚ã€‚</p>
</li>
<li><p>http.post ä»¥ POST æ–¹æ³•å‘èµ·è¯·æ±‚ã€‚</p>
</li>
<li><p>http.put ä»¥ PUT æ–¹æ³•å‘èµ·è¯·æ±‚ã€‚</p>
</li>
<li><p>http.delete ä»¥ DELETE æ–¹æ³•å‘èµ·è¯·æ±‚ã€‚</p>
</li>
<li><p>http.intercept é…ç½®è¯·æ±‚å’Œå“åº”æ‹¦æˆªå™¨ã€‚</p>
</li>
<li><p>http æœ¬èº«åšä¸ºå‡½æ•°è°ƒç”¨ä¹Ÿèƒ½ç”¨äºå‘èµ·ç½‘ç»œè¯·æ±‚ã€‚</p>
</li>
</ul>
<h4 id="å…¬å…±é…ç½®"><a href="#å…¬å…±é…ç½®" class="headerlink" title="å…¬å…±é…ç½®"></a>å…¬å…±é…ç½®</h4><p>æ–°å»º <code>utils/http.js</code> æ–‡ä»¶ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¯¼å…¥ http æ¨¡å—</span></span><br><span class="line"><span class="keyword">import</span> http <span class="keyword">from</span> <span class="string">&#x27;wechat-http&#x27;</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é…ç½®æ¥å£åŸºç¡€è·¯å¾„</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">http.baseURL = <span class="string">&#x27;https://live-api.itheima.net&#x27;</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æŒ‚è½½æ–¹æ³•åˆ°å…¨å±€</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">wx.http = http</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ¨¡å—å¯¼å‡º</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> http</span><br></pre></td></tr></table></figure>

<h4 id="å…¨å±€åŠ è½½-1"><a href="#å…¨å±€åŠ è½½-1" class="headerlink" title="å…¨å±€åŠ è½½"></a>å…¨å±€åŠ è½½</h4><p>é¡¹ç›®å¯åŠ¨å…¥å£ <code>app.js</code> ä¸­åŠ è½½ <code>utils/http.js</code> ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åŠ è½½ utils/uitls.js</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./utils/utils&#x27;</span></span><br><span class="line"><span class="comment">// åŠ è½½ utils/http.js</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./utils/http&#x27;</span></span><br><span class="line"></span><br><span class="line">App(&#123;</span><br><span class="line">    <span class="attr">globalData</span>: &#123;&#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>åœ¨é¦–é¡µé¢æ¥è¿›è¡Œæµ‹è¯•ï¼Œ <code>pages/index/index.js</code> ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Page(&#123;</span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="title">onLoad</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// æµ‹è¯•ç½‘ç»œè¯·æ±‚</span></span><br><span class="line">        <span class="keyword">const</span> res = <span class="keyword">await</span> wx.http(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">&#x27;/announcement&#x27;</span>,</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="built_in">console</span>.log(res)</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>ğŸ¤” æç¤ºï¼šä¸è¦å¿˜äº†åœ¨å°ç¨‹åºç®¡ç†åå° request åˆæ³•åŸŸååˆ—è¡¨ä¸­æ·»åŠ æ¥å£æœåŠ¡å™¨åŸŸåå–”ã€‚</p>
<h4 id="é…ç½®æ‹¦æˆªå™¨"><a href="#é…ç½®æ‹¦æˆªå™¨" class="headerlink" title="é…ç½®æ‹¦æˆªå™¨"></a>é…ç½®æ‹¦æˆªå™¨</h4><p>è¿”å›çš„æ•°æ®ä¸­æœ‰ä¸€äº›å†—ä½™çš„æ•°æ®ï¼Œé€šè¿‡å“åº”æ‹¦æˆªå™¨è¿›è¡Œä¼˜åŒ–ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¯¼å…¥ http æ¨¡å—</span></span><br><span class="line"><span class="keyword">import</span> http <span class="keyword">from</span> <span class="string">&#x27;wechat-http&#x27;</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ¥å£åŸºç¡€è·¯å¾„</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">http.baseURL = <span class="string">&#x27;https://live-api.itheima.net&#x27;</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é…ç½®å“åº”æ‹¦æˆªå™¨</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">http.intercept.response = <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// è¿‡æ»¤æ¥å£è¿”å›çš„æ•°æ®</span></span><br><span class="line">    <span class="keyword">return</span> res.data</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æŒ‚è½½åˆ°wxå…¨å±€å¯¹è±¡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">wx.http = http</span><br></pre></td></tr></table></figure>

<p>ä¼˜åŒ–åè°ƒç”¨æ¥å£æ—¶ä»£ç å°±ä¼šå˜æ›´ç®€æ´ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// pages/index/index</span></span><br><span class="line">Page(&#123;</span><br><span class="line">    <span class="attr">data</span>: &#123;&#125;,</span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="title">onLoad</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// æµ‹è¯•ç½‘ç»œè¯·æ±‚</span></span><br><span class="line">        <span class="keyword">const</span> &#123;</span><br><span class="line">            code,</span><br><span class="line">            data</span><br><span class="line">        &#125; = <span class="keyword">await</span> wx.http(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">&#x27;/announcement&#x27;</span>,</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="comment">// æ£€æµ‹æ¥å£è°ƒç”¨çš„ç»“æœ</span></span><br><span class="line">        <span class="keyword">if</span> (code !== <span class="number">10000</span>) <span class="keyword">return</span> wx.utils.toast()</span><br><span class="line">        <span class="comment">// æ¥å£è¿”å›æ•°æ®</span></span><br><span class="line">        <span class="built_in">console</span>.log(data)</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>æäº¤ä»£ç ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹å½“å‰è¢«ä¿®æ”¹çš„æ–‡ä»¶</span></span><br><span class="line">git status</span><br><span class="line"><span class="comment"># æš‚å­˜æ–‡ä»¶</span></span><br><span class="line">git add .</span><br><span class="line"><span class="comment"># æäº¤åˆ°æœ¬åœ°</span></span><br><span class="line">git commit -m <span class="string">&#x27;feat(utils): é…ç½®ç½‘ç»œè¯·æ±‚&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¨é€åˆ°è¿œç¨‹æˆ–åˆå¹¶åˆ°æœ¬åœ° main</span></span><br><span class="line">git checkout main</span><br><span class="line">git merge feat-utils</span><br></pre></td></tr></table></figure>

<h2 id="å…¬å‘Šç®¡ç†"><a href="#å…¬å‘Šç®¡ç†" class="headerlink" title="å…¬å‘Šç®¡ç†"></a>å…¬å‘Šç®¡ç†</h2><h3 id="å…¬å‘Šåˆ—è¡¨"><a href="#å…¬å‘Šåˆ—è¡¨" class="headerlink" title="å…¬å‘Šåˆ—è¡¨"></a>å…¬å‘Šåˆ—è¡¨</h3><p>å…¬å‘Šæ˜¯ç”±ç‰©ä¸šå‘ä¸šä¸»å‘å‡ºçš„ä¸€ç³»åˆ—çš„é€šçŸ¥ï¼Œå®ƒä¸éœ€è¦æ£€æµ‹ç”¨æˆ·çš„ç™»å½•çŠ¶æ€ï¼Œå› æ­¤ç›´æ¥è°ƒç”¨åç«¯æ•°æ®æ¥å£è·å–æ•°æ®ï¼Œç„¶åæ¸²æŸ“å‡ºæ¥å°±å¯ä»¥äº†ã€‚</p>
<img src="/resource/images/Snipaste_2023-03-03_16-09-30.png"/>

<h4 id="æ¥å£è°ƒç”¨"><a href="#æ¥å£è°ƒç”¨" class="headerlink" title="æ¥å£è°ƒç”¨"></a>æ¥å£è°ƒç”¨</h4><ul>
<li><p>æ¥å£è·¯å¾„ï¼š<code>/announcement</code>ã€‚</p>
</li>
<li><p>è¯·æ±‚æ–¹æ³•: GETã€‚</p>
</li>
<li><p>è¯·æ±‚å‚æ•°ï¼šæ— ã€‚</p>
</li>
<li><p>å“åº”æ•°æ®ï¼š<a target="_blank" rel="noopener" href="https://www.apifox.cn/apidoc/shared-8d66c345-7a9a-4844-9a5a-1201852f6faa/api-41839039">è§æ–‡æ¡£</a>ã€‚</p>
</li>
</ul>
<p> <code>miniprogram/pages/index/index.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Page(&#123;</span><br><span class="line">    <span class="attr">data</span>: &#123;&#125;,</span><br><span class="line">    <span class="function"><span class="title">onLoad</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// #2 é¡µé¢åŠ è½½æ—¶è°ƒç”¨æ¥å£è·å–æ•°æ®</span></span><br><span class="line">        <span class="built_in">this</span>.getNotifyList()</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// #1 å®šä¹‰æ–¹æ³•è¯·æ±‚æ•°æ®æ¥å£</span></span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="title">getNotifyList</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// è¯·æ±‚æ•°æ®æ¥å£</span></span><br><span class="line">        <span class="keyword">const</span> &#123;</span><br><span class="line">            code,</span><br><span class="line">            <span class="attr">data</span>: notifyList</span><br><span class="line">        &#125; = <span class="keyword">await</span> wx.http.get(<span class="string">&#x27;/announcement&#x27;</span>)</span><br><span class="line">        <span class="comment">// æ£€æµ‹æ¥å£è°ƒç”¨çš„ç»“æœ</span></span><br><span class="line">        <span class="keyword">if</span> (code !== <span class="number">10000</span>) <span class="keyword">return</span> wx.utils.toast()</span><br><span class="line">        <span class="comment">// æ›´æ–°æ•°æ®</span></span><br><span class="line">        <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">            notifyList</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="æ¨¡æ¿æ¸²æŸ“"><a href="#æ¨¡æ¿æ¸²æŸ“" class="headerlink" title="æ¨¡æ¿æ¸²æŸ“"></a>æ¨¡æ¿æ¸²æŸ“</h4><p>é€šè¿‡è°ƒè¯•å·¥å…· AppData ä¸­æŸ¥çœ‹æœ¬åœ°æ˜¯å¦å·²ç»å­˜åœ¨æ•°æ®ï¼Œç„¶åå†åˆ°æ¨¡æ¿ä¸­å°†æ•°æ®æ¸²æŸ“å‡ºæ¥ï¼Œ <code>pages/index/index</code> ã€‚</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;notices&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;notices-head&quot;</span>&gt;</span>ç¤¾åŒº<span class="tag">&lt;<span class="name">text</span>&gt;</span>å…¬å‘Š<span class="tag">&lt;/<span class="name">text</span>&gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;notices-body&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">navigator</span> <span class="attr">wx:for</span>=<span class="string">&quot;&#123;&#123;notifyList&#125;&#125;&quot;</span> <span class="attr">wx:key</span>=<span class="string">&quot;id&quot;</span> <span class="attr">hover-class</span>=<span class="string">&quot;none&quot;</span> <span class="attr">url</span>=<span class="string">&quot;&#123;&#123;&#x27;/pages/notify/index?id=&#x27; + item.id&#125;&#125;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;notice&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;notice-title&quot;</span>&gt;</span>&#123;&#123;item.title&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;notice-brief&quot;</span>&gt;</span>&#123;&#123;item.content&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;notice-date&quot;</span>&gt;</span>&#123;&#123;item.createdAt&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">navigator</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>åœ¨å¯¹æ•°æ®æ¸²æŸ“æ—¶è¦æ³¨æ„ï¼Œåœ°å€è·³è½¬æ‹¼å‡‘ä¸Š id å‚æ•°ï¼Œåç»­è¦æ ¹æ®è¿™ä¸ªå‚æ•°è·å–å…¬å‘Šçš„è¯¦æƒ…ã€‚</p>
<p>æäº¤ä»£ç ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ£€æŸ¥å¾…æäº¤çš„æ–‡ä»¶</span></span><br><span class="line">git status</span><br><span class="line"><span class="comment"># æš‚å­˜æ–‡ä»¶</span></span><br><span class="line">git add .</span><br><span class="line"><span class="comment"># æäº¤åˆ°æœ¬åœ°</span></span><br><span class="line">git commit -m <span class="string">&#x27;feat(notify): å®Œæˆäº†å…¬å‘Šåˆ—è¡¨&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="å…¬å‘Šè¯¦æƒ…"><a href="#å…¬å‘Šè¯¦æƒ…" class="headerlink" title="å…¬å‘Šè¯¦æƒ…"></a>å…¬å‘Šè¯¦æƒ…</h3><h4 id="æ¥å£è°ƒç”¨-1"><a href="#æ¥å£è°ƒç”¨-1" class="headerlink" title="æ¥å£è°ƒç”¨"></a>æ¥å£è°ƒç”¨</h4><ul>
<li><p>æ¥å£è·¯å¾„ï¼š<code>/announcement/:id</code>ã€‚</p>
</li>
<li><p>è¯·æ±‚æ–¹æ³•: GETã€‚</p>
</li>
<li><p>è¯·æ±‚å‚æ•°ï¼šæ— ï¼ˆå‚æ•°æ‹¼å‡‘åœ¨è¯·æ±‚è·¯å¾„ä¸Šï¼‰ã€‚</p>
</li>
<li><p>å“åº”æ•°æ®ï¼š<a target="_blank" rel="noopener" href="https://www.apifox.cn/apidoc/shared-8d66c345-7a9a-4844-9a5a-1201852f6faa/api-42249556">è§æ–‡æ¡£</a>ã€‚</p>
</li>
</ul>
<p> <code>pages/notify/index.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">Page(&#123;</span><br><span class="line">    <span class="function"><span class="title">onLoad</span>(<span class="params">&#123;</span></span></span><br><span class="line"><span class="params"><span class="function">        id</span></span></span><br><span class="line"><span class="params"><span class="function">    &#125;</span>)</span> &#123;</span><br><span class="line">        <span class="comment">// 1. è·å–åœ°å€ä¸Šçš„ id å‚æ•°</span></span><br><span class="line">        <span class="comment">// console.log(id)</span></span><br><span class="line">        <span class="comment">// 3. é¡µé¢åŠ è½½æ—¶è°ƒç”¨æ–¹æ³•è·å–æ•°æ®</span></span><br><span class="line">        <span class="built_in">this</span>.getNotifyDetail(id)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 2. å®šä¹‰è¯·æ±‚æ•°æ®æ¥å£çš„æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="title">getNotifyDetail</span>(<span class="params">id</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!id) <span class="keyword">return</span></span><br><span class="line">        <span class="comment">// è¯·æ±‚æ•°æ®æ¥å£</span></span><br><span class="line">        <span class="keyword">const</span> &#123;</span><br><span class="line">            code,</span><br><span class="line">            <span class="attr">data</span>: notifyDetail</span><br><span class="line">        &#125; = <span class="keyword">await</span> wx.http.get(<span class="string">&#x27;/announcement/&#x27;</span> + id)</span><br><span class="line">        <span class="comment">// æ£€æµ‹æ¥å£è°ƒç”¨çš„ç»“æœ</span></span><br><span class="line">        <span class="keyword">if</span> (code !== <span class="number">10000</span>) <span class="keyword">return</span> wx.utils.toast()</span><br><span class="line">        <span class="comment">// æ›´æ–°æ•°æ®</span></span><br><span class="line">        <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">            notifyDetail</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="æ¨¡æ¿æ¸²æŸ“-1"><a href="#æ¨¡æ¿æ¸²æŸ“-1" class="headerlink" title="æ¨¡æ¿æ¸²æŸ“"></a>æ¨¡æ¿æ¸²æŸ“</h4><p>é€šè¿‡è°ƒè¯•å·¥å…· AppData ä¸­æŸ¥çœ‹æœ¬åœ°æ˜¯å¦å·²ç»å­˜åœ¨æ•°æ®ï¼Œå†åˆ°æ¨¡æ¿ä¸­å°†æ•°æ®æ¸²æŸ“å‡ºæ¥ã€‚</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">scroll-view</span> <span class="attr">enhanced</span> <span class="attr">show-scrollbar</span>=<span class="string">&quot;&#123;&#123;false&#125;&#125;&quot;</span> <span class="attr">scroll-y</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;notify-meta&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;title&quot;</span>&gt;</span>&#123;&#123;notifyDetail.title&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;extra&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;author&quot;</span>&gt;</span>&#123;&#123;notifyDetail.creatorName&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;datetime&quot;</span>&gt;</span>&#123;&#123;notifyDetail.createdAt&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;notify-content&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rich-text</span> <span class="attr">nodes</span>=<span class="string">&quot;ç¤¾åŒºå®šäº8æœˆ3æ—¥ä¸­åˆå–·æ´’ç­èšŠè¯...&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">rich-text</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">scroll-view</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="å¯Œæ–‡æœ¬å¤„ç†"><a href="#å¯Œæ–‡æœ¬å¤„ç†" class="headerlink" title="å¯Œæ–‡æœ¬å¤„ç†"></a>å¯Œæ–‡æœ¬å¤„ç†</h4><p>å°ç¨‹åºä¸­æ— æ³•ç›´æ¥è§£æ html çš„æ ‡ç­¾ï¼Œç„¶è€Œä¸€èˆ¬çš„å¯Œæ–‡æœ¬ç¼–è¾‘å™¨ç”Ÿæˆçš„å†…å®¹éƒ½æ˜¯ç”± html æ ‡ç­¾æ„æˆçš„ï¼Œä¸ºäº†åœ¨å°ç¨‹åºä¸­è§£æå¯Œæ–‡ä»¶çš„å†…å®¹ï¼Œç‰¹åˆ«æä¾›äº† <code>rich-text</code> ç»„ä»¶ã€‚</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">scroll-view</span> <span class="attr">enhanced</span> <span class="attr">show-scrollbar</span>=<span class="string">&quot;&#123;&#123;false&#125;&#125;&quot;</span> <span class="attr">scroll-y</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;notify-meta&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;title&quot;</span>&gt;</span>&#123;&#123;notifyDetail.title&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;extra&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;author&quot;</span>&gt;</span>&#123;&#123;notifyDetail.creatorName&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;datetime&quot;</span>&gt;</span>&#123;&#123;notifyDetail.createdAt&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;notify-content&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rich-text</span> <span class="attr">nodes</span>=<span class="string">&quot;&#123;&#123;notifyDetail.content&#125;&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">rich-text</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">scroll-view</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æäº¤ä»£ç ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ£€æŸ¥å¾…æäº¤çš„æ–‡ä»¶</span></span><br><span class="line">git status</span><br><span class="line"><span class="comment"># æš‚å­˜æ–‡ä»¶</span></span><br><span class="line">git add .</span><br><span class="line"><span class="comment"># æäº¤åˆ°æœ¬åœ°</span></span><br><span class="line">git commit -m <span class="string">&#x27;feat(notify): å®Œæˆäº†å…¬å‘Šè¯¦æƒ…&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¨é€åˆ°è¿œç¨‹æˆ–åˆå¹¶åˆ°æœ¬åœ° main</span></span><br><span class="line">git checkout main</span><br><span class="line">git merge feat-notify</span><br></pre></td></tr></table></figure>

<h2 id="ç”¨æˆ·ç®¡ç†"><a href="#ç”¨æˆ·ç®¡ç†" class="headerlink" title="ç”¨æˆ·ç®¡ç†"></a>ç”¨æˆ·ç®¡ç†</h2><h3 id="ç™»å½•æ£€æµ‹"><a href="#ç™»å½•æ£€æµ‹" class="headerlink" title="ç™»å½•æ£€æµ‹"></a>ç™»å½•æ£€æµ‹</h3><p>å°è£…ä¸€äº›é€»è¾‘æ¥æ£€æµ‹ç”¨æˆ·æ˜¯å¦æ˜¯ç™»å½•çŠ¶æ€ï¼Œå¦‚æœä¸æ˜¯åˆ™é‡å®šå‘åˆ°ç™»å½•é¡µï¼Œç­‰ç”¨æˆ·å®Œæˆç™»å½•åå†è·³è½¬åˆ°ç”¨æˆ·æœ¬æ¥è¦è®¿é—®çš„é¡µé¢ã€‚</p>
<p>æˆ‘ä»¬é€šè¿‡æœ¬åœ°å­˜å‚¨çš„ token æ¥åˆ¤æ–­ç”¨æˆ·çš„ç™»å½•çŠ¶æ€ï¼Œåœ¨å°ç¨‹åºå¯åŠ¨æ—¶è¯»å–æœ¬åœ°å­˜å‚¨å¹¶è®°å½•åˆ°åº”ç”¨å®ä¾‹å½“ä¸­ï¼Œæ–¹ä¾¿å…¶å®ƒé¡µé¢å…¨å±€è®¿é—®ã€‚</p>
<p> <code>app.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">App(&#123;</span><br><span class="line">    <span class="function"><span class="title">onLaunch</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// è¯»å– token</span></span><br><span class="line">        <span class="built_in">this</span>.getToken()</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="title">getToken</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// å¼‚æ­¥æ–¹å¼ä¸ä¼šé˜»å¡</span></span><br><span class="line">        wx.getStorage(&#123;</span><br><span class="line">            <span class="attr">key</span>: <span class="string">&#x27;token&#x27;</span>,</span><br><span class="line">            <span class="attr">success</span>: <span class="function">(<span class="params">&#123;</span></span></span><br><span class="line"><span class="params"><span class="function">                data</span></span></span><br><span class="line"><span class="params"><span class="function">            &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="comment">// this æŒ‡å‘åº”ç”¨å®ä¾‹</span></span><br><span class="line">                <span class="built_in">this</span>.token = data</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="function"><span class="title">fail</span>(<span class="params">err</span>)</span> &#123;</span><br><span class="line">                <span class="comment">// æ³¨æ„ï¼šæ²¡æœ‰ token æ—¶ï¼Œå¯èƒ½ä¼šè§¦å‘è¿™å„¿</span></span><br><span class="line">                <span class="built_in">console</span>.log(err)</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>å°ç¨‹åºä¸­ä¸æ”¯æŒè·¯ç”±æ‹¦æˆªï¼Œéœ€è¦å¼€å‘è€…è‡ªè¡Œå°è£…è·¯ç”±æ‹¦æˆªçš„åŠŸèƒ½ï¼Œå®è·µæœ‰è®¸å¤šçš„å®ç°æ€è·¯ï¼Œæœ¬é¡¹ç›®é‡‡ç”¨å°è£…ç»„ä»¶çš„æ–¹å¼å®ç°ï¼Œä¸»è¦çš„æ­¥éª¤å¦‚ä¸‹ã€‚</p>
<ol>
<li>åˆ›å»ºç»„ä»¶ï¼Œ<code>miniprogram/components/authorization</code> å¹¶åœ¨ <code>app.json</code> ä¸­å…¨å±€æ³¨å†Œã€‚</li>
</ol>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="attr">&quot;usingComponents&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;authorization&quot;</span>: <span class="string">&quot;/components/authorization/index&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>åœ¨ç»„ä»¶ä¸­æ·»åŠ æ’æ§½ slotï¼Œç”¨æˆ·ç™»å½•çš„æƒ…å†µä¸‹æ‰æ˜¾ç¤ºæ’æ§½çš„å†…å®¹ï¼Œ<code>components/authorization/index.wxml</code>ã€‚</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">slot</span> <span class="attr">wx:if</span>=<span class="string">&quot;&#123;&#123;isLogin&#125;&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>åœ¨ã€æˆ¿å±‹åˆ—è¡¨ã€‘é¡µé¢åº”ç”¨ authorization ç»„ä»¶ï¼Œ<code>house_pkg/pages/list/index.wxml</code>ã€‚</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">authorization</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">block</span> <span class="attr">wx:if</span>=<span class="string">&quot;&#123;&#123;true&#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">        ...</span><br><span class="line">    <span class="tag">&lt;/<span class="name">block</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">wx:else</span> <span class="attr">class</span>=<span class="string">&quot;blank&quot;</span>&gt;</span></span><br><span class="line">        æ‚¨è¿˜æ²¡æœ‰è®¤è¯æˆ¿å±‹ï¼Œè¯·ç‚¹å‡» <span class="tag">&lt;<span class="name">navigator</span> <span class="attr">hover-class</span>=<span class="string">&quot;none&quot;</span> <span class="attr">class</span>=<span class="string">&quot;link&quot;</span> <span class="attr">url</span>=<span class="string">&quot; &quot;</span>&gt;</span>æ·»åŠ <span class="tag">&lt;/<span class="name">navigator</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">authorization</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æ­¤æ—¶è·³è½¬åˆ°ã€æˆ¿å±‹åˆ—è¡¨ã€‘æ—¶ä¼šå‡ºç°ç©ºç™½çš„å†…å®¹ï¼ŒåŸå› æ˜¯ isLogin çš„å€¼å½“å‰ä¸º undefined å³ä¸º false å‡å€¼ã€‚</p>
<ol start="4">
<li>åœ¨ç”Ÿå‘½å‘¨æœŸå‡½æ•° attached ä¸­è¯»å–ç”¨æˆ·çš„ç™»å½•çŠ¶æ€ï¼Œ<code>components/authorization/index.js</code>ã€‚</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">Component(&#123;</span><br><span class="line">    <span class="attr">data</span>: &#123;</span><br><span class="line">        <span class="attr">isLogin</span>: <span class="literal">false</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// ç”Ÿå‘½å‘¨æœŸå‡½æ•°</span></span><br><span class="line">    <span class="attr">lifetimes</span>: &#123;</span><br><span class="line">        <span class="function"><span class="title">attached</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">            <span class="comment">// ç™»å½•çŠ¶æ€</span></span><br><span class="line">            <span class="keyword">const</span> isLogin = !!getApp().token</span><br><span class="line">            <span class="comment">// è®°å½•ç™»å½•çŠ¶æ€</span></span><br><span class="line">            <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">                isLogin</span><br><span class="line">            &#125;)</span><br><span class="line">            <span class="comment">// æœªç™»å½•é‡å®šå‘åˆ°ç™»å½•é¡µ</span></span><br><span class="line">            <span class="keyword">if</span> (!isLogin) &#123;</span><br><span class="line">                <span class="comment">// å¼•å¯¼ç”¨æˆ·åˆ°ç™»å½•é¡µé¢</span></span><br><span class="line">                wx.redirectTo(&#123;</span><br><span class="line">                    <span class="attr">url</span>: <span class="string">`/pages/login/index`</span>,</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>ç™»å½•æˆåŠŸåå›åˆ°åŸé¡µé¢ã€‚</li>
</ol>
<p>åœ¨ç”¨æˆ·å®Œæˆç™»å½•åï¼ŒæœŸæœ›å›åˆ°ç”¨æˆ·åŸæœ¬è¦è®¿é—®çš„é¡µé¢ï¼Œè¦å®ç°è¿™ä¸ªåŠŸèƒ½éœ€è¦å’±ä»¬å…ˆè·å–ç”¨æˆ·æ­£åœ¨è®¿é—®çš„é¡µé¢è·¯å¾„ï¼Œç„¶åæŠŠè¿™ä¸ªè·¯å¾„ä¼ ç»™ç™»å½•é¡µé¢ï¼Œè¿™æ ·åœ¨ç™»å½•æˆåŠŸåä¾¿å¯ä»¥å†è·³è½¬åˆ°å›è¿™ä¸ªé¡µé¢äº†ï¼Œè·å–é¡µé¢è·¯å¾„çš„æ–¹æ³•å¦‚ä¸‹ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// components/authorization/index.js</span></span><br><span class="line">Component(&#123;</span><br><span class="line">    <span class="attr">data</span>: &#123;</span><br><span class="line">        <span class="attr">isLogin</span>: <span class="literal">false</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// ç”Ÿå‘½å‘¨æœŸå‡½æ•°</span></span><br><span class="line">    <span class="attr">lifetimes</span>: &#123;</span><br><span class="line">        <span class="function"><span class="title">attached</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">            <span class="comment">// ç™»å½•çŠ¶æ€</span></span><br><span class="line">            <span class="keyword">const</span> isLogin = !!getApp().token</span><br><span class="line">            <span class="comment">// è®°å½•ç™»å½•çŠ¶æ€</span></span><br><span class="line">            <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">                isLogin</span><br><span class="line">            &#125;)</span><br><span class="line">            <span class="comment">// æœªç™»å½•é‡å®šå‘åˆ°ç™»å½•é¡µ</span></span><br><span class="line">            <span class="keyword">if</span> (!isLogin) &#123;</span><br><span class="line">                <span class="comment">// è¯»å–å½“å‰å†å²æ ˆ</span></span><br><span class="line">                <span class="keyword">const</span> pageStack = getCurrentPages()</span><br><span class="line">                <span class="comment">// å–å‡ºå½“å‰é¡µé¢è·¯å¾„ï¼Œç™»å½•æˆåŠŸèƒ½è·³è½¬åˆ°è¯¥é¡µé¢</span></span><br><span class="line">                <span class="keyword">const</span> currentPage = pageStack[pageStack.length - <span class="number">1</span>]</span><br><span class="line">                <span class="comment">// å–å‡ºå½“å‰é¡µé¢è·¯å¾„ï¼Œç™»å½•æˆåŠŸèƒ½è·³è½¬åˆ°è¯¥é¡µé¢</span></span><br><span class="line">                <span class="keyword">const</span> redirectURL = currentPage.route</span><br><span class="line">                <span class="comment">// å¼•å¯¼ç”¨æˆ·åˆ°ç™»å½•é¡µé¢</span></span><br><span class="line">                wx.redirectTo(&#123;</span><br><span class="line">                    <span class="attr">url</span>: <span class="string">`/pages/login/index?redirectURL=/<span class="subst">$&#123;redirectURL&#125;</span>`</span>,</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="ç”¨æˆ·ç™»å½•"><a href="#ç”¨æˆ·ç™»å½•" class="headerlink" title="ç”¨æˆ·ç™»å½•"></a>ç”¨æˆ·ç™»å½•</h3><p>äº«+ç¤¾åŒºçš„ç™»å½•å’Œæ³¨å†ŒåŠŸèƒ½æ˜¯åˆå¹¶åœ¨ä¸€èµ·çš„ï¼Œé¦–å…ˆæ£€æµ‹ç”¨æˆ·å¡«å†™çš„æ‰‹æœºå·æ˜¯å¦å·²ç»æ³¨å†Œï¼Œå¦‚æœæœªæ³¨å†Œåˆ™ä¼šè‡ªåŠ¨æ³¨å†Œç”¨æˆ·å¹¶ç™»å½•ï¼Œç›¸åå¦‚æœå·²æ³¨å†Œç”¨æˆ·åˆ™ç›´æ¥ç™»å½•ã€‚</p>
<h4 id="å€’è®¡æ—¶åŠŸèƒ½"><a href="#å€’è®¡æ—¶åŠŸèƒ½" class="headerlink" title="å€’è®¡æ—¶åŠŸèƒ½"></a>å€’è®¡æ—¶åŠŸèƒ½</h4><ol>
<li>Vant ç»„ä»¶åº“ä¸­çš„ van-field æ˜¯ä¸€ä¸ªè¾“å…¥æ¡†ç»„ä»¶ã€‚</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">van-field</span> <span class="attr">placeholder</span>=<span class="string">&quot;è¯·è¾“å…¥æ‰‹æœºå·ç &quot;</span> <span class="attr">type</span>=<span class="string">&quot;number&quot;</span> <span class="attr">placeholder-style</span>=<span class="string">&quot;color: #979797&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">van-field</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>van-field ç»„ä»¶æ”¯æŒæ’æ§½ï¼Œæ’æ§½çš„å†…å®¹æˆ‘ä»¬æ”¾å…¥ä¸€ä¸ªå€’è®¡æ—¶ç»„ä»¶ van-count-downã€‚</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">van-field</span> <span class="attr">placeholder</span>=<span class="string">&quot;è¯·è¾“å…¥æ‰‹æœºå·ç &quot;</span> <span class="attr">type</span>=<span class="string">&quot;number&quot;</span> <span class="attr">use-button-slot</span> <span class="attr">placeholder-style</span>=<span class="string">&quot;color: #979797&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- é€šè¿‡å…·åæ’æ§½ button å¯ä»¥è‡ªå®šä¹‰è¾“å…¥æ¡†å°¾éƒ¨çš„å†…å®¹ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;button-slot&quot;</span> <span class="attr">slot</span>=<span class="string">&quot;button&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">van-count-down</span> <span class="attr">time</span>=<span class="string">&quot;&#123;&#123; 60000 &#125;&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">van-count-down</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">van-field</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>van-count-down ç»„ä»¶çš„é»˜è®¤æ’æ§½ï¼Œå¯ä»¥è‡ªå®šä¹‰å€’è®¡æ—¶å†…å®¹çš„æ˜¾ç¤ºã€‚</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">van-field</span> <span class="attr">placeholder</span>=<span class="string">&quot;è¯·è¾“å…¥æ‰‹æœºå·ç &quot;</span> <span class="attr">type</span>=<span class="string">&quot;number&quot;</span> <span class="attr">use-button-slot</span> <span class="attr">placeholder-style</span>=<span class="string">&quot;color: #979797&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;button-slot&quot;</span> <span class="attr">slot</span>=<span class="string">&quot;button&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">van-count-down</span> <span class="attr">use-slot</span> <span class="attr">time</span>=<span class="string">&quot;&#123;&#123; 60000 &#125;&#125;&quot;</span> <span class="attr">bind:change</span>=<span class="string">&quot;countDownChange&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">text</span>&gt;</span>&#123;&#123; timeData.seconds &#125;&#125;ç§’åé‡æ–°è·å–<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">van-count-down</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">van-field</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="4">
<li>ç›‘å¬ van-count-down change äº‹ä»¶è·å–å€’è®¡æ—¶çš„æ—¶é—´å˜åŒ–ä¿¡æ¯ã€‚</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// pages/login/index.js</span></span><br><span class="line">Page(&#123;</span><br><span class="line">    <span class="comment">// è·å–å€’è®¡æ—¶ä¿¡æ¯</span></span><br><span class="line">    <span class="function"><span class="title">countDownChange</span>(<span class="params">ev</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">            <span class="attr">timeData</span>: ev.detail</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>å€’è®¡æ—¶ç»“æŸæ—¶éšè—å€’è®¡æ—¶ç»„ä»¶ã€‚</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// pages/login/index.js</span></span><br><span class="line">Page(&#123;</span><br><span class="line">    <span class="attr">data</span>: &#123;</span><br><span class="line">        <span class="attr">countDownVisible</span>: <span class="literal">false</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// è·å–å€’è®¡æ—¶ä¿¡æ¯</span></span><br><span class="line">    <span class="function"><span class="title">countDownChange</span>(<span class="params">ev</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">            <span class="attr">timeData</span>: ev.detail,</span><br><span class="line">            <span class="comment">// å€’è®¡æ—¶å‡ºæ¥çš„ç¬é—´ ev.detail.minutes ä¸º 1ï¼Œseconds ä¸º 0 </span></span><br><span class="line">            <span class="attr">countDownVisible</span>: ev.detail.minutes === <span class="number">1</span> || ev.detail.seconds &gt; <span class="number">0</span>,</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ol start="6">
<li>è§†å›¾ä¸­æ ¹æ® countDownVisible çš„çŠ¶æ€ï¼ŒæŒ‰éœ€å±•ç¤º <code>è·å–éªŒè¯ç æŒ‰é’®</code> å’Œ <code>å€’è®¡æ—¶</code> çš„ä¿¡æ¯ã€‚</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">van-field</span> <span class="attr">placeholder</span>=<span class="string">&quot;è¯·è¾“å…¥æ‰‹æœºå·ç &quot;</span> <span class="attr">type</span>=<span class="string">&quot;number&quot;</span> <span class="attr">use-button-slot</span> <span class="attr">placeholder-style</span>=<span class="string">&quot;color: #979797&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;button-slot&quot;</span> <span class="attr">slot</span>=<span class="string">&quot;button&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">text</span> <span class="attr">wx:if</span>=<span class="string">&quot;&#123;&#123;!countDownVisible&#125;&#125;&quot;</span>&gt;</span>è·å–éªŒè¯ç <span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">van-count-down</span> <span class="attr">wx:else</span> <span class="attr">use-slot</span> <span class="attr">time</span>=<span class="string">&quot;&#123;&#123; 60000 &#125;&#125;&quot;</span> <span class="attr">bind:change</span>=<span class="string">&quot;countDownChange&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">text</span>&gt;</span>&#123;&#123; timeData.seconds &#125;&#125;ç§’åé‡æ–°è·å–<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">van-count-down</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">van-field</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="è·å–éªŒè¯ç "><a href="#è·å–éªŒè¯ç " class="headerlink" title="è·å–éªŒè¯ç "></a>è·å–éªŒè¯ç </h4><p>ç”¨æˆ·å¡«å†™æ‰‹æœºå·è·å–çŸ­ä¿¡éªŒè¯ç éªŒè¯ç”¨æˆ·çš„èº«ä»½ï¼Œæˆ‘ä»¬åˆ†æˆ 3 æ­¥æ¥å®ç°è¯¥åŠŸèƒ½ã€‚</p>
<ol>
<li>é€šè¿‡å°ç¨‹åºçš„åŒå‘æ•°æ®ç»‘å®šè·å–è¡¨å•çš„æ•°æ®ï¼Œ<code>miniprogram/pages/login/index.wxml</code>ã€‚</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">van-field</span> <span class="attr">model:value</span>=<span class="string">&quot;&#123;&#123;mobile&#125;&#125;&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;è¯·è¾“å…¥æ‰‹æœºå·ç &quot;</span> <span class="attr">type</span>=<span class="string">&quot;number&quot;</span> <span class="attr">use-button-slot</span> <span class="attr">placeholder-style</span>=<span class="string">&quot;color: #979797&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;button-slot&quot;</span> <span class="attr">slot</span>=<span class="string">&quot;button&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">text</span> <span class="attr">wx:if</span>=<span class="string">&quot;&#123;&#123;!countDownVisible&#125;&#125;&quot;</span>&gt;</span>è·å–éªŒè¯ç <span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">van-count-down</span> <span class="attr">wx:else</span> <span class="attr">use-slot</span> <span class="attr">time</span>=<span class="string">&quot;&#123;&#123; 60000 &#125;&#125;&quot;</span> <span class="attr">bind:change</span>=<span class="string">&quot;countDownChange&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">text</span>&gt;</span>&#123;&#123; timeData.seconds &#125;&#125;ç§’åé‡æ–°è·å–<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">van-count-down</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">van-field</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li> éªŒè¯æ‰‹æœºå·ç ã€‚</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">Page(&#123;</span><br><span class="line">    <span class="attr">data</span>: &#123;</span><br><span class="line">        <span class="attr">mobile</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="attr">countDownVisible</span>: <span class="literal">false</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// å€’è®¡æ—¶</span></span><br><span class="line">    <span class="function"><span class="title">countDownChange</span>(<span class="params">ev</span>)</span> &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// éªŒè¯æ‰‹æœºå·æ ¼å¼</span></span><br><span class="line">    <span class="function"><span class="title">verifyMobile</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// å®½æ¾çš„éªŒè¯è§„åˆ™</span></span><br><span class="line">        <span class="keyword">const</span> reg = <span class="regexp">/^[1][3-8][0-9]&#123;9&#125;$/</span></span><br><span class="line">        <span class="comment">// æ­£åˆ™éªŒè¯ï¼ˆå»é™¤ä¸¤ç«¯ç©ºæ ¼ï¼‰</span></span><br><span class="line">        <span class="keyword">const</span> valid = reg.test(<span class="built_in">this</span>.data.mobile.trim())</span><br><span class="line">        <span class="comment">// éªŒè¯ç»“æœæç¤º</span></span><br><span class="line">        <span class="keyword">if</span> (!valid) wx.utils.toast(<span class="string">&#x27;è¯·å¡«å†™æ­£ç¡®çš„æ‰‹æœºå·ç !&#x27;</span>)</span><br><span class="line">        <span class="comment">// è¿”å›éªŒè¯ç»“æœ</span></span><br><span class="line">        <span class="keyword">return</span> valid</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–çŸ­ä¿¡éªŒè¯ç </span></span><br><span class="line">    <span class="function"><span class="title">getCode</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// éªŒè¯æ‰‹æœºå·ç æ ¼å¼æ˜¯å¦æ­£ç¡®</span></span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">this</span>.verifyMobile()) <span class="keyword">return</span></span><br><span class="line">    &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>è°ƒç”¨æ¥å£ã€‚</li>
</ol>
<p>éªŒè¯ç”¨æˆ·å¡«å†™æ‰‹æœºå·ç æ ¼å¼æ­£ç¡®åè¯·æ±‚åç«¯æ¥å£è·å–çŸ­ä¿¡éªŒè¯ç ã€‚</p>
<ul>
<li><p>æ¥å£è·¯å¾„ï¼š<code>/code</code>ã€‚</p>
</li>
<li><p>è¯·æ±‚æ–¹æ³•: GETã€‚</p>
</li>
<li><p>è¯·æ±‚å‚æ•°ï¼š</p>
<ul>
<li>mobile ç”¨æˆ·å¡«å†™çš„æ‰‹æœºå·ã€‚</li>
</ul>
</li>
<li><p>å“åº”æ•°æ®ï¼š<a target="_blank" rel="noopener" href="https://www.apifox.cn/apidoc/shared-8d66c345-7a9a-4844-9a5a-1201852f6faa/api-42672274">è§æ–‡æ¡£</a>ã€‚</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">Page(&#123;</span><br><span class="line">    <span class="attr">data</span>: &#123;</span><br><span class="line">        <span class="attr">mobile</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="attr">countDownVisible</span>: <span class="literal">false</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// å€’è®¡æ—¶</span></span><br><span class="line">    <span class="function"><span class="title">countDownChange</span>(<span class="params">ev</span>)</span> &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// éªŒè¯æ‰‹æœºå·æ ¼å¼</span></span><br><span class="line">    <span class="function"><span class="title">verifyMobile</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// å®½æ¾çš„éªŒè¯è§„åˆ™</span></span><br><span class="line">        <span class="keyword">const</span> reg = <span class="regexp">/^[1][3-8][0-9]&#123;9&#125;$/</span></span><br><span class="line">        <span class="comment">// æ­£åˆ™éªŒè¯ï¼ˆå»é™¤ä¸¤ç«¯ç©ºæ ¼ï¼‰</span></span><br><span class="line">        <span class="keyword">const</span> valid = reg.test(<span class="built_in">this</span>.data.mobile.trim())</span><br><span class="line">        <span class="comment">// éªŒè¯ç»“æœæç¤º</span></span><br><span class="line">        <span class="keyword">if</span> (!valid) wx.utils.toast(<span class="string">&#x27;è¯·å¡«å†™æ­£ç¡®çš„æ‰‹æœºå·ç !&#x27;</span>)</span><br><span class="line">        <span class="comment">// è¿”å›éªŒè¯ç»“æœ</span></span><br><span class="line">        <span class="keyword">return</span> valid</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–çŸ­ä¿¡éªŒè¯ç </span></span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="title">getCode</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// éªŒè¯æ‰‹æœºå·ç æ ¼å¼æ˜¯å¦æ­£ç¡®</span></span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">this</span>.verifyMobile()) <span class="keyword">return</span></span><br><span class="line">        <span class="comment">// è¯·æ±‚æ•°æ®æ¥å£</span></span><br><span class="line">        <span class="keyword">const</span> &#123;</span><br><span class="line">            code,</span><br><span class="line">        &#125; = <span class="keyword">await</span> wx.http.get(<span class="string">&#x27;/code&#x27;</span>, &#123;</span><br><span class="line">            <span class="attr">mobile</span>: <span class="built_in">this</span>.data.mobile.trim()</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="comment">// éªŒè¯æ¥å£è¿”å›ç»“æœ</span></span><br><span class="line">        <span class="keyword">if</span> (code !== <span class="number">10000</span>) <span class="keyword">return</span> wx.uitls.toast(<span class="string">&#x27;å‘é€å¤±è´¥, è¯·ç¨åé‡è¯•!&#x27;</span>)</span><br><span class="line">        <span class="comment">// å‘é€éªŒè¯ç æˆåŠŸ</span></span><br><span class="line">        wx.utils.toast(<span class="string">&#x27;å‘é€æˆåŠŸ, è¯·æŸ¥æ”¶çŸ­ä¿¡!&#x27;</span>)</span><br><span class="line">        <span class="comment">// å¼€å§‹å€’è®¡æ—¶</span></span><br><span class="line">        <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">            <span class="attr">countDownVisible</span>: <span class="literal">true</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>åé—¨æµ‹è¯•ã€‚</li>
</ol>
<p>ä¸ºäº†æ–¹ä¾¿æµ‹è¯•ï¼Œå’±ä»¬æŠŠçŸ­ä¿¡éªŒè¯ç å·å·çš„ä¿å­˜åœ¨ç²˜è´´æ¿ä¸­ï¼Œé¡ºä¾¿ä¹Ÿå¤šå­¦ä¹ ä¸€ä¸ªå°ç¨‹åºçš„ APIã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å®šä¹‰å˜é‡ä¿å­˜éªŒè¯ç </span></span><br><span class="line"><span class="keyword">let</span> secret_code = <span class="string">&#x27;&#x27;</span></span><br><span class="line">Page(&#123;</span><br><span class="line">    <span class="attr">data</span>: &#123;</span><br><span class="line">        <span class="attr">mobile</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="attr">countDownVisible</span>: <span class="literal">false</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// å€’è®¡æ—¶</span></span><br><span class="line">    <span class="function"><span class="title">countDownChange</span>(<span class="params">ev</span>)</span> &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// éªŒè¯æ‰‹æœºå·æ ¼å¼</span></span><br><span class="line">    <span class="function"><span class="title">verifyMobile</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–çŸ­ä¿¡éªŒè¯ç </span></span><br><span class="line">    <span class="function"><span class="title">getCode</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// éªŒè¯æ‰‹æœºå·ç æ ¼å¼æ˜¯å¦æ­£ç¡®</span></span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">this</span>.verifyMobile()) <span class="keyword">return</span></span><br><span class="line">        <span class="comment">// è¯·æ±‚æ•°æ®æ¥å£</span></span><br><span class="line">        <span class="keyword">const</span> &#123;</span><br><span class="line">            code,</span><br><span class="line">            data</span><br><span class="line">        &#125; = <span class="keyword">await</span> wx.http.get(<span class="string">&#x27;/code&#x27;</span>, &#123;</span><br><span class="line">            <span class="attr">mobile</span>: <span class="built_in">this</span>.data.mobile.trim()</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="comment">// éªŒè¯æ¥å£è¿”å›ç»“æœ</span></span><br><span class="line">        <span class="keyword">if</span> (code !== <span class="number">10000</span>) <span class="keyword">return</span> wx.uitls.toast(<span class="string">&#x27;å‘é€å¤±è´¥, è¯·ç¨åé‡è¯•!&#x27;</span>)</span><br><span class="line">        <span class="comment">// å‘é€éªŒè¯ç æˆåŠŸ</span></span><br><span class="line">        wx.utils.toast(<span class="string">&#x27;å‘é€æˆåŠŸ, è¯·æŸ¥æ”¶çŸ­ä¿¡!&#x27;</span>)</span><br><span class="line">        <span class="comment">// å¼€å§‹å€’è®¡æ—¶</span></span><br><span class="line">        <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">            <span class="attr">countDownVisible</span>: <span class="literal">true</span></span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="comment">// è®°å½•éªŒè¯ç ç­‰å¾…å¤åˆ¶åˆ°ç²˜è´´æ¿ï¼ˆä»…ç”¨äºæµ‹è¯•ç¯å¢ƒï¼‰</span></span><br><span class="line">        secret_code = data.code</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// å¤åˆ¶éªŒè¯ç åˆ°ç²˜è´´æ¿</span></span><br><span class="line">    <span class="function"><span class="title">copyCode</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        wx.setClipboardData(&#123;</span><br><span class="line">            <span class="attr">data</span>: secret_code</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>ğŸ¤” æç¤ºï¼šçœŸå®å¼€å‘ä¸­æ¥å£å¹¶ä¸ä¼šæŠŠçŸ­ä¿¡éªŒè¯ç è¿”å›å‰ç«¯è€Œæ˜¯ç›´æ¥å‘é€åˆ°ç”¨æˆ·çš„æ‰‹æœºä¸Šï¼Œä¸Šè¿°çš„åšæ³•åªæ˜¯ç”¨æ¥å­¦ä¹ ã€‚</p>
<h4 id="ç™»å½•å’Œæ³¨å†Œ"><a href="#ç™»å½•å’Œæ³¨å†Œ" class="headerlink" title="ç™»å½•å’Œæ³¨å†Œ"></a>ç™»å½•å’Œæ³¨å†Œ</h4><ol>
<li>è·å–éªŒè¯ç å¹¶è¿›è¡ŒéªŒè¯ã€‚</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">van-field</span> <span class="attr">model:value</span>=<span class="string">&quot;&#123;&#123;code&#125;&#125;&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;è¯·è¾“å…¥6ä½éªŒè¯ç &quot;</span> <span class="attr">placeholder-style</span>=<span class="string">&quot;color: #979797&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å®šä¹‰å˜é‡ä¿å­˜éªŒè¯ç </span></span><br><span class="line"><span class="keyword">let</span> secret_code = <span class="string">&#x27;&#x27;</span></span><br><span class="line">Page(&#123;</span><br><span class="line">    <span class="attr">data</span>: &#123;</span><br><span class="line">        <span class="attr">mobile</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="attr">code</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="attr">countDownVisible</span>: <span class="literal">false</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="comment">// éªŒè¯éªŒè¯ç </span></span><br><span class="line">    <span class="function"><span class="title">verifyCode</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// éªŒè¯ç ä¸º6ä½æ•°å­—</span></span><br><span class="line">        <span class="keyword">const</span> reg = <span class="regexp">/^\d&#123;6&#125;$/</span></span><br><span class="line">        <span class="comment">// éªŒè¯éªŒè¯ç </span></span><br><span class="line">        <span class="keyword">const</span> valid = reg.test(<span class="built_in">this</span>.data.code.trim())</span><br><span class="line">        <span class="comment">// éªŒè¯ç»“æœæç¤º</span></span><br><span class="line">        <span class="keyword">if</span> (!valid) wx.utils.toast(<span class="string">&#x27;è¯·æ£€æŸ¥éªŒè¯ç æ˜¯å¦æ­£ç¡®!&#x27;</span>)</span><br><span class="line">        <span class="comment">// è¿”å›éªŒè¯ç»“æœ</span></span><br><span class="line">        <span class="keyword">return</span> valid</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// æäº¤æ•°æ®å®Œæˆç™»å½•</span></span><br><span class="line">    <span class="function"><span class="title">submitForm</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// é€ä¸ªéªŒè¯è¡¨å•æ•°æ®</span></span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">this</span>.verifyMobile()) <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">this</span>.verifyCode()) <span class="keyword">return</span></span><br><span class="line">    &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>è°ƒç”¨æ¥å£ã€‚</li>
</ol>
<ul>
<li><p>æ¥å£è·¯å¾„ï¼š<code>/login</code>ã€‚</p>
</li>
<li><p>è¯·æ±‚æ–¹æ³•: POSTã€‚</p>
</li>
<li><p>è¯·æ±‚å‚æ•°ï¼š</p>
<ul>
<li><p>mobile ç”¨æˆ·å¡«å†™çš„æ‰‹æœºå·ã€‚</p>
</li>
<li><p>code çŸ­ä¿¡éªŒè¯ç ã€‚</p>
</li>
</ul>
</li>
<li><p>å“åº”æ•°æ®ï¼š<a target="_blank" rel="noopener" href="https://www.apifox.cn/apidoc/shared-8d66c345-7a9a-4844-9a5a-1201852f6faa/api-42672276">è§æ–‡æ¡£</a>ã€‚</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è·å–åº”ç”¨å®ä¾‹</span></span><br><span class="line"><span class="keyword">const</span> app = getApp()</span><br><span class="line">Page(&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// æäº¤æ•°æ®å®Œæˆç™»å½•</span></span><br><span class="line">    <span class="function"><span class="title">submitForm</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// #1 é€ä¸ªéªŒè¯è¡¨å•æ•°æ®</span></span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">this</span>.verifyMobile()) <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">this</span>.verifyCode()) <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// #2 è§£æ„ç”¨æˆ·å¡«å†™çš„æ‰‹æœºå·å’ŒéªŒè¯ç </span></span><br><span class="line">        <span class="keyword">const</span> &#123;</span><br><span class="line">            mobile,</span><br><span class="line">            code</span><br><span class="line">        &#125; = <span class="built_in">this</span>.data</span><br><span class="line">        <span class="comment">// è°ƒç”¨æ¥å£ç™»å½•/æ³¨å†Œ</span></span><br><span class="line">        <span class="keyword">const</span> res = <span class="keyword">await</span> wx.http.post(<span class="string">&#x27;/login&#x27;</span>, &#123;</span><br><span class="line">            mobile,</span><br><span class="line">            code</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="comment">// #3 åˆ¤é”™</span></span><br><span class="line">        <span class="keyword">if</span> (res.code !== <span class="number">10000</span>) <span class="keyword">return</span> wx.utils.toast(<span class="string">&#x27;è¯·æ£€æŸ¥éªŒè¯ç æ˜¯å¦æ­£ç¡®!&#x27;</span>)</span><br><span class="line">        <span class="comment">// #4 æ‹¼å‡‘å®Œæ•´ token </span></span><br><span class="line">        <span class="keyword">const</span> token = <span class="string">&#x27;Bearer &#x27;</span> + res.data.token</span><br><span class="line">        <span class="comment">// #5 æœ¬åœ°å­˜å‚¨ token</span></span><br><span class="line">        wx.setStorageSync(<span class="string">&#x27;token&#x27;</span>, token)</span><br><span class="line">        <span class="comment">// #6 æ›´æ–°å…¨å±€ token</span></span><br><span class="line">        app.token = token</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>ä¸ºäº†å°†æ¥èƒ½å¤Ÿå¤ç”¨ï¼Œå’±ä»¬å¯ä»¥å°†å­˜å‚¨ token çš„é€»è¾‘å°è£…åˆ° <code>app.js</code> ä¸­ã€‚</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">App(&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="function"><span class="title">setToken</span>(<span class="params">token</span>)</span> &#123;</span><br><span class="line">        <span class="comment">// æ‹¼å‡‘åˆæ³•tokenæ ¼å¼</span></span><br><span class="line">        token = <span class="string">&#x27;Bearer &#x27;</span> + token</span><br><span class="line">        <span class="comment">// æœ¬åœ°å­˜å‚¨ token å’Œ refresh_token</span></span><br><span class="line">        wx.setStorageSync(<span class="string">&#x27;token&#x27;</span>, token)</span><br><span class="line">        <span class="comment">// æ›´æ–°å…¨å±€ token å’Œ refresh_token</span></span><br><span class="line">        <span class="built_in">this</span>.token = token</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>ç„¶åè°ƒç”¨å°è£…å¥½çš„æ–¹æ³•æ¥å­˜å‚¨ tokenï¼Œä»£ç ä¹Ÿä¼šå˜æ›´ç®€æ´è®¸å¤šã€‚</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å®šä¹‰å˜é‡ä¿å­˜éªŒè¯ç </span></span><br><span class="line"><span class="keyword">let</span> secret_code = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="comment">// è·å–åº”ç”¨å®ä¾‹</span></span><br><span class="line"><span class="keyword">const</span> app = getApp()</span><br><span class="line">Page(&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="comment">// æäº¤æ•°æ®å®Œæˆç™»å½•</span></span><br><span class="line">    <span class="function"><span class="title">submitForm</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// #1 é€ä¸ªéªŒè¯è¡¨å•æ•°æ®</span></span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">this</span>.verifyMobile()) <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">this</span>.verifyCode()) <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// #2 ç”¨æˆ·å¡«å†™çš„æ‰‹æœºå·å’ŒéªŒè¯ç </span></span><br><span class="line">        <span class="keyword">const</span> &#123;</span><br><span class="line">            mobile,</span><br><span class="line">            code</span><br><span class="line">        &#125; = <span class="built_in">this</span>.data</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> res = <span class="keyword">await</span> wx.http.post(<span class="string">&#x27;/login&#x27;</span>, &#123;</span><br><span class="line">            mobile,</span><br><span class="line">            code</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="comment">// #3 æ ¡éªŒæ•°æ®æ˜¯å¦åˆæ³•</span></span><br><span class="line">        <span class="keyword">if</span> (res.code !== <span class="number">10000</span>) <span class="keyword">return</span> wx.utils.toast(<span class="string">&#x27;è¯·æ£€æŸ¥éªŒè¯ç æ˜¯å¦æ­£ç¡®!&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// #4 æ‹¼å‡‘å®Œæ•´ token </span></span><br><span class="line">        <span class="comment">// #5 æœ¬åœ°å­˜å‚¨ token</span></span><br><span class="line">        <span class="comment">// #6 æ›´æ–°å…¨å±€ token</span></span><br><span class="line">        app.setToken(res.data.token)</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>é‡å®šå‘è·¯ç”±ã€‚</li>
</ol>
<p>è¿˜è®°å¾—å‰é¢æˆ‘ä»¬æ£€æµ‹äº†ç”¨æˆ·çš„ç™»å½•çŠ¶æ€ï¼Œæœªç™»å½•çš„æƒ…å†µä¼šè·³è½¬åˆ°ç™»å½•é¡µé¢ï¼ŒåŒæ—¶å°†é¡µé¢çš„è·¯å¾„ä½œä¸ºå‚æ•°ä¼ åˆ°äº†ç™»å½•é¡µé¢ï¼Œç°åœ¨æˆ‘ä»¬æ¥è·å–è¿™ä¸ªå‚æ•°ç„¶åé‡å®šå‘åˆ°è¿™ä¸ªé¡µé¢è·¯å¾„ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è·å–åº”ç”¨å®ä¾‹</span></span><br><span class="line"><span class="keyword">const</span> app = getApp()</span><br><span class="line">Page(&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="function"><span class="title">onLoad</span>(<span class="params">&#123;</span></span></span><br><span class="line"><span class="params"><span class="function">        redirectURL</span></span></span><br><span class="line"><span class="params"><span class="function">    &#125;</span>)</span> &#123;</span><br><span class="line">        <span class="comment">// è·å–åœ°å€å‚æ•°</span></span><br><span class="line">        <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">            redirectURL</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// æäº¤æ•°æ®å®Œæˆç™»å½•</span></span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="title">submitForm</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// é€ä¸ªéªŒè¯è¡¨å•æ•°æ®</span></span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">this</span>.verifyMobile()) <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">this</span>.verifyCode()) <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç”¨æˆ·å¡«å†™çš„æ‰‹æœºå·å’ŒéªŒè¯ç </span></span><br><span class="line">        <span class="keyword">const</span> &#123;</span><br><span class="line">            mobile,</span><br><span class="line">            code</span><br><span class="line">        &#125; = <span class="built_in">this</span>.data</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è°ƒç”¨æ¥å£ç™»å½•/æ³¨å†Œ</span></span><br><span class="line">        <span class="keyword">const</span> res = <span class="keyword">await</span> wx.http.post(<span class="string">&#x27;/login&#x27;</span>, &#123;</span><br><span class="line">            mobile,</span><br><span class="line">            code</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="comment">// æ ¡éªŒæ•°æ®æ˜¯å¦åˆæ³•</span></span><br><span class="line">        <span class="keyword">if</span> (res.code !== <span class="number">10000</span>) <span class="keyword">return</span> wx.utils.toast(<span class="string">&#x27;è¯·æ£€æŸ¥éªŒè¯ç æ˜¯å¦æ­£ç¡®!&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        app.setToken(res.data.token)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// é‡å®šå‘è‡³ç™»å½•å‰çš„é¡µé¢</span></span><br><span class="line">        wx.redirectTo(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="built_in">this</span>.data.redirectURL,</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>æäº¤ä»£ç ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹å½“å‰è¢«ä¿®æ”¹çš„æ–‡ä»¶</span></span><br><span class="line">git status</span><br><span class="line"><span class="comment"># æš‚å­˜æ–‡ä»¶</span></span><br><span class="line">git add .</span><br><span class="line"><span class="comment"># æäº¤åˆ°æœ¬åœ°</span></span><br><span class="line">git commit -m <span class="string">&#x27;feat(user): å®Œæˆç”¨æˆ·ç™»å½•/æ³¨å†ŒåŠŸèƒ½&#x27;</span></span><br></pre></td></tr></table></figure>

<h4 id="è¯·æ±‚æ‹¦æˆªå™¨"><a href="#è¯·æ±‚æ‹¦æˆªå™¨" class="headerlink" title="è¯·æ±‚æ‹¦æˆªå™¨"></a>è¯·æ±‚æ‹¦æˆªå™¨</h4><p>éœ€è¦ç™»å½•æƒé™çš„æ¥å£å¿…é¡»å°†ç™»å½•çŠ¶æ€ä¿¡æ¯ï¼ˆtokenï¼‰å‘é€ç»™æœåŠ¡ç«¯ï¼Œé€šè¿‡é…ç½®è¯·æ±‚æ‹¦æˆªå™¨å¯ä»¥è¿›è¡Œç»Ÿä¸€å¤„ç†ã€‚</p>
<ol>
<li>åŸºæœ¬ç”¨æ³•ï¼Œ<code>utils/http.js</code>ã€‚</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é…ç½®å“åº”æ‹¦æˆªå™¨</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">http.intercept.request = <span class="function">(<span class="params">params</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// è¿™é‡Œå¿…é¡»è¦æœ‰è¿”å›</span></span><br><span class="line">    <span class="keyword">return</span> params</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>æµ‹è¯•ï¼Œ<code>house_pkg/pages/list</code>ã€‚</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Page(&#123;</span><br><span class="line">    <span class="function"><span class="title">onLoad</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// ç›®å‰è¯¥æ®µä»£ç åªç”¨äºæµ‹è¯•ç™»å½•</span></span><br><span class="line">        wx.http.get(<span class="string">&#x27;/room&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>åœ¨è°ƒç”¨ä¸Šè¿°æ¥å£æ—¶å¹¶æœªæˆè¿”å›æ•°æ®ï¼ŒåŸå› åœ¨äºè™½ç„¶å®Œæˆäº†ç™»å½•çš„åŠŸèƒ½ï¼Œä½†æ˜¯å½“å†æ¬¡è°ƒç”¨æ¥å£æ—¶æœªå°†ç™»å½•çš„çŠ¶æ€å³ token å‘ç»™æœåŠ¡ç«¯ã€‚</p>
<ol start="2">
<li>è®¾ç½®å¤´ä¿¡æ¯ï¼Œ<code>miniprogram/utils/http.js</code>ã€‚</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é…ç½®å“åº”æ‹¦æˆªå™¨</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">http.intercept.request = <span class="function">(<span class="params">params</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// è¯»å–å…¨å±€å®ä¾‹ä¸­çš„ token</span></span><br><span class="line">    <span class="keyword">const</span> &#123;</span><br><span class="line">        token</span><br><span class="line">    &#125; = getApp()</span><br><span class="line">    <span class="comment">// æŒ‡å®šä¸€ä¸ªå…¬å…±çš„å¤´ä¿¡æ¯</span></span><br><span class="line">    <span class="comment">// åˆå§‹ä¸ºç©ºå¯¹è±¡åç»­å¯ä»¥æ‰©å±•</span></span><br><span class="line">    <span class="keyword">const</span> defaultHeader = &#123;&#125;</span><br><span class="line">    <span class="comment">// è¿½åŠ  token å¤´ä¿¡æ¯</span></span><br><span class="line">    <span class="keyword">if</span> (token) defaultHeader.Authorization = token</span><br><span class="line">    <span class="comment">// åˆå¹¶è‡ªå®šä¹‰å¤´ä¿¡æ¯å’Œå…¬å…±å¤´ä¿¡æ¯</span></span><br><span class="line">    params.header = <span class="built_in">Object</span>.assign(defaultHeader, params.header)</span><br><span class="line">    <span class="comment">// å¤„ç†åçš„è¯·æ±‚å‚æ•°</span></span><br><span class="line">    <span class="keyword">return</span> params</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸Šè¿°ä»£ç ä¸­ç»Ÿä¸€å¤„ç†äº† token ä»¥å¤´ä¿¡æ¯çš„æ–¹å¼ä¼ é€’ç»™åæ¥å£ï¼Œå…¶ä¸­ defaultHeader åˆå§‹ä¸ºä¸€ä¸ªç©ºå¯¹è±¡çš„ç›®çš„æ˜¯å°†æ¥å¯ä»¥æ‰©å±•æ›´å¤šçš„å…¬å…±å¤´ä¿¡æ¯ï¼Œå¦å¤–è¦æ³¨æ„è°ƒç”¨ Object.assigin æ—¶å‚æ•°çš„é¡ºåºï¼Œæˆ‘ä»¬å¸Œæœ›çš„æ˜¯ç”¨æˆ·æŒ‡å®šçš„å¤´ä¿¡æ¯èƒ½å¤Ÿè¦†ç›–æ‰é»˜è®¤çš„å¤´ä¿¡æ¯ã€‚</p>
<p>æäº¤ä»£ç ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹å½“å‰è¢«ä¿®æ”¹çš„æ–‡ä»¶</span></span><br><span class="line">git status</span><br><span class="line"><span class="comment"># æš‚å­˜æ–‡ä»¶</span></span><br><span class="line">git add .</span><br><span class="line"><span class="comment"># æäº¤åˆ°æœ¬åœ°</span></span><br><span class="line">git commit -m <span class="string">&#x27;feat(user): è¯·æ±‚æ‹¦æˆªå™¨ç»Ÿä¸€å¤„ç†token&#x27;</span></span><br></pre></td></tr></table></figure>

<h4 id="refresh-token"><a href="#refresh-token" class="headerlink" title="refresh_token"></a>refresh_token</h4><p>ä»å®‰å…¨è§’åº¦æ¥çœ‹ token å¿…é¡»è¦å…·æœ‰ä¸€å®šçš„æ—¶æ•ˆæ€§ï¼Œäº«+ç¤¾åŒºçº¦å®šäº† token çš„æ—¶æ•ˆä¸º 8 ä¸ªå°æ—¶ï¼Œå¤±æ•ˆåçš„ token ä¸å†èƒ½æ ‡è¯†ç”¨æ˜¯ç™»å½•çŠ¶æ€ã€‚</p>
<p>å¦å¤–ä¹Ÿè¦è€ƒè™‘ç”¨æˆ·çš„ä½“éªŒï¼Œä¾‹å¦‚ç”¨æˆ·åœ¨ token å¤±æ•ˆçš„å‰ 1 åˆ†é’Ÿæ‰“å¼€å°ç¨‹åºï¼Œç”¨æˆ·æµè§ˆå°ç¨‹åº 1 åˆ†é’Ÿå token å¤±æ•ˆï¼Œç”¨æˆ·ä¸å¾—ä¸å†æ¬¡å»ç™»å½•ï¼Œè¿™æ ·çš„ç”¨æˆ·ä½“éªŒæ˜¯æå·®çš„ã€‚</p>
<p>ä¸ºäº†æ—¢èƒ½ä¿è¯å®‰å…¨æ€§åˆå…¼é¡¾ç”¨æˆ·ä½“éªŒï¼Œå’±ä»¬éœ€è¦èƒ½å¤Ÿè‡ªåŠ¨å»¶é•¿ token æ—¶æ•ˆçš„æ–¹æ³•ï¼Œå³ refresh_tokenï¼Œå®ƒçš„ä½œå·¥ä½œåˆ¶æ˜¯è¿™æ ·çš„ã€‚</p>
<ul>
<li><p>ç”¨æˆ·åœ¨é¦–æ¬¡å®Œæˆç™»å½•æ—¶ä¼šåˆ†åˆ«å¾—åˆ° token å’Œ refresh_tokenã€‚</p>
</li>
<li><p>å½“ token å¤±æ•ˆåï¼Œè°ƒç”¨æ¥å£ä¼šè¿”å› 401 çŠ¶æ€ç ï¼ˆè¿™æ˜¯ä¸åç«¯çº¦å®šå¥½çš„è§„åˆ™ï¼‰ã€‚</p>
</li>
<li><p>æ£€æµ‹çŠ¶æ€ç æ˜¯å¦ä¸º 401ï¼Œå¦‚æœæ˜¯åˆ™è°ƒç”¨å»¶é•¿ token æ—¶æ•ˆçš„æ¥å£å¹¶ä¼ é€’ refresh_tokenã€‚</p>
</li>
<li><p>è°ƒç”¨å»¶é•¿ token æ—¶æ•ˆçš„æ¥å£åä¼šè¿”å›æ–°çš„ token å’Œ refresh_tokenã€‚</p>
</li>
</ul>
<ol>
<li>å­˜å‚¨ refresh_tokenï¼Œ<code>app.js</code>ã€‚</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">App(&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="function"><span class="title">onLaunch</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// è¯»å– token å’Œ refresh_token</span></span><br><span class="line">        <span class="built_in">this</span>.getToken(<span class="string">&#x27;token&#x27;</span>)</span><br><span class="line">        <span class="built_in">this</span>.getToken(<span class="string">&#x27;refresh_token&#x27;</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// è¯»å–token</span></span><br><span class="line">    <span class="function"><span class="title">getToken</span>(<span class="params">key</span>)</span> &#123;</span><br><span class="line">        <span class="comment">// å¼‚æ­¥æ–¹å¼ä¸ä¼šé˜»å¡</span></span><br><span class="line">        wx.getStorage(&#123;</span><br><span class="line">            key,</span><br><span class="line">            <span class="attr">success</span>: <span class="function">(<span class="params">&#123;</span></span></span><br><span class="line"><span class="params"><span class="function">                data</span></span></span><br><span class="line"><span class="params"><span class="function">            &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="comment">// this æŒ‡å‘åº”ç”¨å®ä¾‹</span></span><br><span class="line">                <span class="built_in">this</span>[key] = data</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="function"><span class="title">fail</span>(<span class="params"></span>)</span> &#123;&#125;,</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="title">setToken</span>(<span class="params">token, refresh_token</span>)</span> &#123;</span><br><span class="line">        <span class="comment">// æ‹¼å‡‘åˆæ³•tokenæ ¼å¼</span></span><br><span class="line">        token = <span class="string">&#x27;Bearer &#x27;</span> + token</span><br><span class="line">        refresh_token = <span class="string">&#x27;Bearer &#x27;</span> + refresh_token</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æœ¬åœ°å­˜å‚¨ token å’Œ refresh_token</span></span><br><span class="line">        wx.setStorageSync(<span class="string">&#x27;token&#x27;</span>, token)</span><br><span class="line">        wx.setStorageSync(<span class="string">&#x27;refresh_token&#x27;</span>, refresh_token)</span><br><span class="line">        <span class="comment">// æ›´æ–°å…¨å±€ token å’Œ refresh_token</span></span><br><span class="line">        <span class="built_in">this</span>.token = token</span><br><span class="line">        <span class="built_in">this</span>.refresh_token = refresh_token</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>è°ƒç”¨ setToken å¹¶ä¼ å…¥ refresh_tokenï¼Œ<code>pages/login/index.js</code>ã€‚</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">Page(&#123;</span><br><span class="line">    <span class="comment">// ä¹‹å‰ä»£ç çœç•¥...</span></span><br><span class="line">    <span class="comment">// æäº¤æ•°æ®å®Œæˆç™»å½•</span></span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="title">submitForm</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// é€ä¸ªéªŒè¯è¡¨å•æ•°æ®</span></span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">this</span>.verifyMobile()) <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">this</span>.verifyCode()) <span class="keyword">return</span></span><br><span class="line">        <span class="comment">// ç”¨æˆ·å¡«å†™çš„æ‰‹æœºå·å’ŒéªŒè¯ç </span></span><br><span class="line">        <span class="keyword">const</span> &#123;</span><br><span class="line">            mobile,</span><br><span class="line">            code</span><br><span class="line">        &#125; = <span class="built_in">this</span>.data</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è°ƒç”¨æ¥å£ç™»å½•/æ³¨å†Œ</span></span><br><span class="line">        <span class="keyword">const</span> res = <span class="keyword">await</span> wx.http.post(<span class="string">&#x27;/login&#x27;</span>, &#123;</span><br><span class="line">            mobile,</span><br><span class="line">            code</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="comment">// æ ¡éªŒæ•°æ®æ˜¯å¦åˆæ³•</span></span><br><span class="line">        <span class="keyword">if</span> (res.code !== <span class="number">10000</span>) <span class="keyword">return</span> wx.utils.toast(<span class="string">&#x27;è¯·æ£€æŸ¥éªŒè¯ç æ˜¯å¦æ­£ç¡®!&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å­˜å‚¨è®°å½•token</span></span><br><span class="line">        app.setToken(res.data.token, res.data.refreshToken)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// é‡å®šå‘è‡³ç™»å½•å‰çš„é¡µé¢</span></span><br><span class="line">        wx.redirectTo(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="built_in">this</span>.data.redirectURL,</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>è°ƒç”¨åˆ·æ–° token çš„æ¥å£ã€‚</li>
</ol>
<p>äº«+ç¤¾åŒº token çš„æ—¶æ•ˆæœ‰ 8 ä¸ªå°æ—¶ï¼Œåœ¨å¼€å‘è°ƒè¯•é˜¶æ®µå¯ä»¥æ•…æ„ä¿®æ”¹ token çš„å†…å®¹æ¥ä¸»åŠ¨è®© token å¤±æ•ˆã€‚</p>
<ul>
<li><p>æ¥å£è·¯å¾„ï¼š<code>/refreshToken</code>ã€‚</p>
</li>
<li><p>è¯·æ±‚æ–¹æ³•: POSTã€‚</p>
</li>
<li><p>è¯·æ±‚å‚æ•°ï¼šæ— ã€‚</p>
</li>
<li><p>Headersï¼š</p>
<ul>
<li>Authorizationã€‚</li>
</ul>
</li>
<li><p>å“åº”æ•°æ®ï¼š<a target="_blank" rel="noopener" href="https://www.apifox.cn/apidoc/shared-8d66c345-7a9a-4844-9a5a-1201852f6faa/api-44946311">è§æ–‡æ¡£</a>ã€‚</p>
</li>
</ul>
<p> <code>utils/http.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ...</span></span><br><span class="line">http.intercept.response = <span class="keyword">async</span> (&#123;</span><br><span class="line">    statusCode,</span><br><span class="line">    data</span><br><span class="line">&#125;) =&gt; &#123;</span><br><span class="line">    <span class="comment">// statusCode ä¸ºçŠ¶æ€ç </span></span><br><span class="line">    <span class="keyword">if</span> (statusCode === <span class="number">401</span>) &#123;</span><br><span class="line">        <span class="comment">// è·å–å…¨å±€åº”ç”¨å®ä¾‹</span></span><br><span class="line">        <span class="keyword">const</span> app = getApp()</span><br><span class="line">        <span class="comment">// ä½¿ç”¨ refreshToken æ›´æ–° token</span></span><br><span class="line">        <span class="keyword">const</span> res = <span class="keyword">await</span> http(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">&#x27;/refreshToken&#x27;</span>,</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">            <span class="attr">header</span>: &#123;</span><br><span class="line">                <span class="comment">// è¿™æ—¶è¦æ³¨æ„ä½¿ç”¨çš„æ˜¯ refresh_token</span></span><br><span class="line">                <span class="attr">Authorization</span>: app.refresh_token,</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="comment">// æ›´æ–° token å’Œ refresh_token</span></span><br><span class="line">        app.setToken(res.data.token, res.data.refreshToken)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿‡æ»¤æ¥å£è¿”å›çš„æ•°æ®</span></span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure>

<p>åœ¨è°ƒç”¨åˆ·æ–° token æ¥å£æ—¶è¦æ³¨æ„å¤´ä¿¡æ¯ header. Authorization ä½¿ç”¨çš„æ˜¯ refresh_tokenã€‚</p>
<ol start="4">
<li>refresh_token ä¹Ÿè¿‡æœŸäº†æ€ä¹ˆåŠï¼Ÿ</li>
</ol>
<p>ç”¨æˆ·é•¿æœŸæœªä½¿ç”¨å°ç¨‹åºçš„æƒ…å†µä¸‹ refresh_token ä¹Ÿä¼šå¤±æ•ˆï¼Œäº«+ç¤¾åŒºè®¾ç½®çš„æ—¶é—´ä¸º 3å¤©ï¼Œå¦‚æœ refresh_token ä¹Ÿå¤±æ•ˆçš„æƒ…å†µä¸‹éœ€è¦é‡å®šå‘åˆ°ç™»å½•é¡µé¢ã€‚</p>
<p>å†æ¬¡æ‰‹åŠ¨ä¿®æ”¹ refresh_token è®©å®ƒå¤„äºå¤±æ•ˆçŠ¶æ€ï¼Œç„¶åè°ƒç”¨æ¥å£åä¼šå‡ºç°åˆ—å¾ªç¯çš„æƒ…å†µï¼ˆæ¥å£ä¸æ–­çš„è¯·æ±‚ï¼‰ï¼Œè¦è§£å†³è¿™ä¸ªé—®é¢˜éœ€è¦åˆ¤æ–­å½“å‰æ˜¯å¦è°ƒç”¨çš„æ˜¯ /refreshToken æ¥å£ï¼Œå¦‚æœæ˜¯ä¸”çŠ¶æ€ç è¿”å›çš„æ˜¯ 401 åˆ™é‡å®šé¡µåˆ°ç™»å½•é¡µé¢ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">http.intercept.response = <span class="keyword">async</span> (&#123;</span><br><span class="line">    statusCode,</span><br><span class="line">    data,</span><br><span class="line">    config</span><br><span class="line">&#125;) =&gt; &#123;</span><br><span class="line">    <span class="comment">// statusCode ä¸ºçŠ¶æ€ç </span></span><br><span class="line">    <span class="keyword">if</span> (statusCode === <span class="number">401</span>) &#123;</span><br><span class="line">        <span class="comment">// config æ˜¯è°ƒç”¨æ¥å£çš„å‚æ•°</span></span><br><span class="line">        <span class="comment">// refreshToken è¿‡æœŸçš„æƒ…å½¢</span></span><br><span class="line">        <span class="keyword">if</span> (config.url.includes(<span class="string">&#x27;/refreshToken&#x27;</span>)) &#123;</span><br><span class="line">            <span class="comment">// è¯»å–å½“å‰å†å²æ ˆ</span></span><br><span class="line">            <span class="keyword">const</span> pageStack = getCurrentPages()</span><br><span class="line">            <span class="comment">// å–å‡ºå½“å‰é¡µé¢è·¯å¾„ï¼Œç™»å½•æˆåŠŸèƒ½è·³è½¬åˆ°è¯¥é¡µé¢</span></span><br><span class="line">            <span class="keyword">const</span> lastPage = pageStack[pageStack.length - <span class="number">1</span>]</span><br><span class="line">            <span class="comment">// å–å‡ºå½“å‰é¡µé¢è·¯å¾„ï¼Œç™»å½•æˆåŠŸèƒ½è·³è½¬åˆ°è¯¥é¡µé¢</span></span><br><span class="line">            <span class="keyword">const</span> redirectURL = lastPage.route</span><br><span class="line"></span><br><span class="line">            <span class="comment">// å¼•å¯¼ç”¨æˆ·åˆ°ç™»å½•é¡µé¢</span></span><br><span class="line">            <span class="keyword">return</span> wx.redirectTo(&#123;</span><br><span class="line">                <span class="attr">url</span>: <span class="string">`/pages/login/index?redirectURL=/<span class="subst">$&#123;redirectURL&#125;</span>`</span>,</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è·å–å…¨å±€åº”ç”¨å®ä¾‹</span></span><br><span class="line">        <span class="keyword">const</span> app = getApp()</span><br><span class="line">        <span class="comment">// ä½¿ç”¨ refreshToken æ›´æ–° token</span></span><br><span class="line">        <span class="keyword">const</span> res = <span class="keyword">await</span> http(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">&#x27;/refreshToken&#x27;</span>,</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">            <span class="attr">header</span>: &#123;</span><br><span class="line">                <span class="comment">// è¿™æ—¶è¦æ³¨æ„ä½¿ç”¨çš„æ˜¯ refresh_token</span></span><br><span class="line">                <span class="attr">Authorization</span>: app.refresh_token,</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ›´æ–° token å’Œ refresh_token</span></span><br><span class="line">        app.setToken(res.data.token, res.data.refreshToken)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿‡æ»¤æ¥å£è¿”å›çš„æ•°æ®</span></span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>å½“æ¸…ç©º token å’Œ refresh_token åï¼Œè·³è½¬åˆ°ç™»å½•é¡µåæ§åˆ¶åˆ°æœ‰ä¸ª 401 çš„æŠ¥é”™ï¼Œå¯ä»¥å±è”½å—ï¼Ÿ<code>miniprogram/components/authorization/index.js</code>ã€‚</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// components/authorization/index.js</span></span><br><span class="line">Component(&#123;</span><br><span class="line">    <span class="attr">data</span>: &#123;</span><br><span class="line">        <span class="attr">isLogin</span>: <span class="literal">false</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// ç”Ÿå‘½å‘¨æœŸå‡½æ•°</span></span><br><span class="line">    <span class="attr">lifetimes</span>: &#123;</span><br><span class="line">        <span class="function"><span class="title">attached</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">            <span class="comment">// ç™»å½•çŠ¶æ€</span></span><br><span class="line">            <span class="keyword">const</span> isLogin = !!getApp().token</span><br><span class="line">            <span class="comment">// è®°å½•ç™»å½•çŠ¶æ€</span></span><br><span class="line">            <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">                isLogin</span><br><span class="line">            &#125;)</span><br><span class="line">            <span class="comment">// æœªç™»å½•é‡å®šå‘åˆ°ç™»å½•é¡µ</span></span><br><span class="line">            <span class="keyword">if</span> (!isLogin) &#123;</span><br><span class="line">                <span class="comment">// è¯»å–å½“å‰å†å²æ ˆ</span></span><br><span class="line">                <span class="keyword">const</span> pageStack = getCurrentPages()</span><br><span class="line">                <span class="comment">// å–å‡ºå½“å‰é¡µé¢è·¯å¾„ï¼Œç™»å½•æˆåŠŸèƒ½è·³è½¬åˆ°è¯¥é¡µé¢</span></span><br><span class="line">                <span class="keyword">const</span> currentPage = pageStack[pageStack.length - <span class="number">1</span>]</span><br><span class="line">                <span class="comment">// å¦‚æœæœªç™»å½•å°†å†…éƒ¨çš„é€»è¾‘ç½®ç©ºï¼Œè¿™æ ·çš„è¯ network å°±ä¸ä¼šçœ‹åˆ°é‚£ä¸ª 401 æŠ¥é”™å•¦</span></span><br><span class="line">                currentPage.onLoad = <span class="function">() =&gt;</span> &#123;&#125;</span><br><span class="line">                currentPage.onShow = <span class="function">() =&gt;</span> &#123;&#125;</span><br><span class="line">                <span class="keyword">const</span> redirectURL = currentPage.route</span><br><span class="line">                <span class="comment">// å¼•å¯¼ç”¨æˆ·åˆ°ç™»å½•é¡µé¢</span></span><br><span class="line">                wx.redirectTo(&#123;</span><br><span class="line">                    <span class="attr">url</span>: <span class="string">`/pages/login/index?redirectURL=/<span class="subst">$&#123;redirectURL&#125;</span>`</span>,</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>æ— æ„Ÿè¯·æ±‚ã€‚</li>
</ol>
<p>ç”¨æˆ·åœ¨è¯·æ±‚æŸä¸ªæ¥å£æ—¶æ£€æµ‹ token å¤±æ•ˆï¼Œå’±ä»¬å»åˆ·æ–°äº† token å½“åˆ·æ–°æˆåŠŸååº”è¯¥è¦ç»§ç»­å»è¯·æ±‚åŸæ¥çš„æ¥å£ï¼Œç»™ç”¨æˆ·çš„æ„ŸçŸ¥æ˜¯ä¸€ç›´å¤„äºç™»å½•çŠ¶æ€çš„ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é…ç½®å“åº”æ‹¦æˆªå™¨</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">http.intercept.response = <span class="keyword">async</span> (&#123;</span><br><span class="line">    data,</span><br><span class="line">    statusCode,</span><br><span class="line">    config</span><br><span class="line">&#125;) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (statusCode === <span class="number">401</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> app = getApp()</span><br><span class="line">        <span class="keyword">if</span> (config.url.includes(<span class="string">&#x27;/refreshToken&#x27;</span>)) &#123;</span><br><span class="line">            <span class="comment">// app.clearTokenAndRefreshToken()</span></span><br><span class="line">            <span class="comment">// è¯»å–å½“å‰å†å²æ ˆ</span></span><br><span class="line">            <span class="keyword">const</span> pageStack = getCurrentPages()</span><br><span class="line">            <span class="comment">// å–å‡ºå½“å‰é¡µé¢è·¯å¾„ï¼Œç™»å½•æˆåŠŸèƒ½è·³è½¬åˆ°è¯¥é¡µé¢</span></span><br><span class="line">            <span class="keyword">const</span> lastPage = pageStack[pageStack.length - <span class="number">1</span>]</span><br><span class="line">            <span class="comment">// å–å‡ºå½“å‰é¡µé¢è·¯å¾„ï¼Œç™»å½•æˆåŠŸèƒ½è·³è½¬åˆ°è¯¥é¡µé¢</span></span><br><span class="line">            <span class="keyword">const</span> redirectURL = lastPage.route</span><br><span class="line">            <span class="comment">// å¼•å¯¼ç”¨æˆ·åˆ°ç™»å½•é¡µé¢</span></span><br><span class="line">            <span class="keyword">return</span> wx.redirectTo(&#123;</span><br><span class="line">                <span class="attr">url</span>: <span class="string">`/pages/login/index?redirectURL=/<span class="subst">$&#123;redirectURL&#125;</span>`</span>,</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> res = <span class="keyword">await</span> http(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">&#x27;/refreshToken&#x27;</span>,</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">            <span class="attr">header</span>: &#123;</span><br><span class="line">                <span class="attr">Authorization</span>: app.refresh_token</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        app.setToken(res.data.token, res.data.refreshToken)</span><br><span class="line">        <span class="comment">// é‡æ–°å‘èµ·è¯·æ±‚</span></span><br><span class="line">        <span class="keyword">return</span> http(</span><br><span class="line">            <span class="built_in">Object</span>.assign(config, &#123;</span><br><span class="line">                <span class="comment">// ä¼ é€’æ–°çš„ token</span></span><br><span class="line">                <span class="attr">header</span>: &#123;</span><br><span class="line">                    <span class="attr">Authorization</span>: app.token,</span><br><span class="line">                &#125;,</span><br><span class="line">            &#125;)</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// è¿‡æ»¤æ¥å£è¿”å›çš„æ•°æ®</span></span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸Šè¿°ä»£ç ä¸­ config æ˜¯ç”¨æˆ·åŸæœ¬è¦è¯·æ±‚æ¥å£çš„å‚æ•°ï¼Œæ ¹æ®è¿™äº›å‚æ•°å‘èµ·è¯·æ±‚å¹¶ä¼ å…¥åˆ·æ–°åçš„ tokenã€‚</p>
<p>æäº¤ä»£ç ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹å½“å‰è¢«ä¿®æ”¹çš„æ–‡ä»¶</span></span><br><span class="line">git status</span><br><span class="line"><span class="comment"># æš‚å­˜æ–‡ä»¶</span></span><br><span class="line">git add .</span><br><span class="line"><span class="comment"># æäº¤åˆ°æœ¬åœ°</span></span><br><span class="line">git commit -m <span class="string">&#x27;feat(user): å®Œæˆrefresh_tokençš„åŠŸèƒ½&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="ä¸ªäººèµ„æ–™"><a href="#ä¸ªäººèµ„æ–™" class="headerlink" title="ä¸ªäººèµ„æ–™"></a>ä¸ªäººèµ„æ–™</h3><p>äº«+ç¤¾åŒºçš„ä¸ªäººèµ„æ–™åŒ…æ‹¬ç”¨æˆ·æ˜µç§°å’Œå¤´åƒä¸¤ä¸ªéƒ¨åˆ†ï¼Œå…³äºæ˜µç§°å’Œå¤´åƒçš„è·å–åœ¨å‰é¢åŸºç¡€çŸ¥è¯†éƒ¨åˆ†å·²ç»ä»‹ç»è¿‡äº†ï¼Œå’±ä»¬æŠŠè¿™éƒ¨åˆ†çŸ¥è¯†åº”ç”¨åˆ°å®é™…çš„é¡¹ç›®å½“ä¸­ã€‚</p>
<h4 id="ç”¨æˆ·æ˜µç§°"><a href="#ç”¨æˆ·æ˜µç§°" class="headerlink" title="ç”¨æˆ·æ˜µç§°"></a>ç”¨æˆ·æ˜µç§°</h4><img src="/resource/images/Snipaste_2023-03-04_09-07-41.png"/>

<ol>
<li>ä¸ªäººèµ„æ–™é¡µé¢å¿…é¡»åœ¨ç”¨æˆ·ç™»å½•çš„æƒ…å†µæ‰å…è®¸è¢«è®¿é—®ï¼Œéœ€è¦ä½¿ç”¨å‰é¢å°è£…å¥½çš„ Authorization ç»„ä»¶å°†æ•´ä¸ªé¡µé¢åŒ…èµ·æ¥ï¼Œ<code>pages/profile/index.wxml</code>ã€‚</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">authorization</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;profile&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">center</span> <span class="attr">title</span>=<span class="string">&quot;å¤´åƒ&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">van-icon</span> <span class="attr">slot</span>=<span class="string">&quot;right-icon&quot;</span> <span class="attr">name</span>=<span class="string">&quot;arrow&quot;</span> <span class="attr">size</span>=<span class="string">&quot;16&quot;</span> <span class="attr">color</span>=<span class="string">&quot;#c3c3c5&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;button&quot;</span> <span class="attr">size</span>=<span class="string">&quot;mini&quot;</span> <span class="attr">hover-class</span>=<span class="string">&quot;none&quot;</span> <span class="attr">open-type</span>=<span class="string">&quot;chooseAvatar&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">image</span> <span class="attr">src</span>=<span class="string">&quot;/static/images/avatar_1.jpg&quot;</span> <span class="attr">class</span>=<span class="string">&quot;avatar&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">van-cell</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">van-field</span> <span class="attr">type</span>=<span class="string">&quot;nickname&quot;</span> <span class="attr">center</span> <span class="attr">label</span>=<span class="string">&quot;æ˜µç§°&quot;</span> <span class="attr">input-align</span>=<span class="string">&quot;right&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;è¯·è¾“å…¥æ˜µç§°&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">authorization</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>ç›‘å¬è¡¨å• van-field input æ¡†çš„ blur äº‹ä»¶ï¼Œè·å–è¾“å…¥çš„æ˜µç§°ã€‚</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;profile&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">center</span> <span class="attr">title</span>=<span class="string">&quot;å¤´åƒ&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">van-icon</span> <span class="attr">slot</span>=<span class="string">&quot;right-icon&quot;</span> <span class="attr">name</span>=<span class="string">&quot;arrow&quot;</span> <span class="attr">size</span>=<span class="string">&quot;16&quot;</span> <span class="attr">color</span>=<span class="string">&quot;#c3c3c5&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;button&quot;</span> <span class="attr">size</span>=<span class="string">&quot;mini&quot;</span> <span class="attr">hover-class</span>=<span class="string">&quot;none&quot;</span> <span class="attr">open-type</span>=<span class="string">&quot;chooseAvatar&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">image</span> <span class="attr">src</span>=<span class="string">&quot;/static/images/avatar_1.jpg&quot;</span> <span class="attr">class</span>=<span class="string">&quot;avatar&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">van-cell</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-field</span> <span class="attr">bind:blur</span>=<span class="string">&quot;getUserNickName&quot;</span> <span class="attr">type</span>=<span class="string">&quot;nickname&quot;</span> <span class="attr">center</span> <span class="attr">label</span>=<span class="string">&quot;æ˜µç§°&quot;</span> <span class="attr">input-align</span>=<span class="string">&quot;right&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;è¯·è¾“å…¥æ˜µç§°&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ğŸ¤” æç¤ºï¼šåœ¨å¼€å‘è€…å·¥å…·ä¸­ï¼Œç›‘å¬è¡¨å•çš„ blur äº‹ä»¶è·å–ç”¨æˆ·æ˜µç§°æ—¶ä¼šæœ‰ä¸ç¨³å®šçš„ç°è±¡ï¼ˆä¸èƒ½ç«‹å³è·å–è¡¨å•ä¸­çš„å€¼ï¼‰ï¼Œå‘å¸ƒåˆ°çœŸæœºæ—¶é—®é¢˜ä¼šè‡ªåŠ¨ä¿®å¤ã€‚</p>
<ol start="3">
<li>åœ¨äº‹ä»¶å›è°ƒä¸­è·å–ç”¨æˆ·çš„æ˜µç§°ã€‚</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Page(&#123;</span><br><span class="line">    <span class="function"><span class="title">getUserNickName</span>(<span class="params">ev</span>)</span> &#123;</span><br><span class="line">        <span class="comment">// è·å–ç”¨æˆ·çš„æ˜µç§°å†…å®¹</span></span><br><span class="line">        <span class="built_in">console</span>.log(ev.detail.value)</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>è°ƒç”¨æ¥å£ã€‚</li>
</ol>
<ul>
<li><p>æ¥å£è·¯å¾„ï¼š<code>/userInfo</code>ã€‚</p>
</li>
<li><p>è¯·æ±‚æ–¹æ³•: PUTã€‚</p>
</li>
<li><p>è¯·æ±‚å‚æ•°ï¼š</p>
<ul>
<li>nickName ç”¨æˆ·æ˜µç§°ã€‚</li>
</ul>
</li>
<li><p>Headersï¼š</p>
<ul>
<li>Authorizationã€‚</li>
</ul>
</li>
<li><p>å“åº”æ•°æ®ï¼š<a target="_blank" rel="noopener" href="https://www.apifox.cn/apidoc/shared-8d66c345-7a9a-4844-9a5a-1201852f6faa/api-42037730">è§æ–‡æ¡£</a>ã€‚</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">Page(&#123;</span><br><span class="line">    <span class="function"><span class="title">getUserNickName</span>(<span class="params">ev</span>)</span> &#123;</span><br><span class="line">        <span class="comment">// console.log(ev.detail.value)</span></span><br><span class="line">        <span class="comment">// æ›´æ–°ç”¨æˆ·æ˜µç§°</span></span><br><span class="line">        <span class="built_in">this</span>.updateNickName(ev.detail.value)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="title">updateNickName</span>(<span class="params">nickName</span>)</span> &#123;</span><br><span class="line">        <span class="comment">// è¯·æ±‚æ•°æ®æ¥å£</span></span><br><span class="line">        <span class="keyword">const</span> &#123;</span><br><span class="line">            code</span><br><span class="line">        &#125; = <span class="keyword">await</span> wx.http.put(<span class="string">&#x27;/userInfo&#x27;</span>, &#123;</span><br><span class="line">            nickName</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="comment">// æ£€æµ‹æ¥å£è°ƒç”¨çš„ç»“æœ</span></span><br><span class="line">        <span class="keyword">if</span> (code !== <span class="number">10000</span>) <span class="keyword">return</span> wx.utils.toast(<span class="string">&#x27;æ›´æ–°ç”¨æˆ·ä¿¡æ¯å¤±è´¥!&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä¿å­˜ç”¨æˆ·æ˜µç§°</span></span><br><span class="line">        <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">            <span class="string">&#x27;userInfo.nickName&#x27;</span>: nickName</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>å½“ç”¨æˆ·æœªè®¾ç½®æ˜µç§°æ—¶ç»™ç”¨æˆ·æŒ‡å®šä¸€ä¸ªé»˜è®¤çš„åç§°ã€‚</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;profile&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">center</span> <span class="attr">title</span>=<span class="string">&quot;å¤´åƒ&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">van-icon</span> <span class="attr">slot</span>=<span class="string">&quot;right-icon&quot;</span> <span class="attr">name</span>=<span class="string">&quot;arrow&quot;</span> <span class="attr">size</span>=<span class="string">&quot;16&quot;</span> <span class="attr">color</span>=<span class="string">&quot;#c3c3c5&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;button&quot;</span> <span class="attr">size</span>=<span class="string">&quot;mini&quot;</span> <span class="attr">hover-class</span>=<span class="string">&quot;none&quot;</span> <span class="attr">open-type</span>=<span class="string">&quot;chooseAvatar&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">image</span> <span class="attr">src</span>=<span class="string">&quot;/static/images/avatar_1.jpg&quot;</span> <span class="attr">class</span>=<span class="string">&quot;avatar&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">van-cell</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-field</span> <span class="attr">bind:blur</span>=<span class="string">&quot;getUserNickName&quot;</span> <span class="attr">type</span>=<span class="string">&quot;nickname&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&#123;&#123;userInfo.nickName || &#x27;å¾®ä¿¡ç”¨æˆ·&#x27;&#125;&#125;&quot;</span> <span class="attr">center</span> <span class="attr">label</span>=<span class="string">&quot;æ˜µç§°&quot;</span> <span class="attr">input-align</span>=<span class="string">&quot;right&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;è¯·è¾“å…¥æ˜µç§°&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="ç”¨æˆ·å¤´åƒ"><a href="#ç”¨æˆ·å¤´åƒ" class="headerlink" title="ç”¨æˆ·å¤´åƒ"></a>ç”¨æˆ·å¤´åƒ</h4><ol>
<li>ç›‘å¬ button çš„ chooseavatar äº‹ä»¶ï¼Œè·å–å¤´åƒåœ°å€ã€‚</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;profile&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">center</span> <span class="attr">title</span>=<span class="string">&quot;å¤´åƒ&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">van-icon</span> <span class="attr">slot</span>=<span class="string">&quot;right-icon&quot;</span> <span class="attr">name</span>=<span class="string">&quot;arrow&quot;</span> <span class="attr">size</span>=<span class="string">&quot;16&quot;</span> <span class="attr">color</span>=<span class="string">&quot;#c3c3c5&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">open-type</span>=<span class="string">&quot;chooseAvatar&quot;</span> <span class="attr">bind:chooseavatar</span>=<span class="string">&quot;getUserAvatar&quot;</span> <span class="attr">class</span>=<span class="string">&quot;button&quot;</span> <span class="attr">size</span>=<span class="string">&quot;mini&quot;</span> <span class="attr">hover-class</span>=<span class="string">&quot;none&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">image</span> <span class="attr">src</span>=<span class="string">&quot;/static/images/avatar_1.jpg&quot;</span> <span class="attr">class</span>=<span class="string">&quot;avatar&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">van-cell</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-field</span> <span class="attr">bind:blur</span>=<span class="string">&quot;getUserNickName&quot;</span> <span class="attr">type</span>=<span class="string">&quot;nickname&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&#123;&#123;userInfo.nickName || &#x27;å¾®ä¿¡ç”¨æˆ·&#x27;&#125;&#125;&quot;</span> <span class="attr">center</span> <span class="attr">label</span>=<span class="string">&quot;æ˜µç§°&quot;</span> <span class="attr">input-align</span>=<span class="string">&quot;right&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;è¯·è¾“å…¥æ˜µç§°&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>åœ¨äº‹ä»¶å›è°ƒå‡½æ•° getUserAvatar ä¸­è·å–ç”¨æˆ·å¤´åƒåœ°å€ã€‚</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">Page(&#123;</span><br><span class="line">    <span class="function"><span class="title">getUserNickName</span>(<span class="params">ev</span>)</span> &#123;</span><br><span class="line">        <span class="comment">// console.log(ev.detail.value)</span></span><br><span class="line">        <span class="comment">// æ›´æ–°ç”¨æˆ·æ˜µç§°</span></span><br><span class="line">        <span class="built_in">this</span>.updateNickName(ev.detail.value)</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="title">updateNickName</span>(<span class="params">nickName</span>)</span> &#123;</span><br><span class="line">        <span class="comment">// è¯·æ±‚æ•°æ®æ¥å£</span></span><br><span class="line">        <span class="keyword">const</span> &#123;</span><br><span class="line">            code</span><br><span class="line">        &#125; = <span class="keyword">await</span> wx.http.put(<span class="string">&#x27;/userInfo&#x27;</span>, &#123;</span><br><span class="line">            nickName</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="comment">// æ£€æµ‹æ¥å£è°ƒç”¨çš„ç»“æœ</span></span><br><span class="line">        <span class="keyword">if</span> (code !== <span class="number">10000</span>) <span class="keyword">return</span> wx.utils.toast(<span class="string">&#x27;æ›´æ–°ç”¨æˆ·ä¿¡æ¯å¤±è´¥!&#x27;</span>)</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="title">getUserAvatar</span>(<span class="params">ev</span>)</span> &#123;</span><br><span class="line">        <span class="comment">// ç”¨æˆ·å¤´åƒåœ°å€</span></span><br><span class="line">        <span class="built_in">console</span>.log(ev.detail.avatarUrl)</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>è°ƒç”¨æ¥å£ã€‚</li>
</ol>
<ul>
<li><p>æ¥å£è·¯å¾„ï¼š<code>/upload</code>ã€‚</p>
</li>
<li><p>è¯·æ±‚æ–¹æ³•: POSTã€‚</p>
</li>
<li><p>è¯·æ±‚å‚æ•°ï¼š</p>
<ul>
<li><p>file åç«¯æ¥æ”¶ä¸Šä¼ æ–‡ä»¶çš„åç§°ã€‚</p>
</li>
<li><p>type ä¸Šä¼ å¤´åƒæ˜¯ä¼  avatarã€‚</p>
</li>
</ul>
</li>
<li><p>Headersï¼š</p>
<ul>
<li>Authorizationã€‚</li>
</ul>
</li>
<li><p>å“åº”æ•°æ®ï¼š<a target="_blank" rel="noopener" href="https://www.apifox.cn/apidoc/shared-8d66c345-7a9a-4844-9a5a-1201852f6faa/api-42672275">è§æ–‡æ¡£</a>ã€‚</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">Page(&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="function"><span class="title">getUserAvatar</span>(<span class="params">ev</span>)</span> &#123;</span><br><span class="line">        <span class="comment">// ç”¨æˆ·å¤´åƒåœ°å€</span></span><br><span class="line">        <span class="comment">// console.log(ev.detail.avatarUrl)</span></span><br><span class="line">        <span class="built_in">this</span>.updateUserAvatar(ev.detail.avatarUrl)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="title">updateUserAvatar</span>(<span class="params">avatarUrl</span>)</span> &#123;</span><br><span class="line">        <span class="comment">// è°ƒç”¨æ¥å£ä¸Šä¼ å›¾ç‰‡</span></span><br><span class="line">        wx.uploadFile(&#123;</span><br><span class="line">            <span class="attr">url</span>: wx.http.baseURL + <span class="string">&#x27;/upload&#x27;</span>,</span><br><span class="line">            <span class="attr">filePath</span>: avatarUrl,</span><br><span class="line">            <span class="attr">name</span>: <span class="string">&#x27;file&#x27;</span>,</span><br><span class="line">            <span class="attr">header</span>: &#123;</span><br><span class="line">                <span class="attr">Authorization</span>: getApp().token,</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">// wx.uploadFile è§„å®šé™¤äº†æ–‡ä»¶ä¿¡æ¯ï¼Œå…¶ä»–å‚æ•°åœ¨ formData é‡Œé¢ä¼ é€’</span></span><br><span class="line">            <span class="attr">formData</span>: &#123;</span><br><span class="line">                <span class="attr">type</span>: <span class="string">&#x27;avatar&#x27;</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">success</span>: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="comment">// è½¬æ¢ json æ•°æ®</span></span><br><span class="line">                <span class="keyword">const</span> data = <span class="built_in">JSON</span>.parse(res.data)</span><br><span class="line">                <span class="comment">// æ£€æµ‹æ¥å£è°ƒç”¨ç»“æœ</span></span><br><span class="line">                <span class="keyword">if</span> (data.code !== <span class="number">10000</span>) <span class="keyword">return</span> wx.utils.toast(<span class="string">&#x27;æ›´æ–°å¤´åƒå¤±è´¥!&#x27;</span>)</span><br><span class="line"></span><br><span class="line">                <span class="comment">// ä¿å­˜å¹¶é¢„è§ˆå›¾ç‰‡åœ°å€</span></span><br><span class="line">                <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">                    <span class="string">&#x27;userInfo.avatar&#x27;</span>: data.data.url</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>åœ¨é¡µé¢ä¸Šå±•ç¤ºä¸Šä¼ æˆåŠŸåçš„ç”¨æˆ·å¤´åƒã€‚</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;profile&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">center</span> <span class="attr">title</span>=<span class="string">&quot;å¤´åƒ&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">van-icon</span> <span class="attr">slot</span>=<span class="string">&quot;right-icon&quot;</span> <span class="attr">name</span>=<span class="string">&quot;arrow&quot;</span> <span class="attr">size</span>=<span class="string">&quot;16&quot;</span> <span class="attr">color</span>=<span class="string">&quot;#c3c3c5&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">open-type</span>=<span class="string">&quot;chooseAvatar&quot;</span> <span class="attr">bind:chooseavatar</span>=<span class="string">&quot;getUserAvatar&quot;</span> <span class="attr">class</span>=<span class="string">&quot;button&quot;</span> <span class="attr">size</span>=<span class="string">&quot;mini&quot;</span> <span class="attr">hover-class</span>=<span class="string">&quot;none&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">image</span> <span class="attr">src</span>=<span class="string">&quot;&#123;&#123;userInfo.avatar || &#x27;/static/images/avatar_1.jpg&#x27;&#125;&#125;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;avatar&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">van-cell</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-field</span> <span class="attr">bind:blur</span>=<span class="string">&quot;getUserNickName&quot;</span> <span class="attr">center</span> <span class="attr">label</span>=<span class="string">&quot;æ˜µç§°&quot;</span> <span class="attr">input-align</span>=<span class="string">&quot;right&quot;</span> <span class="attr">type</span>=<span class="string">&quot;nickname&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;è¯·è¾“å…¥æ˜µç§°&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ğŸ¤” æç¤ºï¼š <code>wx.uploadFile()</code> æ–‡ä»¶ä¸Šä¼ æ—¶éœ€è¦åœ¨å°ç¨‹åºç®¡ç†åå°æ·»åŠ æ¥å£å¯¹åº”çš„åŸŸåã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹å½“å‰è¢«ä¿®æ”¹çš„æ–‡ä»¶</span></span><br><span class="line">git status</span><br><span class="line"><span class="comment"># æš‚å­˜æ–‡ä»¶</span></span><br><span class="line">git add .</span><br><span class="line"><span class="comment"># æäº¤åˆ°æœ¬åœ°</span></span><br><span class="line">git commit -m <span class="string">&#x27;feat(user): å®Œæˆç”¨æˆ·æ˜µç§°å’Œå¤´åƒå¡«å†™åŠŸèƒ½&#x27;</span></span><br></pre></td></tr></table></figure>

<h4 id="è·å–èµ„æ–™"><a href="#è·å–èµ„æ–™" class="headerlink" title="è·å–èµ„æ–™"></a>è·å–èµ„æ–™</h4><ol>
<li>è°ƒç”¨æ¥å£ã€‚</li>
</ol>
<p>è·å–ç”¨æˆ·èµ„æ–™æ˜¯æŒ‡åœ¨æˆ‘çš„ tabBaré¡µé¢ä¸­è°ƒç”¨æ¥å£è·å–ç”¨æˆ·çš„å¤´åƒå’Œæ˜µç§°ï¼Œä¸Šä¸€å°èŠ‚æˆ‘ä»¬å·²ç»ä¸ºç”¨æˆ·è®¾ç½®äº†æ˜µç§°å’Œå¤´åƒï¼Œè¿™ä¸€èŠ‚åªéœ€è¦è°ƒç”¨æ¥å£æ¥è·å–è¿™äº›æ•°æ®å³å¯ã€‚</p>
<ul>
<li><p>æ¥å£è·¯å¾„ï¼š<code>/userInfo</code>ã€‚</p>
</li>
<li><p>è¯·æ±‚æ–¹æ³•: GETã€‚</p>
</li>
<li><p>è¯·æ±‚å‚æ•°ï¼šæ— ã€‚</p>
</li>
<li><p>Headersï¼š</p>
<ul>
<li>Authorizationã€‚</li>
</ul>
</li>
<li><p>å“åº”æ•°æ®ï¼š<a target="_blank" rel="noopener" href="https://www.apifox.cn/apidoc/shared-8d66c345-7a9a-4844-9a5a-1201852f6faa/api-42037729">è§æ–‡æ¡£</a>ã€‚</p>
</li>
</ul>
<ol>
<li>å°è£…è·å–ç”¨æˆ·ä¿¡æ¯çš„æ–¹æ³•ï¼Œå¹¶åœ¨ onShow ä¸­è°ƒç”¨ï¼Œ<code>miniprogram/pages/my/index.js</code>ã€‚</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Page(&#123;</span><br><span class="line">    <span class="function"><span class="title">onShow</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// è·å–ç™»å½•ç”¨æˆ·ä¿¡æ¯</span></span><br><span class="line">        <span class="built_in">this</span>.getUserInfo()</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç”¨æˆ·ä¿¡æ¯æ¥å£</span></span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="title">getUserInfo</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// è¯·æ±‚æ•°æ®æ¥å£</span></span><br><span class="line">        <span class="keyword">const</span> &#123;</span><br><span class="line">            code,</span><br><span class="line">            <span class="attr">data</span>: userInfo</span><br><span class="line">        &#125; = <span class="keyword">await</span> wx.http.get(<span class="string">&#x27;/userInfo&#x27;</span>)</span><br><span class="line">        <span class="comment">// æ ¡éªŒæ•°æ®æ˜¯å¦åˆæ³•</span></span><br><span class="line">        <span class="keyword">if</span> (code !== <span class="number">10000</span>) <span class="keyword">return</span> wx.utils.toast(<span class="string">&#x27;æ•°æ®åŠ è½½å¤±è´¥, è¯·ç¨åé‡è¯•!&#x27;</span>)</span><br><span class="line">        <span class="comment">// è®¾ç½®æ•°æ®ï¼Œæ›´æ–°æ¸²æŸ“</span></span><br><span class="line">        <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">            userInfo</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>å°†æ¥å£è¯·æ±‚æ¥çš„æ•°æ®æ¸²æŸ“åˆ°é¡µé¢å½“ä¸­ï¼Œ<code>miniprogram/pages/my/index.wxml</code>ã€‚</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;profile&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;profile-base&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">image</span> <span class="attr">class</span>=<span class="string">&quot;avatar&quot;</span> <span class="attr">src</span>=<span class="string">&quot;&#123;&#123;userInfo.avatar || &#x27;/static/images/avatar_1.jpg&#x27;&#125;&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">text</span> <span class="attr">bind:tap</span>=<span class="string">&quot;goLogin&quot;</span> <span class="attr">class</span>=<span class="string">&quot;nickname&quot;</span>&gt;</span>&#123;&#123;userInfo.nickName || &#x27;å¾®ä¿¡ç”¨æˆ·&#x27;&#125;&#125;<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">navigator</span> <span class="attr">hover-class</span>=<span class="string">&quot;none&quot;</span> <span class="attr">class</span>=<span class="string">&quot;link&quot;</span> <span class="attr">url</span>=<span class="string">&quot;/pages/profile/index&quot;</span>&gt;</span></span><br><span class="line">            å»å®Œå–„ä¿¡æ¯<span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;enjoy-icon icon-arrow&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">navigator</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;profile-extra&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">navigator</span> <span class="attr">class</span>=<span class="string">&quot;item house&quot;</span> <span class="attr">url</span>=<span class="string">&quot;/house_pkg/pages/list/index&quot;</span> <span class="attr">hover-class</span>=<span class="string">&quot;none&quot;</span>&gt;</span>æˆ‘çš„æˆ¿å±‹<span class="tag">&lt;/<span class="name">navigator</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">navigator</span> <span class="attr">class</span>=<span class="string">&quot;item repair&quot;</span> <span class="attr">url</span>=<span class="string">&quot;/repair_pkg/pages/list/index&quot;</span> <span class="attr">hover-class</span>=<span class="string">&quot;none&quot;</span>&gt;</span>æˆ‘çš„æŠ¥ä¿®<span class="tag">&lt;/<span class="name">navigator</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">navigator</span> <span class="attr">class</span>=<span class="string">&quot;item visitor&quot;</span> <span class="attr">hover-class</span>=<span class="string">&quot;none&quot;</span> <span class="attr">url</span>=<span class="string">&quot;/visitor_pkg/pages/list/index&quot;</span>&gt;</span>è®¿å®¢è®°å½•<span class="tag">&lt;/<span class="name">navigator</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>tabBar é¡µé¢ã€æˆ‘çš„ã€‘ï¼Œåœ¨ç”¨æˆ·æœªç™»å½•çš„æƒ…å†µä¸‹è¿›è¡Œè°ƒç”¨æ¥å£ä¼šè¿”å› 401ï¼Œæ­¤æ—¶ç”±äºæ˜¯æœªç™»å½•çš„æ‰€ä»¥æœ¬åœ°å¹¶æ²¡æœ‰ refresh_tokenï¼Œé‚£ä¹ˆåˆ·æ–° token ä¹Ÿè‡ªç„¶å°±æ˜¯æ²¡æœ‰å¿…è¦çš„äº†ï¼Œåªéœ€è¦åœ¨è°ƒç”¨åˆ·æ–° token çš„æ¥å£æ—¶è¿›è¡Œä¸€ä¸ªåˆ¤æ–­å³å¯ã€‚</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é…ç½®å“åº”æ‹¦æˆªå™¨</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">http.intercept.response = <span class="keyword">async</span> (&#123;</span><br><span class="line">    data,</span><br><span class="line">    statusCode,</span><br><span class="line">    config</span><br><span class="line">&#125;) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (statusCode === <span class="number">401</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> app = getApp()</span><br><span class="line">        <span class="keyword">if</span> (config.url.includes(<span class="string">&#x27;/refreshToken&#x27;</span>)) &#123;</span><br><span class="line">            <span class="comment">// app.clearTokenAndRefreshToken()</span></span><br><span class="line">            <span class="comment">// è¯»å–å½“å‰å†å²æ ˆ</span></span><br><span class="line">            <span class="keyword">const</span> pageStack = getCurrentPages()</span><br><span class="line">            <span class="comment">// å–å‡ºå½“å‰é¡µé¢è·¯å¾„ï¼Œç™»å½•æˆåŠŸèƒ½è·³è½¬åˆ°è¯¥é¡µé¢</span></span><br><span class="line">            <span class="keyword">const</span> lastPage = pageStack[pageStack.length - <span class="number">1</span>]</span><br><span class="line">            <span class="comment">// å–å‡ºå½“å‰é¡µé¢è·¯å¾„ï¼Œç™»å½•æˆåŠŸèƒ½è·³è½¬åˆ°è¯¥é¡µé¢</span></span><br><span class="line">            <span class="keyword">const</span> redirectURL = lastPage.route</span><br><span class="line">            <span class="comment">// å¼•å¯¼ç”¨æˆ·åˆ°ç™»å½•é¡µé¢</span></span><br><span class="line">            <span class="keyword">return</span> wx.redirectTo(&#123;</span><br><span class="line">                <span class="attr">url</span>: <span class="string">`/pages/login/index?redirectURL=/<span class="subst">$&#123;redirectURL&#125;</span>`</span>,</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// #mark</span></span><br><span class="line">        <span class="keyword">if</span> (!app.refresh_token) <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">const</span> res = <span class="keyword">await</span> http(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">&#x27;/refreshToken&#x27;</span>,</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">            <span class="attr">header</span>: &#123;</span><br><span class="line">                <span class="attr">Authorization</span>: app.refresh_token</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        app.setToken(res.data.token, res.data.refreshToken)</span><br><span class="line">        <span class="comment">// é‡æ–°å‘èµ·è¯·æ±‚</span></span><br><span class="line">        <span class="keyword">return</span> http(</span><br><span class="line">            <span class="built_in">Object</span>.assign(config, &#123;</span><br><span class="line">                <span class="comment">// ä¼ é€’æ–°çš„ token</span></span><br><span class="line">                <span class="attr">header</span>: &#123;</span><br><span class="line">                    <span class="attr">Authorization</span>: app.token,</span><br><span class="line">                &#125;,</span><br><span class="line">            &#125;)</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// è¿‡æ»¤æ¥å£è¿”å›çš„æ•°æ®</span></span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ğŸ¤” å¦‚æœæ­¤æ—¶æ§åˆ¶å°æœ‰è¿™ä¸ªæŠ¥é”™ï¼š <code>TypeError: Cannot read property &#39;code&#39; of undefined</code> ï¼Œå¯ä»¥åœ¨ <code>miniprogram/pages/my/index.js</code> é¡µé¢è¿›è¡Œ try catchã€‚</p>
<ol start="4">
<li>å¤„ç†ä¸ªäººä¿¡æ¯é¡µé¢ç”¨æˆ·æ˜µç§°å’Œå¤´åƒçš„é»˜è®¤å€¼ã€‚</li>
</ol>
<p>æ€è·¯ï¼šåœ¨ã€æˆ‘çš„ã€‘é¡µé¢è·å–åˆ°ç”¨æˆ·ä¿¡æ¯åï¼Œé™¤äº†æ­£å¸¸æ¸²æŸ“å¤–å†æŠŠæ•°æ®å­˜å‚¨åˆ°æœ¬åœ°ï¼Œç„¶ååœ¨ä¸ªäººèµ„æ–™é¡µé¢ç›´æ¥è¿›è¡Œè¯»å–ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// pages/my/index.js</span></span><br><span class="line">Page(&#123;</span><br><span class="line">    <span class="function"><span class="title">onShow</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// è·å–ç™»å½•ç”¨æˆ·ä¿¡æ¯</span></span><br><span class="line">        <span class="built_in">this</span>.getUserInfo()</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// ç”¨æˆ·ä¿¡æ¯æ¥å£</span></span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="title">getUserInfo</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// è¯·æ±‚æ•°æ®æ¥å£</span></span><br><span class="line">        <span class="comment">// 401 æ—¶ï¼Œæ˜¯æ²¡æœ‰ code çš„</span></span><br><span class="line">        <span class="comment">// try catch ç§»é™¤æ§åˆ¶å°é”™è¯¯</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> &#123;</span><br><span class="line">                code,</span><br><span class="line">                <span class="attr">data</span>: userInfo</span><br><span class="line">            &#125; = <span class="keyword">await</span> wx.http.get(<span class="string">&#x27;/userInfo&#x27;</span>)</span><br><span class="line">            <span class="comment">// æ ¡éªŒæ•°æ®æ˜¯å¦åˆæ³•</span></span><br><span class="line">            <span class="keyword">if</span> (code !== <span class="number">10000</span>) <span class="keyword">return</span> wx.utils.toast(<span class="string">&#x27;æ•°æ®åŠ è½½å¤±è´¥, è¯·ç¨åé‡è¯•!&#x27;</span>)</span><br><span class="line">            <span class="comment">// è®¾ç½®æ•°æ®ï¼Œæ›´æ–°æ¸²æŸ“</span></span><br><span class="line">            <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">                userInfo</span><br><span class="line">            &#125;)</span><br><span class="line">            <span class="comment">// å°†ç”¨æˆ·ä¿¡æ¯å­˜å…¥æœ¬åœ°</span></span><br><span class="line">            wx.setStorageSync(<span class="string">&#x27;userInfo&#x27;</span>, userInfo)</span><br><span class="line">        &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>ç„¶åå†åˆ°ä¸ªäººèµ„æ–™é¡µé¢è¿›è¡Œè¯»å–ï¼Œ <code>pages/profile/index.js</code> ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Page(&#123;</span><br><span class="line">    <span class="function"><span class="title">onLoad</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// ä»æœ¬åœ°è·å–ç”¨æˆ·ä¿¡æ¯</span></span><br><span class="line">        <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">            <span class="attr">userInfo</span>: wx.getStorageSync(<span class="string">&#x27;userInfo&#x27;</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>æäº¤ä»£ç ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹å½“å‰è¢«ä¿®æ”¹çš„æ–‡ä»¶</span></span><br><span class="line">git status</span><br><span class="line"><span class="comment"># æš‚å­˜æ–‡ä»¶</span></span><br><span class="line">git add .</span><br><span class="line"><span class="comment"># æäº¤åˆ°æœ¬åœ°</span></span><br><span class="line">git commit -m <span class="string">&#x27;feat(user): å®Œæˆä¸ªèµ„æ–™çš„è¯»å–å’Œå®Œå–„&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="æˆ¿å±‹ç®¡ç†"><a href="#æˆ¿å±‹ç®¡ç†" class="headerlink" title="æˆ¿å±‹ç®¡ç†"></a>æˆ¿å±‹ç®¡ç†</h2><h3 id="æ·»åŠ æˆ¿å±‹"><a href="#æ·»åŠ æˆ¿å±‹" class="headerlink" title="æ·»åŠ æˆ¿å±‹"></a>æ·»åŠ æˆ¿å±‹</h3><p>æ·»åŠ æˆ¿å±‹æ˜¯ä¸ºç™»å½•ç”¨æˆ·æä¾›çš„ä¸€ä¸ªåˆ›å»ºæˆ¿å±‹ä¿¡æ¯çš„åŠŸèƒ½ï¼Œåœ¨æ·»åŠ äº†æˆ¿å±‹çš„åŸºç¡€ä¹‹ä¸Šæ‰èƒ½å®ç°åœ¨çº¿æŠ¥ä¿®ç­‰åŠŸèƒ½ã€‚</p>
<h4 id="åœ°ç†å®šä½"><a href="#åœ°ç†å®šä½" class="headerlink" title="åœ°ç†å®šä½"></a>åœ°ç†å®šä½</h4><p>æ ¹æ®ç”¨æˆ·æ‰€åœ¨çš„ä½ç½®å®šä½åˆ°å‘¨å›´çš„å°åŒºæˆ–è€…æ ¹æ®ç”¨æˆ·æŒ‡å®šçš„ä½ç½®å®šä½åˆ°å‘¨å›´å°åŒºï¼Œè¦å®è¿™ä¸ªåŠŸèƒ½éœ€è¦ç”¨åˆ°å°ç¨‹åºçš„ä¸¤ä¸ª APIï¼Œåˆ†åˆ«å¦‚ä¸‹ã€‚</p>
<ul>
<li><p>getLocation è·å–ç”¨æˆ·æ‰€åœ¨ä½ç½®çš„ç»çº¬åº¦ã€‚</p>
</li>
<li><p>chooseLocation ç”¨æˆ·æŒ‡å®šä½ç½®çš„ç»çº¬åº¦ã€‚</p>
</li>
</ul>
<p>æ³¨æ„ï¼šåœ¨å°ç¨‹åºä¸­è°ƒç”¨è¿™ä¸¤ä¸ªæ¥å£æ—¶å¿…é¡»è¦åœ¨ <code>app.json</code> ä¸­ç”³è¯·è°ƒç”¨æƒé™ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;requiredPrivateInfos&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;getLocation&quot;</span>,</span><br><span class="line">        <span class="string">&quot;chooseLocation&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="string">&quot;permission&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;scope.userLocation&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;desc&quot;</span>: <span class="string">&quot;ä½ çš„ä½ç½®ä¿¡æ¯å°†ç”¨äºå°ç¨‹åºä½ç½®æ¥å£çš„æ•ˆæœå±•ç¤º&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li>åœ¨é¡µé¢åŠ è½½æ—¶è°ƒç”¨ <code>wx.getLocation()</code> è·å–ç”¨æˆ·æ‰€åœ¨ä½ç½®çš„ç»çº¬åº¦ï¼Œ<code>house_pkg/pages/locate/index.js</code>ã€‚</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Page(&#123;</span><br><span class="line">    <span class="function"><span class="title">onLoad</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// è·å–ç”¨æˆ·æ‰€åœ¨ä½ç½®å‘¨å›´å°åŒº</span></span><br><span class="line">        <span class="built_in">this</span>.getLocation()</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="title">getLocation</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// ç”¨æˆ·æ‰€åœ¨ä½ç½®ç»çº¬åº¦</span></span><br><span class="line">        <span class="keyword">const</span> &#123;</span><br><span class="line">            latitude,</span><br><span class="line">            longitude</span><br><span class="line">        &#125; = <span class="keyword">await</span> wx.getLocation()</span><br><span class="line">        <span class="comment">// æŸ¥çœ‹ç»çº¬åº¦</span></span><br><span class="line">        <span class="comment">// latitude =&gt; çº¬åº¦</span></span><br><span class="line">        <span class="built_in">console</span>.log(latitude, longitude)</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>ç”¨æˆ·ç‚¹å‡»ã€é‡æ–°å®šä½ã€‘æŒ‰é’®æ—¶è°ƒç”¨ <code>wx.chooseLocation()</code> è·å–ç”¨æˆ·æŒ‡å®šä½ç½®çš„ç»çº¬åº¦ã€‚</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- house_pkg/pages/locate/index.wxml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">authorization</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;locate&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">van-cell-group</span> <span class="attr">border</span>=<span class="string">&quot;&#123;&#123;false&#125;&#125;&quot;</span> <span class="attr">title</span>=<span class="string">&quot;å½“å‰åœ°ç‚¹&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title</span>=<span class="string">&quot;å»ºæåŸè¥¿è·¯9å·&quot;</span> <span class="attr">border</span>=<span class="string">&quot;&#123;&#123;false&#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;enjoy-icon icon-locate&quot;</span> <span class="attr">bind:tap</span>=<span class="string">&quot;chooseLocation&quot;</span>&gt;</span>é‡æ–°å®šä½<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">van-cell</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">van-cell-group</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">van-cell-group</span> <span class="attr">border</span>=<span class="string">&quot;&#123;&#123;false&#125;&#125;&quot;</span> <span class="attr">title</span>=<span class="string">&quot;é™„è¿‘ç¤¾åŒº&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title</span>=<span class="string">&quot;å»ºæåŸè¥¿è·¯9å·&quot;</span> <span class="attr">link-type</span>=<span class="string">&quot;navigateTo&quot;</span> <span class="attr">url</span>=<span class="string">&quot;/house_pkg/pages/building/index&quot;</span> <span class="attr">is-link</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title</span>=<span class="string">&quot;å»ºæåŸè¥¿è·¯9å·&quot;</span> <span class="attr">link-type</span>=<span class="string">&quot;navigateTo&quot;</span> <span class="attr">url</span>=<span class="string">&quot;/house_pkg/pages/building/index&quot;</span> <span class="attr">is-link</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title</span>=<span class="string">&quot;å»ºæåŸè¥¿è·¯9å·&quot;</span> <span class="attr">link-type</span>=<span class="string">&quot;navigateTo&quot;</span> <span class="attr">url</span>=<span class="string">&quot;/house_pkg/pages/building/index&quot;</span> <span class="attr">is-link</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">van-cell-group</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">authorization</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>åœ¨äº‹ä»¶å›è°ƒå‡½æ•° chooseLocation ä¸­è°ƒç”¨ APIã€‚</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// house_pkg/pages/locate/index.js</span></span><br><span class="line">Page(&#123;</span><br><span class="line">    <span class="function"><span class="title">onLoad</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// è·å–ç”¨æˆ·æ‰€åœ¨ä½ç½®å‘¨å›´å°åŒº</span></span><br><span class="line">        <span class="built_in">this</span>.getLocation()</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="title">getLocation</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// ç”¨æˆ·æ‰€åœ¨ä½ç½®ç»çº¬åº¦</span></span><br><span class="line">        <span class="keyword">const</span> &#123;</span><br><span class="line">            latitude,</span><br><span class="line">            longitude</span><br><span class="line">        &#125; = <span class="keyword">await</span> wx.getLocation()</span><br><span class="line">        <span class="comment">// æŸ¥çœ‹ç»çº¬åº¦</span></span><br><span class="line">        <span class="built_in">console</span>.log(latitude, longitude)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="title">chooseLocation</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// ç”¨æˆ·æ‰€åœ¨ä½ç½®ç»çº¬åº¦</span></span><br><span class="line">        <span class="keyword">const</span> &#123;</span><br><span class="line">            latitude,</span><br><span class="line">            longitude</span><br><span class="line">        &#125; = <span class="keyword">await</span> wx.chooseLocation()</span><br><span class="line">        <span class="comment">// æ³¨æ„ç‚¹ç¡®å®šæŒ‰é’®çš„æ—¶å€™æ‰ä¼šèµ°è¿™å„¿çš„æ‰“å°</span></span><br><span class="line">        <span class="comment">// æŸ¥çœ‹ç»çº¬åº¦</span></span><br><span class="line">        <span class="built_in">console</span>.log(latitude, longitude)</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="è…¾è®¯ä½ç½®"><a href="#è…¾è®¯ä½ç½®" class="headerlink" title="è…¾è®¯ä½ç½®"></a>è…¾è®¯ä½ç½®</h4><p><a target="_blank" rel="noopener" href="https://lbs.qq.com/">https://lbs.qq.com/</a></p>
<p>è…¾è®¯ä½ç½®æœåŠ¡ä¸ºå¾®ä¿¡å°ç¨‹åºæä¾›äº†åŸºç¡€çš„æ ‡ç‚¹èƒ½åŠ›ã€çº¿å’Œåœ†çš„ç»˜åˆ¶æ¥å£ç­‰åœ°å›¾ç»„ä»¶å’Œä½ç½®å±•ç¤ºã€åœ°å›¾é€‰ç‚¹ç­‰åœ°å›¾APIä½ç½®æœåŠ¡èƒ½åŠ›æ”¯æŒï¼Œä½¿å¾—å¼€å‘è€…å¯ä»¥è‡ªç”±åœ°å®ç°è‡ªå·±çš„å¾®ä¿¡å°ç¨‹åºäº§å“ã€‚ åœ¨æ­¤åŸºç¡€ä¸Šï¼Œè…¾è®¯ä½ç½®æœåŠ¡å¾®ä¿¡å°ç¨‹åº JavaScript SDK æ˜¯ä¸“ä¸ºå°ç¨‹åºå¼€å‘è€…æä¾›çš„LBSæ•°æ®æœåŠ¡å·¥å…·åŒ…ï¼Œå¯ä»¥åœ¨å°ç¨‹åºä¸­è°ƒç”¨è…¾è®¯ä½ç½®æœåŠ¡çš„POIæ£€ç´¢ã€å…³é”®è¯è¾“å…¥æç¤ºã€åœ°å€è§£æã€é€†åœ°å€è§£æã€è¡Œæ”¿åŒºåˆ’å’Œè·ç¦»è®¡ç®—ç­‰æ•°æ®æœåŠ¡ï¼Œè®©æ‚¨çš„å°ç¨‹åºæ›´å¼ºå¤§ï¼</p>
<p>æç¤ºï¼šè…¾è®¯ä½ç½®æœåŠ¡å¿…é¡»è¦æ³¨å†Œè´¦å·ç”³è¯·å¯†é’¥å¹¶ä¸”åœ¨å°ç¨‹åºç®¡ç†åå°è®¾ç½® request åˆæ³•åŸŸå: <a target="_blank" rel="noopener" href="https://apis.map.qq.com/">https://apis.map.qq.com</a> åæ‰å¯ä»¥ä½¿ç”¨ã€‚</p>
<p><a target="_blank" rel="noopener" href="https://lbs.qq.com/miniProgram/jsSdk/jsSdkGuide/jsSdkOverview">å¾®ä¿¡å°ç¨‹åº JavaScript SDK</a></p>
<p>æ§åˆ¶å° =&gt; åº”ç”¨ç®¡ç† =&gt; æˆ‘çš„åº”ç”¨ =&gt; åˆ›å»ºåº”ç”¨ =&gt; æ·»åŠ  key =&gt; WebServiceAPI =&gt; åŸŸåç™½åå•ã€‚</p>
<!-- R3PBZ-EIALV-HYDP3-U7LWC-NNNJS-MAF4N7Q -->

<ol>
<li>é€†åœ°å€è§£æã€‚</li>
</ol>
<p>æ ¹æ®ç»çº¬åº¦æŸ¥è¯¢å‘¨å›´å°åŒºç”¨åˆ°çš„æ˜¯é€†åœ°å€è§£æçš„åŠŸèƒ½ï¼Œæ‰€è°“çš„é€†åœ°å€è§£ææ˜¯æŒ‡æ ¹æ®ç»çº¬åº¦è·å–ä½ç½®çš„ç›¸å…³æè¿°ï¼Œåœ¨ç”³è¯·å®Œå¯†é’¥åä¸‹è½½å¾®ä¿¡å°ç¨‹åº Javascript SDK è°ƒç”¨å…¶æä¾›çš„æ–¹æ³•å³å¯å®ç°æŸ¥è¯¢å‘¨å›´å°åŒºçš„åŠŸèƒ½ã€‚</p>
<p>ä¸‹è½½å¹¶è§£å‹åå°† JavaScript SDK æ”¾åˆ° libs ç›®å½•ä¸‹ï¼Œç„¶ååˆ° <code>utils/qqmap.js</code> ä¸­é…ç½®è…¾è®¯ä½ç½®æœåŠ¡çš„å¯†é’¥ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> QQMapWX <span class="keyword">from</span> <span class="string">&#x27;../libs/qqmap-wx-jssdk.min&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–ç”¨æˆ·å½“å‰æ‰€åœ¨ä½ç½®</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> QQMapWX(&#123;</span><br><span class="line">    <span class="comment">// å¡«å†™è‡ªå·²åœ¨è…¾è®¯åœ°å›¾åˆ›å»ºåº”ç”¨çš„ key</span></span><br><span class="line">    <span class="attr">key</span>: <span class="string">&#x27;R3PBZ-EIALV-HYDP3-U7LWC-NNNJS-MAFN4Q7&#x27;</span>,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>ç„¶åå†è°ƒç”¨ SDK æä¾›çš„ reverseGeocoder æ–¹æ³•è·å–ä½ç½®æè¿°ï¼Œ<code>house_pkg/pages/locate/index.js</code>ã€‚</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¯¼å…¥è…¾è®¯ä½ç½®æœåŠ¡æä¾›çš„ Javascript SDK</span></span><br><span class="line"><span class="keyword">import</span> qqMap <span class="keyword">from</span> <span class="string">&#x27;../../../utils/qqmap&#x27;</span></span><br><span class="line">Page(&#123;</span><br><span class="line">    <span class="function"><span class="title">onLoad</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// è·å–ç”¨æˆ·æ‰€åœ¨ä½ç½®å‘¨å›´å°åŒº</span></span><br><span class="line">        <span class="built_in">this</span>.getLocation()</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="title">getLocation</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// ç”¨æˆ·æ‰€åœ¨ä½ç½®ç»çº¬åº¦</span></span><br><span class="line">        <span class="keyword">const</span> &#123;</span><br><span class="line">            latitude,</span><br><span class="line">            longitude</span><br><span class="line">        &#125; = <span class="keyword">await</span> wx.getLocation()</span><br><span class="line">        <span class="comment">// è°ƒç”¨ SDK æå…±çš„æ–¹æ³•</span></span><br><span class="line">        <span class="built_in">this</span>.getPoint(latitude, longitude)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="title">chooseLocation</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// ç”¨æˆ·æ‰€åœ¨ä½ç½®ç»çº¬åº¦</span></span><br><span class="line">        <span class="keyword">const</span> &#123;</span><br><span class="line">            latitude,</span><br><span class="line">            longitude</span><br><span class="line">        &#125; = <span class="keyword">await</span> wx.chooseLocation()</span><br><span class="line">        <span class="comment">// æ³¨æ„ç‚¹ç¡®å®šæŒ‰é’®çš„æ—¶å€™æ‰ä¼šèµ°è¿™å„¿çš„æ‰“å°</span></span><br><span class="line">        <span class="comment">// è°ƒç”¨ SDK æå…±çš„æ–¹æ³•</span></span><br><span class="line">        <span class="built_in">this</span>.getPoint(latitude, longitude)</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="title">getPoint</span>(<span class="params">latitude, longitude</span>)</span> &#123;</span><br><span class="line">        <span class="comment">// æ˜¾ç¤ºåŠ è½½çŠ¶æ€</span></span><br><span class="line">        wx.showLoading(&#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;æ­£åœ¨åŠ è½½...&#x27;</span>,</span><br><span class="line">            <span class="attr">mask</span>: <span class="literal">true</span></span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="comment">// é€†åœ°å€è§£æï¼ˆæ ¹æ®ç»çº¬åº¦æŸ¥è¯¢ä½ç½®ç›¸å…³æè¿°ï¼‰</span></span><br><span class="line">        qqMap.reverseGeocoder(&#123;</span><br><span class="line">            <span class="attr">location</span>: [latitude, longitude].join(<span class="string">&#x27;,&#x27;</span>),</span><br><span class="line">            <span class="attr">success</span>: <span class="function">(<span class="params">&#123;</span></span></span><br><span class="line"><span class="params"><span class="function">                result: &#123;</span></span></span><br><span class="line"><span class="params"><span class="function">                    address</span></span></span><br><span class="line"><span class="params"><span class="function">                &#125;</span></span></span><br><span class="line"><span class="params"><span class="function">            &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="comment">// ç»“æœä¸ºå½“å‰æ‰€åœ¨çš„åœ°å€</span></span><br><span class="line">                <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">                    address</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>å°†è·å–çš„ä½ç½®æè¿°å±•ç¤ºåˆ°é¡µé¢å½“ä¸­ã€‚</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- house_pkg/pages/locate/index --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">authorization</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;locate&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">van-cell-group</span> <span class="attr">border</span>=<span class="string">&quot;&#123;&#123;false&#125;&#125;&quot;</span> <span class="attr">title</span>=<span class="string">&quot;å½“å‰åœ°ç‚¹&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title</span>=<span class="string">&quot;&#123;&#123;address&#125;&#125;&quot;</span> <span class="attr">border</span>=<span class="string">&quot;&#123;&#123;false&#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">text</span> <span class="attr">bind:tap</span>=<span class="string">&quot;chooseLocation&quot;</span> <span class="attr">class</span>=<span class="string">&quot;enjoy-icon icon-locate&quot;</span>&gt;</span>é‡æ–°å®šä½<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">van-cell</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">van-cell-group</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">van-cell-group</span> <span class="attr">border</span>=<span class="string">&quot;&#123;&#123;false&#125;&#125;&quot;</span> <span class="attr">title</span>=<span class="string">&quot;é™„è¿‘ç¤¾åŒº&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title</span>=<span class="string">&quot;å»ºæåŸè¥¿è·¯9å·&quot;</span> <span class="attr">link-type</span>=<span class="string">&quot;navigateTo&quot;</span> <span class="attr">url</span>=<span class="string">&quot;/house_pkg/pages/building/index&quot;</span> <span class="attr">is-link</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title</span>=<span class="string">&quot;å»ºæåŸè¥¿è·¯9å·&quot;</span> <span class="attr">link-type</span>=<span class="string">&quot;navigateTo&quot;</span> <span class="attr">url</span>=<span class="string">&quot;/house_pkg/pages/building/index&quot;</span> <span class="attr">is-link</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title</span>=<span class="string">&quot;å»ºæåŸè¥¿è·¯9å·&quot;</span> <span class="attr">link-type</span>=<span class="string">&quot;navigateTo&quot;</span> <span class="attr">url</span>=<span class="string">&quot;/house_pkg/pages/building/index&quot;</span> <span class="attr">is-link</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">van-cell-group</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">authorization</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="4">
<li>æœç´¢é™„è¿‘çš„ç¤¾åŒºã€‚</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¯¼å…¥è…¾è®¯ä½ç½®æœåŠ¡æä¾›çš„ JavaScript SDK</span></span><br><span class="line"><span class="keyword">import</span> qqMap <span class="keyword">from</span> <span class="string">&#x27;../../../utils/qqmap&#x27;</span></span><br><span class="line">Page(&#123;</span><br><span class="line">    <span class="function"><span class="title">onLoad</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// è·å–ç”¨æˆ·æ‰€åœ¨ä½ç½®å‘¨å›´å°åŒº</span></span><br><span class="line">        <span class="built_in">this</span>.getLocation()</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="title">getLocation</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// ç”¨æˆ·æ‰€åœ¨ä½ç½®ç»çº¬åº¦</span></span><br><span class="line">        <span class="keyword">const</span> &#123;</span><br><span class="line">            latitude,</span><br><span class="line">            longitude</span><br><span class="line">        &#125; = <span class="keyword">await</span> wx.getLocation()</span><br><span class="line">        <span class="comment">// è°ƒç”¨ SDK æå…±çš„æ–¹æ³•</span></span><br><span class="line">        <span class="built_in">this</span>.getPoint(latitude, longitude)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="title">chooseLocation</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// ç”¨æˆ·æ‰€åœ¨ä½ç½®ç»çº¬åº¦</span></span><br><span class="line">        <span class="keyword">const</span> &#123;</span><br><span class="line">            latitude,</span><br><span class="line">            longitude</span><br><span class="line">        &#125; = <span class="keyword">await</span> wx.chooseLocation()</span><br><span class="line">        <span class="comment">// æ³¨æ„ç‚¹ç¡®å®šæŒ‰é’®çš„æ—¶å€™æ‰ä¼šèµ°è¿™å„¿çš„æ‰“å°</span></span><br><span class="line">        <span class="comment">// è°ƒç”¨ SDK æå…±çš„æ–¹æ³•</span></span><br><span class="line">        <span class="built_in">this</span>.getPoint(latitude, longitude)</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="title">getPoint</span>(<span class="params">latitude, longitude</span>)</span> &#123;</span><br><span class="line">        <span class="comment">// æ˜¾ç¤ºåŠ è½½çŠ¶æ€</span></span><br><span class="line">        wx.showLoading(&#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;æ­£åœ¨åŠ è½½...&#x27;</span>,</span><br><span class="line">            <span class="attr">mask</span>: <span class="literal">true</span></span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="comment">// é€†åœ°å€è§£æï¼ˆæ ¹æ®ç»çº¬åº¦æŸ¥è¯¢ä½ç½®ç›¸å…³ä¿¡æ¯ï¼‰</span></span><br><span class="line">        qqMap.reverseGeocoder(&#123;</span><br><span class="line">            <span class="attr">location</span>: [latitude, longitude].join(<span class="string">&#x27;,&#x27;</span>),</span><br><span class="line">            <span class="attr">success</span>: <span class="function">(<span class="params">&#123;</span></span></span><br><span class="line"><span class="params"><span class="function">                result: &#123;</span></span></span><br><span class="line"><span class="params"><span class="function">                    address</span></span></span><br><span class="line"><span class="params"><span class="function">                &#125;</span></span></span><br><span class="line"><span class="params"><span class="function">            &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="comment">// æ›´æ–°æ•°æ®ï¼Œé‡æ–°æ¸²æŸ“</span></span><br><span class="line">                <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">                    address</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æœç´¢å‘¨è¾¹</span></span><br><span class="line">        qqMap.search(&#123;</span><br><span class="line">            <span class="comment">// æœç´¢å…³é”®å­—ï¼ˆæŸ¥è¯¢å‘¨è¾¹çš„å°åŒºï¼‰</span></span><br><span class="line">            <span class="attr">keyword</span>: <span class="string">&#x27;ä½å®…å°åŒº&#x27;</span>,</span><br><span class="line">            <span class="comment">// æŒ‡å®šç»çº¬åº¦</span></span><br><span class="line">            <span class="attr">location</span>: [latitude, longitude].join(<span class="string">&#x27;,&#x27;</span>),</span><br><span class="line">            <span class="comment">// æŸ¥è¯¢æ•°æ®æ¡æ•°</span></span><br><span class="line">            <span class="attr">page_size</span>: <span class="number">5</span>,</span><br><span class="line">            <span class="attr">success</span>: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="comment">// å¤„ç†å¾—åˆ°çš„åœ°ç‚¹ä¿¡æ¯ï¼ˆè¿‡æ»¤æ‰å¤šä½™æ•°æ®ï¼‰</span></span><br><span class="line">                <span class="keyword">const</span> points = []</span><br><span class="line">                res.data.forEach(<span class="function">(<span class="params">&#123;</span></span></span><br><span class="line"><span class="params"><span class="function">                    id,</span></span></span><br><span class="line"><span class="params"><span class="function">                    title,</span></span></span><br><span class="line"><span class="params"><span class="function">                    _distance</span></span></span><br><span class="line"><span class="params"><span class="function">                &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">                    points.push(&#123;</span><br><span class="line">                        id,</span><br><span class="line">                        title,</span><br><span class="line">                        _distance</span><br><span class="line">                    &#125;)</span><br><span class="line">                &#125;)</span><br><span class="line"></span><br><span class="line">                <span class="comment">// æ›´æ–°æ•°æ®ï¼Œé‡æ–°æ¸²æŸ“</span></span><br><span class="line">                <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">                    points</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="function"><span class="title">fail</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">                wx.utils.toast(<span class="string">&#x27;æ²¡æœ‰æ‰¾é™„è¿‘çš„å°åŒº!&#x27;</span>)</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">complete</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">                <span class="comment">// éšè—åŠ è½½çŠ¶æ€</span></span><br><span class="line">                wx.hideLoading()</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>å°†å‘¨è¾¹çš„ç¤¾åŒºæ¸²æŸ“åˆ°é¡µé¢å½“ä¸­ã€‚</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- house_pkg/pages/locate/index --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">authorization</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;locate&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">van-cell-group</span> <span class="attr">border</span>=<span class="string">&quot;&#123;&#123;false&#125;&#125;&quot;</span> <span class="attr">title</span>=<span class="string">&quot;å½“å‰åœ°ç‚¹&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title</span>=<span class="string">&quot;&#123;&#123;address&#125;&#125;&quot;</span> <span class="attr">border</span>=<span class="string">&quot;&#123;&#123;false&#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">text</span> <span class="attr">bind:tap</span>=<span class="string">&quot;chooseLocation&quot;</span> <span class="attr">class</span>=<span class="string">&quot;enjoy-icon icon-locate&quot;</span>&gt;</span>é‡æ–°å®šä½<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">van-cell</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">van-cell-group</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">van-cell-group</span> <span class="attr">border</span>=<span class="string">&quot;&#123;&#123;false&#125;&#125;&quot;</span> <span class="attr">title</span>=<span class="string">&quot;é™„è¿‘ç¤¾åŒº&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">wx:for</span>=<span class="string">&quot;&#123;&#123;points&#125;&#125;&quot;</span> <span class="attr">wx:key</span>=<span class="string">&quot;id&quot;</span> <span class="attr">title</span>=<span class="string">&quot;&#123;&#123;item.title&#125;&#125;&quot;</span> <span class="attr">link-type</span>=<span class="string">&quot;navigateTo&quot;</span> <span class="attr">url</span>=<span class="string">&quot;/house_pkg/pages/building/index&quot;</span> <span class="attr">is-link</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">van-cell-group</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">authorization</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æäº¤ä»£ç ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹å½“å‰è¢«ä¿®æ”¹çš„æ–‡ä»¶</span></span><br><span class="line">git status</span><br><span class="line"><span class="comment"># æš‚å­˜æ–‡ä»¶</span></span><br><span class="line">git add .</span><br><span class="line"><span class="comment"># æäº¤åˆ°æœ¬åœ°</span></span><br><span class="line">git commit -m <span class="string">&#x27;feat(house): æŸ¥è¯¢å‘¨è¾¹å°åŒº&#x27;</span></span><br></pre></td></tr></table></figure>

<h4 id="é€‰æ‹©æ¥¼æ ‹"><a href="#é€‰æ‹©æ¥¼æ ‹" class="headerlink" title="é€‰æ‹©æ¥¼æ ‹"></a>é€‰æ‹©æ¥¼æ ‹</h4><p>åœ¨ç”¨æˆ·ç¡®å®šäº†æŸä¸ªå°åŒºåå†é€‰æ‹©è¯¥å°åŒºå¯¹åº”çš„æ¥¼æ ‹ä¿¡æ¯ï¼Œä½†æ˜¯ç”±äºæ¥¼æ ‹ä¿¡æ¯ä¸æ˜“è‡ªåŠ¨è·å–ï¼Œåªèƒ½ä¼ªé€ ä¸€äº›æ•°æ®ï¼Œåˆ©ç”¨éšæœºæ•°æ¥ç”Ÿæˆä¸€ä¸ªæ¥¼å·å³å¯ã€‚</p>
<ol>
<li>é€šè¿‡ç¼–ç¨‹å¼å¯¼èˆªè·³è½¬åˆ°é€‰æ‹©æ¥¼æ ‹é¡µé¢ï¼Œ<code>house_pkg/pages/locate/index</code>ã€‚</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">authorization</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;locate&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">van-cell-group</span> <span class="attr">border</span>=<span class="string">&quot;&#123;&#123;false&#125;&#125;&quot;</span> <span class="attr">title</span>=<span class="string">&quot;å½“å‰åœ°ç‚¹&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title</span>=<span class="string">&quot;&#123;&#123;address&#125;&#125;&quot;</span> <span class="attr">border</span>=<span class="string">&quot;&#123;&#123;false&#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">text</span> <span class="attr">bind:tap</span>=<span class="string">&quot;chooseLocation&quot;</span> <span class="attr">class</span>=<span class="string">&quot;enjoy-icon icon-locate&quot;</span>&gt;</span>é‡æ–°å®šä½<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">van-cell</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">van-cell-group</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">van-cell-group</span> <span class="attr">border</span>=<span class="string">&quot;&#123;&#123;false&#125;&#125;&quot;</span> <span class="attr">title</span>=<span class="string">&quot;é™„è¿‘ç¤¾åŒº&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- å»æ‰ van-cell çš„ url å±æ€§ï¼Œç»‘å®š tap äº‹ä»¶ --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">wx:for</span>=<span class="string">&quot;&#123;&#123;points&#125;&#125;&quot;</span> <span class="attr">wx:key</span>=<span class="string">&quot;id&quot;</span> <span class="attr">title</span>=<span class="string">&quot;&#123;&#123;item.title&#125;&#125;&quot;</span> <span class="attr">bind:tap</span>=<span class="string">&quot;goBuilding&quot;</span> <span class="attr">mark:point</span>=<span class="string">&quot;&#123;&#123;item.title&#125;&#125;&quot;</span> <span class="attr">is-link</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">van-cell-group</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">authorization</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ğŸ¤” æç¤ºï¼š<code>van-cell</code> ç»„ä»¶æœ¬èº«æ”¯æŒé¡µé¢è·³è½¬ï¼Œä¸ºå…¶æŒ‡å®šä¸€ä¸ª url å±æ€§å³å¯ï¼Œä½†æ˜¯æœ¬èŠ‚ä¸­å’±ä»¬ç›‘å¬ç‚¹å‡»äº‹ä»¶é€šè¿‡ wx.navigateTo å®ç°è·³è½¬ï¼Œè¿™æ ·åšçš„ç›®çš„æ˜¯è®²è§£ä¸€ä¸ª <code>mark:*=&quot;xxx&quot;</code> çš„åº”ç”¨ï¼Œå®ƒæ˜¯ç”¨æ¥å‘äº‹ä»¶å›è°ƒä¼ é€’å‚æ•°çš„ä¸€ç§æ–¹å¼ï¼ŒåŠŸèƒ½æœ‰ç‚¹ç±»ä¼¼äºè‡ªå®šä¹‰å±æ€§ <code>data-*</code>ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// house_pkg/pages/locate/index.js</span></span><br><span class="line">Page(&#123;</span><br><span class="line">    <span class="function"><span class="title">goBuilding</span>(<span class="params">ev</span>)</span> &#123;</span><br><span class="line">        wx.navigateTo(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">&#x27;/house_pkg/pages/building/index?point=&#x27;</span> + ev.mark.point,</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>ä¼ªé€ æ¥¼æ ‹ä¿¡æ¯ï¼Œå®šä¹‰ç”Ÿæˆéšæœºæ•´æ•°çš„æ–¹æ³•ï¼Œ<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Math/random">é“¾æ¥</a>ã€‚</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> utils = &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="function"><span class="title">getRandomIntInclusive</span>(<span class="params">min, max</span>)</span> &#123;</span><br><span class="line">        min = <span class="built_in">Math</span>.ceil(min);</span><br><span class="line">        max = <span class="built_in">Math</span>.floor(max);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * (max - min + <span class="number">1</span>)) + min; <span class="comment">//å«æœ€å¤§å€¼ï¼Œå«æœ€å°å€¼</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// house_pkg/pages/building/index.js</span></span><br><span class="line">Page(&#123;</span><br><span class="line">    <span class="attr">data</span>: &#123;</span><br><span class="line">        <span class="attr">point</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="attr">size</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="title">onLoad</span>(<span class="params">&#123;</span></span></span><br><span class="line"><span class="params"><span class="function">        point</span></span></span><br><span class="line"><span class="params"><span class="function">    &#125;</span>)</span> &#123;</span><br><span class="line">        <span class="comment">// ä¼ªé€ æ•°è¿›è¡Œæ¸²æŸ“</span></span><br><span class="line">        <span class="built_in">this</span>.fake(point)</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="title">fake</span>(<span class="params">point</span>)</span> &#123;</span><br><span class="line">        <span class="comment">// ä¼ªé€ æ¥¼æ ‹/å·æ•°æ®ï¼ˆä»…ç”¨äºæˆè¯¾ï¼‰</span></span><br><span class="line">        <span class="comment">// size æ˜¯ä¸€ä¸ª 3 ~ 6 çš„éšæœºæ•°</span></span><br><span class="line">        <span class="keyword">const</span> size = wx.utils.getRandomIntInclusive(<span class="number">3</span>, <span class="number">6</span>)</span><br><span class="line">        <span class="keyword">const</span> type = size &gt; <span class="number">4</span> ? <span class="string">&#x27;å·æ¥¼&#x27;</span> : <span class="string">&#x27;æ ‹&#x27;</span></span><br><span class="line">        <span class="comment">// æ›´æ–°æ•°æ®ï¼Œé‡æ–°æ¸²æŸ“</span></span><br><span class="line">        <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">            point, <span class="comment">// å°åŒº</span></span><br><span class="line">            size, <span class="comment">// æ¥¼çš„æ•°é‡</span></span><br><span class="line">            type <span class="comment">// &quot;å·æ¥¼&quot; or &quot;æ ‹&quot;</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>ğŸ¤” ä¼ªé€ çš„æ•°æ®æ²¡æœ‰ç‰¹åˆ«çš„è¦æ±‚ï¼Œåªè¦äº§ç”Ÿä¸€ç³»åˆ—çš„éšæœºæ•°å³å¯ã€‚</p>
<ol start="3">
<li>å°†ç”Ÿæˆçš„éšæœºæ•°æ¸²æŸ“é¡µé¢å½“ä¸­ï¼Œ<code>house_pkg/pages/building/index</code>ã€‚</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">authorization</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;building&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">van-cell-group</span> <span class="attr">border</span>=<span class="string">&quot;&#123;&#123;false&#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- å°ç¨‹åºä¸­ `wx:for` æ”¯æŒä»¥çº¯æ•°å­—æ–¹å¼é‡å¤æ‰§è¡Œ --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">wx:for</span>=<span class="string">&quot;&#123;&#123;size&#125;&#125;&quot;</span> <span class="attr">wx:key</span>=<span class="string">&quot;*this&quot;</span> <span class="attr">title</span>=<span class="string">&quot;&#123;&#123;point&#125;&#125; &#123;&#123;item + 1&#125;&#125; &#123;&#123;type&#125;&#125;&quot;</span> <span class="attr">mark:building</span>=<span class="string">&quot;&#123;&#123;item + 1&#125;&#125;&#123;&#123;type&#125;&#125;&quot;</span> <span class="attr">bind:tap</span>=<span class="string">&quot;goRoom&quot;</span> <span class="attr">is-link</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">van-cell-group</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">authorization</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="é€‰æ‹©æˆ¿é—´"><a href="#é€‰æ‹©æˆ¿é—´" class="headerlink" title="é€‰æ‹©æˆ¿é—´"></a>é€‰æ‹©æˆ¿é—´</h4><p>åœ¨ç”¨æˆ·ç¡®å®šäº†æŸä¸ªå°åŒºçš„æ¥¼æ ‹ä¿¡æ¯åï¼Œå†ä¼ªé€ ä¸€äº›æ•°æ®ï¼Œåˆ©ç”¨éšæœºæ•°æ¥ç”Ÿæˆæˆ¿é—´å·ã€‚</p>
<ol>
<li>è·³è½¬åˆ°é€‰æ‹©æˆ¿é—´é¡µé¢å¹¶ä¼ é€’ç›¸å…³å‚æ•°ï¼Œ<code>house_pkg/pages/building/index</code>ã€‚</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">authorization</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;building&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">van-cell-group</span> <span class="attr">border</span>=<span class="string">&quot;&#123;&#123;false&#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">wx:for</span>=<span class="string">&quot;&#123;&#123;size&#125;&#125;&quot;</span> <span class="attr">wx:key</span>=<span class="string">&quot;*this&quot;</span> <span class="attr">title</span>=<span class="string">&quot;&#123;&#123;point&#125;&#125; &#123;&#123;item + 1&#125;&#125; &#123;&#123;type&#125;&#125;&quot;</span> <span class="attr">mark:building</span>=<span class="string">&quot;&#123;&#123;item + 1&#125;&#125; &#123;&#123;type&#125;&#125;&quot;</span> <span class="attr">bind:tap</span>=<span class="string">&quot;goRoom&quot;</span> <span class="attr">is-link</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">van-cell-group</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">authorization</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ğŸ¤” æç¤º: <code>van-cell</code> ç»„ä»¶æœ¬èº«æ”¯æŒé¡µé¢è·³è½¬ï¼Œä¸ºå…¶æŒ‡å®šä¸€ä¸ª url å±æ€§å³å¯ï¼Œä½†æ˜¯æœ¬èŠ‚ä¸­å’±ä»¬ç›‘å¬ç‚¹å‡»äº‹ä»¶é€šè¿‡ wx.navigateTo å®ç°è·³è½¬ï¼Œè¿™æ ·åšçš„ç›®çš„æ˜¯è®²è§£ä¸€ä¸ª <code>mark:*=&quot;xxx&quot;</code> çš„åº”ç”¨ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Page(&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="function"><span class="title">goRoom</span>(<span class="params">ev</span>)</span> &#123;</span><br><span class="line">        <span class="comment">// è·³è½¬åˆ°é€‰æ‹©æˆ¿é—´é¡µé¢</span></span><br><span class="line">        wx.navigateTo(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">`/house_pkg/pages/room/index?point=<span class="subst">$&#123;<span class="built_in">this</span>.data.point&#125;</span>&amp;building=<span class="subst">$&#123;ev.mark.building&#125;</span>`</span>,</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>éšæœºè‹¥å¹²ä¸ªæˆ¿é—´ï¼Œ<code>house_pkg/pages/room/index.js</code>ã€‚</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">Page(&#123;</span><br><span class="line">    <span class="attr">data</span>: &#123;</span><br><span class="line">        <span class="attr">point</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="attr">building</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="attr">rooms</span>: []</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="title">onLoad</span>(<span class="params">&#123;</span></span></span><br><span class="line"><span class="params"><span class="function">        point,</span></span></span><br><span class="line"><span class="params"><span class="function">        building</span></span></span><br><span class="line"><span class="params"><span class="function">    &#125;</span>)</span> &#123;</span><br><span class="line">        <span class="comment">// ä¼ªé€ æˆ¿é—´æ•°æ®</span></span><br><span class="line">        <span class="built_in">this</span>.fake(<span class="built_in">decodeURIComponent</span>(point), <span class="built_in">decodeURIComponent</span>(building))</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="title">fake</span>(<span class="params">point, building</span>)</span> &#123;</span><br><span class="line">        <span class="comment">// 4 ~ 8</span></span><br><span class="line">        <span class="comment">// è¡¨ç¤ºæˆ¿é—´æ•°é‡</span></span><br><span class="line">        <span class="keyword">const</span> size = wx.utils.getRandomIntInclusive(<span class="number">4</span>, <span class="number">8</span>)</span><br><span class="line">        <span class="keyword">const</span> rooms = []</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; size; i++) &#123;</span><br><span class="line">            <span class="comment">// éšæœºæ¥¼å±‚å·</span></span><br><span class="line">            <span class="keyword">const</span> floor = wx.utils.getRandomIntInclusive(<span class="number">1</span>, <span class="number">20</span>)</span><br><span class="line">            <span class="comment">// éšæœºæˆ¿é—´å·</span></span><br><span class="line">            <span class="keyword">const</span> No = wx.utils.getRandomIntInclusive(<span class="number">1</span>, <span class="number">3</span>)</span><br><span class="line">            <span class="comment">// ç»„åˆæ¥¼å±‚å’Œæˆ¿é—´å·</span></span><br><span class="line">            <span class="keyword">const</span> room = [floor, <span class="number">0</span>, No].join(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">            <span class="comment">// ä¸å…è®¸é‡å¤çš„æˆ¿é—´å·</span></span><br><span class="line">            <span class="keyword">if</span> (rooms.includes(room)) <span class="keyword">continue</span></span><br><span class="line">            <span class="comment">// è®°å½•æˆ¿é—´å·</span></span><br><span class="line">            rooms.push(room)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">            point, <span class="comment">// å°åŒº</span></span><br><span class="line">            building, <span class="comment">// &quot;x å·æ¥¼&quot; or &quot;x æ ‹&quot;</span></span><br><span class="line">            rooms <span class="comment">// æˆ¿é—´å·</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>æ¸²æŸ“éšæœºç”Ÿæˆçš„æ•°æ®åˆ°é¡µé¢å½“ä¸­ï¼Œ<code>house_pkg/pages/room/index.wxml</code>ã€‚</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">authorization</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;room&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">van-cell-group</span> <span class="attr">border</span>=<span class="string">&quot;&#123;&#123;false&#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">wx:for</span>=<span class="string">&quot;&#123;&#123;rooms&#125;&#125;&quot;</span> <span class="attr">wx:key</span>=<span class="string">&quot;*this&quot;</span> <span class="attr">title</span>=<span class="string">&quot;&#123;&#123;point&#125;&#125; &#123;&#123;building&#125;&#125; &#123;&#123;item&#125;&#125;&quot;</span> <span class="attr">mark:room</span>=<span class="string">&quot;&#123;&#123;item&#125;&#125;&quot;</span> <span class="attr">bind:tap</span>=<span class="string">&quot;goForm&quot;</span> <span class="attr">is-link</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">van-cell-group</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">authorization</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="4">
<li>æ¥ä¸‹æ¥å°†è¿™äº›ä¿¡æ¯åšä¸ºåœ°å€å‚æ•°ä¼ é€’åˆ°ä¸‹ä¸€ä¸ªè¡¨å•é¡µé¢ï¼Œç»§ç»­å®Œå–„æˆ¿å±‹çš„å…·ä½“ä¿¡æ¯ï¼Œå¦‚ä¸šä¸»å§“åã€æ‰‹æœºå·ç­‰ã€‚</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// house_pkg/pages/room/index.js</span></span><br><span class="line">Page(&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="function"><span class="title">goForm</span>(<span class="params">ev</span>)</span> &#123;</span><br><span class="line">        <span class="comment">// è·å–å°åŒºå’Œæ¥¼æ ‹ä¿¡æ¯</span></span><br><span class="line">        <span class="keyword">const</span> &#123;</span><br><span class="line">            point,</span><br><span class="line">            building</span><br><span class="line">        &#125; = <span class="built_in">this</span>.data</span><br><span class="line">        wx.navigateTo(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">`/house_pkg/pages/form/index?point=<span class="subst">$&#123;point&#125;</span>&amp;building=<span class="subst">$&#123;building&#125;</span>&amp;room=<span class="subst">$&#123;ev.mark.room&#125;</span>`</span>,</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="æ·»åŠ æˆ¿å±‹-1"><a href="#æ·»åŠ æˆ¿å±‹-1" class="headerlink" title="æ·»åŠ æˆ¿å±‹"></a>æ·»åŠ æˆ¿å±‹</h4><ol>
<li>è·å–åœ°å€å‚æ•°ï¼Œ<code>house_pkg/pages/form/index.js</code>ã€‚</li>
</ol>
<p>é€šè¿‡åœ°å€å‚æ•°ä¼ é€’äº†å°åŒºåã€æ¥¼æ ‹å·å’Œæˆ¿é—´å·ç­‰ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯ä¸ä»…è¦å±•ç¤ºåœ¨é¡µé¢å½“ä¸­ï¼Œåœ¨æäº¤æ•°æ®æ—¶ä¹Ÿéœ€è¦å‘é€åˆ°æœåŠ¡ç«¯ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Page(&#123;</span><br><span class="line">    <span class="attr">data</span>: &#123;&#125;,</span><br><span class="line">    <span class="function"><span class="title">onLoad</span>(<span class="params">&#123;</span></span></span><br><span class="line"><span class="params"><span class="function">        point,</span></span></span><br><span class="line"><span class="params"><span class="function">        building,</span></span></span><br><span class="line"><span class="params"><span class="function">        room</span></span></span><br><span class="line"><span class="params"><span class="function">    &#125;</span>)</span> &#123;</span><br><span class="line">        <span class="comment">// è·å–å¹¶è®°å½•åœ°å€å‚æ•°</span></span><br><span class="line">        <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">            point,</span><br><span class="line">            building,</span><br><span class="line">            room</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>å°†è·å–çš„å°åŒºåã€æ¥¼æ ‹å·å’Œæˆ¿é—´å·ç­‰ä¿¡æ¯å±•ç¤ºåˆ°é¡µé¢å½“ä¸­ï¼Œ<code>house_pkg/pages/from/index.wxml</code>ã€‚</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">authorization</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scroll-view</span> <span class="attr">enhanced</span> <span class="attr">show-scrollbar</span>=<span class="string">&quot;&#123;&#123;false&#125;&#125;&quot;</span> <span class="attr">scroll-y</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;form&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">van-cell-group</span> <span class="attr">border</span>=<span class="string">&quot;&#123;&#123;false&#125;&#125;&quot;</span> <span class="attr">title</span>=<span class="string">&quot;æˆ¿å±‹ä¿¡æ¯&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title</span>=<span class="string">&quot;&#123;&#123;point&#125;&#125; &#123;&#123;building&#125;&#125; &#123;&#123;room&#125;&#125;&quot;</span> <span class="attr">border</span>=<span class="string">&quot;&#123;&#123;false&#125;&#125;&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">van-cell-group</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- ... --&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">scroll-view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">authorization</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>è¡¨å•æ•°æ®æ ¡éªŒã€‚</li>
</ol>
<p>ç”¨ <code>model:value</code> åˆ†åˆ«è·å–ä¸šä¸»å§“åã€ä¸šä¸»æ€§åˆ«ã€ä¸šä¸»æ‰‹æœºå·æ•°æ®ï¼Œ <code>house_pkg/pages/form/index.wxml</code> ã€‚</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">scroll-view</span> <span class="attr">enhanced</span> <span class="attr">show-scrollbar</span>=<span class="string">&quot;&#123;&#123;false&#125;&#125;&quot;</span> <span class="attr">scroll-y</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;form&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">van-cell-group</span> <span class="attr">border</span>=<span class="string">&quot;&#123;&#123;false&#125;&#125;&quot;</span> <span class="attr">title</span>=<span class="string">&quot;æˆ¿å±‹ä¿¡æ¯&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title</span>=<span class="string">&quot;&#123;&#123;point&#125;&#125; &#123;&#123;building&#125;&#125; &#123;&#123;room&#125;&#125;&quot;</span> <span class="attr">border</span>=<span class="string">&quot;&#123;&#123;false&#125;&#125;&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">van-cell-group</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">van-cell-group</span> <span class="attr">border</span>=<span class="string">&quot;&#123;&#123;false&#125;&#125;&quot;</span> <span class="attr">title</span>=<span class="string">&quot;ä¸šä¸»ä¿¡æ¯&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- #1 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">van-field</span> <span class="attr">model:value</span>=<span class="string">&quot;&#123;&#123;name&#125;&#125;&quot;</span> <span class="attr">label</span>=<span class="string">&quot;å§“å&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;è¯·å¡«å†™æ‚¨çš„çœŸå®å§“å&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title-width</span>=<span class="string">&quot;200rpx&quot;</span> <span class="attr">title</span>=<span class="string">&quot;æ€§åˆ«&quot;</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- #2 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">van-radio-group</span> <span class="attr">direction</span>=<span class="string">&quot;horizontal&quot;</span> <span class="attr">model:value</span>=<span class="string">&quot;&#123;&#123; gender &#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!-- #3 --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">van-radio</span> <span class="attr">icon-size</span>=<span class="string">&quot;36rpx&quot;</span> <span class="attr">checked-color</span>=<span class="string">&quot;#5591AF&quot;</span> <span class="attr">name</span>=<span class="string">&quot;&#123;&#123;1&#125;&#125;&quot;</span>&gt;</span>ç”·<span class="tag">&lt;/<span class="name">van-radio</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!-- #4 --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">van-radio</span> <span class="attr">icon-size</span>=<span class="string">&quot;36rpx&quot;</span> <span class="attr">checked-color</span>=<span class="string">&quot;#5591AF&quot;</span> <span class="attr">name</span>=<span class="string">&quot;&#123;&#123;0&#125;&#125;&quot;</span>&gt;</span>å¥³<span class="tag">&lt;/<span class="name">van-radio</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">van-radio-group</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">van-cell</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- #5 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">van-field</span> <span class="attr">model:value</span>=<span class="string">&quot;&#123;&#123;mobile&#125;&#125;&quot;</span> <span class="attr">label</span>=<span class="string">&quot;æ‰‹æœºå·&quot;</span> <span class="attr">type</span>=<span class="string">&quot;number&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;è¯·è¾“å…¥æ‚¨çš„æ‰‹æœºå·&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">van-cell-group</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;id-card-upload&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title</span>=<span class="string">&quot;æœ¬äººèº«ä»½è¯ç…§ç‰‡&quot;</span> <span class="attr">label</span>=<span class="string">&quot;è¯·æ‹æ‘„è¯ä»¶åŸä»¶ï¼Œå¹¶ä½¿ç…§ç‰‡ä¸­è¯ä»¶è¾¹ç¼˜å®Œæ•´ï¼Œæ–‡å­—æ¸…æ™°ï¼Œå…‰çº¿å‡åŒ€ã€‚&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;id-card-front&quot;</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- #6 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;image-preview&quot;</span> <span class="attr">wx:if</span>=<span class="string">&quot;&#123;&#123;idcardFrontUrl&#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;image-remove&quot;</span> <span class="attr">mark:type</span>=<span class="string">&quot;idcardFrontUrl&quot;</span> <span class="attr">bind:tap</span>=<span class="string">&quot;removePicture&quot;</span>&gt;</span>x<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">image</span> <span class="attr">src</span>=<span class="string">&quot;&#123;&#123;idcardFrontUrl&#125;&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;upload-button&quot;</span> <span class="attr">wx:else</span>&gt;</span><span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;enjoy-icon icon-add&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">text</span>&gt;</span>ä¸Šä¼ äººåƒé¢ç…§ç‰‡<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;id-card-back&quot;</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- #7 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;image-preview&quot;</span> <span class="attr">wx:if</span>=<span class="string">&quot;&#123;&#123;idcardBackUrl&#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;image-remove&quot;</span> <span class="attr">mark:type</span>=<span class="string">&quot;idcardBackUrl&quot;</span> <span class="attr">bind:tap</span>=<span class="string">&quot;removePicture&quot;</span>&gt;</span>x<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">image</span> <span class="attr">src</span>=<span class="string">&quot;&#123;&#123;idcardBackUrl&#125;&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;upload-button&quot;</span> <span class="attr">wx:else</span>&gt;</span><span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;enjoy-icon icon-add&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">text</span>&gt;</span>ä¸Šä¼ å›½å¾½é¢ç…§ç‰‡<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">scroll-view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;toolbar&quot;</span> <span class="attr">bind:tap</span>=<span class="string">&quot;goList&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;enjoy-icon icon-check&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;button-text&quot;</span>&gt;</span>æäº¤å®¡æ ¸<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p> <code>house_pkg/pages/form/index.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">Page(&#123;</span><br><span class="line">    <span class="attr">data</span>: &#123;</span><br><span class="line">        <span class="attr">gender</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="attr">mobile</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="attr">idcardFrontUrl</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="attr">idcardBackUrl</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="title">onLoad</span>(<span class="params">&#123;</span></span></span><br><span class="line"><span class="params"><span class="function">        point,</span></span></span><br><span class="line"><span class="params"><span class="function">        building,</span></span></span><br><span class="line"><span class="params"><span class="function">        room</span></span></span><br><span class="line"><span class="params"><span class="function">    &#125;</span>)</span> &#123;</span><br><span class="line">        <span class="comment">// è·å–å¹¶è®°å½•åœ°å€å‚æ•°</span></span><br><span class="line">        <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">            point,</span><br><span class="line">            building,</span><br><span class="line">            room</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// éªŒè¯ä¸šä¸»å§“å</span></span><br><span class="line">    <span class="function"><span class="title">verifyName</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// éªŒè¯ä¸šä¸»å§“åï¼ˆå¿…é¡»ä¸ºæ±‰å­—ï¼‰</span></span><br><span class="line">        <span class="keyword">const</span> reg = <span class="regexp">/^[\u4e00-\u9fa5]&#123;2,5&#125;$/</span></span><br><span class="line">        <span class="comment">// éªŒè¯ä¸šä¸»å§“å</span></span><br><span class="line">        <span class="keyword">const</span> valid = reg.test(<span class="built_in">this</span>.data.name.trim())</span><br><span class="line">        <span class="comment">// éªŒè¯ç»“æœæç¤º</span></span><br><span class="line">        <span class="keyword">if</span> (!valid) wx.utils.toast(<span class="string">&#x27;è¯·å¡«å†™çœŸå®ä¸­æ–‡å§“å!&#x27;</span>)</span><br><span class="line">        <span class="comment">// è¿”å›éªŒè¯ç»“æœ</span></span><br><span class="line">        <span class="keyword">return</span> valid</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="title">verifyMobile</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// éªŒè¯æ‰‹æœºå·</span></span><br><span class="line">        <span class="keyword">const</span> reg = <span class="regexp">/^[1][3-8][0-9]&#123;9&#125;$/</span></span><br><span class="line">        <span class="keyword">const</span> valid = reg.test(<span class="built_in">this</span>.data.mobile)</span><br><span class="line">        <span class="comment">// éªŒè¯ç»“æœæç¤º</span></span><br><span class="line">        <span class="keyword">if</span> (!valid) wx.utils.toast(<span class="string">&#x27;è¯·å¡«å†™æ­£ç¡®çš„æ‰‹æœºå·ç !&#x27;</span>)</span><br><span class="line">        <span class="comment">// è¿”å›éªŒè¯ç»“æœ</span></span><br><span class="line">        <span class="keyword">return</span> valid</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="title">verifyPicture</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// å›¾ç‰‡åœ°å€ä¸èƒ½ä¸ºç©º</span></span><br><span class="line">        <span class="keyword">const</span> valid = !!<span class="built_in">this</span>.data.idcardBackUrl &amp;&amp; !!<span class="built_in">this</span>.data.idcardFrontUrl</span><br><span class="line">        <span class="comment">// éªŒè¯ç»“æœæç¤º</span></span><br><span class="line">        <span class="keyword">if</span> (!valid) wx.utils.toast(<span class="string">&#x27;è¯·ä¸Šä¼ èº«ä»½è¯ç…§ç‰‡!&#x27;</span>)</span><br><span class="line">        <span class="comment">// è¿”å›éªŒè¯ç»“æœ</span></span><br><span class="line">        <span class="keyword">return</span> valid</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>ç‚¹å‡»æäº¤å®¡æ ¸æŒ‰é’®åéªŒè¯è¡¨å•çš„æ•°æ®ã€‚</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- house_pkg/pages/form/index.wxml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">authorization</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scroll-view</span> <span class="attr">enhanced</span> <span class="attr">show-scrollbar</span>=<span class="string">&quot;&#123;&#123;false&#125;&#125;&quot;</span> <span class="attr">scroll-y</span>&gt;</span></span><br><span class="line">        ...</span><br><span class="line">    <span class="tag">&lt;/<span class="name">scroll-view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;toolbar&quot;</span> <span class="attr">bind:tap</span>=<span class="string">&quot;submitForm&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;enjoy-icon icon-check&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;button-text&quot;</span>&gt;</span>æäº¤å®¡æ ¸<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">authorization</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// house_pkg/pages/form/index.js</span></span><br><span class="line">Page(&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="title">submitForm</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// é€ä¸ªéªŒè¯è¡¨å•çš„æ•°æ®</span></span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">this</span>.verifyName()) <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">this</span>.verifyMobile()) <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">this</span>.verifyPicture()) <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>ä¸Šä¼ èº«ä»½è¯ç…§ç‰‡ï¼ˆè®²è§£å·²æœ‰çš„ä»£ç äº¤äº’ï¼‰ã€‚</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- house_pkg/pages/form/index.wxml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;id-card-upload&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title</span>=<span class="string">&quot;æœ¬äººèº«ä»½è¯ç…§ç‰‡&quot;</span> <span class="attr">label</span>=<span class="string">&quot;è¯·æ‹æ‘„è¯ä»¶åŸä»¶ï¼Œå¹¶ä½¿ç…§ç‰‡ä¸­è¯ä»¶è¾¹ç¼˜å®Œæ•´ï¼Œæ–‡å­—æ¸…æ™°ï¼Œå…‰çº¿å‡åŒ€ã€‚&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;id-card-front&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- å¦‚æœå­˜åœ¨å›¾ç‰‡åœ°å€å°±æ˜¾ç¤ºèº«ä»½è¯æ­£é¢ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;image-preview&quot;</span> <span class="attr">wx:if</span>=<span class="string">&quot;&#123;&#123;idcardFrontUrl&#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- åˆ é™¤åŠŸèƒ½ --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;image-remove&quot;</span> <span class="attr">mark:type</span>=<span class="string">&quot;idcardFrontUrl&quot;</span> <span class="attr">bind:tap</span>=<span class="string">&quot;removePicture&quot;</span>&gt;</span>x<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">image</span> <span class="attr">src</span>=<span class="string">&quot;&#123;&#123;idcardFrontUrl&#125;&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- å¦åˆ™æ˜¾ç¤ºä¸Šä¼ æŒ‰é’® --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;upload-button&quot;</span> <span class="attr">wx:else</span>&gt;</span><span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;enjoy-icon icon-add&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">text</span>&gt;</span>ä¸Šä¼ äººåƒé¢ç…§ç‰‡<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;id-card-back&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- å¦‚æœå­˜åœ¨å›¾ç‰‡åœ°å€å°±æ˜¾ç¤ºèº«ä»½è¯åé¢ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;image-preview&quot;</span> <span class="attr">wx:if</span>=<span class="string">&quot;&#123;&#123;idcardBackUrl&#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- åˆ é™¤åŠŸèƒ½ --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;image-remove&quot;</span> <span class="attr">mark:type</span>=<span class="string">&quot;idcardBackUrl&quot;</span> <span class="attr">bind:tap</span>=<span class="string">&quot;removePicture&quot;</span>&gt;</span>x<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">image</span> <span class="attr">src</span>=<span class="string">&quot;&#123;&#123;idcardBackUrl&#125;&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- å¦åˆ™æ˜¾ç¤ºä¸Šä¼ æŒ‰é’® --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;upload-button&quot;</span> <span class="attr">wx:else</span>&gt;</span><span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;enjoy-icon icon-add&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">text</span>&gt;</span>ä¸Šä¼ å›½å¾½é¢ç…§ç‰‡<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>åˆ é™¤åŠŸèƒ½çš„ä»£ç ï¼Œ <code>house_pkg/pages/form/index.js</code> ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Page(&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="function"><span class="title">removePicture</span>(<span class="params">ev</span>)</span> &#123;</span><br><span class="line">        <span class="comment">// ç§»é™¤å›¾ç‰‡çš„ç±»å‹ï¼ˆèº«ä»½è¯æ­£é¢æˆ–åé¢ï¼‰</span></span><br><span class="line">        <span class="keyword">const</span> type = ev.mark.type</span><br><span class="line">        <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">            [type]: <span class="string">&#x27;&#x27;</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ol start="6">
<li>æ¥ä¸‹æ¥ä¸ºä¸Šä¼ æŒ‰é’®æ·»åŠ ç‚¹å‡»äº‹ä»¶ã€‚</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- house_pkg/pages/from/index.wxml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;id-card-upload&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title</span>=<span class="string">&quot;æœ¬äººèº«ä»½è¯ç…§ç‰‡&quot;</span> <span class="attr">label</span>=<span class="string">&quot;è¯·æ‹æ‘„è¯ä»¶åŸä»¶ï¼Œå¹¶ä½¿ç…§ç‰‡ä¸­è¯ä»¶è¾¹ç¼˜å®Œæ•´ï¼Œæ–‡å­—æ¸…æ™°ï¼Œå…‰çº¿å‡åŒ€ã€‚&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;id-card-front&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;image-preview&quot;</span> <span class="attr">wx:if</span>=<span class="string">&quot;&#123;&#123;idcardFrontUrl&#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;image-remove&quot;</span> <span class="attr">mark:type</span>=<span class="string">&quot;idcardFrontUrl&quot;</span> <span class="attr">bind:tap</span>=<span class="string">&quot;removePicture&quot;</span>&gt;</span>x<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">image</span> <span class="attr">src</span>=<span class="string">&quot;&#123;&#123;idcardFrontUrl&#125;&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">wx:else</span> <span class="attr">class</span>=<span class="string">&quot;upload-button&quot;</span> <span class="attr">bind:tap</span>=<span class="string">&quot;uploadPicture&quot;</span> <span class="attr">mark:type</span>=<span class="string">&quot;idcardFrontUrl&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;enjoy-icon icon-add&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">text</span>&gt;</span>ä¸Šä¼ äººåƒé¢ç…§ç‰‡</span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;id-card-back&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;image-preview&quot;</span> <span class="attr">wx:if</span>=<span class="string">&quot;&#123;&#123;idcardBackUrl&#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;image-remove&quot;</span> <span class="attr">mark:type</span>=<span class="string">&quot;idcardBackUrl&quot;</span> <span class="attr">bind:tap</span>=<span class="string">&quot;removePicture&quot;</span>&gt;</span>x<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">image</span> <span class="attr">src</span>=<span class="string">&quot;&#123;&#123;idcardBackUrl&#125;&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">wx:else</span> <span class="attr">class</span>=<span class="string">&quot;upload-button&quot;</span> <span class="attr">bind:tap</span>=<span class="string">&quot;uploadPicture&quot;</span> <span class="attr">mark:type</span>=<span class="string">&quot;idcardBackUrl&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;enjoy-icon icon-add&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">text</span>&gt;</span>ä¸Šä¼ å›½å¾½é¢ç…§ç‰‡</span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>é€šè¿‡ <code>mark:type=&quot;idcardFrontUrl&quot;</code> å’Œ <code>mark:type=&quot;idcardBackUrl&quot;</code> æ¥åŒºåˆ†ç”¨æˆ·ç‚¹å‡»çš„æ˜¯ä¸Šä¼ èº«ä»½è¯æ­£é¢è¿˜æ˜¯èº«ä»½è¯çš„åé¢ï¼Œå…¶ä¸­ã€‚</p>
<ul>
<li><p>idcardFrontUrl è¡¨ç¤ºèº«ä»½è¯çš„æ­£é¢ã€‚</p>
</li>
<li><p>idcardBackUrl è¡¨ç¤ºèº«ä»½è¯çš„åé¢ã€‚</p>
</li>
</ul>
<p>åœ¨ä¸Šä¼ å›¾ç‰‡ä¹‹å‰å†æ¥ä»‹ç»å°ç¨‹åºçš„ä¸€ä¸ª API <a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/api/media/video/wx.chooseMedia.html">wx.chooseMedia()</a>ï¼Œé€šè¿‡è¿™ä¸ª API ç”¨æˆ·å¯ä»¥æ‰“å¼€ç›¸æœºæ‹ç…§æˆ–ä»æœºå†Œä¸­é€‰æ‹©å›¾ç‰‡ï¼Œå…¶è¯­æ³•æ ¼å¼å¦‚ä¸‹æ‰€ç¤ºã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">wx.chooseMedia(&#123;</span><br><span class="line">    <span class="attr">count</span>: <span class="number">1</span>, <span class="comment">// åªèƒ½é€‰æ‹©1å¼ å›¾ç‰‡</span></span><br><span class="line">    <span class="attr">mediaType</span>: [<span class="string">&#x27;image&#x27;</span>], <span class="comment">// åªèƒ½é€‰æ‹©å›¾ç‰‡ç±»å‹</span></span><br><span class="line">    <span class="attr">sizeType</span>: [<span class="string">&#x27;compressed&#x27;</span>], <span class="comment">// é»˜è®¤ä¸ºå‹ç¼©æ¨¡å¼</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ol start="7">
<li>ç”¨æˆ·æ‹ç…§æˆ–ä»æœºå†Œä¸­é€‰æ‹©ä¸€å¼ å›¾ç‰‡åå°†è¿™å¼ ç…§ç‰‡ä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼Œæ¥å£ä¿¡æ¯å¦‚ä¸‹æ‰€ç¤ºã€‚</li>
</ol>
<ul>
<li><p>æ¥å£è·¯å¾„ï¼š<code>/upload</code>ã€‚</p>
</li>
<li><p>è¯·æ±‚æ–¹æ³•: POSTã€‚</p>
</li>
<li><p>è¯·æ±‚å‚æ•°ï¼š</p>
<ul>
<li><p>file åç«¯æ¥æ”¶ä¸Šä¼ æ–‡ä»¶çš„åç§°ã€‚</p>
</li>
<li><p>type åªæœ‰ä¸Šä¼ å¤´åƒæ—¶æ‰éœ€è¦ä¼ è¯¥å‚æ•°ã€‚</p>
</li>
</ul>
</li>
<li><p>Headersï¼š</p>
<ul>
<li>Authorizationã€‚</li>
</ul>
</li>
<li><p>å“åº”æ•°æ®ï¼š<a target="_blank" rel="noopener" href="https://www.apifox.cn/apidoc/shared-8d66c345-7a9a-4844-9a5a-1201852f6faa/api-42672275">è§æ–‡æ¡£</a>ã€‚</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// house_pkg/pages/form/index.js</span></span><br><span class="line">Page(&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="title">uploadPicture</span>(<span class="params">ev</span>)</span> &#123;</span><br><span class="line">        <span class="comment">// ä¸Šä¼ èº«ä»½è¯ç…§ç‰‡çš„ç±»åˆ«</span></span><br><span class="line">        <span class="keyword">const</span> type = ev.mark.type</span><br><span class="line">        <span class="comment">// é€‰æ‹©å›¾ç‰‡</span></span><br><span class="line">        <span class="keyword">const</span> media = <span class="keyword">await</span> wx.chooseMedia(&#123;</span><br><span class="line">            <span class="attr">count</span>: <span class="number">1</span>,</span><br><span class="line">            <span class="attr">mediaType</span>: [<span class="string">&#x27;image&#x27;</span>],</span><br><span class="line">            <span class="attr">sizeType</span>: [<span class="string">&#x27;compressed&#x27;</span>],</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è°ƒç”¨æ¥å£ä¸Šä¼ å›¾ç‰‡</span></span><br><span class="line">        wx.uploadFile(&#123;</span><br><span class="line">            <span class="attr">url</span>: wx.http.baseURL + <span class="string">&#x27;/upload&#x27;</span>,</span><br><span class="line">            <span class="attr">filePath</span>: media.tempFiles[<span class="number">0</span>].tempFilePath,</span><br><span class="line">            <span class="attr">name</span>: <span class="string">&#x27;file&#x27;</span>,</span><br><span class="line">            <span class="attr">header</span>: &#123;</span><br><span class="line">                <span class="attr">Authorization</span>: getApp().token,</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">success</span>: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="comment">// è½¬æ¢ json æ•°æ®</span></span><br><span class="line">                <span class="keyword">const</span> data = <span class="built_in">JSON</span>.parse(res.data)</span><br><span class="line">                <span class="comment">// æ£€æµ‹æ¥å£è°ƒç”¨ç»“æœ</span></span><br><span class="line">                <span class="keyword">if</span> (data.code !== <span class="number">10000</span>) <span class="keyword">return</span> wx.utils.toast(<span class="string">&#x27;ä¸Šä¼ å›¾ç‰‡å¤±è´¥!&#x27;</span>)</span><br><span class="line"></span><br><span class="line">                <span class="comment">// ä¿å­˜å¹¶é¢„è§ˆå›¾ç‰‡åœ°å€</span></span><br><span class="line">                <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">                    [type]: data.data.url,</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ol start="8">
<li>è°ƒç”¨æ¥å£å°†è¡¨å•æ•°æ®æäº¤ç»™æœåŠ¡ç«¯ã€‚</li>
</ol>
<ul>
<li><p>æ¥å£è·¯å¾„ï¼š<code>/room</code>ã€‚</p>
</li>
<li><p>è¯·æ±‚æ–¹æ³•: POSTã€‚</p>
</li>
<li><p>è¯·æ±‚å‚æ•°ï¼š</p>
<ul>
<li><p>point å°åŒºçš„åç§°ï¼Œå¦‚è‚²æ–°èŠ±å›­ã€‚</p>
</li>
<li><p>building æ¥¼æ ‹å·ï¼Œå¦‚ 5å·æ¥¼ã€‚</p>
</li>
<li><p>room æˆ¿é—´å·ï¼Œå¦‚ 302ã€‚</p>
</li>
<li><p>name ä¸šä¸»å§“åã€‚</p>
</li>
<li><p>gender æ€§åˆ«ï¼Œ0 è¡¨ç¤ºå¥³ï¼Œ1 è¡¨ç¤ºç”·ã€‚</p>
</li>
<li><p>mobile ä¸šä¸»æ‰‹æœºå·ã€‚</p>
</li>
<li><p>idcardFrontUrl èº«ä»½è¯æ­£é¢ã€‚</p>
</li>
<li><p>idcardBackUrl èº«ä»½è¯åé¢ã€‚</p>
</li>
</ul>
</li>
<li><p>Headersï¼š</p>
<ul>
<li>Authorizationã€‚</li>
</ul>
</li>
<li><p>å“åº”æ•°æ®ï¼š<a target="_blank" rel="noopener" href="https://www.apifox.cn/apidoc/shared-8d66c345-7a9a-4844-9a5a-1201852f6faa/api-41400753">è§æ–‡æ¡£</a>ã€‚</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// house_pkg/pages/form/index.wxml</span></span><br><span class="line">Page(&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="title">submitForm</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// é€ä¸ªéªŒè¯è¡¨å•çš„æ•°æ®</span></span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">this</span>.verifyName()) <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">this</span>.verifyMobile()) <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">this</span>.verifyPicture()) <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ é™¤å°ç¨‹åºè‡ªå¸¦çš„ä¸éœ€è¦æäº¤åˆ°åç«¯çš„æ•°æ®</span></span><br><span class="line">        <span class="keyword">delete</span> <span class="built_in">this</span>.data.__webviewId__</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è¯·æ±‚æ•°æ®æ¥å£</span></span><br><span class="line">        <span class="keyword">const</span> &#123;</span><br><span class="line">            code</span><br><span class="line">        &#125; = <span class="keyword">await</span> wx.http.post(<span class="string">&#x27;/room&#x27;</span>, <span class="built_in">this</span>.data)</span><br><span class="line">        <span class="comment">// æ£€æµ‹æ¥å£è°ƒç”¨çš„ç»“æœ</span></span><br><span class="line">        <span class="keyword">if</span> (code !== <span class="number">10000</span>) <span class="keyword">return</span> wx.utils.toast(<span class="string">&#x27;æ·»åŠ æˆ¿å±‹å¤±è´¥!&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æˆåŠŸåè·³è½¬è‡³æˆ¿å±‹åˆ—è¡¨</span></span><br><span class="line">        wx.navigateBack(&#123;</span><br><span class="line">            <span class="attr">delta</span>: <span class="number">4</span>,</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>æäº¤ä»£ç ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹å½“å‰è¢«ä¿®æ”¹çš„æ–‡ä»¶</span></span><br><span class="line">git status</span><br><span class="line"><span class="comment"># æš‚å­˜æ–‡ä»¶</span></span><br><span class="line">git add .</span><br><span class="line"><span class="comment"># æäº¤åˆ°æœ¬åœ°</span></span><br><span class="line">git commit -m <span class="string">&#x27;feat(house): å®Œæˆäº†æˆ¿å±‹æ·»åŠ çš„åŠŸèƒ½&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="æˆ¿å±‹åˆ—è¡¨"><a href="#æˆ¿å±‹åˆ—è¡¨" class="headerlink" title="æˆ¿å±‹åˆ—è¡¨"></a>æˆ¿å±‹åˆ—è¡¨</h3><ol>
<li>onShow çš„æ—¶å€™ç›´æ¥è°ƒç”¨æ¥å£ã€‚</li>
</ol>
<ul>
<li><p>æ¥å£è·¯å¾„ï¼š<code>/room</code>ã€‚</p>
</li>
<li><p>è¯·æ±‚æ–¹æ³•: GETã€‚</p>
</li>
<li><p>è¯·æ±‚å‚æ•°ï¼šæ— ã€‚</p>
</li>
<li><p>Headersï¼š</p>
<ul>
<li>Authorizationã€‚</li>
</ul>
</li>
<li><p>å“åº”æ•°æ®ï¼š<a target="_blank" rel="noopener" href="https://www.apifox.cn/apidoc/shared-8d66c345-7a9a-4844-9a5a-1201852f6faa/api-41400750">è§æ–‡æ¡£</a>ã€‚</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// house_pkg/pages/list/index.js</span></span><br><span class="line">Page(&#123;</span><br><span class="line">    <span class="attr">data</span>: &#123;</span><br><span class="line">        <span class="attr">dialogVisible</span>: <span class="literal">false</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="title">onShow</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// è·å–æˆ¿å±‹åˆ—è¡¨</span></span><br><span class="line">        <span class="built_in">this</span>.getHouseList()</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="title">getHouseList</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// è¯·æ±‚æ•°æ®æ¥å£</span></span><br><span class="line">        <span class="keyword">const</span> &#123;</span><br><span class="line">            code,</span><br><span class="line">            <span class="attr">data</span>: houseList</span><br><span class="line">        &#125; = <span class="keyword">await</span> wx.http.get(<span class="string">&#x27;/room&#x27;</span>)</span><br><span class="line">        <span class="comment">// æ£€æµ‹æ¥å£è¿”å›çš„ç»“æœ</span></span><br><span class="line">        <span class="keyword">if</span> (code !== <span class="number">10000</span>) <span class="keyword">return</span> wx.utils.toast()</span><br><span class="line">        <span class="comment">// æ¸²æŸ“æ•°æ®</span></span><br><span class="line">        <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">            houseList</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>è¿”å›çš„æ•°æ®å½“ä¸­ status è¡¨ç¤ºå½“å‰æˆ¿å±‹çš„å®¡æ ¸çŠ¶æ€ã€‚</p>
<ul>
<li><p>å€¼ä¸º 1 è¡¨ç¤ºæ­£åœ¨å®¡æ ¸ã€‚</p>
</li>
<li><p>å€¼ä¸º 2 è¡¨ç¤ºå®¡æ ¸æˆåŠŸã€‚</p>
</li>
<li><p>å€¼ä¸º 3 è¡¨ç¤ºå®¡æ ¸å¤±è´¥ã€‚</p>
</li>
</ul>
<ol start="2">
<li>æ¸²æŸ“æˆ¿å±‹åˆ—è¡¨ï¼Œ<code>house_pkg/pages/list/index.wxml</code>ã€‚</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">authorization</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">block</span> <span class="attr">wx:if</span>=<span class="string">&quot;&#123;&#123;true&#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scroll-view</span> <span class="attr">show-scrollbar</span>=<span class="string">&quot;&#123;&#123;false&#125;&#125;&quot;</span> <span class="attr">enhanced</span> <span class="attr">scroll-y</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;houses&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;houses-title&quot;</span>&gt;</span>æˆ¿å±‹ä¿¡æ¯<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;houses-list&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">van-swipe-cell</span> <span class="attr">wx:for</span>=<span class="string">&quot;&#123;&#123;houseList&#125;&#125;&quot;</span> <span class="attr">wx:key</span>=<span class="string">&quot;id&quot;</span> <span class="attr">async-close</span> <span class="attr">bind:close</span>=<span class="string">&quot;swipeClose&quot;</span> <span class="attr">right-width</span>=<span class="string">&quot;&#123;&#123; 70 &#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">van-cell-group</span> <span class="attr">bind:tap</span>=<span class="string">&quot;goDetail&quot;</span> <span class="attr">border</span>=<span class="string">&quot;&#123;&#123;false&#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">size</span>=<span class="string">&quot;large&quot;</span> <span class="attr">title</span>=<span class="string">&quot;&#123;&#123;item.point&#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;tag info&quot;</span> <span class="attr">wx:if</span>=<span class="string">&quot;&#123;&#123;item.status === 1&#125;&#125;&quot;</span>&gt;</span>æ­£åœ¨å®¡æ ¸<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;tag success&quot;</span> <span class="attr">wx:if</span>=<span class="string">&quot;&#123;&#123;item.status === 2&#125;&#125;&quot;</span>&gt;</span>å®¡æ ¸é€šè¿‡<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;tag fail&quot;</span> <span class="attr">wx:if</span>=<span class="string">&quot;&#123;&#123;item.status === 3&#125;&#125;&quot;</span>&gt;</span>å®¡æ ¸å¤±è´¥<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">van-cell</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title</span>=<span class="string">&quot;æˆ¿é—´å·&quot;</span> <span class="attr">border</span>=<span class="string">&quot;&#123;&#123;false&#125;&#125;&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&#123;&#123;item.building&#125;&#125;&#123;&#123;item.room&#125;&#125;&quot;</span> /&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title</span>=<span class="string">&quot;ä¸šä¸»&quot;</span> <span class="attr">border</span>=<span class="string">&quot;&#123;&#123;false&#125;&#125;&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&#123;&#123;item.name&#125;&#125;&quot;</span> /&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">van-cell-group</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">view</span> <span class="attr">slot</span>=<span class="string">&quot;right&quot;</span>&gt;</span>åˆ é™¤<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">van-swipe-cell</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">scroll-view</span>&gt;</span></span><br><span class="line">        ...</span><br><span class="line">    <span class="tag">&lt;/<span class="name">block</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">authorization</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>ä¸ºäº†æ–¹ä¾¿å¼€å‘æµ‹è¯•ï¼Œåç«¯æä¾›äº†ä¸€ä¸ªæ¥å£ä¸“é—¨ç”¨æ¥ä¿®æ”¹æˆ¿å±‹<a target="_blank" rel="noopener" href="https://www.apifox.cn/apidoc/shared-8d66c345-7a9a-4844-9a5a-1201852f6faa/api-42672273">å®¡æ ¸çŠ¶æ€çš„æ¥å£</a>ï¼Œç›´æ¥åœ¨ apifox åœ¨çº¿è°ƒç”¨æ¥å£å³å¯ã€‚</li>
</ol>
<p>æäº¤ä»£ç ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹å½“å‰è¢«ä¿®æ”¹çš„æ–‡ä»¶</span></span><br><span class="line">git status</span><br><span class="line"><span class="comment"># æš‚å­˜æ–‡ä»¶</span></span><br><span class="line">git add .</span><br><span class="line"><span class="comment"># æäº¤åˆ°æœ¬åœ°</span></span><br><span class="line">git commit -m <span class="string">&#x27;feat(house): å®ŒæˆæŸ¥è¯¢æˆ¿åˆ°åˆ—è¡¨&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="åˆ é™¤æˆ¿å±‹"><a href="#åˆ é™¤æˆ¿å±‹" class="headerlink" title="åˆ é™¤æˆ¿å±‹"></a>åˆ é™¤æˆ¿å±‹</h3><ol>
<li>å‡†å¤‡ van-dialog ç¡®è®¤æ¡†ç»„ä»¶ï¼Œè¯¥ç»„ä»¶ä½¿ç”¨æ•°æ® dialogVisible æ§åˆ¶å…¶æ˜¾ç¤ºæˆ–éšè—ã€‚</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- house_pkg/pages/list.wxml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">van-dialog</span> <span class="attr">message</span>=<span class="string">&quot;æ˜¯å¦åˆ é™¤å·²ç»‘å®šæˆ¿å±‹ï¼Ÿ&quot;</span> <span class="attr">showCancelButton</span> <span class="attr">show</span>=<span class="string">&quot;&#123;&#123;dialogVisible&#125;&#125;&quot;</span> <span class="attr">cancel-button-color</span>=<span class="string">&quot;#848484&quot;</span> <span class="attr">confirm-button-color</span>=<span class="string">&quot;#5591af&quot;</span> <span class="attr">bind:close</span>=<span class="string">&quot;dialogClose&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>ç”¨æˆ·æ»‘åŠ¨ van-swipe-cell ç»„ä»¶åç‚¹å‡»äº†ã€åˆ é™¤ã€‘æŒ‰é’®åä¼šè°ƒç”¨ swipeClose æ–¹æ³•ï¼Œç„¶åæ˜¾ç¤º van-dialog ç¡®è®¤æ¡†ç»„ä»¶ï¼Œç„¶åç”¨æˆ·ç‚¹å‡»äº† van-dialog ç¡®è®¤æ¡†ç»„ä»¶ä¸­çš„ã€ç¡®è®¤ã€‘æŒ‰é’®åä¼šè°ƒç”¨ dialogClose æ–¹æ³•ã€‚</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// house_pkg/pages/list/index.js</span></span><br><span class="line">Page(&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="function"><span class="title">swipeClose</span>(<span class="params">ev</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123;</span><br><span class="line">            position,</span><br><span class="line">            instance</span><br><span class="line">        &#125; = ev.detail</span><br><span class="line">        <span class="keyword">if</span> (position === <span class="string">&#x27;right&#x27;</span>) &#123;</span><br><span class="line">            <span class="comment">// æ˜¾ç¤º Dialog å¯¹è¯æ¡†</span></span><br><span class="line">            <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">                <span class="attr">dialogVisible</span>: <span class="literal">true</span>,</span><br><span class="line">            &#125;)</span><br><span class="line">            <span class="comment">// swiper-cell æ»‘å—å…³é—­</span></span><br><span class="line">            instance.close()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="title">dialogClose</span>(<span class="params">ev</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(ev.detail)</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>è·å–å¾…åˆ é™¤æˆ¿å±‹çš„ idï¼ˆåç«¯åˆ é™¤ï¼‰å’Œ indexï¼ˆå‰ç«¯ç”¨ï¼‰ï¼Œå¯ä»¥é€šè¿‡ mark æ¥ä¼ é€’è¿™ä¸¤ä¸ªå‚æ•°ã€‚</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- house_pkg/pages/list/index.wxml --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- ... --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">van-swipe-cell</span> <span class="attr">wx:for</span>=<span class="string">&quot;&#123;&#123;houseList&#125;&#125;&quot;</span> <span class="attr">wx:key</span>=<span class="string">&quot;id&quot;</span> <span class="attr">mark:index</span>=<span class="string">&quot;&#123;&#123;index&#125;&#125;&quot;</span> <span class="attr">mark:id</span>=<span class="string">&quot;&#123;&#123;item.id&#125;&#125;&quot;</span> <span class="attr">async-close</span> <span class="attr">bind:close</span>=<span class="string">&quot;swipeClose&quot;</span> <span class="attr">right-width</span>=<span class="string">&quot;&#123;&#123;70&#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-cell-group</span> <span class="attr">bind:tap</span>=<span class="string">&quot;goDetail&quot;</span> <span class="attr">border</span>=<span class="string">&quot;&#123;&#123;false&#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">size</span>=<span class="string">&quot;large&quot;</span> <span class="attr">title</span>=<span class="string">&quot;&#123;&#123;item.point&#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;tag info&quot;</span> <span class="attr">wx:if</span>=<span class="string">&quot;&#123;&#123;item.status === 1&#125;&#125;&quot;</span>&gt;</span>æ­£åœ¨å®¡æ ¸<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;tag success&quot;</span> <span class="attr">wx:if</span>=<span class="string">&quot;&#123;&#123;item.status === 2&#125;&#125;&quot;</span>&gt;</span>å®¡æ ¸é€šè¿‡<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;tag fail&quot;</span> <span class="attr">wx:if</span>=<span class="string">&quot;&#123;&#123;item.status === 3&#125;&#125;&quot;</span>&gt;</span>å®¡æ ¸å¤±è´¥<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">van-cell</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title</span>=<span class="string">&quot;æˆ¿é—´å·&quot;</span> <span class="attr">border</span>=<span class="string">&quot;&#123;&#123;false&#125;&#125;&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&#123;&#123;item.building&#125;&#125;&#123;&#123;item.room&#125;&#125;&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title</span>=<span class="string">&quot;ä¸šä¸»&quot;</span> <span class="attr">border</span>=<span class="string">&quot;&#123;&#123;false&#125;&#125;&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&#123;&#123;item.name&#125;&#125;&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">van-cell-group</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">slot</span>=<span class="string">&quot;right&quot;</span>&gt;</span>åˆ é™¤<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">van-swipe-cell</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- ... --&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// house_pkg/pages/list/index.js</span></span><br><span class="line"><span class="keyword">let</span> house_id = <span class="number">0</span></span><br><span class="line"><span class="keyword">let</span> house_index = <span class="number">0</span></span><br><span class="line">Page(&#123;</span><br><span class="line">    <span class="function"><span class="title">swipeClose</span>(<span class="params">ev</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123;</span><br><span class="line">            position,</span><br><span class="line">            instance</span><br><span class="line">        &#125; = ev.detail</span><br><span class="line">        <span class="keyword">if</span> (position === <span class="string">&#x27;right&#x27;</span>) &#123;</span><br><span class="line">            <span class="comment">// æ˜¾ç¤º Dialog å¯¹è¯æ¡†</span></span><br><span class="line">            <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">                <span class="attr">dialogVisible</span>: <span class="literal">true</span></span><br><span class="line">            &#125;)</span><br><span class="line">            <span class="comment">// å¾…åˆ é™¤çš„æˆ¿å±‹idå’Œç´¢å¼•</span></span><br><span class="line">            house_id = ev.mark.id</span><br><span class="line">            house_index = ev.mark.index</span><br><span class="line">            <span class="comment">// swiper-cell æ»‘å—å…³é—­</span></span><br><span class="line">            instance.close()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>åœ¨ dialogClose æ–¹æ³•ä¸­è°ƒç”¨åˆ é™¤çš„æ¥å£ã€‚</li>
</ol>
<ul>
<li><p>æ¥å£è·¯å¾„ï¼š<code>room/:id</code>ã€‚</p>
</li>
<li><p>è¯·æ±‚æ–¹æ³•: DELETEã€‚</p>
</li>
<li><p>è¯·æ±‚å‚æ•°ï¼š</p>
<ul>
<li>id å¾…åˆ é™¤çš„æˆ¿åˆ° idã€‚</li>
</ul>
</li>
<li><p>Headersï¼š</p>
<ul>
<li>Authorizationã€‚</li>
</ul>
</li>
<li><p>å“åº”æ•°æ®ï¼š<a target="_blank" rel="noopener" href="https://www.apifox.cn/apidoc/shared-8d66c345-7a9a-4844-9a5a-1201852f6faa/api-41400746">è§æ–‡æ¡£</a>ã€‚</p>
</li>
</ul>
<p>å°è£…æ–¹æ³•æ¥è°ƒç”¨æ¥å£åˆ é™¤æˆ¿å±‹æ•°æ®ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// house_pkg/pages/list/index.js</span></span><br><span class="line">Page(&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="title">deleteHouse</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// è¯·æ±‚æ•°æ®æ¥å£</span></span><br><span class="line">        <span class="keyword">const</span> &#123;</span><br><span class="line">            code</span><br><span class="line">        &#125; = <span class="keyword">await</span> wx.http.delete(<span class="string">&#x27;/room/&#x27;</span> + house_id)</span><br><span class="line">        <span class="comment">// æ£€æµ‹æ¥å£è°ƒç”¨ç»“æœ</span></span><br><span class="line">        <span class="keyword">if</span> (code !== <span class="number">10000</span>) <span class="keyword">return</span> wx.utils.toast(<span class="string">&#x27;åˆ é™¤æˆ¿å±‹å¤±è´¥!&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ›´æ–°æˆ¿å±‹åˆ—è¡¨</span></span><br><span class="line">        <span class="built_in">this</span>.data.houseList.splice(house_index, <span class="number">1</span>)</span><br><span class="line">        <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">            <span class="attr">houseList</span>: <span class="built_in">this</span>.data.houseList,</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="title">dialogClose</span>(<span class="params">ev</span>)</span> &#123;</span><br><span class="line">        <span class="comment">// é€‰æ‹©äº†ç¡®è®¤ååˆ é™¤æˆ¿å±‹</span></span><br><span class="line">        ev.detail === <span class="string">&#x27;confirm&#x27;</span> &amp;&amp; <span class="built_in">this</span>.deleteHouse()</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>ä¼˜åŒ–æ•°æ®ä¸ºç©ºæ—¶çš„é¡µé¢å±•ç¤ºï¼Œ<code>house_pkg/page/list/index.wxml</code>ã€‚</li>
</ol>
<p>å½“æ‰€æœ‰çš„æˆ¿å±‹éƒ½è¢«åˆ é™¤åï¼Œæˆ–æœ€å¼€å§‹è·å–é¡µé¢åˆ—è¡¨æ—¶ï¼Œåœ¨é¡µé¢ä¸­ç»™ç”¨æˆ·ä¸€ä¸ªç©ºæç¤ºã€‚</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">authorization</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">block</span> <span class="attr">wx:if</span>=<span class="string">&quot;&#123;&#123;!isEmpty&#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">        ...</span><br><span class="line">    <span class="tag">&lt;/<span class="name">block</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">wx:else</span> <span class="attr">class</span>=<span class="string">&quot;blank&quot;</span>&gt;</span></span><br><span class="line">        æ‚¨è¿˜æ²¡æœ‰è®¤è¯æˆ¿å±‹ï¼Œè¯·ç‚¹å‡» <span class="tag">&lt;<span class="name">navigator</span> <span class="attr">hover-class</span>=<span class="string">&quot;none&quot;</span> <span class="attr">class</span>=<span class="string">&quot;link&quot;</span> <span class="attr">url</span>=<span class="string">&quot;/house_pkg/pages/locate/index&quot;</span>&gt;</span>æ·»åŠ <span class="tag">&lt;/<span class="name">navigator</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">authorization</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// house_pkg/pages/list/index.js</span></span><br><span class="line">Page(&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="title">deleteHouse</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// è¯·æ±‚æ•°æ®æ¥å£</span></span><br><span class="line">        <span class="keyword">const</span> &#123;</span><br><span class="line">            code</span><br><span class="line">        &#125; = <span class="keyword">await</span> wx.http.delete(<span class="string">&#x27;/room/&#x27;</span> + house_id)</span><br><span class="line">        <span class="comment">// æ£€æµ‹æ¥å£è°ƒç”¨ç»“æœ</span></span><br><span class="line">        <span class="keyword">if</span> (code !== <span class="number">10000</span>) <span class="keyword">return</span> wx.utils.toast(<span class="string">&#x27;åˆ é™¤æˆ¿å±‹å¤±è´¥!&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ›´æ–°æˆ¿å±‹åˆ—è¡¨</span></span><br><span class="line">        <span class="built_in">this</span>.data.houseList.splice(house_index, <span class="number">1</span>)</span><br><span class="line">        <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">            <span class="attr">houseList</span>: <span class="built_in">this</span>.data.houseList,</span><br><span class="line">            <span class="comment">// #1</span></span><br><span class="line">            <span class="attr">isEmpty</span>: <span class="built_in">this</span>.data.houseList.length === <span class="number">0</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="title">getHouseList</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// è¯·æ±‚æ•°æ®æ¥å£</span></span><br><span class="line">        <span class="keyword">const</span> &#123;</span><br><span class="line">            code,</span><br><span class="line">            <span class="attr">data</span>: houseList</span><br><span class="line">        &#125; = <span class="keyword">await</span> wx.http.get(<span class="string">&#x27;/room&#x27;</span>)</span><br><span class="line">        <span class="comment">// æ£€æµ‹æ¥å£è¿”å›çš„ç»“æœ</span></span><br><span class="line">        <span class="keyword">if</span> (code !== <span class="number">10000</span>) <span class="keyword">return</span> wx.utils.toast()</span><br><span class="line">        <span class="comment">// æ¸²æŸ“æ•°æ®</span></span><br><span class="line">        <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">            houseList,</span><br><span class="line">            <span class="comment">// #2</span></span><br><span class="line">            <span class="attr">isEmpty</span>: houseList.length === <span class="number">0</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>æäº¤ä»£ç ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹å½“å‰è¢«ä¿®æ”¹çš„æ–‡ä»¶</span></span><br><span class="line">git status</span><br><span class="line"><span class="comment"># æš‚å­˜æ–‡ä»¶</span></span><br><span class="line">git add .</span><br><span class="line"><span class="comment"># æäº¤åˆ°æœ¬åœ°</span></span><br><span class="line">git commit -m <span class="string">&#x27;feat(house): å®Œæˆåˆ é™¤æˆ¿å±‹çš„åŠŸèƒ½&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="æˆ¿å±‹è¯¦æƒ…"><a href="#æˆ¿å±‹è¯¦æƒ…" class="headerlink" title="æˆ¿å±‹è¯¦æƒ…"></a>æˆ¿å±‹è¯¦æƒ…</h3><ol>
<li>è·³è½¬åˆ°è¯¦æƒ…é¡µé¢æ—¶ä¼ é€’æˆ¿å±‹ IDã€‚</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// house_pkg/pages/list/index.js</span></span><br><span class="line">Page(&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="function"><span class="title">goDetail</span>(<span class="params">ev</span>)</span> &#123;</span><br><span class="line">        wx.navigateTo(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">&#x27;/house_pkg/pages/detail/index?id=&#x27;</span> + ev.mark.id,</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>æ ¹æ®æˆ¿å±‹ ID è·å–è¯¦æƒ…ï¼Œ<code>house_pkg/pages/detail/index.js</code>ã€‚</li>
</ol>
<ul>
<li><p>æ¥å£è·¯å¾„ï¼š<code>/room/:id</code>ã€‚</p>
</li>
<li><p>è¯·æ±‚æ–¹æ³•: GETã€‚</p>
</li>
<li><p>è¯·æ±‚å‚æ•°ï¼š</p>
<ul>
<li>id æˆ¿å±‹idã€‚</li>
</ul>
</li>
<li><p>Headersï¼š</p>
<ul>
<li>Authorizationã€‚</li>
</ul>
</li>
<li><p>å“åº”æ•°æ®ï¼š<a target="_blank" rel="noopener" href="https://www.apifox.cn/apidoc/shared-8d66c345-7a9a-4844-9a5a-1201852f6faa/api-41400751">è§æ–‡æ¡£</a>ã€‚</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">Page(&#123;</span><br><span class="line">    <span class="function"><span class="title">onLoad</span>(<span class="params">&#123;</span></span></span><br><span class="line"><span class="params"><span class="function">        id</span></span></span><br><span class="line"><span class="params"><span class="function">    &#125;</span>)</span> &#123;</span><br><span class="line">        <span class="comment">// è·å–æˆ¿å±‹è¯¦æƒ…</span></span><br><span class="line">        <span class="built_in">this</span>.getHouseDetail(id)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="title">getHouseDetail</span>(<span class="params">id</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!id) <span class="keyword">return</span></span><br><span class="line">        <span class="comment">// è¯·æ±‚æ•°æ®æ¥å£</span></span><br><span class="line">        <span class="keyword">const</span> &#123;</span><br><span class="line">            code,</span><br><span class="line">            <span class="attr">data</span>: houseDetail</span><br><span class="line">        &#125; = <span class="keyword">await</span> wx.http.get(<span class="string">&#x27;/room/&#x27;</span> + id)</span><br><span class="line">        <span class="comment">// æ£€æµ‹æ¥å£è¿”å›çš„ç»“æœ</span></span><br><span class="line">        <span class="keyword">if</span> (code !== <span class="number">10000</span>) <span class="keyword">return</span> wx.utils.toast()</span><br><span class="line">        <span class="comment">// æ¸²æŸ“æ•°æ®</span></span><br><span class="line">        <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">            ...houseDetail</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="title">editHouse</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        wx.navigateTo(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">&#x27;/house_pkg/pages/form/index&#x27;</span>,</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>æ¸²æŸ“æ•°æ®åˆ°æ¨¡æ¿ä¸­ã€‚</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- house_pkg/pages/detail/index.wxml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">scroll-view</span> <span class="attr">scroll-y</span> <span class="attr">enhanced</span> <span class="attr">show-scrollbar</span>=<span class="string">&quot;&#123;&#123;false&#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;house-detail&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">van-cell-group</span> <span class="attr">border</span>=<span class="string">&quot;&#123;&#123;false&#125;&#125;&quot;</span> <span class="attr">title</span>=<span class="string">&quot;æˆ¿å±‹ä¿¡æ¯&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- #1 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title</span>=<span class="string">&quot;&#123;&#123;point&#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- #2 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;tag info&quot;</span> <span class="attr">wx:if</span>=<span class="string">&quot;&#123;&#123;status === 1&#125;&#125;&quot;</span>&gt;</span>æ­£åœ¨å®¡æ ¸<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;tag success&quot;</span> <span class="attr">wx:if</span>=<span class="string">&quot;&#123;&#123;status === 2&#125;&#125;&quot;</span>&gt;</span>å®¡æ ¸æˆåŠŸ<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;tag fail&quot;</span> <span class="attr">wx:if</span>=<span class="string">&quot;&#123;&#123;status === 3&#125;&#125;&quot;</span>&gt;</span>å®¡æ ¸å¤±è´¥<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">van-cell</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">van-cell-group</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">van-cell-group</span> <span class="attr">title</span>=<span class="string">&quot;ä¸šä¸»ä¿¡æ¯&quot;</span> <span class="attr">border</span>=<span class="string">&quot;&#123;&#123;false&#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- #3 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title-width</span>=<span class="string">&quot;200rpx&quot;</span> <span class="attr">title</span>=<span class="string">&quot;æˆ¿é—´å·&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&#123;&#123;building&#125;&#125; &#123;&#123;room&#125;&#125;&quot;</span> /&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- #4 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title-width</span>=<span class="string">&quot;200rpx&quot;</span> <span class="attr">title</span>=<span class="string">&quot;ä¸šä¸»&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&#123;&#123;name&#125;&#125;&quot;</span> /&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- #5 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title-width</span>=<span class="string">&quot;200rpx&quot;</span> <span class="attr">border</span>=<span class="string">&quot;&#123;&#123;false&#125;&#125;&quot;</span> <span class="attr">title</span>=<span class="string">&quot;æ‰‹æœºå·&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&#123;&#123;mobile&#125;&#125;&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">van-cell-group</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;id-card&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title</span>=<span class="string">&quot;æœ¬äººèº«ä»½è¯ç…§ç‰‡&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;id-card-front&quot;</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- #6 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">image</span> <span class="attr">src</span>=<span class="string">&quot;&#123;&#123;idcardFrontUrl&#125;&#125;&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;id-card-back&quot;</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- #7 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">image</span> <span class="attr">src</span>=<span class="string">&quot;&#123;&#123;idcardBackUrl&#125;&#125;&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">scroll-view</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- ... --&gt;</span></span><br></pre></td></tr></table></figure>

<p>æäº¤ä»£ç ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹å½“å‰è¢«ä¿®æ”¹çš„æ–‡ä»¶</span></span><br><span class="line">git status</span><br><span class="line"><span class="comment"># æš‚å­˜æ–‡ä»¶</span></span><br><span class="line">git add .</span><br><span class="line"><span class="comment"># æäº¤åˆ°æœ¬åœ°</span></span><br><span class="line">git commit -m <span class="string">&#x27;feat(house): å®ŒæˆæŸ¥è¯¢æˆ¿å±‹è¯¦æƒ…çš„åŠŸèƒ½&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="ç¼–è¾‘æˆ¿å±‹"><a href="#ç¼–è¾‘æˆ¿å±‹" class="headerlink" title="ç¼–è¾‘æˆ¿å±‹"></a>ç¼–è¾‘æˆ¿å±‹</h3><p>ç¼–è¾‘å’Œæ·»åŠ æˆ¿å±‹çš„é€»è¾‘æ˜¯ç›¸ä¼¼çš„å¹¶ä¸”å…±ç”¨äº†ç›¸åŒçš„é¡µé¢ï¼Œå³ <code>house_pkg/pages/form/index</code> ï¼Œåœ¨æ­¤é¡µé¢éœ€è¦æ ¹æ®æœ‰æ—  ID è¿›è¡ŒåŒºåˆ†ã€‚</p>
<ol>
<li>ç‚¹å‡»ã€ä¿®æ”¹æˆ¿å±‹ä¿¡æ¯ã€‘æ—¶ä¼ é€’ IDã€‚</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// miniprogram/house_pkg/pages/detail/index.js</span></span><br><span class="line">Page(&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="function"><span class="title">editHouse</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        wx.navigateTo(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">&#x27;/house_pkg/pages/form/index?id=&#x27;</span> + <span class="built_in">this</span>.data.id,</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>è®¾ç½®é¡µé¢æ ‡é¢˜ï¼Œå¦‚æœé¡µé¢åœ°å€ä¸­åŒ…å« id å‚æ•°åˆ™è¡¨æ˜å½“å‰çš„æ“ä½œä¸ºç¼–è¾‘æˆ¿å±‹ä¿¡æ¯ã€‚</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// house_pkg/pages/form/index.js</span></span><br><span class="line">Page(&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="function"><span class="title">onLoad</span>(<span class="params">&#123;</span></span></span><br><span class="line"><span class="params"><span class="function">        point,</span></span></span><br><span class="line"><span class="params"><span class="function">        building,</span></span></span><br><span class="line"><span class="params"><span class="function">        room,</span></span></span><br><span class="line"><span class="params"><span class="function">        id</span></span></span><br><span class="line"><span class="params"><span class="function">    &#125;</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (id) &#123;</span><br><span class="line">            wx.setNavigationBarTitle(&#123;</span><br><span class="line">                <span class="attr">title</span>: <span class="string">&#x27;ç¼–è¾‘æˆ¿å±‹ä¿¡æ¯&#x27;</span></span><br><span class="line">            &#125;)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// è·å–å¹¶è®°å½•åœ°å€å‚æ•°</span></span><br><span class="line">            <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">                point,</span><br><span class="line">                building,</span><br><span class="line">                room</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>æ ¹æ® ID æŸ¥è¯¢æˆ¿å±‹è¯¦æƒ…æ•°æ®ã€‚</li>
</ol>
<ul>
<li><p>æ¥å£è·¯å¾„ï¼š<code>/room/:id</code>ã€‚</p>
</li>
<li><p>è¯·æ±‚æ–¹æ³•: GETã€‚</p>
</li>
<li><p>è¯·æ±‚å‚æ•°ï¼š</p>
<ul>
<li>id æˆ¿å±‹idã€‚</li>
</ul>
</li>
<li><p>Headersï¼š</p>
<ul>
<li>Authorizationã€‚</li>
</ul>
</li>
<li><p>å“åº”æ•°æ®ï¼š<a target="_blank" rel="noopener" href="https://www.apifox.cn/apidoc/shared-8d66c345-7a9a-4844-9a5a-1201852f6faa/api-41400751">è§æ–‡æ¡£</a>ã€‚</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// house_pkg/pages/form/index.js</span></span><br><span class="line">Page(&#123;</span><br><span class="line">    <span class="function"><span class="title">onLoad</span>(<span class="params">&#123;</span></span></span><br><span class="line"><span class="params"><span class="function">        point,</span></span></span><br><span class="line"><span class="params"><span class="function">        building,</span></span></span><br><span class="line"><span class="params"><span class="function">        room,</span></span></span><br><span class="line"><span class="params"><span class="function">        id</span></span></span><br><span class="line"><span class="params"><span class="function">    &#125;</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (id) &#123;</span><br><span class="line">            wx.setNavigationBarTitle(&#123;</span><br><span class="line">                <span class="attr">title</span>: <span class="string">&#x27;ç¼–è¾‘æˆ¿å±‹ä¿¡æ¯&#x27;</span></span><br><span class="line">            &#125;)</span><br><span class="line">            <span class="comment">// è·å–æˆ¿å±‹ä¿¡æ¯</span></span><br><span class="line">            <span class="built_in">this</span>.getHouseDetail(id)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// è·å–å¹¶è®°å½•åœ°å€å‚æ•°</span></span><br><span class="line">            <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">                point,</span><br><span class="line">                building,</span><br><span class="line">                room</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="title">getHouseDetail</span>(<span class="params">id</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!id) <span class="keyword">return</span></span><br><span class="line">        <span class="comment">// è¯·æ±‚æ•°æ®æ¥å£</span></span><br><span class="line">        <span class="keyword">const</span> &#123;</span><br><span class="line">            code,</span><br><span class="line">            <span class="attr">data</span>: houseDetail</span><br><span class="line">        &#125; = <span class="keyword">await</span> wx.http.get(<span class="string">&#x27;/room/&#x27;</span> + id)</span><br><span class="line">        <span class="comment">// æ£€æµ‹æ¥å£è¿”å›çš„ç»“æœ</span></span><br><span class="line">        <span class="keyword">if</span> (code !== <span class="number">10000</span>) <span class="keyword">return</span> wx.utils.toast()</span><br><span class="line">        <span class="comment">// æ¸²æŸ“æ•°æ®</span></span><br><span class="line">        <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">            ...houseDetail</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>è°ƒç”¨æ›´æ–°æˆ¿å±‹ä¿¡æ¯çš„æ¥å£ã€‚</li>
</ol>
<ul>
<li><p>æ·»åŠ æˆ¿å±‹å’Œæ›´æ–°æˆ¿å±‹ä¿¡æ¯è°ƒç”¨çš„æ˜¯åŒä¸€ä¸ªæ¥å£ï¼Œåç«¯ä¼šåŠ¨åˆ¤æ–­ä¼ é€’å‚æ•°æ—¶æœ‰æ²¡æœ‰ idï¼Œå¦‚æœæœ‰ id åˆ™è¡¨ç¤ºæ˜¯ç¼–è¾‘æ“ä½œå¦åˆ™æ˜¯æ·»åŠ æ“ä½œã€‚</p>
</li>
<li><p>è¦æ³¨æ„æ¥å£å‚æ•°ä¸­å¹¶ä¸åŒ…å« status è¿™ä¸ªå‚æ•°ï¼Œè¿™ä¸ªæ•°æ®æ˜¯æ ‡è¯†æˆ¿å±‹çš„å®¡æ ¸çŠ¶æ€çš„ï¼Œåœ¨è°ƒç”¨æ¥å£å‰æˆ‘ä»¬æŠŠè¿™ä¸ªå‚æ•°åˆ é™¤ã€‚</p>
</li>
<li><p>è¦æ³¨æ„æ¥å£è°ƒç”¨æˆåŠŸåçš„è¿”å›æ“ä½œä¹Ÿéœ€è¦åšä¸€äº›è°ƒæ•´ã€‚</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// house_pkg/pages/form/index.js</span></span><br><span class="line">Page(&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="title">submitForm</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// é€ä¸ªéªŒè¯è¡¨å•çš„æ•°æ®</span></span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">this</span>.verifyName()) <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">this</span>.verifyMobile()) <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">this</span>.verifyPicture()) <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ é™¤ä¸€äº›æ•°æ®</span></span><br><span class="line">        <span class="keyword">delete</span> <span class="built_in">this</span>.data.__webviewId__</span><br><span class="line">        <span class="comment">// #1</span></span><br><span class="line">        <span class="keyword">delete</span> <span class="built_in">this</span>.data.status</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è¯·æ±‚æ•°æ®æ¥å£</span></span><br><span class="line">        <span class="keyword">const</span> &#123;</span><br><span class="line">            code</span><br><span class="line">        &#125; = <span class="keyword">await</span> wx.http.post(<span class="string">&#x27;/room&#x27;</span>, <span class="built_in">this</span>.data)</span><br><span class="line">        <span class="comment">// æ£€æµ‹æ¥å£è°ƒç”¨çš„ç»“æœ</span></span><br><span class="line">        <span class="keyword">if</span> (code !== <span class="number">10000</span>) <span class="keyword">return</span> wx.utils.toast(<span class="string">&#x27;æ·»åŠ æˆ¿å±‹å¤±è´¥!&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// #2 æˆåŠŸåè·³è½¬è‡³æˆ¿å±‹åˆ—è¡¨</span></span><br><span class="line">        wx.navigateBack(&#123;</span><br><span class="line">            <span class="attr">delta</span>: <span class="built_in">this</span>.data.id ? <span class="number">2</span> : <span class="number">4</span>,</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>æäº¤ä»£ç ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹å½“å‰è¢«ä¿®æ”¹çš„æ–‡ä»¶</span></span><br><span class="line">git status</span><br><span class="line"><span class="comment"># æš‚å­˜æ–‡ä»¶</span></span><br><span class="line">git add .</span><br><span class="line"><span class="comment"># æäº¤åˆ°æœ¬åœ°</span></span><br><span class="line">git commit -m <span class="string">&#x27;feat(house): å®Œæˆæˆ¿å±‹ç¼–è¾‘çš„åŠŸèƒ½&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¨é€åˆ°è¿œç¨‹æˆ–åˆå¹¶åˆ°æœ¬åœ° main</span></span><br><span class="line">git checkout main</span><br><span class="line">git merge feat-house</span><br></pre></td></tr></table></figure>

<h2 id="æŠ¥ä¿®ç®¡ç†"><a href="#æŠ¥ä¿®ç®¡ç†" class="headerlink" title="æŠ¥ä¿®ç®¡ç†"></a>æŠ¥ä¿®ç®¡ç†</h2><h3 id="åœ¨çº¿æŠ¥ä¿®"><a href="#åœ¨çº¿æŠ¥ä¿®" class="headerlink" title="åœ¨çº¿æŠ¥ä¿®"></a>åœ¨çº¿æŠ¥ä¿®</h3><p>ç”¨æˆ·åœ¨çº¿å¡«å†™æŠ¥ä¿®çš„ä¿¡æ¯ï¼Œæ‰€æ¶‰åŠçš„åŠŸèƒ½ä¸»è¦æ˜¯æ–‡ä»¶ä¸Šä¼ ã€è¡¨å•éªŒè¯ç­‰æŠ€æœ¯ç‚¹ã€‚</p>
<h4 id="ç”¨æˆ·äº¤äº’"><a href="#ç”¨æˆ·äº¤äº’" class="headerlink" title="ç”¨æˆ·äº¤äº’"></a>ç”¨æˆ·äº¤äº’</h4><p>æœ¬é¡µé¢æœ‰ 3 ä¸ªé‡è¦çš„äº¤äº’ï¼Œåˆ†åˆ«ç”¨åˆ°äº† <a target="_blank" rel="noopener" href="https://vant-contrib.gitee.io/vant-weapp/#/action-sheet">van-action-sheet</a>ã€<a target="_blank" rel="noopener" href="https://vant-contrib.gitee.io/vant-weapp/#/datetime-picker">van-datetime-picker</a> ä»¥åŠ <a target="_blank" rel="noopener" href="https://vant-contrib.gitee.io/vant-weapp/#/popup">van-popup</a> ç»„ä»¶ï¼Œä½¿ç”¨ä¸‹é¢ 3 ä¸ªå˜é‡æ¥æ§åˆ¶æ˜¯å¦å±•ç¤ºç»„ä»¶ã€‚</p>
<ul>
<li><p>houseLayerVisible æ˜¯å¦å±•ç¤ºæˆ¿å±‹åˆ—è¡¨ã€‚</p>
</li>
<li><p>repairLayerVisible æ˜¯å¦å±•ç¤ºç»´ä¿®é¡¹ç›®ã€‚</p>
</li>
<li><p>dateLayerVisible æ˜¯å¦æ˜¾ç¤ºæ—¥æœŸé€‰æ‹©ã€‚</p>
</li>
</ul>
<p>é€šè¿‡æ”¹å˜è¿™ 3 ä¸ªå˜é‡çš„å€¼æ¥åˆ‡æ¢ç»„ä»¶çš„æ˜¾ç¤º/éšè—ã€‚</p>
<ol>
<li>ã€è¯·é€‰æ‹©æŠ¥ä¿®çš„æˆ¿å±‹ã€‘ï¼Œç›‘å¬ select äº‹ä»¶ï¼Œåœ¨äº‹ä»¶å›è°ƒå‡½æ•°ä¸­<strong>è·å–ç”¨æˆ·æ‰€é€‰æ‹©çš„å†…å®¹</strong>ã€‚</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- repair_pkg/pages/form/index.wxml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">van-action-sheet</span> <span class="attr">bind:close</span>=<span class="string">&quot;closeHouseLayer&quot;</span> <span class="attr">bind:cancel</span>=<span class="string">&quot;closeHouseLayer&quot;</span> <span class="attr">bind:select</span>=<span class="string">&quot;selectHouse&quot;</span> <span class="attr">round</span> <span class="attr">show</span>=<span class="string">&quot;&#123;&#123; houseLayerVisible &#125;&#125;&quot;</span> <span class="attr">actions</span>=<span class="string">&quot;&#123;&#123; houseList &#125;&#125;&quot;</span> <span class="attr">cancel-text</span>=<span class="string">&quot;å–æ¶ˆ&quot;</span> <span class="attr">title</span>=<span class="string">&quot;é€‰æ‹©æŠ¥ä¿®æˆ¿å±‹&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// repair_pkg/pages/form/index.js</span></span><br><span class="line">Page(&#123;</span><br><span class="line">    <span class="attr">data</span>: &#123;</span><br><span class="line">        <span class="attr">houseInfo</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="function"><span class="title">selectHouse</span>(<span class="params">ev</span>)</span> &#123;</span><br><span class="line">        <span class="comment">// è·å–ç”¨æˆ·é€‰æ‹©æˆ¿å±‹çš„åç§°</span></span><br><span class="line">        <span class="keyword">const</span> &#123;</span><br><span class="line">            <span class="attr">name</span>: houseInfo</span><br><span class="line">        &#125; = ev.detail</span><br><span class="line">        <span class="comment">// é¡µé¢ä¸­æ¸²æŸ“</span></span><br><span class="line">        <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">            houseInfo</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>æ¸²æŸ“ houseInfoï¼Œç”¨æˆ·åœ¨æˆ¿å±‹åˆ—è¡¨ä¸­é€‰æ‹©äº†æŸä¸ªæˆ¿å±‹é¡¹åéœ€è¦é«˜äº®æ˜¾ç¤ºï¼Œåªè¦æ·»åŠ  active-cell ç±»åå³å¯ã€‚</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- repair_pkg/pages/form/index.wxml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">van-cell-group</span> <span class="attr">border</span>=<span class="string">&quot;&#123;&#123;false&#125;&#125;&quot;</span> <span class="attr">title</span>=<span class="string">&quot;æŠ¥ä¿®æˆ¿å±‹&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">value</span>=<span class="string">&quot;&#123;&#123;houseInfo || &#x27;è¯·é€‰æ‹©æŠ¥ä¿®æˆ¿å±‹&#x27;&#125;&#125;&quot;</span> <span class="attr">value-class</span>=<span class="string">&quot;&#123;&#123;houseInfo &amp;&amp; &#x27;active-cell&#x27;&#125;&#125;&quot;</span> <span class="attr">bind:click</span>=<span class="string">&quot;openHouseLayer&quot;</span> <span class="attr">is-link</span> <span class="attr">border</span>=<span class="string">&quot;&#123;&#123;false&#125;&#125;&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">van-cell-group</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>ã€è¯·é€‰æ‹©ç»´ä¿®é¡¹ç›®ã€‘ï¼Œç›‘å¬ select äº‹ä»¶ï¼Œåœ¨äº‹ä»¶å›è°ƒå‡½æ•°ä¸­<strong>è·å–ç”¨æˆ·æ‰€é€‰æ‹©çš„å†…å®¹</strong>ã€‚</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- repair_pkg/pages/form/index.wxml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">van-action-sheet</span> <span class="attr">bind:close</span>=<span class="string">&quot;closeRepairLayer&quot;</span> <span class="attr">bind:cancel</span>=<span class="string">&quot;closeRepairLayer&quot;</span> <span class="attr">bind:select</span>=<span class="string">&quot;selectRepairItem&quot;</span> <span class="attr">round</span> <span class="attr">show</span>=<span class="string">&quot;&#123;&#123; repairLayerVisible &#125;&#125;&quot;</span> <span class="attr">actions</span>=<span class="string">&quot;&#123;&#123; repairItem &#125;&#125;&quot;</span> <span class="attr">cancel-text</span>=<span class="string">&quot;å–æ¶ˆ&quot;</span> <span class="attr">title</span>=<span class="string">&quot;é€‰æ‹©ç»´ä¿®é¡¹ç›®&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// repair_pkg/pages/form/index.js</span></span><br><span class="line">Page(&#123;</span><br><span class="line">    <span class="attr">data</span>: &#123;</span><br><span class="line">        <span class="attr">repairItemName</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="function"><span class="title">selectRepairItem</span>(<span class="params">ev</span>)</span> &#123;</span><br><span class="line">        <span class="comment">// è·å–ç”¨æˆ·é€‰æ‹©çš„ç»´ä¿®é¡¹ç›®åç§°</span></span><br><span class="line">        <span class="keyword">const</span> &#123;</span><br><span class="line">            <span class="attr">name</span>: repairItemName</span><br><span class="line">        &#125; = ev.detail</span><br><span class="line">        <span class="comment">// é¡µé¢ä¸­æ¸²æŸ“</span></span><br><span class="line">        <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">            repairItemName</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>æ¸²æŸ“ repairItemNameï¼Œé«˜äº®åŒæ ·æ·»åŠ  active-cell ç±»åå³å¯ã€‚</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- repair_pkg/pages/form/index.wxml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title-width</span>=<span class="string">&quot;100&quot;</span> <span class="attr">title</span>=<span class="string">&quot;ç»´ä¿®é¡¹ç›®&quot;</span> <span class="attr">bind:click</span>=<span class="string">&quot;openRepairLayer&quot;</span> <span class="attr">value-class</span>=<span class="string">&quot;&#123;&#123;repairItemName &amp;&amp; &#x27;active-cell&#x27;&#125;&#125;&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&#123;&#123;repairItemName || &#x27;è¯·é€‰æ‹©ç»´ä¿®é¡¹ç›®&#x27;&#125;&#125;&quot;</span> <span class="attr">is-link</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="5">
<li>ç›‘å¬æ—¥æœŸé€‰æ‹©åçš„ confirm äº‹ä»¶ã€‚</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- repair_pkg/pages/form/index.wxml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">van-popup</span> <span class="attr">bind:close</span>=<span class="string">&quot;closeDateLayer&quot;</span> <span class="attr">round</span> <span class="attr">show</span>=<span class="string">&quot;&#123;&#123;dateLayerVisible&#125;&#125;&quot;</span> <span class="attr">position</span>=<span class="string">&quot;bottom&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-datetime-picker</span> <span class="attr">type</span>=<span class="string">&quot;date&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&#123;&#123;currentDate&#125;&#125;&quot;</span> <span class="attr">min-date</span>=<span class="string">&quot;&#123;&#123;minDate&#125;&#125;&quot;</span> <span class="attr">bind:cancel</span>=<span class="string">&quot;closeDateLayer&quot;</span> <span class="attr">bind:confirm</span>=<span class="string">&quot;selectDate&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">van-popup</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// repair_pkg/pages/form/index.js</span></span><br><span class="line">Page(&#123;</span><br><span class="line">    <span class="attr">data</span>: &#123;</span><br><span class="line">        <span class="attr">appointment</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="function"><span class="title">selectDate</span>(<span class="params">ev</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">            <span class="attr">dateLayerVisible</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">appointment</span>: wx.utils.formatDate(ev.detail),</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p> <code>miniprogram/utils/utils.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å·¥å…·æ–¹æ³•</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> utils = &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å°è£… wx.showToast</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param <span class="type">&#123;string&#125;</span> </span>title æ¶ˆæ¯æç¤ºçš„å†…å®¹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="title">toast</span>(<span class="params">title = <span class="string">&#x27;æ•°æ®åŠ è½½å¤±è´¥...&#x27;</span></span>)</span> &#123;</span><br><span class="line">        wx.showToast(&#123;</span><br><span class="line">            title,</span><br><span class="line">            <span class="attr">mask</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">icon</span>: <span class="string">&#x27;none&#x27;</span>,</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¼å¼åŒ–æ—¶é—´</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="title">formatDate</span>(<span class="params">timestamp</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> date = <span class="keyword">new</span> <span class="built_in">Date</span>(timestamp)</span><br><span class="line">        <span class="keyword">const</span> year = date.getFullYear()</span><br><span class="line">        <span class="keyword">const</span> month = date.getMonth() + <span class="number">1</span></span><br><span class="line">        <span class="keyword">const</span> day = date.getDate()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> [year, month, day].map(<span class="built_in">this</span>.formatNumber).join(<span class="string">&#x27;/&#x27;</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="title">formatNumber</span>(<span class="params">n</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> s = n.toString()</span><br><span class="line">        <span class="keyword">return</span> s[<span class="number">1</span>] ? s : <span class="string">&#x27;0&#x27;</span> + s</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ‰©å±• wx å…¨å±€å¯¹è±¡ï¼Œåˆ‡è®°ä¸è¦ä¸åŸç”¨ api é‡å</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">wx.utils = utils</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ¨¡å—åŒ–å¯¼å‡º</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> utils</span><br></pre></td></tr></table></figure>

<ol start="6">
<li>æ¸²æŸ“ appointmentã€‚</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- repair_pkg/pages/form/index.wxml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title-width</span>=<span class="string">&quot;100&quot;</span> <span class="attr">title</span>=<span class="string">&quot;é¢„çº¦æ—¥æœŸ&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&#123;&#123;appointment || &#x27;è¯·é€‰æ‹©ä¸Šé—¨ç»´ä¿®æ—¥æœŸ&#x27;&#125;&#125;&quot;</span> <span class="attr">value-class</span>=<span class="string">&quot;&#123;&#123;appointment &amp;&amp; &#x27;active-cell&#x27;&#125;&#125;&quot;</span> <span class="attr">bind:click</span>=<span class="string">&quot;openDateLayer&quot;</span> <span class="attr">is-link</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>æäº¤ä»£ç ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹å½“å‰è¢«ä¿®æ”¹çš„æ–‡ä»¶</span></span><br><span class="line">git status</span><br><span class="line"><span class="comment"># æš‚å­˜æ–‡ä»¶</span></span><br><span class="line">git add .</span><br><span class="line"><span class="comment"># æäº¤åˆ°æœ¬åœ°</span></span><br><span class="line">git commit -m <span class="string">&#x27;feat(repair): å®Œæˆåœ¨çº¿æŠ¥ä¿®çš„äº¤äº’å¤„ç†&#x27;</span></span><br></pre></td></tr></table></figure>

<h4 id="æˆ¿å±‹åˆ—è¡¨-1"><a href="#æˆ¿å±‹åˆ—è¡¨-1" class="headerlink" title="æˆ¿å±‹åˆ—è¡¨"></a>æˆ¿å±‹åˆ—è¡¨</h4><p>è·å–çœŸå®çš„åç«¯è¿”å›çš„æˆ¿å±‹åˆ—è¡¨ã€‚</p>
<ul>
<li><p>æ¥å£è·¯å¾„ï¼š<code>/house</code>ã€‚</p>
</li>
<li><p>è¯·æ±‚æ–¹æ³•: GETã€‚</p>
</li>
<li><p>è¯·æ±‚å‚æ•°ï¼šæ— ã€‚</p>
</li>
<li><p>Headersï¼š</p>
<ul>
<li>Authorizationã€‚</li>
</ul>
</li>
<li><p>å“åº”æ•°æ®ï¼š<a target="_blank" rel="noopener" href="https://www.apifox.cn/apidoc/shared-8d66c345-7a9a-4844-9a5a-1201852f6faa/api-42635315">è§æ–‡æ¡£</a>ã€‚</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// repair_pkg/pages/form/index.js</span></span><br><span class="line">Page(&#123;</span><br><span class="line">    <span class="attr">data</span>: &#123;</span><br><span class="line">        <span class="comment">// #1</span></span><br><span class="line">        <span class="attr">houseList</span>: [],</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="title">onLoad</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// #2 è·å–æˆ¿å±‹åˆ—è¡¨</span></span><br><span class="line">        <span class="built_in">this</span>.getHouseList()</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="title">getHouseList</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// #3 è¯·æ±‚æ•°æ®æ¥å£</span></span><br><span class="line">        <span class="keyword">const</span> &#123;</span><br><span class="line">            code,</span><br><span class="line">            <span class="attr">data</span>: houseList</span><br><span class="line">        &#125; = <span class="keyword">await</span> wx.http.get(<span class="string">&#x27;/house&#x27;</span>)</span><br><span class="line">        <span class="comment">// æ£€æµ‹æ¥å£è¿”å›çš„ç»“æœ</span></span><br><span class="line">        <span class="keyword">if</span> (code !== <span class="number">10000</span>) <span class="keyword">return</span> wx.utils.toast(<span class="string">&#x27;è·å–æˆ¿å±‹åˆ—è¡¨å¤±è´¥!&#x27;</span>)</span><br><span class="line">        <span class="comment">// æ•°æ®æ¸²æŸ“</span></span><br><span class="line">        <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">            houseList</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>ğŸ¤” æç¤ºï¼šè¿™é‡Œåªèƒ½æŸ¥è¯¢åˆ°é€šè¿‡å®¡æ ¸é€šè¿‡çš„æˆ¿å±‹ä¿¡æ¯ï¼Œé€šè¿‡è¿™ä¸ª<a target="_blank" rel="noopener" href="https://www.apifox.cn/apidoc/shared-8d66c345-7a9a-4844-9a5a-1201852f6faa/api-42672273">æ¥å£</a>å¯ä»¥ä¿®æ”¹å®¡æ ¸åçŠ¶æ€è¿›è¡Œæµ‹è¯•ã€‚</p>
<h4 id="ç»´ä¿®é¡¹ç›®"><a href="#ç»´ä¿®é¡¹ç›®" class="headerlink" title="ç»´ä¿®é¡¹ç›®"></a>ç»´ä¿®é¡¹ç›®</h4><p>è·å–çœŸå®çš„åç«¯è¿”å›çš„ç»´ä¿®é¡¹ç›®ã€‚</p>
<ul>
<li><p>æ¥å£è·¯å¾„ï¼š<code>/repairItem</code>ã€‚</p>
</li>
<li><p>è¯·æ±‚æ–¹æ³•: GETã€‚</p>
</li>
<li><p>è¯·æ±‚å‚æ•°ï¼šæ— ã€‚</p>
</li>
<li><p>Headersï¼š</p>
<ul>
<li>Authorizationã€‚</li>
</ul>
</li>
<li><p>å“åº”æ•°æ®ï¼š<a target="_blank" rel="noopener" href="https://www.apifox.cn/apidoc/shared-8d66c345-7a9a-4844-9a5a-1201852f6faa/api-41400758">è§æ–‡æ¡£</a>ã€‚</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// repair_pkg/pages/form/index.js</span></span><br><span class="line">Page(&#123;</span><br><span class="line">    <span class="attr">data</span>: &#123;</span><br><span class="line">        <span class="comment">// #1</span></span><br><span class="line">        <span class="attr">repairItem</span>: [],</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="title">onLoad</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// #2 è·å–ç»´ä¿®é¡¹ç›®</span></span><br><span class="line">        <span class="built_in">this</span>.getRepairItem()</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="title">getRepairItem</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// #3 è¯·æ±‚æ•°æ®æ¥å£</span></span><br><span class="line">        <span class="keyword">const</span> &#123;</span><br><span class="line">            code,</span><br><span class="line">            <span class="attr">data</span>: repairItem</span><br><span class="line">        &#125; = <span class="keyword">await</span> wx.http.get(<span class="string">&#x27;/repairItem&#x27;</span>)</span><br><span class="line">        <span class="comment">// æ£€æµ‹æ¥å£è¿”å›çš„æ•°æ®</span></span><br><span class="line">        <span class="keyword">if</span> (code !== <span class="number">10000</span>) <span class="keyword">return</span> wx.utils.toast(<span class="string">&#x27;è·å–ç»´ä¿®é¡¹ç›®å¤±è´¥!&#x27;</span>)</span><br><span class="line">        <span class="comment">// æ•°æ®æ¸²æŸ“</span></span><br><span class="line">        <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">            repairItem</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="ä¸Šä¼ å›¾ç‰‡"><a href="#ä¸Šä¼ å›¾ç‰‡" class="headerlink" title="ä¸Šä¼ å›¾ç‰‡"></a>ä¸Šä¼ å›¾ç‰‡</h4><ol>
<li>ç›‘å¬ after-read äº‹ä»¶ï¼Œå½“ç”¨æˆ·é€‰æ‹©äº†ä¸€å¼ å›¾ç‰‡åä¼šè§¦å‘è¯¥äº‹ä»¶ï¼Œåœ¨è¯¥äº‹ä»¶å›è°ƒä¸­æ‰§è¡Œæ–‡ä»¶ä¸Šä¼ çš„é€»è¾‘ã€‚</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- repair_pkg/pages/form/index.wxml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">use-label-slot</span> <span class="attr">custom-style</span>=<span class="string">&quot;padding-bottom: 0&quot;</span> <span class="attr">title</span>=<span class="string">&quot;é—®é¢˜é™„ä»¶&quot;</span> <span class="attr">border</span>=<span class="string">&quot;&#123;&#123;false&#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;uploader&quot;</span> <span class="attr">slot</span>=<span class="string">&quot;label&quot;</span> <span class="attr">style</span>=<span class="string">&quot;margin-top: 20rpx;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">van-uploader</span> <span class="attr">preview-size</span>=<span class="string">&quot;100&quot;</span> <span class="attr">bind:after-read</span>=<span class="string">&quot;afterRead&quot;</span> <span class="attr">file-list</span>=<span class="string">&quot;&#123;&#123; fileList &#125;&#125;&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">van-cell</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// repair_pkg/pages/form/index.js</span></span><br><span class="line">Page(&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="function"><span class="title">afterRead</span>(<span class="params">ev</span>)</span> &#123;</span><br><span class="line">        <span class="comment">// console.log(ev.detail.file)</span></span><br><span class="line">        <span class="comment">// ä¸´æ—¶æ–‡ä»¶</span></span><br><span class="line">        <span class="keyword">const</span> &#123;</span><br><span class="line">            file</span><br><span class="line">        &#125; = ev.detail</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>è·å–åˆ°ä¸´æ—¶å›¾ç‰‡è·¯å¾„åè°ƒç”¨æ¥å£å°†å…¶ä¸Šä¼ åˆ°æœåŠ¡å™¨ã€‚</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// repair_pkg/pages/form/index.js</span></span><br><span class="line">Page(&#123;</span><br><span class="line">    <span class="attr">data</span>: &#123;</span><br><span class="line">        <span class="attr">attachment</span>: [],</span><br><span class="line">        <span class="comment">// è¿™ä¸ªæ•°æ®ä¸éœ€è¦äº†ï¼Œå¯ä»¥åˆ é™¤</span></span><br><span class="line">        <span class="comment">// fileList: []</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="function"><span class="title">afterRead</span>(<span class="params">ev</span>)</span> &#123;</span><br><span class="line">        <span class="comment">// console.log(ev.detail.file)</span></span><br><span class="line">        <span class="comment">// ä¸´æ—¶æ–‡ä»¶</span></span><br><span class="line">        <span class="keyword">const</span> &#123;</span><br><span class="line">            file</span><br><span class="line">        &#125; = ev.detail</span><br><span class="line">        <span class="comment">// è°ƒç”¨æ¥å£ä¸Šä¼ è‡³æœåŠ¡å™¨</span></span><br><span class="line">        wx.uploadFile(&#123;</span><br><span class="line">            <span class="attr">url</span>: wx.http.baseURL + <span class="string">&#x27;/upload&#x27;</span>,</span><br><span class="line">            <span class="attr">filePath</span>: file.url,</span><br><span class="line">            <span class="attr">name</span>: <span class="string">&#x27;file&#x27;</span>,</span><br><span class="line">            <span class="attr">header</span>: &#123;</span><br><span class="line">                <span class="attr">Authorization</span>: getApp().token,</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">success</span>: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="comment">// è½¬æ¢ json æ•°æ®</span></span><br><span class="line">                <span class="keyword">const</span> data = <span class="built_in">JSON</span>.parse(res.data)</span><br><span class="line">                <span class="comment">// ä¸Šä¼ å®Œæˆéœ€è¦æ›´æ–°</span></span><br><span class="line">                <span class="keyword">const</span> &#123;</span><br><span class="line">                    attachment = []</span><br><span class="line">                &#125; = <span class="built_in">this</span>.data</span><br><span class="line">                attachment.push(&#123;</span><br><span class="line">                    ...data.data</span><br><span class="line">                &#125;)</span><br><span class="line">                <span class="comment">// æ¸²æŸ“æ•°æ®</span></span><br><span class="line">                <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">                    attachment</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>ğŸ¤” æç¤ºï¼šåœ¨å†™é™æ€é¡µé¢æ—¶å­˜å›¾ç‰‡è·¯å¾„ä½¿ç”¨çš„æ˜¯ fileList æ•°æ®ï¼Œå’±ä»¬è¿™å„¿æ”¹æˆäº† attchmentï¼ˆè§†å›¾ä¸­çš„ fileList ä¹Ÿè®°å¾—æ”¹æˆ attachmentï¼‰ï¼ŒåŸå› æ˜¯è·Ÿåç«¯æ¥å£çš„éœ€è¦å¯¹åº”èµ·æ¥ã€‚</p>
<ol start="3">
<li>é€šè¿‡ max-count å±æ€§å¯ä»¥æ§åˆ¶ van-uploader ç»„ä»¶çš„ä¸Šä¼ æ•°é‡ã€‚</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- repair_pkg/pages/form/index.wxml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">use-label-slot</span> <span class="attr">custom-style</span>=<span class="string">&quot;padding-bottom: 0&quot;</span> <span class="attr">title</span>=<span class="string">&quot;é—®é¢˜é™„ä»¶&quot;</span> <span class="attr">border</span>=<span class="string">&quot;&#123;&#123;false&#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;uploader&quot;</span> <span class="attr">slot</span>=<span class="string">&quot;label&quot;</span> <span class="attr">style</span>=<span class="string">&quot;margin-top: 20rpx;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">van-uploader</span> <span class="attr">preview-size</span>=<span class="string">&quot;100&quot;</span> <span class="attr">bind:after-read</span>=<span class="string">&quot;afterRead&quot;</span> <span class="attr">max-count</span>=<span class="string">&quot;6&quot;</span> <span class="attr">file-list</span>=<span class="string">&quot;&#123;&#123;attachment&#125;&#125;&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">van-cell</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æäº¤ä»£ç ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹å½“å‰è¢«ä¿®æ”¹çš„æ–‡ä»¶</span></span><br><span class="line">git status</span><br><span class="line"><span class="comment"># æš‚å­˜æ–‡ä»¶</span></span><br><span class="line">git add .</span><br><span class="line"><span class="comment"># æäº¤åˆ°æœ¬åœ°</span></span><br><span class="line">git commit -m <span class="string">&#x27;feat(repair): å®ŒæˆæŠ¥ä¿®ä¿¡æ¯çš„æ•°æ®å¤„ç†&#x27;</span></span><br></pre></td></tr></table></figure>

<h4 id="æäº¤è¡¨å•"><a href="#æäº¤è¡¨å•" class="headerlink" title="æäº¤è¡¨å•"></a>æäº¤è¡¨å•</h4><ol>
<li>è¡¥å……è·å–ç»´ä¿®æˆ¿å±‹çš„ id å’Œ ç»´ä¿®é¡¹ç›®çš„ idã€‚</li>
</ol>
<p>ğŸ¤” ä¸Šä¸€å°èŠ‚å†™äº¤äº’é€»è¾‘æ—¶åªè·å–åˆ°äº†ç»´ä¿®æˆ¿å±‹çš„åç§°å’Œç»´ä¿®é¡¹ç›®çš„åç§°ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// repair_pkg/pages/form/index.js</span></span><br><span class="line">Page(&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="function"><span class="title">selectHouse</span>(<span class="params">ev</span>)</span> &#123;</span><br><span class="line">        <span class="comment">// è·å–ç”¨æˆ·é€‰æ‹©æˆ¿å±‹çš„ id å’Œåç§°</span></span><br><span class="line">        <span class="keyword">const</span> &#123;</span><br><span class="line">            <span class="attr">id</span>: houseId,</span><br><span class="line">            <span class="attr">name</span>: houseInfo</span><br><span class="line">        &#125; = ev.detail</span><br><span class="line">        <span class="comment">// é¡µé¢ä¸­æ¸²æŸ“</span></span><br><span class="line">        <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">            houseId,</span><br><span class="line">            houseInfo</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="title">selectRepairItem</span>(<span class="params">ev</span>)</span> &#123;</span><br><span class="line">        <span class="comment">// è·å–ç”¨æˆ·é€‰æ‹©çš„ç»´ä¿®é¡¹ç›®åŠ id</span></span><br><span class="line">        <span class="keyword">const</span> &#123;</span><br><span class="line">            <span class="attr">id</span>: repairItemId,</span><br><span class="line">            <span class="attr">name</span>: repairItemName</span><br><span class="line">        &#125; = ev.detail</span><br><span class="line">        <span class="comment">// é¡µé¢ä¸­æ¸²æŸ“</span></span><br><span class="line">        <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">            repairItemId,</span><br><span class="line">            repairItemName</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>è·å–æŠ¥ä¿®äººæ‰‹æœºå·ç å’ŒæŠ¥ä¿®é—®é¢˜æè¿°ï¼Œä½¿ç”¨ <code>model:value</code> åŒå‘æ•°æ®ç»‘å®šå³å¯ã€‚</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- repair_pkg/pages/form/index.wxml --&gt;</span></span><br><span class="line">...</span><br><span class="line"><span class="tag">&lt;<span class="name">van-field</span> <span class="attr">title-width</span>=<span class="string">&quot;88&quot;</span> <span class="attr">label</span>=<span class="string">&quot;æ‰‹æœºå·ç &quot;</span> <span class="attr">model:value</span>=<span class="string">&quot;&#123;&#123;mobile&#125;&#125;&quot;</span> <span class="attr">type</span>=<span class="string">&quot;number&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;è¯·è¾“å…¥è”ç³»ç”µè¯å·ç &quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title-width</span>=<span class="string">&quot;100&quot;</span> <span class="attr">title</span>=<span class="string">&quot;é¢„çº¦æ—¥æœŸ&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&#123;&#123;appointment || &#x27;è¯·é€‰æ‹©ä¸Šé—¨ç»´ä¿®æ—¥æœŸ&#x27;&#125;&#125;&quot;</span> <span class="attr">value-class</span>=<span class="string">&quot;&#123;&#123;appointment &amp;&amp; &#x27;active-cell&#x27;&#125;&#125;&quot;</span> <span class="attr">bind:click</span>=<span class="string">&quot;openDateLayer&quot;</span> <span class="attr">is-link</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">use-label-slot</span> <span class="attr">title</span>=<span class="string">&quot;é—®é¢˜æè¿°&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-field</span> <span class="attr">slot</span>=<span class="string">&quot;label&quot;</span> <span class="attr">border</span>=<span class="string">&quot;&#123;&#123;false&#125;&#125;&quot;</span> <span class="attr">model:value</span>=<span class="string">&quot;&#123;&#123;description&#125;&#125;&quot;</span> <span class="attr">autosize</span> <span class="attr">custom-style</span>=<span class="string">&quot;padding: 0; font-size: 28rpx; min-height: 60rpx&quot;</span> <span class="attr">type</span>=<span class="string">&quot;textarea&quot;</span> <span class="attr">placeholder-style</span>=<span class="string">&quot;color: #c3c3c5;&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;è¯·å¡«å†™æŠ¥ä¿®å†…å®¹ï¼Œå·¥ä½œäººå‘˜å°†å¿«é€Ÿå¸®æ‚¨è§£å†³é—®é¢˜ã€‚&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">van-cell</span>&gt;</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>éªŒè¯è¡¨å•æ•°æ®ã€‚</li>
</ol>
<p>ğŸ¤” åœ¨è°ƒç”¨æ¥å£æäº¤è¡¨å•æ•°æ®å‰å¿…é¡»è¦å¯¹ç”¨æˆ·å¡«å†™æ•°æ®çš„åˆæ³•æ€§è¿›è¡ŒéªŒè¯ï¼Œæœ¬å°èŠ‚çš„å†…å®¹è¯¾å ‚å°±ä¸å†™ä»£ç äº†ï¼Œè¦æ±‚å¤§å®¶èƒ½è¯»æ‡‚å°±å¯ä»¥ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// repair_pkg/pages/form/index.js</span></span><br><span class="line">Page(&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="function"><span class="title">verifyHouse</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> valid = <span class="built_in">this</span>.data.houseId !== <span class="string">&#x27;&#x27;</span></span><br><span class="line">        <span class="comment">// éªŒè¯ç»“æœæç¤º</span></span><br><span class="line">        <span class="keyword">if</span> (!valid) wx.utils.toast(<span class="string">&#x27;è¯·é€‰æ‹©æˆ¿å±‹ä¿¡æ¯!&#x27;</span>)</span><br><span class="line">        <span class="comment">// è¿”å›éªŒè¯ç»“æœ</span></span><br><span class="line">        <span class="keyword">return</span> valid</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="title">verifyRepair</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> valid = <span class="built_in">this</span>.data.repairItemId !== <span class="string">&#x27;&#x27;</span></span><br><span class="line">        <span class="comment">// éªŒè¯ç»“æœæç¤º</span></span><br><span class="line">        <span class="keyword">if</span> (!valid) wx.utils.toast(<span class="string">&#x27;è¯·é€‰æ‹©ç»´ä¿®é¡¹ç›®!&#x27;</span>)</span><br><span class="line">        <span class="comment">// è¿”å›éªŒè¯ç»“æœ</span></span><br><span class="line">        <span class="keyword">return</span> valid</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="title">verifyMobile</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// éªŒè¯æ‰‹æœºå·ï¼Œè®°å¾—ç»™ mobile ä¸€ä¸ªé»˜è®¤å€¼ä¸º &#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">const</span> reg = <span class="regexp">/^[1][3-8][0-9]&#123;9&#125;$/</span></span><br><span class="line">        <span class="keyword">const</span> valid = reg.test(<span class="built_in">this</span>.data.mobile.trim())</span><br><span class="line">        <span class="comment">// éªŒè¯ç»“æœæç¤º</span></span><br><span class="line">        <span class="keyword">if</span> (!valid) wx.utils.toast(<span class="string">&#x27;è¯·å¡«å†™æ­£ç¡®çš„æ‰‹æœºå·ç !&#x27;</span>)</span><br><span class="line">        <span class="comment">// è¿”å›éªŒè¯ç»“æœ</span></span><br><span class="line">        <span class="keyword">return</span> valid</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="title">verifyDate</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// éªŒè¯æ—¥æœŸæ ¼å¼</span></span><br><span class="line">        <span class="keyword">const</span> reg = <span class="regexp">/^\d&#123;4&#125;\/\d&#123;2&#125;\/\d&#123;2&#125;$/</span></span><br><span class="line">        <span class="keyword">const</span> valid = reg.test(<span class="built_in">this</span>.data.appointment)</span><br><span class="line">        <span class="comment">// éªŒè¯ç»“æœæç¤º</span></span><br><span class="line">        <span class="keyword">if</span> (!valid) wx.utils.toast(<span class="string">&#x27;è¯·é€‰æ‹©é¢„çº¦æ—¥æœŸ!&#x27;</span>)</span><br><span class="line">        <span class="comment">// è¿”å›éªŒè¯ç»“æœ</span></span><br><span class="line">        <span class="keyword">return</span> valid</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="title">verifyDescription</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// éªŒè¯æŠ¥ä¿®é¡¹ç›®æè¿°ï¼Œè®°å¾—ç»™ description ä¸€ä¸ªé»˜è®¤å€¼ä¸º &#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">const</span> valid = <span class="built_in">this</span>.data.description.trim() !== <span class="string">&#x27;&#x27;</span></span><br><span class="line">        <span class="comment">// éªŒè¯ç»“æœæç¤º</span></span><br><span class="line">        <span class="keyword">if</span> (!valid) wx.utils.toast(<span class="string">&#x27;è¯·å¡«å†™é—®é¢˜æè¿°!&#x27;</span>)</span><br><span class="line">        <span class="comment">// è¿”å›éªŒè¯ç»“æœ</span></span><br><span class="line">        <span class="keyword">return</span> valid</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>ç›‘å¬ç”¨æˆ·æäº¤æŠ¥ä¿®æŒ‰é’®çš„ç‚¹å‡»äº‹ä»¶ï¼Œè°ƒç”¨æ¥å£ã€‚</li>
</ol>
<ul>
<li><p>æ¥å£è·¯å¾„ï¼š<code>/repair</code>ã€‚</p>
</li>
<li><p>è¯·æ±‚æ–¹æ³•: POSTã€‚</p>
</li>
<li><p>è¯·æ±‚å‚æ•°ï¼š</p>
<ul>
<li><p>houseId æŠ¥ä¿®æˆ¿å±‹çš„ idã€‚</p>
</li>
<li><p>repairItemId æŠ¥ä¿®é¡¹ç›®çš„ idã€‚</p>
</li>
<li><p>mobile æŠ¥ä¿®äººç”µè¯å·ç ã€‚</p>
</li>
<li><p>appointment é¢„çº¦ä¸Šé—¨ç»´ä¿®æ—¶é—´ã€‚</p>
</li>
<li><p>description ç»´ä¿®é—®é¢˜æè¿°ã€‚</p>
</li>
<li><p>attachment ç»´ä¿®é—®é¢˜ç…§ç‰‡ã€‚</p>
</li>
</ul>
</li>
<li><p>Headersï¼š</p>
<ul>
<li>Authorizationã€‚</li>
</ul>
</li>
<li><p>å“åº”æ•°æ®ï¼š<a target="_blank" rel="noopener" href="https://www.apifox.cn/apidoc/shared-8d66c345-7a9a-4844-9a5a-1201852f6faa/api-41400754">è§æ–‡æ¡£</a>ã€‚</p>
</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- repari_pkg/pages/form/index.wxml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;toolbar&quot;</span> <span class="attr">bind:tap</span>=<span class="string">&quot;submitForm&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;enjoy-icon icon-repair&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;button-text&quot;</span>&gt;</span>æäº¤æŠ¥ä¿®<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">Page(&#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="title">submitForm</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// #1 é€ä¸ªéªŒè¯è¡¨å•æ•°æ®</span></span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">this</span>.verifyHouse()) <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">this</span>.verifyRepair()) <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">this</span>.verifyMobile()) <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">this</span>.verifyDate()) <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">this</span>.verifyDescription()) <span class="keyword">return</span></span><br><span class="line">        <span class="comment">// #2 è§£æ„è·å–æ¥å£éœ€è¦çš„å‚æ•°</span></span><br><span class="line">        <span class="keyword">const</span> &#123;</span><br><span class="line">            houseId,</span><br><span class="line">            repairItemId,</span><br><span class="line">            appointment,</span><br><span class="line">            mobile,</span><br><span class="line">            description,</span><br><span class="line">            attachment</span><br><span class="line">        &#125; = <span class="built_in">this</span>.data</span><br><span class="line">        <span class="comment">// #3 è¯·æ±‚æ•°æ®æ¥å£</span></span><br><span class="line">        <span class="keyword">const</span> &#123;</span><br><span class="line">            code</span><br><span class="line">        &#125; = <span class="keyword">await</span> wx.http.post(<span class="string">&#x27;/repair&#x27;</span>, &#123;</span><br><span class="line">            houseId,</span><br><span class="line">            repairItemId,</span><br><span class="line">            appointment,</span><br><span class="line">            mobile,</span><br><span class="line">            description,</span><br><span class="line">            attachment</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="comment">// #4 æ£€æµ‹æ¥å£è¯·æ±‚çš„ç»“æœ</span></span><br><span class="line">        <span class="keyword">if</span> (code !== <span class="number">10000</span>) <span class="keyword">return</span> wx.showToast(&#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;åœ¨çº¿æŠ¥ä¿®å¤±è´¥!&#x27;</span>,</span><br><span class="line">            <span class="attr">icon</span>: <span class="string">&#x27;none&#x27;</span></span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="comment">// #5 è·³è½¬åˆ°æŠ¥ä¿®åˆ—è¡¨é¡µé¢</span></span><br><span class="line">        wx.redirectTo(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">&#x27;/repair_pkg/pages/list/index&#x27;</span>,</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>æäº¤ä»£ç ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹å½“å‰è¢«ä¿®æ”¹çš„æ–‡ä»¶</span></span><br><span class="line">git status</span><br><span class="line"><span class="comment"># æš‚å­˜æ–‡ä»¶</span></span><br><span class="line">git add .</span><br><span class="line"><span class="comment"># æäº¤åˆ°æœ¬åœ°</span></span><br><span class="line">git commit -m <span class="string">&#x27;feat(repair): å®Œæˆåœ¨çº¿å¡«å†™æŠ¥ä¿®ä¿¡æ¯çš„åŠŸèƒ½&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="æŠ¥ä¿®åˆ—è¡¨"><a href="#æŠ¥ä¿®åˆ—è¡¨" class="headerlink" title="æŠ¥ä¿®åˆ—è¡¨"></a>æŠ¥ä¿®åˆ—è¡¨</h3><ol>
<li>ç›´æ¥è°ƒç”¨åç«¯æ¥å£è·å–æ•°æ®ã€‚</li>
</ol>
<ul>
<li><p>æ¥å£è·¯å¾„ï¼š<code>/repair</code>ã€‚</p>
</li>
<li><p>è¯·æ±‚æ–¹æ³•: GETã€‚</p>
</li>
<li><p>è¯·æ±‚å‚æ•°ï¼š</p>
<ul>
<li><p>current å½“å‰è¯·æ±‚æ•°æ®çš„é¡µç ã€‚</p>
</li>
<li><p>pageSize æ¯é¡µè¯·æ±‚è·å¾—çš„æ•°æ®æ¡æ•°ã€‚</p>
</li>
</ul>
</li>
<li><p>Headersï¼š</p>
<ul>
<li>Authorizationã€‚</li>
</ul>
</li>
<li><p>å“åº”æ•°æ®ï¼š<a target="_blank" rel="noopener" href="https://www.apifox.cn/apidoc/shared-8d66c345-7a9a-4844-9a5a-1201852f6faa/api-41400755">è§æ–‡æ¡£</a>ã€‚</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// repair_pkg/pages/list/index.wxml</span></span><br><span class="line">Page(&#123;</span><br><span class="line">    <span class="function"><span class="title">onShow</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// è·å–æŠ¥ä¿®åˆ—è¡¨</span></span><br><span class="line">        <span class="built_in">this</span>.getRepairList()</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="title">getRepairList</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// è¯·æ±‚æ•°æ®æ¥å£</span></span><br><span class="line">        <span class="keyword">const</span> &#123;</span><br><span class="line">            code,</span><br><span class="line">            <span class="attr">data</span>: &#123;</span><br><span class="line">                <span class="attr">rows</span>: repairList</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; = <span class="keyword">await</span> wx.http.get(<span class="string">&#x27;/repair&#x27;</span>, &#123;</span><br><span class="line">            <span class="attr">current</span>: <span class="number">1</span>,</span><br><span class="line">            <span class="attr">pageSize</span>: <span class="number">10</span></span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="comment">// æ£€æµ‹æ¥å£è°ƒç”¨çš„ç»“æœ</span></span><br><span class="line">        <span class="keyword">if</span> (code !== <span class="number">10000</span>) <span class="keyword">return</span> wx.utils.toast(<span class="string">&#x27;è·å–æŠ¥ä¿®åˆ—è¡¨å¤±è´¥!&#x27;</span>)</span><br><span class="line">        <span class="comment">// æ¸²æŸ“æŠ¥ä¿®åˆ—è¡¨</span></span><br><span class="line">        <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">            repairList,</span><br><span class="line">            <span class="attr">isEmpty</span>: repairList.length === <span class="number">0</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>è¿”å›çš„æ•°æ®å½“ä¸­ status è¡¨ç¤ºå½“å‰æŠ¥ä¿®é¡¹ç›®è¿›è¡Œçš„çŠ¶æ€ã€‚</p>
<ul>
<li><p>å€¼ä¸º 1 è¡¨ç¤ºå—ç†ä¸­ï¼Œå¯¹åº”çš„æ ·å¼ç±»å infoã€‚</p>
</li>
<li><p>å€¼ä¸º 2 è¡¨ç¤ºä¸Šé—¨ä¸­ï¼Œå¯¹åº”çš„æ ·å¼ç±»å successã€‚</p>
</li>
<li><p>å€¼ä¸º 3 è¡¨ç¤ºå·²å®Œæˆï¼Œå¯¹åº”çš„æ ·å¼ç±»å completeã€‚</p>
</li>
<li><p>å€¼ä¸º 0 è¡¨ç¤ºå·²å–æ¶ˆï¼Œå¯¹åº”çš„æ ·å¼ç±»å cancelã€‚</p>
</li>
</ul>
<ol start="2">
<li>åœ¨æ¨¡æ¿ä¸­æ¸²æŸ“åç«¯è¿”å›çš„æ•°æ®ã€‚</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- repair_pkg/pages/list/index.wxml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">authorization</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">block</span> <span class="attr">wx:if</span>=<span class="string">&quot;&#123;&#123;!isEmpty&#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scroll-view</span> <span class="attr">show-scrollbar</span>=<span class="string">&quot;&#123;&#123;false&#125;&#125;&quot;</span> <span class="attr">enhanced</span> <span class="attr">scroll-y</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;repairs&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;repairs-title&quot;</span>&gt;</span>æˆ‘çš„æŠ¥ä¿®<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;repairs-list&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">van-cell-group</span> <span class="attr">wx:for</span>=<span class="string">&quot;&#123;&#123;repairList&#125;&#125;&quot;</span> <span class="attr">wx:key</span>=<span class="string">&quot;id&quot;</span> <span class="attr">border</span>=<span class="string">&quot;&#123;&#123;false&#125;&#125;&quot;</span> <span class="attr">bind:tap</span>=<span class="string">&quot;goDetail&quot;</span> <span class="attr">mark:id</span>=<span class="string">&quot;&#123;&#123;item.id&#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">size</span>=<span class="string">&quot;large&quot;</span> <span class="attr">title</span>=<span class="string">&quot;&#123;&#123;item.houseInfo&#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;tag info&quot;</span> <span class="attr">wx:if</span>=<span class="string">&quot;&#123;&#123;item.status === 1&#125;&#125;&quot;</span>&gt;</span>å—ç†ä¸­<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;tag success&quot;</span> <span class="attr">wx:if</span>=<span class="string">&quot;&#123;&#123;item.status === 2&#125;&#125;&quot;</span>&gt;</span>ä¸Šé—¨ä¸­<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;tag complete&quot;</span> <span class="attr">wx:if</span>=<span class="string">&quot;&#123;&#123;item.status === 3&#125;&#125;&quot;</span>&gt;</span>å·²å®Œæˆ<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;tag cancel&quot;</span> <span class="attr">wx:if</span>=<span class="string">&quot;&#123;&#123;item.status === 0&#125;&#125;&quot;</span>&gt;</span>å·²å–æ¶ˆ<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">van-cell</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title</span>=<span class="string">&quot;æŠ¥ä¿®é¡¹ç›®&quot;</span> <span class="attr">border</span>=<span class="string">&quot;&#123;&#123;false&#125;&#125;&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&#123;&#123;item.repairItemName&#125;&#125;&quot;</span> /&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title</span>=<span class="string">&quot;é¢„çº¦æ—¶é—´&quot;</span> <span class="attr">border</span>=<span class="string">&quot;&#123;&#123;false&#125;&#125;&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&#123;&#123;item.appointment&#125;&#125;&quot;</span> /&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title</span>=<span class="string">&quot;ç”µè¯å·ç &quot;</span> <span class="attr">border</span>=<span class="string">&quot;&#123;&#123;false&#125;&#125;&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&#123;&#123;item.mobile&#125;&#125;&quot;</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">van-cell-group</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">scroll-view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;toolbar&quot;</span> <span class="attr">bind:tap</span>=<span class="string">&quot;addRepair&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;enjoy-icon icon-repair&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;button-text&quot;</span>&gt;</span>åœ¨çº¿æŠ¥ä¿®<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">block</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">wx:else</span> <span class="attr">class</span>=<span class="string">&quot;blank&quot;</span>&gt;</span></span><br><span class="line">        æ‚¨è¿˜æ²¡æœ‰æŠ¥ä¿®è®°å½•ï¼Œè¯·ç‚¹å‡»</span><br><span class="line">        <span class="tag">&lt;<span class="name">navigator</span> <span class="attr">hover-class</span>=<span class="string">&quot;none&quot;</span> <span class="attr">class</span>=<span class="string">&quot;link&quot;</span> <span class="attr">url</span>=<span class="string">&quot;/repair_pkg/pages/form/index&quot;</span>&gt;</span>æ·»åŠ <span class="tag">&lt;/<span class="name">navigator</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">authorization</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä¸ºäº†æ–¹ä¾¿å¼€å‘æµ‹è¯•ï¼Œåç«¯æä¾›äº†ä¸€ä¸ªæ¥å£ä¸“é—¨ç”¨æ¥ä¿®æ”¹æŠ¥ä¿®é¡¹ç›®çŠ¶æ€çš„<a target="_blank" rel="noopener" href="https://www.apifox.cn/apidoc/shared-8d66c345-7a9a-4844-9a5a-1201852f6faa/api-42672273">æ¥å£</a>ï¼Œç›´æ¥åœ¨ apifox åœ¨çº¿è°ƒç”¨æ¥å£å³å¯ã€‚</p>
<p>æäº¤ä»£ç ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹å½“å‰è¢«ä¿®æ”¹çš„æ–‡ä»¶</span></span><br><span class="line">git status</span><br><span class="line"><span class="comment"># æš‚å­˜æ–‡ä»¶</span></span><br><span class="line">git add .</span><br><span class="line"><span class="comment"># æäº¤åˆ°æœ¬åœ°</span></span><br><span class="line">git commit -m <span class="string">&#x27;feat(repair): å®ŒæˆæŸ¥è¯¢æŠ¥ä¿®åˆ—è¡¨çš„åŠŸèƒ½&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="æŠ¥ä¿®è¯¦æƒ…"><a href="#æŠ¥ä¿®è¯¦æƒ…" class="headerlink" title="æŠ¥ä¿®è¯¦æƒ…"></a>æŠ¥ä¿®è¯¦æƒ…</h3><h4 id="æ•°æ®æ¸²æŸ“"><a href="#æ•°æ®æ¸²æŸ“" class="headerlink" title="æ•°æ®æ¸²æŸ“"></a>æ•°æ®æ¸²æŸ“</h4><ol>
<li>è·³è½¬åˆ°è¯¦æƒ…é¡µé¢æ—¶ï¼Œä¼ é€’æŠ¥ä¿®é¡¹ç›®çš„ IDã€‚</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- repair_pkg/pages/list/index.wxml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">van-cell-group</span> <span class="attr">wx:for</span>=<span class="string">&quot;&#123;&#123;repairList&#125;&#125;&quot;</span> <span class="attr">wx:key</span>=<span class="string">&quot;id&quot;</span> <span class="attr">border</span>=<span class="string">&quot;&#123;&#123;false&#125;&#125;&quot;</span> <span class="attr">bind:tap</span>=<span class="string">&quot;goDetail&quot;</span> <span class="attr">mark:id</span>=<span class="string">&quot;&#123;&#123;item.id&#125;&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">van-cell-group</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// repair_pkg/pages/list/index.js</span></span><br><span class="line">Page(&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="function"><span class="title">goDetail</span>(<span class="params">ev</span>)</span> &#123;</span><br><span class="line">        wx.navigateTo(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">&#x27;/repair_pkg/pages/detail/index?id=&#x27;</span> + ev.mark.id,</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>åœ¨è¯¦æƒ…é¡µï¼Œæ ¹æ®æ¥æ”¶åˆ°çš„ ID è¯·æ±‚æ•°æ®ã€‚</li>
</ol>
<ul>
<li><p>æ¥å£è·¯å¾„ï¼š<code>/repair/:id</code>ã€‚</p>
</li>
<li><p>è¯·æ±‚æ–¹æ³•: GETã€‚</p>
</li>
<li><p>è¯·æ±‚å‚æ•°ï¼š</p>
<ul>
<li>id æŠ¥ä¿®é¡¹ç›®çš„ idã€‚</li>
</ul>
</li>
<li><p>Headersï¼š</p>
<ul>
<li>Authorizationã€‚</li>
</ul>
</li>
<li><p>å“åº”æ•°æ®ï¼š<a target="_blank" rel="noopener" href="https://www.apifox.cn/apidoc/shared-8d66c345-7a9a-4844-9a5a-1201852f6faa/api-41400757">è§æ–‡æ¡£</a>ã€‚</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// repair_pkg/pages/detail/index.js</span></span><br><span class="line"><span class="keyword">let</span> repair_id = <span class="string">&#x27;&#x27;</span></span><br><span class="line">Page(&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="function"><span class="title">onLoad</span>(<span class="params">&#123;</span></span></span><br><span class="line"><span class="params"><span class="function">        id</span></span></span><br><span class="line"><span class="params"><span class="function">    &#125;</span>)</span> &#123;</span><br><span class="line">        <span class="comment">// è·å–ç»´ä¿®è¯¦æƒ…</span></span><br><span class="line">        <span class="built_in">this</span>.getRepairDetail((repair_id = id))</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="title">getRepairDetail</span>(<span class="params">id</span>)</span> &#123;</span><br><span class="line">        <span class="comment">// id ä¸å­˜åœ¨å°±ä¸å¿…å‘è¯·æ±‚äº†</span></span><br><span class="line">        <span class="keyword">if</span> (!id) <span class="keyword">return</span></span><br><span class="line">        <span class="comment">// è¯·æ±‚æ•°æ®æ¥å£</span></span><br><span class="line">        <span class="keyword">const</span> &#123;</span><br><span class="line">            code,</span><br><span class="line">            <span class="attr">data</span>: repairDetail</span><br><span class="line">        &#125; = <span class="keyword">await</span> wx.http.get(<span class="string">&#x27;/repair/&#x27;</span> + id)</span><br><span class="line">        <span class="comment">// æ ¡éªŒæ¥å£è°ƒç”¨ç»“æœ</span></span><br><span class="line">        <span class="keyword">if</span> (code !== <span class="number">10000</span>) <span class="keyword">return</span> wx.utils.toast(<span class="string">&#x27;è·å–æŠ¥ä¿®è¯¦æƒ…å¤±è´¥!&#x27;</span>)</span><br><span class="line">        <span class="comment">// æ¸²æŸ“æŠ¥ä¿®è¯¦æƒ…</span></span><br><span class="line">        <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">            ...repairDetail</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>æ¸²æŸ“æ•°æ®åˆ°æ¨¡æ¿ä¸­ã€‚</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- repair_pkg/pages/detail/index.wxml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">authorization</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scroll-view</span> <span class="attr">scroll-y</span> <span class="attr">enhanced</span> <span class="attr">show-scrollbar</span>=<span class="string">&quot;&#123;&#123;false&#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;repair-detail&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- åœ°å›¾ç»„ä»¶ï¼Œåªæœ‰å¤„äºä¸Šé—¨ä¸­çŠ¶æ€æ‰æ˜¾ç¤º --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;polyline&quot;</span> <span class="attr">wx:if</span>=<span class="string">&quot;&#123;&#123;status === 2&#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">map</span> <span class="attr">style</span>=<span class="string">&quot;width: 100%; height: 100%;&quot;</span> <span class="attr">scale</span>=<span class="string">&quot;16&quot;</span> <span class="attr">latitude</span>=<span class="string">&quot;&#123;&#123;latitude&#125;&#125;&quot;</span> <span class="attr">longitude</span>=<span class="string">&quot;&#123;&#123;longitude&#125;&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">map</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">van-cell-group</span> <span class="attr">border</span>=<span class="string">&quot;&#123;&#123;false&#125;&#125;&quot;</span> <span class="attr">title</span>=<span class="string">&quot;æˆ¿å±‹ä¿¡æ¯&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title</span>=<span class="string">&quot;&#123;&#123;houseInfo&#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;tag info&quot;</span> <span class="attr">wx:if</span>=<span class="string">&quot;&#123;&#123;status === 1&#125;&#125;&quot;</span>&gt;</span>å—ç†ä¸­<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;tag success&quot;</span> <span class="attr">wx:if</span>=<span class="string">&quot;&#123;&#123;status === 2&#125;&#125;&quot;</span>&gt;</span>ä¸Šé—¨ä¸­<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;tag complete&quot;</span> <span class="attr">wx:if</span>=<span class="string">&quot;&#123;&#123;status === 3&#125;&#125;&quot;</span>&gt;</span>å·²å®Œæˆ<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;tag cancel&quot;</span> <span class="attr">wx:if</span>=<span class="string">&quot;&#123;&#123;status === 0&#125;&#125;&quot;</span>&gt;</span>å·²å–æ¶ˆ<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">van-cell</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">van-cell-group</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">van-cell-group</span> <span class="attr">title</span>=<span class="string">&quot;æŠ¥ä¿®ä¿¡æ¯&quot;</span> <span class="attr">border</span>=<span class="string">&quot;&#123;&#123;false&#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title-width</span>=<span class="string">&quot;200rpx&quot;</span> <span class="attr">title</span>=<span class="string">&quot;ç»´ä¿®é¡¹ç›®&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&#123;&#123;repairItemName&#125;&#125;&quot;</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title-width</span>=<span class="string">&quot;200rpx&quot;</span> <span class="attr">title</span>=<span class="string">&quot;æ‰‹æœºå·ç &quot;</span> <span class="attr">value</span>=<span class="string">&quot;&#123;&#123;mobile&#125;&#125;&quot;</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title-width</span>=<span class="string">&quot;200rpx&quot;</span> <span class="attr">title</span>=<span class="string">&quot;é¢„çº¦æ—¥æœŸ&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&#123;&#123;appointment&#125;&#125;&quot;</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title</span>=<span class="string">&quot;é—®é¢˜æè¿°&quot;</span> <span class="attr">label</span>=<span class="string">&quot;&#123;&#123;description&#125;&#125;&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">van-cell-group</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;attachment&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;title&quot;</span>&gt;</span>é—®é¢˜é™„ä»¶<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">scroll-view</span> <span class="attr">scroll-x</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">image</span> <span class="attr">wx:for</span>=<span class="string">&quot;&#123;&#123;attachment&#125;&#125;&quot;</span> <span class="attr">wx:key</span>=<span class="string">&quot;id&quot;</span> <span class="attr">src</span>=<span class="string">&quot;&#123;&#123;item.url&#125;&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">scroll-view</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">scroll-view</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- åªèƒ½å—ç†ä¸­çŠ¶æ€æ˜¯æ‰å…è®¸å–æ¶ˆæŠ¥ä¿®æˆ–ä¿®æ”¹æŠ¥ä¿® --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;toolbar&quot;</span> <span class="attr">wx:if</span>=<span class="string">&quot;&#123;&#123;status === 1&#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;button-text active&quot;</span>&gt;</span>ä¿®æ”¹ä¿¡æ¯<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">bind:tap</span>=<span class="string">&quot;test&quot;</span> <span class="attr">class</span>=<span class="string">&quot;button-text&quot;</span>&gt;</span>å–æ¶ˆæŠ¥ä¿®<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">authorization</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æäº¤ä»£ç ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹å½“å‰è¢«ä¿®æ”¹çš„æ–‡ä»¶</span></span><br><span class="line">git status</span><br><span class="line"><span class="comment"># æš‚å­˜æ–‡ä»¶</span></span><br><span class="line">git add .</span><br><span class="line"><span class="comment"># æäº¤åˆ°æœ¬åœ°</span></span><br><span class="line">git commit -m <span class="string">&#x27;feat(repair): å®ŒæˆæŸ¥è¯¢æŠ¥ä¿®é¡¹ç›®è¯¦æƒ…çš„åŠŸèƒ½&#x27;</span></span><br></pre></td></tr></table></figure>

<h4 id="ä¸Šé—¨è·¯çº¿"><a href="#ä¸Šé—¨è·¯çº¿" class="headerlink" title="ä¸Šé—¨è·¯çº¿"></a>ä¸Šé—¨è·¯çº¿</h4><ol>
<li>å°ç¨‹åºä¸­æœ‰ä¸€ä¸ªä¸“é—¨å±•ç¤ºåœ°å€çš„ç»„ä»¶ mapï¼Œç›´æ¥å°†ç»„ä»¶å†™åˆ°é¡µé¢å½“ä¸­å°±ä¼šå±•ç¤ºåœ°å›¾ï¼Œä¸€äº›å¸¸ç”¨çš„ç»„ä»¶å±æ€§å¦‚ä¸‹ã€‚</li>
</ol>
<ul>
<li><p>latitude åœ°å›¾ä¸­å¿ƒçš„ç»åº¦ã€‚</p>
</li>
<li><p>longitude åœ°å›¾ä¸­å¿ƒçš„çº¬åº¦ã€‚</p>
</li>
<li><p>scale åœ°å›¾åˆå§‹çš„ç¼©æ”¾æ¯”ä¾‹ã€‚</p>
</li>
<li><p>markers åœ°å›¾ä¸Šçš„æ ‡è®°ã€‚</p>
</li>
<li><p>polyline åœ°å›¾è·¯çº¿ã€‚</p>
</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">map</span> <span class="attr">markers</span>=<span class="string">&quot;&#123;&#123;markers&#125;&#125;&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width: 100%; height: 100%;&quot;</span> <span class="attr">scale</span>=<span class="string">&quot;14.5&quot;</span> <span class="attr">latitude</span>=<span class="string">&quot;&#123;&#123;markers[0].latitude&#125;&#125;&quot;</span> <span class="attr">longitude</span>=<span class="string">&quot;&#123;&#123;markers[0].longitude&#125;&#125;&quot;</span> <span class="attr">polyline</span>=<span class="string">&quot;&#123;&#123;[]&#125;&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">map</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// repair_pkg/pages/detail/index.js</span></span><br><span class="line">Page(&#123;</span><br><span class="line">    <span class="attr">data</span>: &#123;</span><br><span class="line">        <span class="attr">markers</span>: [&#123;</span><br><span class="line">                <span class="attr">id</span>: <span class="number">1</span>,</span><br><span class="line">                <span class="comment">// å­¦æ ¡</span></span><br><span class="line">                <span class="attr">latitude</span>: <span class="number">30.71326903396565</span>, <span class="comment">// ç»åº¦</span></span><br><span class="line">                <span class="attr">longitude</span>: <span class="number">114.40691808969243</span>, <span class="comment">// çº¬åº¦</span></span><br><span class="line">                <span class="attr">width</span>: <span class="number">24</span>,</span><br><span class="line">                <span class="attr">height</span>: <span class="number">30</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">id</span>: <span class="number">2</span>,</span><br><span class="line">                <span class="comment">// ä¸‹è´©æ–°è‹‘</span></span><br><span class="line">                <span class="attr">latitude</span>: <span class="number">30.71317488159291</span>,</span><br><span class="line">                <span class="attr">longitude</span>: <span class="number">114.39899701136655</span>,</span><br><span class="line">                <span class="attr">iconPath</span>: <span class="string">&#x27;/static/images/marker.png&#x27;</span>,</span><br><span class="line">                <span class="attr">width</span>: <span class="number">40</span>,</span><br><span class="line">                <span class="attr">height</span>: <span class="number">40</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">// &#123;</span></span><br><span class="line">            <span class="comment">//   id: 2,</span></span><br><span class="line">            <span class="comment">//   // å…‰è°·ä½›ç¥–å²­ G åŒº</span></span><br><span class="line">            <span class="comment">//   latitude: 30.438011271240395,</span></span><br><span class="line">            <span class="comment">//   longitude: 114.46212300565537,</span></span><br><span class="line">            <span class="comment">//   iconPath: &#x27;/static/images/marker.png&#x27;,</span></span><br><span class="line">            <span class="comment">//   width: 40,</span></span><br><span class="line">            <span class="comment">//   height: 40,</span></span><br><span class="line">            <span class="comment">// &#125;,</span></span><br><span class="line">        ],</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="http://www.metools.info/learn/jingweidu200.html">æ ¹æ®ä½ç½®å¾—åˆ°ç»çº¬åº¦</a>ï¼Œä¸Šè¿°ä»£ç ä¸­çš„ç»çº¬åº¦æ˜¯å­¦æ ¡å’Œé™„è¿‘çš„ä¸€ä¸ªå°åŒºï¼Œå¤§å®¶å¯ä»¥è‡ªç”±æŒ‡å®šï¼ˆä¸¤ç‚¹è·ç¦»ä¸è¦ç›¸å·®å¤ªè¿œï¼‰ã€‚</p>
<ol start="2">
<li>é€šè¿‡å¾®ä¿¡å°ç¨‹åºçš„åœ°å›¾æœåŠ¡ <a target="_blank" rel="noopener" href="https://lbs.qq.com/miniProgram/jsSdk/jsSdkGuide/methodDirection">SDK</a> ç”Ÿæˆè·¯çº¿è§„åˆ’çš„åæ ‡ç‚¹ã€‚</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> qqMap <span class="keyword">from</span> <span class="string">&#x27;../../../utils/qqmap&#x27;</span></span><br><span class="line">Page(&#123;</span><br><span class="line">    <span class="function"><span class="title">onLoad</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">        <span class="built_in">this</span>.createPolyLine()</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="title">createPolyLine</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// #1 è°ƒç”¨è·ç¦»è®¡ç®—æ¥å£</span></span><br><span class="line">        qqMap.direction(&#123;</span><br><span class="line">            <span class="comment">// #2 äº¤é€šå·¥å…·çš„ç±»å‹</span></span><br><span class="line">            <span class="attr">mode</span>: <span class="string">&#x27;bicycling&#x27;</span>,</span><br><span class="line">            <span class="comment">// #3 ä¸å¡«é»˜è®¤å½“å‰åœ°å€ï¼Œä»å“ª</span></span><br><span class="line">            <span class="attr">from</span>: <span class="string">&#x27;30.71317488159291,114.39899701136655&#x27;</span>, <span class="comment">// ä¸‹è´©æ–°è‹‘</span></span><br><span class="line">            <span class="attr">to</span>: <span class="string">&#x27;30.71326903396565,114.40691808969243&#x27;</span>, <span class="comment">// ä¼ æ™ºæ’­å®¢</span></span><br><span class="line">            <span class="attr">success</span>: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">const</span> coords = res.result.routes[<span class="number">0</span>].polyline</span><br><span class="line">                <span class="keyword">const</span> points = []</span><br><span class="line">                <span class="comment">// #4 ç”Ÿæˆæ–°çš„åæ ‡ç‚¹ï¼ˆåœ°å›¾çš„ç®—æ³•ï¼Œæ— éœ€å…³å¿ƒï¼‰</span></span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">2</span>; i &lt; coords.length; i++) &#123;</span><br><span class="line">                    coords[i] = <span class="built_in">Number</span>(coords[i - <span class="number">2</span>]) + <span class="built_in">Number</span>(coords[i]) / <span class="number">1000000</span></span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// #5 å°†æ–°çš„åæ ‡ç‚¹åŠ å·¥ä¸€ä¸‹æ€¼åˆ°éœ€è¦çš„æ–°æ•°ç»„æ ¼å¼</span></span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; coords.length; i += <span class="number">2</span>) &#123;</span><br><span class="line">                    points.push(&#123;</span><br><span class="line">                        <span class="attr">latitude</span>: coords[i],</span><br><span class="line">                        <span class="attr">longitude</span>: coords[i + <span class="number">1</span>]</span><br><span class="line">                    &#125;)</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// #6 è®¾ç½® polyline å±æ€§ï¼Œå°†è·¯çº¿æ˜¾ç¤ºå‡ºæ¥</span></span><br><span class="line">                <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">                    <span class="attr">polyline</span>: [&#123;</span><br><span class="line">                        points,</span><br><span class="line">                        <span class="attr">color</span>: <span class="string">&#x27;#5591af&#x27;</span>,</span><br><span class="line">                        <span class="attr">width</span>: <span class="number">4</span>,</span><br><span class="line">                    &#125;, ],</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">fail</span>: <span class="function"><span class="keyword">function</span>(<span class="params">error</span>) </span>&#123;</span><br><span class="line">                <span class="built_in">console</span>.error(error)</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="å–æ¶ˆæŠ¥ä¿®"><a href="#å–æ¶ˆæŠ¥ä¿®" class="headerlink" title="å–æ¶ˆæŠ¥ä¿®"></a>å–æ¶ˆæŠ¥ä¿®</h3><p>å½“æŠ¥ä¿®é¡¹ç›®çš„çŠ¶æ€å¤„äº<strong>å—ç†ä¸­</strong>æ—¶ï¼Œç”¨æˆ·å¯ä»¥è¯¦æƒ…é¡µé¢ä¸»åŠ¨å–æ¶ˆæœ¬æ¬¡æŠ¥ä¿®ã€‚</p>
<ol>
<li>å‡†å¤‡ä¸€ä¸ªç¡®è®¤æç¤ºæ¡†ã€‚</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- repair_pkg/pages/detail/index.wxml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">van-dialog</span> <span class="attr">message</span>=<span class="string">&quot;æ˜¯å¦è¦å–æ¶ˆæœ¬æ¬¡æŠ¥ä¿®ï¼Ÿ&quot;</span> <span class="attr">showCancelButton</span> <span class="attr">show</span>=<span class="string">&quot;&#123;&#123;dialogVisible&#125;&#125;&quot;</span> <span class="attr">cancel-button-color</span>=<span class="string">&quot;#848484&quot;</span> <span class="attr">confirm-button-color</span>=<span class="string">&quot;#5591af&quot;</span> <span class="attr">bind:close</span>=<span class="string">&quot;dialogClose&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨ dialogVisible æ•°æ®æ§åˆ¶ç¡®è®¤æ¡†æ˜¯å¦æ˜¾ç¤ºã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Page(&#123;</span><br><span class="line">    <span class="attr">data</span>: &#123;</span><br><span class="line">        <span class="attr">dialogVisible</span>: <span class="literal">false</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="title">dialogClose</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>åœ¨ç”¨æˆ·ç‚¹ã€å–æ¶ˆæŠ¥ä¿®ã€‘æŒ‰é’®åæ˜¾ç¤ºç¡®è®¤æ¡†ã€‚</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- åªèƒ½å—ç†ä¸­çŠ¶æ€æ˜¯æ‰å…è®¸å–æ¶ˆæŠ¥ä¿®æˆ–ä¿®æ”¹æŠ¥ä¿® --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;toolbar&quot;</span> <span class="attr">wx:if</span>=<span class="string">&quot;&#123;&#123;status === 1&#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;button-text active&quot;</span>&gt;</span>ä¿®æ”¹ä¿¡æ¯<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">bind:tap</span>=<span class="string">&quot;openDialogLayer&quot;</span> <span class="attr">class</span>=<span class="string">&quot;button-text&quot;</span>&gt;</span>å–æ¶ˆæŠ¥ä¿®<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Page(&#123;</span><br><span class="line">    <span class="comment">// æ‰“å¼€ç¡®è®¤æ¡†</span></span><br><span class="line">    <span class="function"><span class="title">openDialogLayer</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">            <span class="attr">dialogVisible</span>: <span class="literal">true</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>ç›‘å¬å¼¹æ¡†çš„å…³é—­äº‹ä»¶ï¼Œå½“ç‚¹å‡»çš„æ˜¯ç¡®å®šæŒ‰é’®æ—¶ï¼Œè°ƒç”¨å–æ¶ˆæŠ¥ä¿®çš„æ¥å£ã€‚</li>
</ol>
<ul>
<li><p>æ¥å£è·¯å¾„ï¼š<code>/cancel/repaire/:id</code>ã€‚</p>
</li>
<li><p>è¯·æ±‚æ–¹æ³•: PUTã€‚</p>
</li>
<li><p>è¯·æ±‚å‚æ•°ï¼š</p>
<ul>
<li>id æŠ¥ä¿®é¡¹ç›®çš„ idã€‚</li>
</ul>
</li>
<li><p>Headersï¼š</p>
<ul>
<li>Authorizationã€‚</li>
</ul>
</li>
<li><p>å“åº”æ•°æ®ï¼š<a target="_blank" rel="noopener" href="https://www.apifox.cn/apidoc/shared-8d66c345-7a9a-4844-9a5a-1201852f6faa/api-41400752">è§æ–‡æ¡£</a>ã€‚</p>
</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">van-dialog</span> <span class="attr">message</span>=<span class="string">&quot;æ˜¯å¦è¦å–æ¶ˆæœ¬æ¬¡æŠ¥ä¿®ï¼Ÿ&quot;</span> <span class="attr">showCancelButton</span> <span class="attr">show</span>=<span class="string">&quot;&#123;&#123;dialogVisible&#125;&#125;&quot;</span> <span class="attr">cancel-button-color</span>=<span class="string">&quot;#848484&quot;</span> <span class="attr">confirm-button-color</span>=<span class="string">&quot;#5591af&quot;</span> <span class="attr">bind:close</span>=<span class="string">&quot;dialogClose&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Page(&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="title">cancelRepair</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// è¯·æ±‚æ•°æ®æ¥å£</span></span><br><span class="line">        <span class="keyword">const</span> &#123;</span><br><span class="line">            code</span><br><span class="line">        &#125; = <span class="keyword">await</span> wx.http.put(<span class="string">&#x27;/cancel/repaire/&#x27;</span> + repair_id)</span><br><span class="line">        <span class="comment">// æ£€æµ‹æ¥å£çš„è°ƒç”¨ç»“æœ</span></span><br><span class="line">        <span class="keyword">if</span> (code !== <span class="number">10000</span>) <span class="keyword">return</span> wx.utils.toast(<span class="string">&#x27;å–æ¶ˆæŠ¥ä¿®å¤±è´¥!&#x27;</span>)</span><br><span class="line">        <span class="comment">// è·³è½¬åˆ°æŠ¥ä¿®åˆ—è¡¨é¡µé¢</span></span><br><span class="line">        wx.navigateBack()</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="title">dialogClose</span>(<span class="params">ev</span>)</span> &#123;</span><br><span class="line">        <span class="comment">// é€‰æ‹©äº†ç¡®è®¤åå–æ¶ˆæŠ¥ä¿®</span></span><br><span class="line">        <span class="keyword">if</span> (ev.detail === <span class="string">&#x27;confirm&#x27;</span>) <span class="built_in">this</span>.cancelRepair()</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>æäº¤ä»£ç ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹å½“å‰è¢«ä¿®æ”¹çš„æ–‡ä»¶</span></span><br><span class="line">git status</span><br><span class="line"><span class="comment"># æš‚å­˜æ–‡ä»¶</span></span><br><span class="line">git add .</span><br><span class="line"><span class="comment"># æäº¤åˆ°æœ¬åœ°</span></span><br><span class="line">git commit -m <span class="string">&#x27;feat(repair): å®Œæˆå–æ¶ˆæŠ¥ä¿®é¡¹ç›®çš„åŠŸèƒ½&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="ä¿®æ”¹ä¿¡æ¯"><a href="#ä¿®æ”¹ä¿¡æ¯" class="headerlink" title="ä¿®æ”¹ä¿¡æ¯"></a>ä¿®æ”¹ä¿¡æ¯</h3><p>ä¿®æ”¹æŠ¥ä¿®ä¿¡æ¯è¦å…ˆæ ¹æ®æŠ¥ä¿®é¡¹ç›®çš„ id å°†åŸæ¥çš„æŠ¥ä¿®ä¿¡æ¯æŸ¥è¯¢å‡ºæ¥ï¼Œç„¶ååœ¨å¯¹åŸæ•°æ®è¿›è¡Œä¿®æ”¹åå†è°ƒç”¨æ¥å£æ¥æ›´æ–°æ•°æ®ï¼›ä¿®æ”¹æŠ¥ä¿®ä¿¡æ¯å’Œå¡«å†™æŠ¥ä¿®ä¿¡æ¯çš„é€»è¾‘æ˜¯ç›¸ä¼¼çš„å¹¶ä¸”å…±ç”¨äº†ç›¸åŒçš„é¡µé¢ï¼Œå³ <code>repair_pkg/pages/form/index</code> ã€‚</p>
<ol>
<li>ç»™ä¿®æ”¹æŠ¥ä¿®ä¿¡æ¯çš„æŒ‰é’®ç»‘å®šç‚¹å‡»äº‹ä»¶ã€‚</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- repair_pkg/pages/detail/index.wxml --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- åªèƒ½å—ç†ä¸­çŠ¶æ€æ˜¯æ‰å…è®¸å–æ¶ˆæŠ¥ä¿®æˆ–ä¿®æ”¹æŠ¥ä¿® --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;toolbar&quot;</span> <span class="attr">wx:if</span>=<span class="string">&quot;&#123;&#123;status === 1&#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;button-text active&quot;</span> <span class="attr">bind:tap</span>=<span class="string">&quot;editRepair&quot;</span>&gt;</span>ä¿®æ”¹ä¿¡æ¯<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;button-text&quot;</span> <span class="attr">bind:tap</span>=<span class="string">&quot;openDialogLayer&quot;</span>&gt;</span>å–æ¶ˆæŠ¥ä¿®<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>åœ¨äº‹ä»¶ä¼šè°ƒç”¨è·³è½¬åˆ° form è¡¨å•å¹¶ä¼ é€’æŠ¥ä¿® IDã€‚</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// repair_pkg/pages/detail/index.js</span></span><br><span class="line">Page(&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="function"><span class="title">editRepair</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        wx.navigateTo(&#123;</span><br><span class="line">            <span class="comment">// repair_id æ˜¯å…¨å±€å˜é‡ï¼Œåœ¨å‰é¢å·²ç»å®šä¹‰</span></span><br><span class="line">            <span class="attr">url</span>: <span class="string">&#x27;/repair_pkg/pages/form/index?id=&#x27;</span> + repair_id,</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>è®¾ç½®é¡µé¢æ ‡é¢˜ã€‚</li>
</ol>
<p>å¦‚æœé¡µé¢åœ°å€ä¸­åŒ…å« id å‚æ•°åˆ™è¡¨æ˜å½“å‰çš„æ“ä½œä¸ºä¿®æ”¹æŠ¥ä¿®ä¿¡æ¯ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// repair_pkg/pages/form/index.js</span></span><br><span class="line">Page(&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="function"><span class="title">onLoad</span>(<span class="params">&#123;</span></span></span><br><span class="line"><span class="params"><span class="function">        id</span></span></span><br><span class="line"><span class="params"><span class="function">    &#125;</span>)</span> &#123;</span><br><span class="line">        <span class="comment">// è·å–æˆ¿å±‹åˆ—è¡¨</span></span><br><span class="line">        <span class="built_in">this</span>.getHouseList()</span><br><span class="line">        <span class="comment">// è·å–ç»´ä¿®é¡¹ç›®</span></span><br><span class="line">        <span class="built_in">this</span>.getRepairItem()</span><br><span class="line">        <span class="keyword">if</span> (id) &#123;</span><br><span class="line">            <span class="comment">// æ›´æ–°æ ‡é¢˜</span></span><br><span class="line">            wx.setNavigationBarTitle(&#123;</span><br><span class="line">                <span class="attr">title</span>: <span class="string">&#x27;ä¿®æ”¹æŠ¥ä¿®ä¿¡æ¯&#x27;</span></span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>æ ¹æ® ID æŸ¥è¯¢æŠ¥ä¿®è¯¦æƒ…ã€‚</li>
</ol>
<ul>
<li><p>æ¥å£è·¯å¾„ï¼š<code>/repair/:id</code>ã€‚</p>
</li>
<li><p>è¯·æ±‚æ–¹æ³•: GETã€‚</p>
</li>
<li><p>è¯·æ±‚å‚æ•°ï¼š</p>
<ul>
<li>id æŠ¥ä¿®é¡¹ç›®çš„ idã€‚</li>
</ul>
</li>
<li><p>Headersï¼š</p>
<ul>
<li>Authorizationã€‚</li>
</ul>
</li>
<li><p>å“åº”æ•°æ®ï¼š<a target="_blank" rel="noopener" href="https://www.apifox.cn/apidoc/shared-8d66c345-7a9a-4844-9a5a-1201852f6faa/api-41400757">è§æ–‡æ¡£</a>ã€‚</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// repair_pkg/pages/form/index.js</span></span><br><span class="line">Page(&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="function"><span class="title">onLoad</span>(<span class="params">&#123;</span></span></span><br><span class="line"><span class="params"><span class="function">        id</span></span></span><br><span class="line"><span class="params"><span class="function">    &#125;</span>)</span> &#123;</span><br><span class="line">        <span class="comment">// è·å–æˆ¿å±‹åˆ—è¡¨</span></span><br><span class="line">        <span class="built_in">this</span>.getHouseList()</span><br><span class="line">        <span class="comment">// è·å–ç»´ä¿®é¡¹ç›®</span></span><br><span class="line">        <span class="built_in">this</span>.getRepairItem()</span><br><span class="line">        <span class="keyword">if</span> (id) &#123;</span><br><span class="line">            <span class="comment">// æ›´æ–°æ ‡é¢˜</span></span><br><span class="line">            wx.setNavigationBarTitle(&#123;</span><br><span class="line">                <span class="attr">title</span>: <span class="string">&#x27;ä¿®æ”¹æŠ¥ä¿®ä¿¡æ¯&#x27;</span></span><br><span class="line">            &#125;)</span><br><span class="line">            <span class="built_in">this</span>.getRepairDetail(id)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="title">getRepairDetail</span>(<span class="params">id</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!id) <span class="keyword">return</span></span><br><span class="line">        <span class="comment">// è¯·æ±‚æ•°æ®æ¥å£</span></span><br><span class="line">        <span class="keyword">const</span> &#123;</span><br><span class="line">            code,</span><br><span class="line">            <span class="attr">data</span>: repairDetail</span><br><span class="line">        &#125; = <span class="keyword">await</span> wx.http.get(<span class="string">&#x27;/repair/&#x27;</span> + id)</span><br><span class="line">        <span class="comment">// æ£€æµ‹æ¥å£è°ƒç”¨ç»“æœ</span></span><br><span class="line">        <span class="keyword">if</span> (code !== <span class="number">10000</span>) <span class="keyword">return</span> wx.utils.toast(<span class="string">&#x27;è·å–æŠ¥ä¿®ä¿¡æ¯å¤±è´¥!&#x27;</span>)</span><br><span class="line">        <span class="comment">// æ¸²æŸ“æŠ¥ä¿®ä¿¡æ¯</span></span><br><span class="line">        <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">            ...repairDetail</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>è°ƒç”¨æ›´æ–°æŠ¥ä¿®ä¿¡æ¯çš„æ¥å£ã€‚</li>
</ol>
<p>å¡«å†™æŠ¥ä¿®ä¿¡æ¯å’Œä¿®æ”¹æˆ¿å±‹ä¿¡æ¯è°ƒç”¨çš„æ˜¯åŒä¸€ä¸ªæ¥å£ï¼Œåç«¯ä¼šåŠ¨åˆ¤æ–­ä¼ é€’å‚æ•°æ—¶æœ‰æ²¡æœ‰ idï¼Œå¦‚æœæœ‰ id åˆ™è¡¨ç¤ºæ˜¯ç¼–è¾‘æ“ä½œå¦åˆ™æ˜¯æ·»åŠ æ“ä½œã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// repair_pkg/pages/form/index.js</span></span><br><span class="line">Page(&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="title">submitForm</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// é€ä¸ªéªŒè¯è¡¨å•æ•°æ®</span></span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">this</span>.verifyHouse()) <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">this</span>.verifyRepair()) <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">this</span>.verifyMobile()) <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">this</span>.verifyDate()) <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">this</span>.verifyDescription()) <span class="keyword">return</span></span><br><span class="line">        <span class="comment">// è§£æ„è·å–æ¥å£éœ€è¦çš„å‚æ•°</span></span><br><span class="line">        <span class="keyword">const</span> &#123;</span><br><span class="line">            id,</span><br><span class="line">            houseId,</span><br><span class="line">            repairItemId,</span><br><span class="line">            appointment,</span><br><span class="line">            mobile,</span><br><span class="line">            description,</span><br><span class="line">            attachment</span><br><span class="line">        &#125; = <span class="built_in">this</span>.data</span><br><span class="line">        <span class="comment">// è¯·æ±‚æ•°æ®æ¥å£</span></span><br><span class="line">        <span class="keyword">const</span> &#123;</span><br><span class="line">            code</span><br><span class="line">        &#125; = <span class="keyword">await</span> wx.http.post(<span class="string">&#x27;/repair&#x27;</span>, &#123;</span><br><span class="line">            id,</span><br><span class="line">            houseId,</span><br><span class="line">            repairItemId,</span><br><span class="line">            appointment,</span><br><span class="line">            mobile,</span><br><span class="line">            description,</span><br><span class="line">            attachment</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="comment">// æ£€æµ‹æ¥å£è¯·æ±‚çš„ç»“æœ</span></span><br><span class="line">        <span class="keyword">if</span> (code !== <span class="number">10000</span>) <span class="keyword">return</span> wx.showToast(&#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;åœ¨çº¿æŠ¥ä¿®å¤±è´¥!&#x27;</span>,</span><br><span class="line">            <span class="attr">icon</span>: <span class="string">&#x27;none&#x27;</span></span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="comment">// è·³è½¬åˆ°è¡¨å•åˆ—è¡¨é¡µé¢</span></span><br><span class="line">        wx.redirectTo(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">&#x27;/repair_pkg/pages/list/index&#x27;</span>,</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>æäº¤ä»£ç ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹å½“å‰è¢«ä¿®æ”¹çš„æ–‡ä»¶</span></span><br><span class="line">git status</span><br><span class="line"><span class="comment"># æš‚å­˜æ–‡ä»¶</span></span><br><span class="line">git add .</span><br><span class="line"><span class="comment"># æäº¤åˆ°æœ¬åœ°</span></span><br><span class="line">git commit -m <span class="string">&#x27;feat(repair): å®Œæˆä¿®æ”¹æŠ¥ä¿®ä¿¡æ¯çš„åŠŸèƒ½&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¨é€åˆ°è¿œç¨‹æˆ–åˆå¹¶åˆ°æœ¬åœ° main</span></span><br><span class="line">git checkout main</span><br><span class="line">git merge feat-house</span><br></pre></td></tr></table></figure>

<h2 id="è®¿å®¢ç®¡ç†"><a href="#è®¿å®¢ç®¡ç†" class="headerlink" title="è®¿å®¢ç®¡ç†"></a>è®¿å®¢ç®¡ç†</h2><h3 id="é‚€è¯·è®¿å®¢"><a href="#é‚€è¯·è®¿å®¢" class="headerlink" title="é‚€è¯·è®¿å®¢"></a>é‚€è¯·è®¿å®¢</h3><h4 id="ç”¨æˆ·äº¤äº’-1"><a href="#ç”¨æˆ·äº¤äº’-1" class="headerlink" title="ç”¨æˆ·äº¤äº’"></a>ç”¨æˆ·äº¤äº’</h4><ol>
<li>ç›‘å¬ van-action-sheet ç»„ä»¶çš„ select äº‹ä»¶ã€‚</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- visitor_pkg/pages/form/index.wxml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">van-action-sheet</span> <span class="attr">bind:close</span>=<span class="string">&quot;closeHouseLayer&quot;</span> <span class="attr">bind:cancel</span>=<span class="string">&quot;closeHouseLayer&quot;</span> <span class="attr">bind:select</span>=<span class="string">&quot;selectHouse&quot;</span> <span class="attr">round</span> <span class="attr">show</span>=<span class="string">&quot;&#123;&#123; houseLayerVisible &#125;&#125;&quot;</span> <span class="attr">actions</span>=<span class="string">&quot;&#123;&#123; houseList &#125;&#125;&quot;</span> <span class="attr">cancel-text</span>=<span class="string">&quot;å–æ¶ˆ&quot;</span> <span class="attr">title</span>=<span class="string">&quot;é€‰æ‹©æˆ¿å±‹ä¿¡æ¯&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>åœ¨ selectHouse å›è°ƒæ–¹æ³•ä¸­è·å–ç”¨æˆ·é€‰æ‹©çš„æˆ¿å±‹ä¿¡æ¯ã€‚</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// visitor_pkg/pages/form/index.js</span></span><br><span class="line">Page(&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="function"><span class="title">selectHouse</span>(<span class="params">ev</span>)</span> &#123;</span><br><span class="line">        <span class="comment">// è·å–æˆ¿åˆ°çš„ä¿¡æ¯æ•°æ®</span></span><br><span class="line">        <span class="keyword">const</span> &#123;</span><br><span class="line">            <span class="attr">id</span>: houseId,</span><br><span class="line">            <span class="attr">name</span>: houseInfo</span><br><span class="line">        &#125; = ev.detail</span><br><span class="line">        <span class="comment">// é¡µé¢ä¸­æ¸²æŸ“</span></span><br><span class="line">        <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">            houseId,</span><br><span class="line">            houseInfo</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>å°†ç”¨æˆ·é€‰æ‹©çš„æˆ¿å±‹ä¿¡æ¯æ¸²æŸ“åˆ°é¡µé¢ä¸­ã€‚</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- visitor_pkg/pages/form/index.wxml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">van-cell-group</span> <span class="attr">border</span>=<span class="string">&quot;&#123;&#123;false&#125;&#125;&quot;</span> <span class="attr">title</span>=<span class="string">&quot;æˆ¿å±‹ä¿¡æ¯&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">value</span>=<span class="string">&quot;&#123;&#123;houseInfo || &#x27;è¯·é€‰æ‹©æˆ¿å±‹ä¿¡æ¯&#x27;&#125;&#125;&quot;</span> <span class="attr">value-class</span>=<span class="string">&quot;&#123;&#123;houseInfo &amp;&amp; &#x27;active-cell&#x27;&#125;&#125;&quot;</span> <span class="attr">border</span>=<span class="string">&quot;&#123;&#123;false&#125;&#125;&quot;</span> <span class="attr">bind:click</span>=<span class="string">&quot;openHouseLayer&quot;</span> <span class="attr">is-link</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">van-cell-group</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="4">
<li>ç›‘å¬ van-datetime-picker ç»„ä»¶çš„ confirm äº‹ä»¶ã€‚</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- visitor_pkg/pages/form/index.wxml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">van-popup</span> <span class="attr">bind:close</span>=<span class="string">&quot;closeDateLayer&quot;</span> <span class="attr">round</span> <span class="attr">show</span>=<span class="string">&quot;&#123;&#123; dateLayerVisible &#125;&#125;&quot;</span> <span class="attr">position</span>=<span class="string">&quot;bottom&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-datetime-picker</span> <span class="attr">bind:confirm</span>=<span class="string">&quot;selectDate&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&#123;&#123; currentDate &#125;&#125;&quot;</span> <span class="attr">type</span>=<span class="string">&quot;date&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">van-popup</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="5">
<li>åœ¨äº‹ä»¶å›è°ƒä¸­è·å–ç”¨æˆ·é€‰æ‹©çš„æ—¥æœŸã€‚</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// visitor_pkg/pages/form/index.js</span></span><br><span class="line">Page(&#123;</span><br><span class="line">    <span class="attr">data</span>: &#123;</span><br><span class="line">        <span class="comment">// æŒ‡å®š van-datetime-picker ç»„ä»¶çš„èµ·å§‹æ—¥æœŸ</span></span><br><span class="line">        <span class="attr">currentDate</span>: <span class="built_in">Date</span>.now()</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="function"><span class="title">selectDate</span>(<span class="params">ev</span>)</span> &#123;</span><br><span class="line">        <span class="comment">// è·å–è®¿å®¢æ¥è®¿çš„æ—¶é—´</span></span><br><span class="line">        <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">            <span class="comment">// éšè—æ—¶é—´å¼¹å±‚</span></span><br><span class="line">            <span class="attr">dateLayerVisible</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">visitDate</span>: wx.utils.formatDate(ev.detail)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// ..</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ol start="6">
<li>å°†ç”¨æˆ·é€‰æ‹©çš„æ—¥æœŸæ¸²æŸ“åˆ°é¡µé¢çš„ van-cell ç»„ä»¶ä¸­ã€‚</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- visitor_pkg/pages/form/index.wxml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title-width</span>=<span class="string">&quot;200rpx&quot;</span> <span class="attr">title</span>=<span class="string">&quot;è®¿é—®æ—¥æœŸ&quot;</span> <span class="attr">border</span>=<span class="string">&quot;&#123;&#123;false&#125;&#125;&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&#123;&#123;visitDate || &#x27;è¯·é€‰æ‹©è®¿é—®æ—¥æœŸ&#x27;&#125;&#125;&quot;</span> <span class="attr">value-class</span>=<span class="string">&quot;&#123;&#123;visitDate &amp;&amp; &#x27;active-cell&#x27;&#125;&#125;&quot;</span> <span class="attr">bind:click</span>=<span class="string">&quot;openDateLayer&quot;</span> <span class="attr">is-link</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="æˆ¿å±‹åˆ—è¡¨-2"><a href="#æˆ¿å±‹åˆ—è¡¨-2" class="headerlink" title="æˆ¿å±‹åˆ—è¡¨"></a>æˆ¿å±‹åˆ—è¡¨</h4><p>é€šè¿‡è°ƒç”¨æ¥å£è·å–è‡ªå·²è´¦å·ä¸‹çš„æˆ¿å±‹ä¿¡æ¯ã€‚</p>
<ul>
<li><p>æ¥å£è·¯å¾„ï¼š/houseã€‚</p>
</li>
<li><p>è¯·æ±‚æ–¹æ³•: GETã€‚</p>
</li>
<li><p>è¯·æ±‚å‚æ•°ï¼šæ— ã€‚</p>
</li>
<li><p>Headersï¼š</p>
<ul>
<li>Authorizationã€‚</li>
</ul>
</li>
<li><p>å“åº”æ•°æ®ï¼š<a target="_blank" rel="noopener" href="https://www.apifox.cn/apidoc/shared-8d66c345-7a9a-4844-9a5a-1201852f6faa/api-42635315">è§æ–‡æ¡£</a>ã€‚</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// repair_pkg/pages/form/index.js</span></span><br><span class="line">Page(&#123;</span><br><span class="line">    <span class="attr">data</span>: &#123;</span><br><span class="line">        <span class="attr">houseList</span>: [],</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="title">onLoad</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// è·å–æˆ¿å±‹åˆ—è¡¨</span></span><br><span class="line">        <span class="built_in">this</span>.getHouseList()</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="title">getHouseList</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// è¯·æ±‚æ•°æ®æ¥å£</span></span><br><span class="line">        <span class="keyword">const</span> &#123;</span><br><span class="line">            code,</span><br><span class="line">            <span class="attr">data</span>: houseList</span><br><span class="line">        &#125; = <span class="keyword">await</span> wx.http.get(<span class="string">&#x27;/house&#x27;</span>)</span><br><span class="line">        <span class="comment">// æ£€æµ‹æ¥å£è¿”å›çš„ç»“æœ</span></span><br><span class="line">        <span class="keyword">if</span> (code !== <span class="number">10000</span>) <span class="keyword">return</span> wx.utils.toast(<span class="string">&#x27;è·å–æˆ¿å±‹åˆ—è¡¨å¤±è´¥!&#x27;</span>)</span><br><span class="line">        <span class="comment">// æ•°æ®æ¸²æŸ“</span></span><br><span class="line">        <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">            houseList</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>ğŸ¤” æç¤ºï¼šè¿™é‡Œåªèƒ½æŸ¥è¯¢åˆ°é€šè¿‡å®¡æ ¸é€šè¿‡çš„æˆ¿å±‹ä¿¡æ¯ã€‚</p>
<h4 id="è¡¨å•éªŒè¯"><a href="#è¡¨å•éªŒè¯" class="headerlink" title="è¡¨å•éªŒè¯"></a>è¡¨å•éªŒè¯</h4><ol>
<li>ä½¿ç”¨ <code>model:value</code> åˆ†åˆ«è·å–è®¿å®¢å§“åã€è®¿å®¢æ€§åˆ«ã€è®¿å®¢æ‰‹æœºå· 3 ä¸ªæ•°æ®ã€‚</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- visitor_pkg/pages/form/index.wxml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">van-field</span> <span class="attr">label</span>=<span class="string">&quot;å§“å&quot;</span> <span class="attr">model:value</span>=<span class="string">&quot;&#123;&#123;name&#125;&#125;&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;è¯·è¾“å…¥è®¿å®¢çœŸå®å§“å&quot;</span> /&gt;</span></span><br><span class="line">...</span><br><span class="line"><span class="tag">&lt;<span class="name">van-radio-group</span> <span class="attr">direction</span>=<span class="string">&quot;horizontal&quot;</span> <span class="attr">model:value</span>=<span class="string">&quot;&#123;&#123;gender&#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-radio</span> <span class="attr">icon-size</span>=<span class="string">&quot;36rpx&quot;</span> <span class="attr">checked-color</span>=<span class="string">&quot;#5591AF&quot;</span> <span class="attr">name</span>=<span class="string">&quot;&#123;&#123;1&#125;&#125;&quot;</span>&gt;</span>ç”·</span><br><span class="line">    <span class="tag">&lt;/<span class="name">van-radio</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-radio</span> <span class="attr">icon-size</span>=<span class="string">&quot;36rpx&quot;</span> <span class="attr">checked-color</span>=<span class="string">&quot;#5591AF&quot;</span> <span class="attr">name</span>=<span class="string">&quot;&#123;&#123;0&#125;&#125;&quot;</span>&gt;</span>å¥³</span><br><span class="line">    <span class="tag">&lt;/<span class="name">van-radio</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">van-radio-group</span>&gt;</span></span><br><span class="line">...</span><br><span class="line"><span class="tag">&lt;<span class="name">van-field</span> <span class="attr">label</span>=<span class="string">&quot;æ‰‹æœºå·&quot;</span> <span class="attr">type</span>=<span class="string">&quot;number&quot;</span> <span class="attr">model:value</span>=<span class="string">&quot;&#123;&#123;mobile&#125;&#125;&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;è¯·è¾“å…¥è®¿å®¢è”ç³»ç”µè¯å·ç &quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>æ ¡éªŒç›¸å…³ä¿¡æ¯ï¼ˆè¿™å„¿ç±»ä¼¼çš„ä»£ç å‰é¢å†™è¿‡å¤šæ¬¡ï¼Œè¦æ±‚å¤§å®¶èƒ½è¯»æ‡‚å°±å¯ä»¥ï¼‰ã€‚</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// visitor_pkg/pages/form/index.js</span></span><br><span class="line">Page(&#123;</span><br><span class="line">    <span class="attr">data</span>: &#123;</span><br><span class="line">        <span class="attr">gender</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="attr">mobile</span>: <span class="string">&#x27;&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="function"><span class="title">verifyHouse</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> valid = <span class="built_in">this</span>.data.houseId !== <span class="string">&#x27;&#x27;</span></span><br><span class="line">        <span class="comment">// éªŒè¯ç»“æœæç¤º</span></span><br><span class="line">        <span class="keyword">if</span> (!valid) wx.utils.toast(<span class="string">&#x27;è¯·é€‰æ‹©æˆ¿å±‹ä¿¡æ¯!&#x27;</span>)</span><br><span class="line">        <span class="comment">// è¿”å›éªŒè¯ç»“æœ</span></span><br><span class="line">        <span class="keyword">return</span> valid</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// éªŒè¯ä¸šä¸»å§“åï¼ˆå¿…é¡»ä¸ºæ±‰å­—ï¼‰</span></span><br><span class="line">    <span class="function"><span class="title">verifyName</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// æ­£åˆ™è¡¨è¾¾å¼</span></span><br><span class="line">        <span class="keyword">const</span> reg = <span class="regexp">/^[\u4e00-\u9fa5]&#123;2,5&#125;$/</span></span><br><span class="line">        <span class="comment">// éªŒè¯ä¸šä¸»å§“å</span></span><br><span class="line">        <span class="keyword">const</span> valid = reg.test(<span class="built_in">this</span>.data.name.trim())</span><br><span class="line">        <span class="comment">// éªŒè¯ç»“æœæç¤º</span></span><br><span class="line">        <span class="keyword">if</span> (!valid) wx.utils.toast(<span class="string">&#x27;è¯·å¡«å†™çœŸå®ä¸­æ–‡å§“å!&#x27;</span>)</span><br><span class="line">        <span class="comment">// è¿”å›éªŒè¯ç»“æœ</span></span><br><span class="line">        <span class="keyword">return</span> valid</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="title">verifyMobile</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// éªŒè¯æ‰‹æœºå·</span></span><br><span class="line">        <span class="keyword">const</span> reg = <span class="regexp">/^[1][3-8][0-9]&#123;9&#125;$/</span></span><br><span class="line">        <span class="keyword">const</span> valid = reg.test(<span class="built_in">this</span>.data.mobile)</span><br><span class="line">        <span class="comment">// éªŒè¯ç»“æœæç¤º</span></span><br><span class="line">        <span class="keyword">if</span> (!valid) wx.utils.toast(<span class="string">&#x27;è¯·å¡«å†™æ­£ç¡®çš„æ‰‹æœºå·ç !&#x27;</span>)</span><br><span class="line">        <span class="comment">// è¿”å›éªŒè¯ç»“æœ</span></span><br><span class="line">        <span class="keyword">return</span> valid</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="è°ƒç”¨æ¥å£"><a href="#è°ƒç”¨æ¥å£" class="headerlink" title="è°ƒç”¨æ¥å£"></a>è°ƒç”¨æ¥å£</h4><ol>
<li>ç›‘å¬ç”¨æˆ·ã€ç¡®è®¤ã€‘æŒ‰é’®çš„ç‚¹å‡»äº‹ä»¶ã€‚</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- repair_pkg/pages/form/index.wxml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;toolbar&quot;</span> <span class="attr">bind:tap</span>=<span class="string">&quot;submitForm&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;enjoy-icon icon-confirm&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;button-text&quot;</span>&gt;</span>ç¡®è®¤<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>è°ƒç”¨æ·»åŠ è®¿å®¢ä¿¡æ¯çš„æ¥å£ã€‚</li>
</ol>
<ul>
<li><p>æ¥å£è·¯å¾„ï¼š<code>/visitor</code>ã€‚</p>
</li>
<li><p>è¯·æ±‚æ–¹æ³•: POSTã€‚</p>
</li>
<li><p>è¯·æ±‚å‚æ•°ï¼š</p>
<ul>
<li><p>houseId æˆ¿å±‹idã€‚</p>
</li>
<li><p>name è®¿å®¢å§“åã€‚</p>
</li>
<li><p>gender è®¿å®¢æ€§åˆ«ã€‚</p>
</li>
<li><p>mobile è®¿å®¢æ‰‹æœºå·ã€‚</p>
</li>
<li><p>visitDate è®¿å®¢è®¿é—®æ—¶é—´ã€‚</p>
</li>
</ul>
</li>
<li><p>Headersï¼š</p>
<ul>
<li>Authorizationã€‚</li>
</ul>
</li>
<li><p>å“åº”æ•°æ®ï¼š<a target="_blank" rel="noopener" href="https://www.apifox.cn/apidoc/shared-8d66c345-7a9a-4844-9a5a-1201852f6faa/api-41400760">è§æ–‡æ¡£</a>ã€‚</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">Page(&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="title">submitForm</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// #1 é€ä¸ªéªŒè¯è¡¨å•çš„æ•°æ®</span></span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">this</span>.verifyHouse()) <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">this</span>.verifyName()) <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">this</span>.verifyMobile()) <span class="keyword">return</span></span><br><span class="line">        <span class="comment">// #2 å¾…æäº¤çš„æ•°æ®</span></span><br><span class="line">        <span class="keyword">const</span> &#123;</span><br><span class="line">            houseId,</span><br><span class="line">            name,</span><br><span class="line">            gender,</span><br><span class="line">            mobile,</span><br><span class="line">            visitDate</span><br><span class="line">        &#125; = <span class="built_in">this</span>.data</span><br><span class="line">        <span class="comment">// #3 è¯·æ±‚æ¥å£</span></span><br><span class="line">        <span class="keyword">const</span> &#123;</span><br><span class="line">            code,</span><br><span class="line">            data</span><br><span class="line">        &#125; = <span class="keyword">await</span> wx.http.post(<span class="string">&#x27;/visitor&#x27;</span>, &#123;</span><br><span class="line">            houseId,</span><br><span class="line">            name,</span><br><span class="line">            gender,</span><br><span class="line">            mobile,</span><br><span class="line">            visitDate</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="comment">// #4 æ£€æµ‹æ¥å£è°ƒç”¨ç»“æœ</span></span><br><span class="line">        <span class="keyword">if</span> (code !== <span class="number">10000</span>) <span class="keyword">return</span> wx.utils.toast(<span class="string">&#x27;æ·»åŠ è®¿å®¢å¤±è´¥!&#x27;</span>)</span><br><span class="line">        <span class="comment">// #5 æŸ¥çœ‹é€šè¡Œè¯</span></span><br><span class="line">        wx.navigateTo(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">&#x27;/visitor_pkg/pages/passport/index?id=&#x27;</span> + data.id,</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>æäº¤ä»£ç ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹å½“å‰è¢«ä¿®æ”¹çš„æ–‡ä»¶</span></span><br><span class="line">git status</span><br><span class="line"><span class="comment"># æš‚å­˜æ–‡ä»¶</span></span><br><span class="line">git add .</span><br><span class="line"><span class="comment"># æäº¤åˆ°æœ¬åœ°</span></span><br><span class="line">git commit -m <span class="string">&#x27;feat(repair): å®Œæˆè®¿å®¢é‚€è¯·çš„åŠŸèƒ½&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="è®¿å®¢è®°å½•"><a href="#è®¿å®¢è®°å½•" class="headerlink" title="è®¿å®¢è®°å½•"></a>è®¿å®¢è®°å½•</h3><ol>
<li>è°ƒç”¨è®¿å®¢è®°å½•çš„æ¥å£ã€‚</li>
</ol>
<ul>
<li><p>æ¥å£è·¯å¾„ï¼š<code>/visitor</code>ã€‚</p>
</li>
<li><p>è¯·æ±‚æ–¹æ³•: GETã€‚</p>
</li>
<li><p>è¯·æ±‚å‚æ•°ï¼š</p>
<ul>
<li>id è®¿å®¢é‚€è¯· idã€‚</li>
</ul>
</li>
<li><p>Headersï¼š</p>
<ul>
<li>Authorizationã€‚</li>
</ul>
</li>
<li><p>å“åº”æ•°æ®ï¼š<a target="_blank" rel="noopener" href="https://www.apifox.cn/apidoc/shared-8d66c345-7a9a-4844-9a5a-1201852f6faa/api-41400761">è§æ–‡æ¡£</a>ã€‚</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// visitor_pkg/pages/list/index.js</span></span><br><span class="line">Page(&#123;</span><br><span class="line">    <span class="function"><span class="title">onLoad</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// è·å–è®¿å®¢åˆ—è¡¨</span></span><br><span class="line">        <span class="built_in">this</span>.getVistorList()</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="title">getVistorList</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// è¯·æ±‚æ•°æ®æ¥å£</span></span><br><span class="line">        <span class="keyword">const</span> &#123;</span><br><span class="line">            code,</span><br><span class="line">            <span class="attr">data</span>: &#123;</span><br><span class="line">                <span class="attr">rows</span>: visitorList</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; = <span class="keyword">await</span> wx.http.get(<span class="string">&#x27;/visitor&#x27;</span>)</span><br><span class="line">        <span class="comment">// æ£€æµ‹æ¥å£è°ƒç”¨ç»“æœ</span></span><br><span class="line">        <span class="keyword">if</span> (code !== <span class="number">10000</span>) <span class="keyword">return</span> wx.utils.toast(<span class="string">&#x27;è·å–è®¿å®¢åˆ—è¡¨å¤±è´¥!&#x27;</span>)</span><br><span class="line">        <span class="comment">// æ¸²æŸ“è®¿å®¢åˆ—è¡¨</span></span><br><span class="line">        <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">            visitorList</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// ç‚¹å‡»è®¿å®¢åˆ—è¡¨çš„æ¯ä¸€é¡¹è·³è½¬åˆ°è¯¦æƒ…</span></span><br><span class="line">    <span class="function"><span class="title">goPassport</span>(<span class="params">ev</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123;</span><br><span class="line">            id,</span><br><span class="line">            status</span><br><span class="line">        &#125; = ev.mark</span><br><span class="line">        <span class="keyword">if</span> (status === <span class="number">0</span>) <span class="keyword">return</span> wx.utils.toast(<span class="string">&#x27;å½“å‰é€šè¡Œè¯å·²å¤±æ•ˆ&#x27;</span>)</span><br><span class="line">        <span class="comment">// æŸ¥çœ‹é€šä¿¡è¯</span></span><br><span class="line">        wx.navigateTo(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">&#x27;/visitor_pkg/pages/passport/index?id=&#x27;</span> + ev.mark.id,</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>å°†è·å–åˆ°çš„æ•°æ®æ¸²æŸ“åˆ°æ¨¡æ¿å½“ä¸­ã€‚</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">authorization</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">block</span> <span class="attr">wx:if</span>=<span class="string">&quot;&#123;&#123;true&#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scroll-view</span> <span class="attr">show-scrollbar</span>=<span class="string">&quot;&#123;&#123;false&#125;&#125;&quot;</span> <span class="attr">enhanced</span> <span class="attr">scroll-y</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;visitor&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;visitor-title&quot;</span>&gt;</span>æˆ‘çš„è®¿å®¢<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;visitor-list&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">van-cell-group</span> <span class="attr">wx:for</span>=<span class="string">&quot;&#123;&#123;visitorList&#125;&#125;&quot;</span> <span class="attr">wx:key</span>=<span class="string">&quot;id&quot;</span> <span class="attr">border</span>=<span class="string">&quot;&#123;&#123;false&#125;&#125;&quot;</span> <span class="attr">mark:id</span>=<span class="string">&quot;&#123;&#123;item.id&#125;&#125;&quot;</span> <span class="attr">bind:tap</span>=<span class="string">&quot;goPassport&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">size</span>=<span class="string">&quot;large&quot;</span> <span class="attr">title</span>=<span class="string">&quot;&#123;&#123;item.houseInfo&#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;tag success&quot;</span> <span class="attr">wx:if</span>=<span class="string">&quot;&#123;&#123;item.status === 1&#125;&#125;&quot;</span>&gt;</span>ç”Ÿæ•ˆä¸­<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;tag cancel&quot;</span> <span class="attr">wx:if</span>=<span class="string">&quot;&#123;&#123;item.status === 0&#125;&#125;&quot;</span>&gt;</span>å·²å¤±æ•ˆ<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">van-cell</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title</span>=<span class="string">&quot; è®¿å®¢å§“å&quot;</span> <span class="attr">border</span>=<span class="string">&quot;&#123;&#123;false&#125;&#125;&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&#123;&#123;item.name&#125;&#125;&quot;</span> /&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title</span>=<span class="string">&quot;æ‰‹æœºå·ç &quot;</span> <span class="attr">border</span>=<span class="string">&quot;&#123;&#123;false&#125;&#125;&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&#123;&#123;item.mobile&#125;&#125;&quot;</span> /&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title</span>=<span class="string">&quot;è®¿é—®æ—¥æœŸ&quot;</span> <span class="attr">border</span>=<span class="string">&quot;&#123;&#123;false&#125;&#125;&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&#123;&#123;item.visitDate&#125;&#125;&quot;</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">van-cell-group</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">scroll-view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">block</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">wx:else</span> <span class="attr">class</span>=<span class="string">&quot;blank&quot;</span>&gt;</span></span><br><span class="line">        æ‚¨è¿˜æ²¡æœ‰è®¿å®¢è®°å½•ï¼Œè¯·ç‚¹å‡»</span><br><span class="line">        <span class="tag">&lt;<span class="name">navigator</span> <span class="attr">hover-class</span>=<span class="string">&quot;none&quot;</span> <span class="attr">class</span>=<span class="string">&quot;link&quot;</span> <span class="attr">url</span>=<span class="string">&quot;/visitor_pkg/pages/form/index&quot;</span>&gt;</span>æ·»åŠ <span class="tag">&lt;/<span class="name">navigator</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">authorization</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="è®¿å®¢é€šçŸ¥è¯"><a href="#è®¿å®¢é€šçŸ¥è¯" class="headerlink" title="è®¿å®¢é€šçŸ¥è¯"></a>è®¿å®¢é€šçŸ¥è¯</h3><p>æ‰€è°“çš„é€šè¡Œè¯æ˜¯ç”±åç«¯ç”Ÿæˆçš„ä¸€ä¸ªäºŒç»´ç ï¼Œè¯¥äºŒç»´ç å…·æœ‰æ—¶æ•ˆæ€§ï¼ˆä¸è¶…è¿‡ 72 å°æ—¶ï¼‰ï¼Œæœ¬èŠ‚çš„ä»»åŠ¡æ˜¯è°ƒç”¨æ¥å£è·å–é€šè¡Œè¯å¹¶å±•ç¤ºç»™ç”¨æˆ·ã€‚</p>
<h4 id="æ•°æ®æ¸²æŸ“-1"><a href="#æ•°æ®æ¸²æŸ“-1" class="headerlink" title="æ•°æ®æ¸²æŸ“"></a>æ•°æ®æ¸²æŸ“</h4><ol>
<li>è°ƒç”¨åç«¯çš„æ¥å£ã€‚</li>
</ol>
<ul>
<li><p>æ¥å£è·¯å¾„ï¼š<code>/visitor/:id</code>ã€‚</p>
</li>
<li><p>è¯·æ±‚æ–¹æ³•: GETã€‚</p>
</li>
<li><p>è¯·æ±‚å‚æ•°ï¼š</p>
<ul>
<li>id è®¿å®¢é‚€è¯· idã€‚</li>
</ul>
</li>
<li><p>Headersï¼š</p>
<ul>
<li>Authorizationã€‚</li>
</ul>
</li>
<li><p>å“åº”æ•°æ®ï¼š<a target="_blank" rel="noopener" href="https://www.apifox.cn/apidoc/shared-8d66c345-7a9a-4844-9a5a-1201852f6faa/api-42635315">è§æ–‡æ¡£</a>ã€‚</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// visitor_pkg/pages/passport/index.js</span></span><br><span class="line">Page(&#123;</span><br><span class="line">    <span class="function"><span class="title">onLoad</span>(<span class="params">&#123;</span></span></span><br><span class="line"><span class="params"><span class="function">        id</span></span></span><br><span class="line"><span class="params"><span class="function">    &#125;</span>)</span> &#123;</span><br><span class="line">        <span class="comment">// è·å–é€šè¡Œè¯</span></span><br><span class="line">        <span class="built_in">this</span>.getPassport(id)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="title">getPassport</span>(<span class="params">id</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!id) <span class="keyword">return</span></span><br><span class="line">        <span class="comment">// è¯·æ±‚æ•°æ®æ¥å£</span></span><br><span class="line">        <span class="keyword">const</span> &#123;</span><br><span class="line">            code,</span><br><span class="line">            <span class="attr">data</span>: passport</span><br><span class="line">        &#125; = <span class="keyword">await</span> wx.http.get(<span class="string">&#x27;/visitor/&#x27;</span> + id)</span><br><span class="line">        <span class="comment">// æ£€æµ‹æ¥å£è°ƒç”¨çš„ç»“æœ</span></span><br><span class="line">        <span class="keyword">if</span> (code !== <span class="number">10000</span>) <span class="keyword">return</span> wx.utils.toast(<span class="string">&#x27;è·å–é€šè¡Œè¯å¤±è´¥!&#x27;</span>)</span><br><span class="line">        <span class="comment">// æ¸²æŸ“é€šè¡Œè¯</span></span><br><span class="line">        <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">            ...passport</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>å°†æ•°æ®æ¸²æŸ“åˆ°æ¨¡æ¿å½“ä¸­ã€‚</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- visitor_pkg/pages/passport/index.wxml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;passport&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;countdown&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">block</span> <span class="attr">wx:if</span>=<span class="string">&quot;&#123;&#123;validTime &gt; 0&#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">van-count-down</span> <span class="attr">time</span>=<span class="string">&quot;&#123;&#123; validTime * 1000 &#125;&#125;&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;label&quot;</span>&gt;</span>é€šè¡Œè¯æœ‰æ•ˆæ—¶é—´<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">block</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">block</span> <span class="attr">wx:else</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;van-count-down&quot;</span>&gt;</span>00:00:00<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;label&quot;</span>&gt;</span>é€šè¡Œè¯å·²å¤±æ•ˆ!<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">block</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;qrcode&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">image</span> <span class="attr">src</span>=<span class="string">&quot;&#123;&#123;url&#125;&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;description&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;house&quot;</span>&gt;</span>&#123;&#123;houseInfo&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;tips&quot;</span>&gt;</span>å°†æ­¤äºŒç»´ç åˆ†äº«ç»™è®¿å®¢ï¼Œè®¿å®¢æ‰«ç å³å¯å¼€é—¨<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- é€šè¡Œè¯å¤±æ•ˆåå°†ä¸å†å…è®¸åˆ†äº«å’Œä¿å­˜äºŒç»´ç åˆ°æœ¬åœ° --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;toolbar&quot;</span> <span class="attr">wx:if</span>=<span class="string">&quot;&#123;&#123;validTime &gt; 0&#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;button-share&quot;</span> <span class="attr">open-type</span>=<span class="string">&quot;share&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;enjoy-icon icon-share&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;text&quot;</span>&gt;</span>åˆ†äº«ç»™æœ‹å‹<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;button-save&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;enjoy-icon icon-save&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;text&quot;</span>&gt;</span>ä¿å­˜åˆ°æœ¬åœ°<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="åˆ†äº«ç»™æœ‹å‹"><a href="#åˆ†äº«ç»™æœ‹å‹" class="headerlink" title="åˆ†äº«ç»™æœ‹å‹"></a>åˆ†äº«ç»™æœ‹å‹</h4><p>å°ç¨‹åºä¸­æä¾›äº†<a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/reference/api/Page.html#onShareAppMessage-Object-object">è‡ªå®šä¹‰åˆ†äº«</a>å†…å®¹çš„æ–¹æ³•ï¼Œéœ€è¦æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ã€‚</p>
<ul>
<li><p>ç”¨æˆ·ç‚¹å‡» button ç»„ä»¶ï¼Œä¸” open-type çš„å€¼è®¾ç½®ä¸º shareã€‚</p>
</li>
<li><p>åœ¨é¡µé¢ä¸­ç›‘å¬äº‹ä»¶å›è°ƒ onShareAppMessageã€‚</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Page(&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="function"><span class="title">onShareAppMessage</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;æŸ¥çœ‹é€šè¡Œè¯&#x27;</span>,</span><br><span class="line">            <span class="attr">path</span>: <span class="string">&#x27;/visitor_pkg/pages/passport/index&#x27;</span>,</span><br><span class="line">            <span class="attr">imageUrl</span>: <span class="string">&#x27;https://enjoy-plus.oss-cn-beijing.aliyuncs.com/images/share_poster.png&#x27;</span>,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="ä¿å­˜é€šè¡Œç "><a href="#ä¿å­˜é€šè¡Œç " class="headerlink" title="ä¿å­˜é€šè¡Œç "></a>ä¿å­˜é€šè¡Œç </h4><p><a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/api/media/image/wx.saveImageToPhotosAlbum.html">wx.saveImageToPhotosAlbum()</a>ï¼šä¿å­˜å›¾ç‰‡åˆ°æœ¬åœ°ï¼ˆä¸æ”¯æŒç½‘ç»œè·¯å¾„ï¼‰ã€‚</p>
<p><a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/api/media/image/wx.getImageInfo.html">wx.getImageInfo()</a>ï¼šå¯ä»¥æŠŠç½‘ç»œè·¯å¾„å˜ä¸ºä¸´æ—¶è·¯å¾„ï¼ˆæ³¨æ„éœ€è¦åœ¨åå°é…ç½® download åŸŸåï¼‰ã€‚</p>
<ol>
<li>ç»‘å®šç‚¹å‡»äº‹ä»¶ï¼Œ<code>miniprogram/visitor_pkg/pages/passport/index.wxml</code>ã€‚</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;button-save&quot;</span> <span class="attr">bind:tap</span>=<span class="string">&quot;saveImage&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;enjoy-icon icon-save&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;text&quot;</span>&gt;</span>ä¿å­˜åˆ°æœ¬åœ°<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>åœ¨äº‹ä»¶å›è°ƒä¸­è¿›è¡Œå¤„ç†ï¼Œ<code>miniprogram/visitor_pkg/pages/passport/index.js</code>ã€‚</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="title">saveImage</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="comment">// è·å–å›¾ç‰‡çš„ä¸´æ—¶è·¯å¾„</span></span><br><span class="line">    <span class="keyword">const</span> &#123;</span><br><span class="line">        path</span><br><span class="line">    &#125; = <span class="keyword">await</span> wx.getImageInfo(&#123;</span><br><span class="line">        <span class="attr">src</span>: <span class="built_in">this</span>.data.url,</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">// å°†å›¾ç‰‡ä¿å­˜åˆ°æœ¬åœ°ç›¸å†Œ</span></span><br><span class="line">    <span class="keyword">await</span> wx.saveImageToPhotosAlbum(&#123;</span><br><span class="line">        <span class="attr">filePath</span>: path,</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2023/02/20/xcx-course02/" rel="prev" title="02_å°ç¨‹åºè¿›é˜¶">
      <i class="fa fa-chevron-left"></i> 02_å°ç¨‹åºè¿›é˜¶
    </a></div>
      <div class="post-nav-item">
    <a href="/2023/03/06/xcx-course04/" rel="next" title="04_å°ç¨‹åºå“ä¼˜è´­é¡¹ç›®">
      04_å°ç¨‹åºå“ä¼˜è´­é¡¹ç›® <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%A1%B9%E7%9B%AE%E7%9B%AE%E6%A0%87"><span class="nav-number">1.</span> <span class="nav-text">é¡¹ç›®ç›®æ ‡</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BC%80%E5%8F%91%E5%87%86%E5%A4%87"><span class="nav-number">2.</span> <span class="nav-text">å¼€å‘å‡†å¤‡</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%A1%B9%E7%9B%AE%E4%BB%8B%E7%BB%8D"><span class="nav-number">2.1.</span> <span class="nav-text">é¡¹ç›®ä»‹ç»</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%90%AF%E5%8A%A8%E9%A1%B9%E7%9B%AE"><span class="nav-number">2.2.</span> <span class="nav-text">å¯åŠ¨é¡¹ç›®</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8B%89%E5%8F%96%E4%BB%A3%E7%A0%81"><span class="nav-number">2.2.1.</span> <span class="nav-text">æ‹‰å–ä»£ç </span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%BF%90%E8%A1%8C%E4%BB%A3%E7%A0%81"><span class="nav-number">2.2.2.</span> <span class="nav-text">è¿è¡Œä»£ç </span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%86%9F%E6%82%89%E7%8E%AF%E5%A2%83"><span class="nav-number">2.2.3.</span> <span class="nav-text">ç†Ÿæ‚‰ç¯å¢ƒ</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#VSCode"><span class="nav-number">2.2.4.</span> <span class="nav-text">VSCode</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B7%A5%E5%85%B7%E6%96%B9%E6%B3%95"><span class="nav-number">3.</span> <span class="nav-text">å·¥å…·æ–¹æ³•</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B6%88%E6%81%AF%E5%8F%8D%E9%A6%88"><span class="nav-number">3.1.</span> <span class="nav-text">æ¶ˆæ¯åé¦ˆ</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9F%BA%E7%A1%80%E5%B0%81%E8%A3%85"><span class="nav-number">3.1.1.</span> <span class="nav-text">åŸºç¡€å°è£…</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B1%80%E9%83%A8%E5%8A%A0%E8%BD%BD"><span class="nav-number">3.1.2.</span> <span class="nav-text">å±€éƒ¨åŠ è½½</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%85%A8%E5%B1%80%E5%8A%A0%E8%BD%BD"><span class="nav-number">3.1.3.</span> <span class="nav-text">å…¨å±€åŠ è½½</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82"><span class="nav-number">3.2.</span> <span class="nav-text">ç½‘ç»œè¯·æ±‚</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%89%E8%A3%85-wechat-http"><span class="nav-number">3.2.1.</span> <span class="nav-text">å®‰è£… wechat-http</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%85%AC%E5%85%B1%E9%85%8D%E7%BD%AE"><span class="nav-number">3.2.2.</span> <span class="nav-text">å…¬å…±é…ç½®</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%85%A8%E5%B1%80%E5%8A%A0%E8%BD%BD-1"><span class="nav-number">3.2.3.</span> <span class="nav-text">å…¨å±€åŠ è½½</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E6%8B%A6%E6%88%AA%E5%99%A8"><span class="nav-number">3.2.4.</span> <span class="nav-text">é…ç½®æ‹¦æˆªå™¨</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%AC%E5%91%8A%E7%AE%A1%E7%90%86"><span class="nav-number">4.</span> <span class="nav-text">å…¬å‘Šç®¡ç†</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%AC%E5%91%8A%E5%88%97%E8%A1%A8"><span class="nav-number">4.1.</span> <span class="nav-text">å…¬å‘Šåˆ—è¡¨</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8E%A5%E5%8F%A3%E8%B0%83%E7%94%A8"><span class="nav-number">4.1.1.</span> <span class="nav-text">æ¥å£è°ƒç”¨</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A8%A1%E6%9D%BF%E6%B8%B2%E6%9F%93"><span class="nav-number">4.1.2.</span> <span class="nav-text">æ¨¡æ¿æ¸²æŸ“</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%AC%E5%91%8A%E8%AF%A6%E6%83%85"><span class="nav-number">4.2.</span> <span class="nav-text">å…¬å‘Šè¯¦æƒ…</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8E%A5%E5%8F%A3%E8%B0%83%E7%94%A8-1"><span class="nav-number">4.2.1.</span> <span class="nav-text">æ¥å£è°ƒç”¨</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A8%A1%E6%9D%BF%E6%B8%B2%E6%9F%93-1"><span class="nav-number">4.2.2.</span> <span class="nav-text">æ¨¡æ¿æ¸²æŸ“</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AF%8C%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86"><span class="nav-number">4.2.3.</span> <span class="nav-text">å¯Œæ–‡æœ¬å¤„ç†</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86"><span class="nav-number">5.</span> <span class="nav-text">ç”¨æˆ·ç®¡ç†</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%99%BB%E5%BD%95%E6%A3%80%E6%B5%8B"><span class="nav-number">5.1.</span> <span class="nav-text">ç™»å½•æ£€æµ‹</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95"><span class="nav-number">5.2.</span> <span class="nav-text">ç”¨æˆ·ç™»å½•</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%80%92%E8%AE%A1%E6%97%B6%E5%8A%9F%E8%83%BD"><span class="nav-number">5.2.1.</span> <span class="nav-text">å€’è®¡æ—¶åŠŸèƒ½</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E9%AA%8C%E8%AF%81%E7%A0%81"><span class="nav-number">5.2.2.</span> <span class="nav-text">è·å–éªŒè¯ç </span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%99%BB%E5%BD%95%E5%92%8C%E6%B3%A8%E5%86%8C"><span class="nav-number">5.2.3.</span> <span class="nav-text">ç™»å½•å’Œæ³¨å†Œ</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%AF%B7%E6%B1%82%E6%8B%A6%E6%88%AA%E5%99%A8"><span class="nav-number">5.2.4.</span> <span class="nav-text">è¯·æ±‚æ‹¦æˆªå™¨</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#refresh-token"><span class="nav-number">5.2.5.</span> <span class="nav-text">refresh_token</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%AA%E4%BA%BA%E8%B5%84%E6%96%99"><span class="nav-number">5.3.</span> <span class="nav-text">ä¸ªäººèµ„æ–™</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%94%A8%E6%88%B7%E6%98%B5%E7%A7%B0"><span class="nav-number">5.3.1.</span> <span class="nav-text">ç”¨æˆ·æ˜µç§°</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%94%A8%E6%88%B7%E5%A4%B4%E5%83%8F"><span class="nav-number">5.3.2.</span> <span class="nav-text">ç”¨æˆ·å¤´åƒ</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E8%B5%84%E6%96%99"><span class="nav-number">5.3.3.</span> <span class="nav-text">è·å–èµ„æ–™</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%88%BF%E5%B1%8B%E7%AE%A1%E7%90%86"><span class="nav-number">6.</span> <span class="nav-text">æˆ¿å±‹ç®¡ç†</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B7%BB%E5%8A%A0%E6%88%BF%E5%B1%8B"><span class="nav-number">6.1.</span> <span class="nav-text">æ·»åŠ æˆ¿å±‹</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9C%B0%E7%90%86%E5%AE%9A%E4%BD%8D"><span class="nav-number">6.1.1.</span> <span class="nav-text">åœ°ç†å®šä½</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%85%BE%E8%AE%AF%E4%BD%8D%E7%BD%AE"><span class="nav-number">6.1.2.</span> <span class="nav-text">è…¾è®¯ä½ç½®</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%80%89%E6%8B%A9%E6%A5%BC%E6%A0%8B"><span class="nav-number">6.1.3.</span> <span class="nav-text">é€‰æ‹©æ¥¼æ ‹</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%80%89%E6%8B%A9%E6%88%BF%E9%97%B4"><span class="nav-number">6.1.4.</span> <span class="nav-text">é€‰æ‹©æˆ¿é—´</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B7%BB%E5%8A%A0%E6%88%BF%E5%B1%8B-1"><span class="nav-number">6.1.5.</span> <span class="nav-text">æ·»åŠ æˆ¿å±‹</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%88%BF%E5%B1%8B%E5%88%97%E8%A1%A8"><span class="nav-number">6.2.</span> <span class="nav-text">æˆ¿å±‹åˆ—è¡¨</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%A0%E9%99%A4%E6%88%BF%E5%B1%8B"><span class="nav-number">6.3.</span> <span class="nav-text">åˆ é™¤æˆ¿å±‹</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%88%BF%E5%B1%8B%E8%AF%A6%E6%83%85"><span class="nav-number">6.4.</span> <span class="nav-text">æˆ¿å±‹è¯¦æƒ…</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%96%E8%BE%91%E6%88%BF%E5%B1%8B"><span class="nav-number">6.5.</span> <span class="nav-text">ç¼–è¾‘æˆ¿å±‹</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8A%A5%E4%BF%AE%E7%AE%A1%E7%90%86"><span class="nav-number">7.</span> <span class="nav-text">æŠ¥ä¿®ç®¡ç†</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9C%A8%E7%BA%BF%E6%8A%A5%E4%BF%AE"><span class="nav-number">7.1.</span> <span class="nav-text">åœ¨çº¿æŠ¥ä¿®</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%94%A8%E6%88%B7%E4%BA%A4%E4%BA%92"><span class="nav-number">7.1.1.</span> <span class="nav-text">ç”¨æˆ·äº¤äº’</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%88%BF%E5%B1%8B%E5%88%97%E8%A1%A8-1"><span class="nav-number">7.1.2.</span> <span class="nav-text">æˆ¿å±‹åˆ—è¡¨</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BB%B4%E4%BF%AE%E9%A1%B9%E7%9B%AE"><span class="nav-number">7.1.3.</span> <span class="nav-text">ç»´ä¿®é¡¹ç›®</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%8A%E4%BC%A0%E5%9B%BE%E7%89%87"><span class="nav-number">7.1.4.</span> <span class="nav-text">ä¸Šä¼ å›¾ç‰‡</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8F%90%E4%BA%A4%E8%A1%A8%E5%8D%95"><span class="nav-number">7.1.5.</span> <span class="nav-text">æäº¤è¡¨å•</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8A%A5%E4%BF%AE%E5%88%97%E8%A1%A8"><span class="nav-number">7.2.</span> <span class="nav-text">æŠ¥ä¿®åˆ—è¡¨</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8A%A5%E4%BF%AE%E8%AF%A6%E6%83%85"><span class="nav-number">7.3.</span> <span class="nav-text">æŠ¥ä¿®è¯¦æƒ…</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E6%B8%B2%E6%9F%93"><span class="nav-number">7.3.1.</span> <span class="nav-text">æ•°æ®æ¸²æŸ“</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%8A%E9%97%A8%E8%B7%AF%E7%BA%BF"><span class="nav-number">7.3.2.</span> <span class="nav-text">ä¸Šé—¨è·¯çº¿</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%96%E6%B6%88%E6%8A%A5%E4%BF%AE"><span class="nav-number">7.4.</span> <span class="nav-text">å–æ¶ˆæŠ¥ä¿®</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9%E4%BF%A1%E6%81%AF"><span class="nav-number">7.5.</span> <span class="nav-text">ä¿®æ”¹ä¿¡æ¯</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AE%BF%E5%AE%A2%E7%AE%A1%E7%90%86"><span class="nav-number">8.</span> <span class="nav-text">è®¿å®¢ç®¡ç†</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%82%80%E8%AF%B7%E8%AE%BF%E5%AE%A2"><span class="nav-number">8.1.</span> <span class="nav-text">é‚€è¯·è®¿å®¢</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%94%A8%E6%88%B7%E4%BA%A4%E4%BA%92-1"><span class="nav-number">8.1.1.</span> <span class="nav-text">ç”¨æˆ·äº¤äº’</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%88%BF%E5%B1%8B%E5%88%97%E8%A1%A8-2"><span class="nav-number">8.1.2.</span> <span class="nav-text">æˆ¿å±‹åˆ—è¡¨</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%A1%A8%E5%8D%95%E9%AA%8C%E8%AF%81"><span class="nav-number">8.1.3.</span> <span class="nav-text">è¡¨å•éªŒè¯</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%B0%83%E7%94%A8%E6%8E%A5%E5%8F%A3"><span class="nav-number">8.1.4.</span> <span class="nav-text">è°ƒç”¨æ¥å£</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AE%BF%E5%AE%A2%E8%AE%B0%E5%BD%95"><span class="nav-number">8.2.</span> <span class="nav-text">è®¿å®¢è®°å½•</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AE%BF%E5%AE%A2%E9%80%9A%E7%9F%A5%E8%AF%81"><span class="nav-number">8.3.</span> <span class="nav-text">è®¿å®¢é€šçŸ¥è¯</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E6%B8%B2%E6%9F%93-1"><span class="nav-number">8.3.1.</span> <span class="nav-text">æ•°æ®æ¸²æŸ“</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%86%E4%BA%AB%E7%BB%99%E6%9C%8B%E5%8F%8B"><span class="nav-number">8.3.2.</span> <span class="nav-text">åˆ†äº«ç»™æœ‹å‹</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BF%9D%E5%AD%98%E9%80%9A%E8%A1%8C%E7%A0%81"><span class="nav-number">8.3.3.</span> <span class="nav-text">ä¿å­˜é€šè¡Œç </span></a></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Ifer"
      src="/images/49337922.png">
  <p class="site-author-name" itemprop="name">Ifer</p>
  <div class="site-description" itemprop="description">React å…¨å®¶æ¡¶ <span style='position:relative;top:-2px;'>âœ</span></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">92</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://www.bilibili.com/video/BV1iW4y1k7Ci?spm_id_from=333.337.search-card.all.click" title="ğŸ˜š â†’ https:&#x2F;&#x2F;www.bilibili.com&#x2F;video&#x2F;BV1iW4y1k7Ci?spm_id_from&#x3D;333.337.search-card.all.click" rel="noopener" target="_blank"><i class="a fa-fw"></i>ğŸ˜š</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.zhihu.com/people/weixiantx" title="ğŸ˜™ â†’ https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;weixiantx" rel="noopener" target="_blank"><i class="a fa-fw"></i>ğŸ˜™</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Ifer</span>
</div>
  <div class="powered-by">ç”± <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> å¼ºåŠ›é©±åŠ¨
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
