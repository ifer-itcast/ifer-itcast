<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.ico">
  <link rel="mask-icon" href="/images/favicon.ico" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"mac"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="项目目标✔ 掌握通过 uni-app 技术搭建项目。 ✔ 掌握项目首页、分类、搜索、商品列表、商品详情、购物车等开发。 ✔ 掌握登录和支付的开发思路。">
<meta property="og:type" content="article">
<meta property="og:title" content="04_小程序品优购项目">
<meta property="og:url" content="http://example.com/2023/03/06/xcx-course04/index.html">
<meta property="og:site_name" content="危险">
<meta property="og:description" content="项目目标✔ 掌握通过 uni-app 技术搭建项目。 ✔ 掌握项目首页、分类、搜索、商品列表、商品详情、购物车等开发。 ✔ 掌握登录和支付的开发思路。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/resource/images/1-7.43264ae4.png">
<meta property="og:image" content="http://example.com/resource/images/1-1.74fed64c.png">
<meta property="og:image" content="http://example.com/resource/images/1-2.1c0c98c6.png">
<meta property="og:image" content="http://example.com/resource/images/1-3.b48ee161.png">
<meta property="og:image" content="http://example.com/resource/images/1-4.b7efec14.png">
<meta property="og:image" content="http://example.com/resource/images/Snipaste_2022-08-29_10-00-26.png">
<meta property="og:image" content="http://example.com/resource/images/Snipaste_2022-08-29_10-06-07.png">
<meta property="og:image" content="http://example.com/resource/images/1-8.4c14eb68.png">
<meta property="og:image" content="http://example.com/resource/images/1-9.deca7c09.png">
<meta property="og:image" content="http://example.com/resource/images/image%20(7).png">
<meta property="og:image" content="http://example.com/resource/images/1-11.2637002b.png">
<meta property="og:image" content="http://example.com/resource/images/Snipaste_2022-08-29_10-25-25.png">
<meta property="og:image" content="http://example.com/resource/images/image%20(8).png">
<meta property="og:image" content="http://example.com/resource/images/image%20(9).png">
<meta property="og:image" content="http://example.com/resource/images/xxxs.png">
<meta property="og:image" content="http://example.com/resource/images/title_xxx.png">
<meta property="og:image" content="http://example.com/resource/images/floor_content.png">
<meta property="og:image" content="http://example.com/resource/images/image%20(10).png">
<meta property="og:image" content="http://example.com/resource/images/5-1.25ab714d.png">
<meta property="og:image" content="http://example.com/resource/images/image%20(11).png">
<meta property="og:image" content="http://example.com/resource/images/6-2.6a66124f.png">
<meta property="og:image" content="http://example.com/resource/images/image%20(12).png">
<meta property="og:image" content="http://example.com/resource/images/7-2.82dd8e0f.png">
<meta property="og:image" content="http://example.com/resource/images/gwx_bottom.png">
<meta property="og:image" content="http://example.com/resource/images/image%20(13).png">
<meta property="og:image" content="http://example.com/resource/images/image%20(14).png">
<meta property="og:image" content="http://example.com/resource/images/image%20(15).png">
<meta property="og:image" content="http://example.com/resource/images/9-3.d168684c.png">
<meta property="og:image" content="http://example.com/resource/images/9-4.1739d570.png">
<meta property="og:image" content="http://example.com/resource/images/10-1.46e30c32.png">
<meta property="og:image" content="http://example.com/resource/images/10-2.ace63114.png">
<meta property="og:image" content="http://example.com/resource/images/11-1.9cdf19c7.png">
<meta property="og:image" content="http://example.com/resource/images/image%20(18).png">
<meta property="og:image" content="http://example.com/resource/images/11-3.567c1979.png">
<meta property="og:image" content="http://example.com/resource/images/11-4.9c24f0ee.png">
<meta property="og:image" content="http://example.com/resource/images/image%20(19).png">
<meta property="og:image" content="http://example.com/resource/images/11-6.d5c408c3.png">
<meta property="og:image" content="http://example.com/resource/images/11-7.ec9045bc.png">
<meta property="og:image" content="http://example.com/resource/images/11-8.a251f8b8.png">
<meta property="article:published_time" content="2023-03-06T10:10:09.000Z">
<meta property="article:modified_time" content="2023-05-11T07:42:51.616Z">
<meta property="article:author" content="Ifer">
<meta property="article:tag" content="React,Redux,Mobx,Saga,Dva,Umi,AntD,TS">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/resource/images/1-7.43264ae4.png">

<link rel="canonical" href="http://example.com/2023/03/06/xcx-course04/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>04_小程序品优购项目 | 危险</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">危险</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">为之则易，不为则难</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/03/06/xcx-course04/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/49337922.png">
      <meta itemprop="name" content="Ifer">
      <meta itemprop="description" content="React 全家桶 <span style='position:relative;top:-2px;'>✍</span>">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="危险">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          04_小程序品优购项目
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-03-06 18:10:09" itemprop="dateCreated datePublished" datetime="2023-03-06T18:10:09+08:00">2023-03-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-05-11 15:42:51" itemprop="dateModified" datetime="2023-05-11T15:42:51+08:00">2023-05-11</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="项目目标"><a href="#项目目标" class="headerlink" title="项目目标"></a>项目目标</h1><p>✔ 掌握通过 uni-app 技术搭建项目。</p>
<p>✔ 掌握项目首页、分类、搜索、商品列表、商品详情、购物车等开发。</p>
<p>✔ 掌握登录和支付的开发思路。</p>
<span id="more"></span>

<h1 id="项目概述"><a href="#项目概述" class="headerlink" title="项目概述"></a>项目概述</h1><h2 id="项目概述-1"><a href="#项目概述-1" class="headerlink" title="项目概述"></a>项目概述</h2><ul>
<li>  基于 uni-app 开发的微信小程序商城项目。</li>
</ul>
<!-- -   原版文档：https://www.escook.cn/docs-uni-shop/ -->

<ul>
<li>  接口说明：<a target="_blank" rel="noopener" href="https://www.showdoc.com.cn/128719739414963">https://www.showdoc.com.cn/128719739414963</a></li>
</ul>
<h2 id="项目概览"><a href="#项目概览" class="headerlink" title="项目概览"></a>项目概览</h2><p>首页、分类、购物车、我的、搜索、商品列表、商品详情、微信支付。</p>
<p>图片参考：<code>xcx_doc =&gt; files =&gt; 小程序项目 =&gt; 预览</code>。</p>
<h3 id="技术栈"><a href="#技术栈" class="headerlink" title="技术栈"></a>技术栈</h3><ol>
<li><p>开发框架：uni-app。</p>
</li>
<li><p>ui 组件库：uni-ui。</p>
</li>
<li><p>网络请求：@escook/request-miniprogram。</p>
</li>
<li><p>状态（数据）管理：vuex。</p>
</li>
<li><p>开发工具：HBuilderX。</p>
</li>
</ol>
<h1 id="项目起步"><a href="#项目起步" class="headerlink" title="项目起步"></a>项目起步</h1><h2 id="uni-app-简介"><a href="#uni-app-简介" class="headerlink" title="uni-app 简介"></a>uni-app 简介</h2><p>uni-app 是一个使用 Vue.js 开发所有前端应用的框架，开发者编写一套代码，可发布到 iOS、Android、H5、以及各种小程序（微信/支付宝/百度/头条/QQ/钉钉/淘宝）、快应用等多个平台。</p>
<img src="/resource/images/1-7.43264ae4.png" />

<p>详细的 uni-app 官方文档，请翻阅，<a target="_blank" rel="noopener" href="https://uniapp.dcloud.net.cn/">https://uniapp.dcloud.net.cn/</a></p>
<h2 id="开发工具下载"><a href="#开发工具下载" class="headerlink" title="开发工具下载"></a>开发工具下载</h2><p>uni-app 官方推荐使用 HBuilderX 来开发 uni-app 类型的项目，主要好处：模板丰富、完善的智能提示、一键运行，当然，你依然可以根据自己的喜好，选择使用 VS Code、Sublime 等自己喜欢的编辑器！</p>
<h2 id="下载-HBuilder"><a href="#下载-HBuilder" class="headerlink" title="下载 HBuilder"></a>下载 HBuilder</h2><p>访问 HBuilderX 的官网首页，选择下载 <a target="_blank" rel="noopener" href="https://www.dcloud.io/hbuilderx.html">正式版</a> 下载即可。</p>
<h2 id="安装-HBuilder"><a href="#安装-HBuilder" class="headerlink" title="安装 HBuilder"></a>安装 HBuilder</h2><ol>
<li><p>将下载的 zip 包进行解压缩。</p>
</li>
<li><p>将解压之后的文件夹，存放到纯英文的目录中（且不能包含括号等特殊字符），比如：<code>D:\Soft\HBuilderX</code>。</p>
</li>
<li><p>双击 HBuilderX.exe 即可启动。</p>
</li>
</ol>
<h2 id="开发者工具的配置"><a href="#开发者工具的配置" class="headerlink" title="开发者工具的配置"></a>开发者工具的配置</h2><h3 id="安装-Sass"><a href="#安装-Sass" class="headerlink" title="安装 Sass"></a>安装 Sass</h3><ol>
<li><p>为了方便编写样式，建议安装 scss/sass 编译 插件（新版本的开发工具已经不需要手动安装了），<a target="_blank" rel="noopener" href="https://ext.dcloud.net.cn/plugin?name=compile-node-sass">下载地址</a>。</p>
</li>
<li><p>进入插件下载页面之后，点击右上角的 使用 HBuilderX 导入插件 按钮进行自动安装，截图如下。</p>
</li>
</ol>
<img src="/resource/images/1-1.74fed64c.png"/>

<h3 id="快捷键方案切换"><a href="#快捷键方案切换" class="headerlink" title="快捷键方案切换"></a>快捷键方案切换</h3><p>操作步骤：工具 -&gt; 预设快捷键方案切换 -&gt; VSCode。</p>
<img src="/resource/images/1-2.1c0c98c6.png"/>

<h3 id="修改编辑器设置"><a href="#修改编辑器设置" class="headerlink" title="修改编辑器设置"></a>修改编辑器设置</h3><p>操作步骤：工具 -&gt; 设置 -&gt; 源码视图 -&gt; 打开 Settings.json 按需进行配置。</p>
<img src="/resource/images/1-3.b48ee161.png"/>

<p>参考如下。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;editor.tabSize&quot;</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="attr">&quot;editor.wordWrap&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">&quot;explorer.iconTheme&quot;</span>: <span class="string">&quot;vs-seti&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;editor.formatOnSave&quot;</span>: <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="新建-uni-app-项目"><a href="#新建-uni-app-项目" class="headerlink" title="新建 uni-app 项目"></a>新建 uni-app 项目</h2><h3 id="创建项目"><a href="#创建项目" class="headerlink" title="创建项目"></a>创建项目</h3><p>文件 -&gt; 新建 -&gt; 项目。</p>
<img src="/resource/images/1-4.b7efec14.png"/>

<h3 id="填写信息"><a href="#填写信息" class="headerlink" title="填写信息"></a>填写信息</h3><img src="/resource/images/Snipaste_2022-08-29_10-00-26.png"/>

<h3 id="创建成功"><a href="#创建成功" class="headerlink" title="创建成功"></a>创建成功</h3><img src="/resource/images/Snipaste_2022-08-29_10-06-07.png"/>

<h2 id="uni-app-目录结构"><a href="#uni-app-目录结构" class="headerlink" title="uni-app 目录结构"></a>uni-app 目录结构</h2><p><a target="_blank" rel="noopener" href="https://uniapp.dcloud.net.cn/tutorial/project.html">官网说明</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">├─.hbuilderx <span class="comment"># 编辑器配置信息</span></span><br><span class="line">├─App.vue <span class="comment"># 根组件</span></span><br><span class="line">├─index.html <span class="comment"># 模板文件</span></span><br><span class="line">├─main.js <span class="comment"># 项目入口文件</span></span><br><span class="line">├─manifest.json <span class="comment"># 配置应用名称、appid、logo、版本等打包信息</span></span><br><span class="line">├─pages.json <span class="comment"># 配置页面路径、页面窗口样式、tabBar、navigationBar 等页面类信息</span></span><br><span class="line">├─uni.scss <span class="comment"># uni-app 内置的常用样式变量</span></span><br><span class="line">├─pages <span class="comment"># 业务页面文件存放的目录</span></span><br><span class="line">│  └─index</span><br><span class="line">├─static <span class="comment"># 存放应用引用静态资源（如图片、视频等）的目录，注意：静态资源只能存放于此</span></span><br><span class="line">├─uni_modules <span class="comment"># uni-ui 组件库</span></span><br><span class="line">└─unpackage <span class="comment"># 编译后的代码</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>  编译到任意平台时，static 目录下的文件均会被完整打包进去，且不会编译，非 static 目录下的文件（vue、js、css 等）只有被引用到才会被打包编译进去。</p>
</li>
<li><p>  static 目录下的 JS 文件不会被编译，如果里面有 ES6 的代码，不会经过转换直接运行，在手机设备上可能会报错。</p>
</li>
<li><p>  css、less/scss 等资源不要放在 static 目录下，建议这些公用的资源放在自建的 common 目录下。</p>
</li>
</ul>
<h2 id="微信工具预览项目"><a href="#微信工具预览项目" class="headerlink" title="微信工具预览项目"></a>微信工具预览项目</h2><h3 id="填写-AppID"><a href="#填写-AppID" class="headerlink" title="填写 AppID"></a>填写 AppID</h3><p>填写自己的微信小程序的 AppID，<code>wxfb52f2d7b2f6123a</code>。</p>
<img src="/resource/images/1-8.4c14eb68.png"/>

<p>如果不填写 AppID ，微信开发者工具可能会报错：TypeError: Cannot read property ‘forceUpdate’ of undefined。</p>
<h3 id="配置工具路径"><a href="#配置工具路径" class="headerlink" title="配置工具路径"></a>配置工具路径</h3><p>在 HBuilder 中配置微信开发者工具的路径地址。</p>
<img src="/resource/images/1-9.deca7c09.png"/>

<h3 id="开启服务端口"><a href="#开启服务端口" class="headerlink" title="开启服务端口"></a>开启服务端口</h3><p>微信开发者工具中，通过 设置 -&gt; 安全设置 面板，开启“微信开发者工具”的服务端口。</p>
<img src="/resource/images/image (7).png"/>

<h3 id="启动预览项目"><a href="#启动预览项目" class="headerlink" title="启动预览项目"></a>启动预览项目</h3><p>在 HBuilderX 中，点击菜单栏中的 运行 -&gt; 运行到小程序模拟器 -&gt; 微信开发者工具，将当前 uni-app 项目编译之后，自动运行到微信开发者工具中，从而方便查看项目效果与调试。</p>
<img src="/resource/images/1-11.2637002b.png"/>

<h3 id="运行成功效果"><a href="#运行成功效果" class="headerlink" title="运行成功效果"></a>运行成功效果</h3><img src="/resource/images/Snipaste_2022-08-29_10-25-25.png"/>

<h2 id="使用-Git-管理项目"><a href="#使用-Git-管理项目" class="headerlink" title="使用 Git 管理项目"></a>使用 Git 管理项目</h2><h3 id="创建-gitignore"><a href="#创建-gitignore" class="headerlink" title="创建 .gitignore"></a>创建 .gitignore</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 忽略 node_modules 目录</span></span><br><span class="line">/node_modules</span><br><span class="line">/unpackage/dist</span><br><span class="line">/.hbuilderx</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> MacOS 还要忽略 .DS_Store 文件</span></span><br><span class="line">.DS_Store</span><br></pre></td></tr></table></figure>

<h3 id="初始化本地-Git-仓库"><a href="#初始化本地-Git-仓库" class="headerlink" title="初始化本地 Git 仓库"></a>初始化本地 Git 仓库</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git init</span><br></pre></td></tr></table></figure>

<h3 id="添加到暂存区"><a href="#添加到暂存区" class="headerlink" title="添加到暂存区"></a>添加到暂存区</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git add .</span><br></pre></td></tr></table></figure>

<h3 id="本地提交项目"><a href="#本地提交项目" class="headerlink" title="本地提交项目"></a>本地提交项目</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git commit -m <span class="string">&quot;init project&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="项目托管码云"><a href="#项目托管码云" class="headerlink" title="项目托管码云"></a>项目托管码云</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git remote add origin https://gitee.com/ifercarly/uni-47.git</span><br><span class="line">git push -u origin master</span><br></pre></td></tr></table></figure>

<!-- 1. 注册并激活码云账号（注册页面地址：https://gitee.com/signup）。

2. 生成并配置 SSH 公钥(windows 下 c 盘下的“用户”文件夹下.ssh 目录)。

   git 多账户解决办法
   1、https://www.cnblogs.com/rysinal/p/6381874.html 多账户配置
   2、主账户使用 ssh，其它账户使用 https
   git remote add origin git@gitee.com:ycomputer/uni-shop1.git
   git push -u origin master
   修改为
   git remote add origin https://gitee.com/ycomputer/uni-shop1.git
   git push -u origin master
3. 创建空白的码云仓库
4. 把本地项目上传到码云对应的空白仓库中 -->

<h1 id="TabBar"><a href="#TabBar" class="headerlink" title="TabBar"></a>TabBar</h1><h2 id="创建-TabBar-对应页面"><a href="#创建-TabBar-对应页面" class="headerlink" title="创建 TabBar 对应页面"></a>创建 TabBar 对应页面</h2><p>在 pages 目录中，创建首页（home）、分类（cate）、购物车（cart）、我的（my） 这 4 个 tabBar 页面。在 HBuilderX 中，可以通过如下的两个步骤，快速新建页面。</p>
<ol>
<li><p>在 pages 目录上鼠标右键，选择新建页面。</p>
</li>
<li><p>在弹出的窗口中，填写页面的名称、勾选 scss 模板之后，点击创建按钮，截图如下。</p>
</li>
</ol>
<img src="/resource/images/image (8).png"/>

<h2 id="删除默认的-index-首页"><a href="#删除默认的-index-首页" class="headerlink" title="删除默认的 index 首页"></a>删除默认的 index 首页</h2><ol>
<li><p>在 HBuilderX 中，把 pages 目录下的 index 首页文件夹删掉，同时把 <code>page.json</code> 中记录的 index 路径删除掉。</p>
</li>
<li><p>在 HBuilderX 中的运行 -&gt; 小程序模拟器 -&gt; 停止，然后重新启动运行。</p>
</li>
</ol>
<h2 id="配置-TabBar-对应信息"><a href="#配置-TabBar-对应信息" class="headerlink" title="配置 TabBar 对应信息"></a>配置 TabBar 对应信息</h2><ol>
<li><p>拷贝 <code>xcx_doc/files/小程序项目/素材</code> 中的内容到项目的 static 文件中，原来 customicons.css customicons.ttf 继续保留。</p>
</li>
<li><p>修改项目根目录中的 <code>pages.json</code> 配置文件，新增 tabBar 的配置节点如下（注意是在 HBuilder 中的项目中写下面的这些配置，不是在小程序开发工具中）。</p>
</li>
</ol>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;tabBar&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;selectedColor&quot;</span>: <span class="string">&quot;#C00000&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;list&quot;</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">&quot;pagePath&quot;</span>: <span class="string">&quot;pages/home/home&quot;</span>,</span><br><span class="line">                <span class="attr">&quot;text&quot;</span>: <span class="string">&quot;首页&quot;</span>,</span><br><span class="line">                <span class="attr">&quot;iconPath&quot;</span>: <span class="string">&quot;static/tab_icons/home.png&quot;</span>,</span><br><span class="line">                <span class="attr">&quot;selectedIconPath&quot;</span>: <span class="string">&quot;static/tab_icons/home-active.png&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">&quot;pagePath&quot;</span>: <span class="string">&quot;pages/cate/cate&quot;</span>,</span><br><span class="line">                <span class="attr">&quot;text&quot;</span>: <span class="string">&quot;分类&quot;</span>,</span><br><span class="line">                <span class="attr">&quot;iconPath&quot;</span>: <span class="string">&quot;static/tab_icons/cate.png&quot;</span>,</span><br><span class="line">                <span class="attr">&quot;selectedIconPath&quot;</span>: <span class="string">&quot;static/tab_icons/cate-active.png&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">&quot;pagePath&quot;</span>: <span class="string">&quot;pages/cart/cart&quot;</span>,</span><br><span class="line">                <span class="attr">&quot;text&quot;</span>: <span class="string">&quot;购物车&quot;</span>,</span><br><span class="line">                <span class="attr">&quot;iconPath&quot;</span>: <span class="string">&quot;static/tab_icons/cart.png&quot;</span>,</span><br><span class="line">                <span class="attr">&quot;selectedIconPath&quot;</span>: <span class="string">&quot;static/tab_icons/cart-active.png&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">&quot;pagePath&quot;</span>: <span class="string">&quot;pages/my/my&quot;</span>,</span><br><span class="line">                <span class="attr">&quot;text&quot;</span>: <span class="string">&quot;我的&quot;</span>,</span><br><span class="line">                <span class="attr">&quot;iconPath&quot;</span>: <span class="string">&quot;static/tab_icons/my.png&quot;</span>,</span><br><span class="line">                <span class="attr">&quot;selectedIconPath&quot;</span>: <span class="string">&quot;static/tab_icons/my-active.png&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="修改导航条的样式效果"><a href="#修改导航条的样式效果" class="headerlink" title="修改导航条的样式效果"></a>修改导航条的样式效果</h2><ol>
<li><p>打开 <code>pages.json</code> 这个全局的配置文件。</p>
</li>
<li><p>修改 globalStyle 节点如下。</p>
</li>
</ol>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;globalStyle&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;navigationBarTextStyle&quot;</span>: <span class="string">&quot;white&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;navigationBarTitleText&quot;</span>: <span class="string">&quot;黑马优购&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;navigationBarBackgroundColor&quot;</span>: <span class="string">&quot;#C00000&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;backgroundColor&quot;</span>: <span class="string">&quot;#FFFFFF&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><font color=e32d40><strong>3. 注意不要忘了把 pages 配置项中默认的 navigationBarTitleText 删掉。</strong></font></p>
<h1 id="项目首页"><a href="#项目首页" class="headerlink" title="项目首页"></a>项目首页</h1><h2 id="配置网络请求"><a href="#配置网络请求" class="headerlink" title="配置网络请求"></a>配置网络请求</h2><p>由于平台的限制，小程序项目中不支持 axios，而且原生的 <code>wx.request()</code> API 功能较为简单，不支持拦截器等全局定制的功能。因此，建议在 uni-app 项目中使用 <a target="_blank" rel="noopener" href="https://www.npmjs.com/package/@escook/request-miniprogram">@escook/request-miniprogram</a> 第三方包发起网络数据请求。</p>
<ol start="0">
<li>安装 <code>@escook/request-miniprogram</code>。</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm init -y</span><br><span class="line">npm i @escook/request-miniprogram</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>在项目的根目录下创建 common 文件夹，在文件夹中创建 <code>request.js</code> 文件，专门用来处理请求。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; $http &#125; <span class="keyword">from</span> <span class="string">&#x27;@escook/request-miniprogram&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置请求根路径</span></span><br><span class="line">$http.baseUrl = <span class="string">&#x27;https://api-hmugo-web.itheima.net/api/public/v1&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 请求开始之前</span></span><br><span class="line">$http.beforeRequest = <span class="function"><span class="keyword">function</span> (<span class="params">options</span>) </span>&#123;</span><br><span class="line">    uni.showLoading(&#123;</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&#x27;数据加载中...&#x27;</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 请求完成之后</span></span><br><span class="line">$http.afterRequest = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    uni.hideLoading()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将$http挂载到uni全局对象</span></span><br><span class="line">uni.$http = $http</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>在 main.js 中导入 request.js。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入请求配置文件</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./common/request.js&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="首页轮播区域"><a href="#首页轮播区域" class="headerlink" title="首页轮播区域"></a>首页轮播区域</h2><h3 id="请求轮播图的数据"><a href="#请求轮播图的数据" class="headerlink" title="请求轮播图的数据"></a>请求轮播图的数据</h3><p><a target="_blank" rel="noopener" href="https://uniapp.dcloud.net.cn/api/ui/prompt.html#showtoast">uni.showToast(OBJECT)</a></p>
<p><code>pages/home/home.vue</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="comment">// 1. 轮播图的数据列表，默认为空数组</span></span><br><span class="line">            <span class="attr">swiperList</span>: [],</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="title">onLoad</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// 2. 在小程序页面刚加载的时候，调用获取轮播图数据的方法</span></span><br><span class="line">        <span class="built_in">this</span>.getSwiperList()</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">methods</span>: &#123;</span><br><span class="line">        <span class="comment">// 3. 获取轮播图数据的方法</span></span><br><span class="line">        <span class="keyword">async</span> <span class="function"><span class="title">getSwiperList</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">            <span class="comment">// 3.1 发起请求</span></span><br><span class="line">            <span class="keyword">const</span> &#123; <span class="attr">data</span>: res &#125; = <span class="keyword">await</span> uni.$http.get(<span class="string">&#x27;/home/swiperdata&#x27;</span>)</span><br><span class="line">            <span class="comment">// 3.2 请求失败</span></span><br><span class="line">            <span class="keyword">if</span> (res.meta.status !== <span class="number">200</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> uni.showToast(&#123;</span><br><span class="line">                    <span class="attr">title</span>: <span class="string">&#x27;数据请求失败！&#x27;</span>,</span><br><span class="line">                    <span class="attr">duration</span>: <span class="number">1500</span>,</span><br><span class="line">                    <span class="attr">icon</span>: <span class="string">&#x27;none&#x27;</span>,</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 3.3 请求成功，为 data 中的数据赋值</span></span><br><span class="line">            <span class="built_in">this</span>.swiperList = res.message</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="渲染轮播图的结构"><a href="#渲染轮播图的结构" class="headerlink" title="渲染轮播图的结构"></a>渲染轮播图的结构</h3><p>🤔 如果小程序模拟器出不来，关闭重新打开。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 轮播图区域 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">swiper</span> <span class="attr">:indicator-dots</span>=<span class="string">&quot;true&quot;</span> <span class="attr">:autoplay</span>=<span class="string">&quot;true&quot;</span> <span class="attr">:interval</span>=<span class="string">&quot;3000&quot;</span> <span class="attr">:duration</span>=<span class="string">&quot;1000&quot;</span> <span class="attr">:circular</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 循环渲染轮播图的 item 项 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">swiper-item</span> <span class="attr">v-for</span>=<span class="string">&quot;(item, i) in swiperList&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;i&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;swiper-item&quot;</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!-- 动态绑定图片的 src 属性 --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">image</span> <span class="attr">:src</span>=<span class="string">&quot;item.image_src&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">swiper-item</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">swiper</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">lang</span>=<span class="string">&quot;scss&quot;</span>&gt;</span><span class="css"></span></span><br><span class="line"><span class="css">    swiper &#123;</span></span><br><span class="line"><span class="css">        <span class="attribute">height</span>: <span class="number">330</span>rpx;</span></span><br><span class="line"><span class="css">        <span class="selector-class">.swiper-item</span>,</span></span><br><span class="line"><span class="css">        image &#123;</span></span><br><span class="line"><span class="css">            <span class="attribute">width</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="css">            <span class="attribute">height</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="css">        &#125;</span></span><br><span class="line"><span class="css">    &#125;</span></span><br><span class="line"><span class="css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="配置小程序的分包"><a href="#配置小程序的分包" class="headerlink" title="配置小程序的分包"></a>配置小程序的分包</h3><p><a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/framework/subpackages.html">关于分包</a>：分包是小程序提供的一种项目优化手段，类似于路由懒加载，只有用到时才会加载对应的代码，可以减少小程序首次启动时的加载时间。</p>
<p>为此，我们在项目中，把 tabBar 相关的 4 个页面放到<font color=e32d40><strong>主包</strong></font>中，其它页面（例如：商品详情页、商品列表页）放到<font color=e32d40><strong>分包</strong></font>中，uni-app 中配置分包的步骤如下。</p>
<ol>
<li><p>在项目根目录中，创建分包的根目录，命名为 subpkg。</p>
</li>
<li><p>在 <code>pages.json</code> 中，和 pages 字段平级的位置声明 subPackages 数据节点，用来定义分包相关的结构。</p>
</li>
</ol>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;pages&quot;</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">&quot;path&quot;</span>: <span class="string">&quot;pages/home/home&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;style&quot;</span>: &#123;&#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">&quot;path&quot;</span>: <span class="string">&quot;pages/cate/cate&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;style&quot;</span>: &#123;&#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">&quot;path&quot;</span>: <span class="string">&quot;pages/cart/cart&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;style&quot;</span>: &#123;&#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">&quot;path&quot;</span>: <span class="string">&quot;pages/my/my&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;style&quot;</span>: &#123;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">&quot;subPackages&quot;</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">&quot;root&quot;</span>: <span class="string">&quot;subpkg&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;pages&quot;</span>: []</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在 subpkg 目录上鼠标右键，点击【新建页面】选项，并填写页面的相关信息。</p>
<img src="/resource/images/image (9).png"/>

<p>创建成功后开发工具会自动在 <code>pages.json</code> 下的 <code>subPackages.pages</code> 中生成对应分包的配置。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;pages&quot;</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">&quot;path&quot;</span>: <span class="string">&quot;goods_detail/goods_detail&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;style&quot;</span>: &#123;</span><br><span class="line">                <span class="attr">&quot;navigationBarTitleText&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">                <span class="attr">&quot;enablePullDownRefresh&quot;</span>: <span class="literal">false</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="点击轮播跳转详情"><a href="#点击轮播跳转详情" class="headerlink" title="点击轮播跳转详情"></a>点击轮播跳转详情</h3><p>将 <code>pages/home/home.vue</code> 中 <code>&lt;swiper-item&gt;</code> 节点内的 view 组件，改造为 navigator 导航组件，并动态绑定 url 属性 的值，改造之前的 UI 结构。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">swiper-item</span> <span class="attr">v-for</span>=<span class="string">&quot;(item, i) in swiperList&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;i&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;swiper-item&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 动态绑定图片的 src 属性 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">image</span> <span class="attr">:src</span>=<span class="string">&quot;item.image_src&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">swiper-item</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>url 的模版字符串写法。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">swiper-item</span> <span class="attr">v-for</span>=<span class="string">&quot;(item, i) in swiperList&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;i&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">navigator</span> <span class="attr">class</span>=<span class="string">&quot;swiper-item&quot;</span> <span class="attr">:url</span>=<span class="string">&quot;`/subpkg/goods_detail/goods_detail?goods_id=$&#123;item.goods_id&#125;`&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 动态绑定图片的 src 属性 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">image</span> <span class="attr">:src</span>=<span class="string">&quot;item.image_src&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">navigator</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">swiper-item</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="封装-uni-showMsg"><a href="#封装-uni-showMsg" class="headerlink" title="封装 uni.$showMsg()"></a>封装 uni.$showMsg()</h3><ul>
<li><p>  问题：当数据请求失败之后，经常需要调用 <code>uni.showToast(&#123; /* 配置对象 */ &#125;)</code> 方法来提示用户，比较麻烦。</p>
</li>
<li><p>  解决：在全局封装一个 <code>uni.$showMsg()</code> 方法，来简化 <code>uni.showToast()</code> 方法的调用，具体的改造步骤如下。</p>
</li>
</ul>
<ol>
<li>在 <code>common/request.js</code> 中，为 uni 对象挂载自定义的 <code>$showMsg()</code> 方法。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 封装的展示消息提示的方法</span></span><br><span class="line">uni.$showMsg = <span class="function"><span class="keyword">function</span> (<span class="params">title = <span class="string">&#x27;数据加载失败！&#x27;</span>, duration = <span class="number">1500</span></span>) </span>&#123;</span><br><span class="line">    uni.showToast(&#123;</span><br><span class="line">        title,</span><br><span class="line">        duration,</span><br><span class="line">        <span class="attr">icon</span>: <span class="string">&#x27;none&#x27;</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>今后在需要提示消息的时候，直接调用 <code>uni.$showMsg()</code> 方法即可，<code>pages/home/home.vue</code>。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="title">getSwiperList</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">   <span class="keyword">const</span> &#123; <span class="attr">data</span>: res &#125; = <span class="keyword">await</span> uni.$http.get(<span class="string">&#x27;/home/swiperdata&#x27;</span>)</span><br><span class="line">   <span class="keyword">if</span> (res.meta.status !== <span class="number">200</span>) <span class="keyword">return</span> uni.$showMsg()</span><br><span class="line">   <span class="built_in">this</span>.swiperList = res.message</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="分类导航区域"><a href="#分类导航区域" class="headerlink" title="分类导航区域"></a>分类导航区域</h2><img src="/resource/images/xxxs.png"/>

<h3 id="获取分类导航的数据"><a href="#获取分类导航的数据" class="headerlink" title="获取分类导航的数据"></a>获取分类导航的数据</h3><ol>
<li><p>定义 data 数据。</p>
</li>
<li><p>在 methods 中<font color=e32d40><strong>定义</strong></font>获取数据的方法。</p>
</li>
<li><p>在 onLoad 中<font color=e32d40><strong>调用</strong></font>获取数据的方法。</p>
</li>
</ol>
<p><code>pages/home/home.vue</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="comment">// 1. 分类导航的数据列表</span></span><br><span class="line">            <span class="attr">navList</span>: [],</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="title">onLoad</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// 3. 在 onLoad 中调用获取数据的方法</span></span><br><span class="line">        <span class="built_in">this</span>.getNavList()</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">methods</span>: &#123;</span><br><span class="line">        <span class="comment">// 2. 在 methods 中定义获取数据的方法</span></span><br><span class="line">        <span class="keyword">async</span> <span class="function"><span class="title">getNavList</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> &#123; <span class="attr">data</span>: res &#125; = <span class="keyword">await</span> uni.$http.get(<span class="string">&#x27;/home/catitems&#x27;</span>)</span><br><span class="line">            <span class="keyword">if</span> (res.meta.status !== <span class="number">200</span>) <span class="keyword">return</span> uni.$showMsg()</span><br><span class="line">            <span class="built_in">this</span>.navList = res.message</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="渲染分类导航的结构"><a href="#渲染分类导航的结构" class="headerlink" title="渲染分类导航的结构"></a>渲染分类导航的结构</h3><p>定义如下的 UI 结构。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 分类导航区域 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;nav-list&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;nav-item&quot;</span> <span class="attr">v-for</span>=<span class="string">&quot;(item, i) in navList&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;i&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">image</span> <span class="attr">class</span>=<span class="string">&quot;nav-img&quot;</span> <span class="attr">:src</span>=<span class="string">&quot;item.image_src&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>通过如下的样式美化页面结构。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.nav-list</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">justify-content</span>: space-around;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">32</span>rpx <span class="number">0</span>;</span><br><span class="line">    <span class="selector-class">.nav-img</span> &#123;</span><br><span class="line">        <span class="attribute">width</span>: <span class="number">128</span>rpx;</span><br><span class="line">        <span class="attribute">height</span>: <span class="number">140</span>rpx;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="点击第一项到分类页"><a href="#点击第一项到分类页" class="headerlink" title="点击第一项到分类页"></a>点击第一项到分类页</h3><p>为 nav-item 绑定点击事件处理函数。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 分类导航区域 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;nav-list&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;nav-item&quot;</span> <span class="attr">v-for</span>=<span class="string">&quot;(item, i) in navList&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;i&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;navClickHandler(item)&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">image</span> <span class="attr">class</span>=<span class="string">&quot;nav-img&quot;</span> <span class="attr">:src</span>=<span class="string">&quot;item.image_src&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>定义 navClickHandler 事件处理函数。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// nav-item 项被点击时候的事件处理函数</span></span><br><span class="line"><span class="function"><span class="title">navClickHandler</span>(<span class="params">item</span>)</span> &#123;</span><br><span class="line">    <span class="comment">// 判断点击的是哪个 nav</span></span><br><span class="line">    <span class="keyword">if</span> (item.name === <span class="string">&#x27;分类&#x27;</span>) &#123;</span><br><span class="line">        uni.switchTab(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">&#x27;/pages/cate/cate&#x27;</span> <span class="comment">//url: &quot;../cate/cate&quot; //或者是使用相对路径</span></span><br><span class="line">        &#125;)</span><br><span class="line">&#125;&#125;</span><br></pre></td></tr></table></figure>

<h2 id="首页楼层区域"><a href="#首页楼层区域" class="headerlink" title="首页楼层区域"></a>首页楼层区域</h2><h3 id="获取楼层数据"><a href="#获取楼层数据" class="headerlink" title="获取楼层数据"></a>获取楼层数据</h3><ol>
<li><p>定义 data 数据。</p>
</li>
<li><p>在 methods 中<font color=e32d40><strong>定义</strong></font>获取数据的方法。</p>
</li>
<li><p>在 onLoad 中<font color=e32d40><strong>调用</strong></font>获取数据的方法。</p>
</li>
</ol>
<p><code>pages/home/home.vue</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="comment">// 1. 楼层的数据列表</span></span><br><span class="line">            <span class="attr">floorList</span>: [],</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="title">onLoad</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// 3. 在 onLoad 中调用获取楼层数据的方法</span></span><br><span class="line">        <span class="built_in">this</span>.getFloorList()</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">methods</span>: &#123;</span><br><span class="line">        <span class="comment">// 2. 定义获取楼层列表数据的方法</span></span><br><span class="line">        <span class="keyword">async</span> <span class="function"><span class="title">getFloorList</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> &#123; <span class="attr">data</span>: res &#125; = <span class="keyword">await</span> uni.$http.get(<span class="string">&#x27;/home/floordata&#x27;</span>)</span><br><span class="line">            <span class="keyword">if</span> (res.meta.status !== <span class="number">200</span>) <span class="keyword">return</span> uni.$showMsg()</span><br><span class="line">            <span class="built_in">this</span>.floorList = res.message</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="渲染楼层标题"><a href="#渲染楼层标题" class="headerlink" title="渲染楼层标题"></a>渲染楼层标题</h3><img src="/resource/images/title_xxx.png"/>

<p>定义如下的 UI 结构。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 楼层区域 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;floor-list&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 楼层 item 项 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;floor-item&quot;</span> <span class="attr">v-for</span>=<span class="string">&quot;(item, i) in floorList&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;i&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 楼层标题 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">image</span> <span class="attr">class</span>=<span class="string">&quot;floor-title&quot;</span> <span class="attr">:src</span>=<span class="string">&quot;item.floor_title.image_src&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>美化楼层标题的样式。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.floor-title</span> &#123;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">60</span>rpx;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="渲染楼层内容"><a href="#渲染楼层内容" class="headerlink" title="渲染楼层内容"></a>渲染楼层内容</h3><img src="/resource/images/floor_content.png"/>

<p>定义楼层图片区域的 UI 结构。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 楼层标题 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">image</span> <span class="attr">class</span>=<span class="string">&quot;floor-title&quot;</span> <span class="attr">:src</span>=<span class="string">&quot;item.floor_title.image_src&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 楼层图片区域 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;floor-img-box&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 左侧大图片的盒子 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;left-img-box&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">image</span> <span class="attr">:src</span>=<span class="string">&quot;item.product_list[0].image_src&quot;</span> <span class="attr">:style</span>=<span class="string">&quot;&#123;width: item.product_list[0].image_width + &#x27;rpx&#x27;&#125;&quot;</span> <span class="attr">mode</span>=<span class="string">&quot;widthFix&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 右侧 4 个小图片的盒子 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;right-img-box&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;right-img-item&quot;</span> <span class="attr">v-for</span>=<span class="string">&quot;(item2, i2) in item.product_list&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;i2&quot;</span> <span class="attr">v-if</span>=<span class="string">&quot;i2 !== 0&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">image</span> <span class="attr">:src</span>=<span class="string">&quot;item2.image_src&quot;</span> <span class="attr">mode</span>=<span class="string">&quot;widthFix&quot;</span> <span class="attr">:style</span>=<span class="string">&quot;&#123;width: item2.image_width + &#x27;rpx&#x27;&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>美化楼层图片区域的样式。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.floor-img-box</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">padding-left</span>: <span class="number">10</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.right-img-box</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">flex-wrap</span>: wrap;</span><br><span class="line">    <span class="attribute">justify-content</span>: space-around;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="点击楼层跳转"><a href="#点击楼层跳转" class="headerlink" title="点击楼层跳转"></a>点击楼层跳转</h3><p>点击楼层图片跳转到商品列表页，在 subpkg 分包中，新建 goods_list 页面。</p>
<img src="/resource/images/image (10).png"/>

<p>问题：楼层数据请求成功之后，后端返回的 navigator_url 如下。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 后端返回的</span></span><br><span class="line"><span class="attr">navigator_url</span>: <span class="string">&#x27;/pages/goods_list?query=服饰&#x27;</span></span><br></pre></td></tr></table></figure>

<p>解决：通过双层 forEach 循环，处理后端返回的 URL 地址为实际需要的。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取楼层列表数据</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="title">getFloorList</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; <span class="attr">data</span>: res &#125; = <span class="keyword">await</span> uni.$http.get(<span class="string">&#x27;/home/floordata&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> (res.meta.status !== <span class="number">200</span>) <span class="keyword">return</span> uni.$showMsg()</span><br><span class="line">    <span class="comment">// 通过双层 forEach 循环，处理 URL 地址</span></span><br><span class="line">    res.message.forEach(<span class="function"><span class="params">floor</span> =&gt;</span> &#123;</span><br><span class="line">        floor.product_list.forEach(<span class="function"><span class="params">prod</span> =&gt;</span> &#123;</span><br><span class="line">            prod.url = <span class="string">&#x27;/subpkg/goods_list/goods_list?&#x27;</span> + prod.navigator_url.split(<span class="string">&#x27;?&#x27;</span>)[<span class="number">1</span>]</span><br><span class="line">            <span class="comment">// prod.url = `/subpkg/goods_list/goods_list?$&#123;prod.navigator_url.split(&#x27;?&#x27;)[1]&#125;` // 模版字符串写法</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="built_in">this</span>.floorList = res.message</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用：把图片外层的 view 组件，改造为 navigator 组件，并动态绑定 url 属性 的值。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 楼层图片区域 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;floor-img-box&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 左侧大图片的盒子 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">navigator</span> <span class="attr">class</span>=<span class="string">&quot;left-img-box&quot;</span> <span class="attr">:url</span>=<span class="string">&quot;item.product_list[0].url&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">image</span> <span class="attr">:src</span>=<span class="string">&quot;item.product_list[0].image_src&quot;</span> <span class="attr">:style</span>=<span class="string">&quot;&#123;width: item.product_list[0].image_width + &#x27;rpx&#x27;&#125;&quot;</span> <span class="attr">mode</span>=<span class="string">&quot;widthFix&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">navigator</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 右侧 4 个小图片的盒子 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;right-img-box&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">navigator</span> <span class="attr">class</span>=<span class="string">&quot;right-img-item&quot;</span> <span class="attr">v-for</span>=<span class="string">&quot;(item2, i2) in item.product_list&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;i2&quot;</span> <span class="attr">v-if</span>=<span class="string">&quot;i2 !== 0&quot;</span> <span class="attr">:url</span>=<span class="string">&quot;item2.url&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">image</span> <span class="attr">:src</span>=<span class="string">&quot;item2.image_src&quot;</span> <span class="attr">mode</span>=<span class="string">&quot;widthFix&quot;</span> <span class="attr">:style</span>=<span class="string">&quot;&#123;width: item2.image_width + &#x27;rpx&#x27;&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">navigator</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="分类页面"><a href="#分类页面" class="headerlink" title="分类页面"></a>分类页面</h1><h2 id="基本结构和样式"><a href="#基本结构和样式" class="headerlink" title="基本结构和样式"></a>基本结构和样式</h2><ol>
<li>准备结构，<code>pages/cate/cate.vue</code>。</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 搜索框 --&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 分类选择 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;cate-container&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 左侧一级分类 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scroll-view</span> <span class="attr">class</span>=<span class="string">&quot;cate-left&quot;</span> <span class="attr">scroll-y</span> <span class="attr">:style</span>=<span class="string">&quot;&#123;height: wh+&#x27;px&#x27;&#125;&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;cate-left-item active&quot;</span>&gt;</span>一级分类<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;cate-left-item&quot;</span>&gt;</span>一级分类<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;cate-left-item&quot;</span>&gt;</span>一级分类<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;cate-left-item&quot;</span>&gt;</span>一级分类<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;cate-left-item&quot;</span>&gt;</span>一级分类<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;cate-left-item&quot;</span>&gt;</span>一级分类<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;cate-left-item&quot;</span>&gt;</span>一级分类<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;cate-left-item&quot;</span>&gt;</span>一级分类<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;cate-left-item&quot;</span>&gt;</span>一级分类<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;cate-left-item&quot;</span>&gt;</span>一级分类<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;cate-left-item&quot;</span>&gt;</span>一级分类<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">scroll-view</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 右侧二级分类 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scroll-view</span> <span class="attr">class</span>=<span class="string">&quot;cate-right&quot;</span> <span class="attr">scroll-y</span> <span class="attr">:style</span>=<span class="string">&quot;&#123;height: wh+&#x27;px&#x27;&#125;&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">view</span>&gt;</span>二级分类<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">scroll-view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>准备页面样式。</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">lang</span>=<span class="string">&quot;scss&quot;</span>&gt;</span><span class="css"></span></span><br><span class="line"><span class="css">    <span class="selector-class">.cate-container</span> &#123;</span></span><br><span class="line"><span class="css">        <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="css">        <span class="selector-class">.cate-left</span> &#123;</span></span><br><span class="line"><span class="css">            <span class="attribute">width</span>: <span class="number">240</span>rpx;</span></span><br><span class="line"><span class="css">            <span class="selector-class">.cate-left-item</span> &#123;</span></span><br><span class="line"><span class="css">                <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="css">                <span class="attribute">justify-content</span>: center;</span></span><br><span class="line"><span class="css">                <span class="attribute">align-items</span>: center;</span></span><br><span class="line"><span class="css">                <span class="attribute">height</span>: <span class="number">120</span>rpx;</span></span><br><span class="line"><span class="css">                <span class="attribute">background-color</span>: <span class="number">#efefef</span>;</span></span><br><span class="line"><span class="css">                <span class="attribute">font-size</span>: <span class="number">24</span>rpx;</span></span><br><span class="line"><span class="css">                // 选中样式</span></span><br><span class="line"><span class="css">                &amp;<span class="selector-class">.active</span> &#123;</span></span><br><span class="line"><span class="css">                    <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="css">                    <span class="attribute">justify-content</span>: space-between;</span></span><br><span class="line"><span class="css">                    <span class="attribute">background-color</span>: <span class="number">#ffffff</span>;</span></span><br><span class="line"><span class="css">                    // 左边红线</span></span><br><span class="line"><span class="css">                    &amp;<span class="selector-pseudo">::before</span> &#123;</span></span><br><span class="line"><span class="css">                        <span class="attribute">content</span>: <span class="string">&#x27;&#x27;</span>;</span></span><br><span class="line"><span class="css">                        <span class="attribute">width</span>: <span class="number">6</span>rpx;</span></span><br><span class="line"><span class="css">                        <span class="attribute">height</span>: <span class="number">60</span>rpx;</span></span><br><span class="line"><span class="css">                        <span class="attribute">background-color</span>: <span class="number">#c00000</span>;</span></span><br><span class="line"><span class="css">                    &#125;</span></span><br><span class="line"><span class="css">                    // 右边白线和背景相同</span></span><br><span class="line"><span class="css">                    &amp;<span class="selector-pseudo">::after</span> &#123;</span></span><br><span class="line"><span class="css">                        <span class="attribute">content</span>: <span class="string">&#x27;&#x27;</span>;</span></span><br><span class="line"><span class="css">                        <span class="attribute">width</span>: <span class="number">6</span>rpx;</span></span><br><span class="line"><span class="css">                        <span class="attribute">height</span>: <span class="number">60</span>rpx;</span></span><br><span class="line"><span class="css">                        <span class="attribute">background-color</span>: <span class="number">#fff</span>ff;</span></span><br><span class="line"><span class="css">                    &#125;</span></span><br><span class="line"><span class="css">                &#125;</span></span><br><span class="line"><span class="css">            &#125;</span></span><br><span class="line"><span class="css">        &#125;</span></span><br><span class="line"><span class="css">    &#125;</span></span><br><span class="line"><span class="css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>动态计算窗口的剩余高度并赋值给 scroll-view 组件。</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">                <span class="comment">// 窗口的可用高度 = 屏幕高度 - navigationBar高度 - tabBar 高度</span></span></span><br><span class="line"><span class="javascript">                <span class="attr">wh</span>: <span class="number">0</span>,</span></span><br><span class="line"><span class="javascript">            &#125;</span></span><br><span class="line"><span class="javascript">        &#125;,</span></span><br><span class="line"><span class="javascript">        <span class="function"><span class="title">onLoad</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">            <span class="comment">// 获取页面可用高度</span></span></span><br><span class="line"><span class="javascript">            <span class="comment">// https://uniapp.dcloud.io/api/system/info?id=getsysteminfosync</span></span></span><br><span class="line"><span class="javascript">            <span class="keyword">const</span> sysInfo = uni.getSystemInfoSync()</span></span><br><span class="line"><span class="javascript">            <span class="comment">// 为 wh 赋值（windowHeight，可使用窗口高度）</span></span></span><br><span class="line"><span class="javascript">            <span class="built_in">this</span>.wh = sysInfo.windowHeight</span></span><br><span class="line"><span class="javascript">        &#125;,</span></span><br><span class="line"><span class="javascript">    &#125;</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="获取分类的数据"><a href="#获取分类的数据" class="headerlink" title="获取分类的数据"></a>获取分类的数据</h2><ol>
<li>在 data 中定义分类数据。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="comment">// 分类数据列表</span></span><br><span class="line">        <span class="attr">cateList</span>: []</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>定义获取分类列表数据的方法。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">methods: &#123;</span><br><span class="line">    <span class="comment">// 获取分类数据</span></span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="title">getCateList</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// 发起请求</span></span><br><span class="line">        <span class="keyword">const</span> &#123; <span class="attr">data</span>: res &#125; = <span class="keyword">await</span> uni.$http.get(<span class="string">&#x27;/categories&#x27;</span>)</span><br><span class="line">        <span class="comment">// 数据获取异常判断</span></span><br><span class="line">        <span class="keyword">if</span> (res.meta.status !== <span class="number">200</span>) <span class="keyword">return</span> uni.$showMsg()</span><br><span class="line">        <span class="comment">// 保存数据到data中</span></span><br><span class="line">        <span class="built_in">this</span>.cateList = res.message</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>调用获取分类列表数据的方法。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">onLoad</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="comment">// 获取分类数据</span></span><br><span class="line">    <span class="built_in">this</span>.getCateList()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="左侧的一级分类"><a href="#左侧的一级分类" class="headerlink" title="左侧的一级分类"></a>左侧的一级分类</h2><ol>
<li>循环渲染列表结构。</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 左侧一级分类 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">scroll-view</span> <span class="attr">class</span>=<span class="string">&quot;cate-left&quot;</span> <span class="attr">scroll-y</span> <span class="attr">:style</span>=<span class="string">&quot;&#123;height: wh+&#x27;px&#x27;&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;cate-left-item&quot;</span> <span class="attr">v-for</span>=<span class="string">&quot;(item, i) in cateList&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;i&quot;</span>&gt;</span> &#123;&#123;item.cat_name&#125;&#125; <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">scroll-view</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>在 data 中定义默认选中项的索引。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="comment">// 左侧一级分类选中索引</span></span><br><span class="line">        <span class="attr">active</span>: <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>循环渲染结构时，为选中项动态添加 .active 类名。</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 左侧一级分类 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">scroll-view</span> <span class="attr">class</span>=<span class="string">&quot;cate-left&quot;</span> <span class="attr">:style</span>=<span class="string">&quot;&#123;height: wh+&#x27;px&#x27;&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">:class</span>=<span class="string">&quot;[&#x27;cate-left-item&#x27;, i===active ? &#x27;active&#x27;:&#x27;&#x27;]&quot;</span> <span class="attr">v-for</span>=<span class="string">&quot;(item, i) in cateList&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;i&quot;</span>&gt;</span> &#123;&#123;item.cat_name&#125;&#125; <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">scroll-view</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="4">
<li>为一级分类的 Item 项绑定点击事件处理函数 changeActive。</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 左侧一级分类 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">scroll-view</span> <span class="attr">class</span>=<span class="string">&quot;cate-left&quot;</span> <span class="attr">:style</span>=<span class="string">&quot;&#123;height: wh+&#x27;px&#x27;&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">:class</span>=<span class="string">&quot;[&#x27;cate-left-item&#x27;, i===active ? &#x27;active&#x27;:&#x27;&#x27;]&quot;</span> <span class="attr">v-for</span>=<span class="string">&quot;(item, i) in cateList&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;i&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;changeActive(i)&quot;</span>&gt;</span> &#123;&#123;item.cat_name&#125;&#125; <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">scroll-view</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="5">
<li>定义 changeActive 事件处理函数，动态修改选中项的索引。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">methods: &#123;</span><br><span class="line">    <span class="comment">// 改变一级分类索引</span></span><br><span class="line">    <span class="function"><span class="title">changeActive</span>(<span class="params">i</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.active = i</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="二级分类的标题"><a href="#二级分类的标题" class="headerlink" title="二级分类的标题"></a>二级分类的标题</h2><ol>
<li>二级分类结构。</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 右侧二级分类 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">scroll-view</span> <span class="attr">class</span>=<span class="string">&quot;cate-right&quot;</span> <span class="attr">:style</span>=<span class="string">&quot;&#123;height: wh+&#x27;px&#x27;&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 二级分类item --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;cate-right-item&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 二级分类title --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;cate-right-item-title&quot;</span>&gt;</span> <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 二级分类内容 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;cate-right-item-content&quot;</span>&gt;</span> <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">scroll-view</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>在 data 中定义二级分类列表的数据节点。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="comment">// 二级分类列表</span></span><br><span class="line">        <span class="attr">cateLevel2</span>: []</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>修改 getCateList 方法，在请求到数据之后，为二级分类列表数据赋值。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="title">getCateList</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; <span class="attr">data</span>: res &#125; = <span class="keyword">await</span> uni.$http.get(<span class="string">&#x27;/categories&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> (res.meta.status !== <span class="number">200</span>) <span class="keyword">return</span> uni.$showMsg()</span><br><span class="line">    <span class="built_in">this</span>.cateList = res.message</span><br><span class="line">    <span class="comment">// 为二级分类赋值</span></span><br><span class="line">    <span class="built_in">this</span>.cateLevel2 = res.message[<span class="number">0</span>].children</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>修改 changeActive 方法，在一级分类选中项改变之后，为二级分类列表数据重新赋值。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">changeActive</span>(<span class="params">i</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.active = i</span><br><span class="line">    <span class="comment">// 更新二级分类列表数据</span></span><br><span class="line">    <span class="built_in">this</span>.cateLevel2 = <span class="built_in">this</span>.cateList[i].children</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>循环渲染右侧二级分类列表的 UI 结构。</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 右侧二级分类 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">scroll-view</span> <span class="attr">class</span>=<span class="string">&quot;cate-right&quot;</span> <span class="attr">:style</span>=<span class="string">&quot;&#123;height: wh+&#x27;px&#x27;&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 二级分类item --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;cate-right-item&quot;</span> <span class="attr">v-for</span>=<span class="string">&quot;(item, i) in cateLevel2&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;i&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 二级分类title --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;cate-right-item-title&quot;</span>&gt;</span> /&#123;&#123;item.cat_name&#125;&#125;/ <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 二级分类内容 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;cate-right-item-content&quot;</span>&gt;</span> <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">scroll-view</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="6">
<li>美化二级分类的标题样式。</li>
</ol>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.cate-right</span> &#123;</span><br><span class="line">    <span class="selector-class">.cate-right-item</span> &#123;</span><br><span class="line">        <span class="selector-class">.cate-right-item-title</span> &#123;</span><br><span class="line">            <span class="attribute">display</span>: flex;</span><br><span class="line">            <span class="attribute">justify-content</span>: center;</span><br><span class="line">            <span class="attribute">font-weight</span>: bold;</span><br><span class="line">            <span class="attribute">font-size</span>: <span class="number">24</span>rpx;</span><br><span class="line">            <span class="attribute">padding</span>: <span class="number">20</span>rpx <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="二级分类的内容"><a href="#二级分类的内容" class="headerlink" title="二级分类的内容"></a>二级分类的内容</h2><ol>
<li>在二级分类的 <code>&lt;view&gt;</code> 组件中，循环渲染二级分类详情结构。</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 右侧二级分类 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">scroll-view</span> <span class="attr">class</span>=<span class="string">&quot;cate-right&quot;</span> <span class="attr">:style</span>=<span class="string">&quot;&#123;height: wh+&#x27;px&#x27;&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 二级分类item --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;cate-right-item&quot;</span> <span class="attr">v-for</span>=<span class="string">&quot;(item, i) in cateLevel2&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;i&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 二级分类title --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;cate-right-item-title&quot;</span>&gt;</span> /&#123;&#123;item.cat_name&#125;&#125;/ <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 二级分类内容容器 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;cate-right-item-content&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 二级分类每一项内容 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;cate-right-item-content-box&quot;</span> <span class="attr">v-for</span>=<span class="string">&quot;(item2, i2) in item.children&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;i2&quot;</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 二级分类图片 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">image</span> <span class="attr">:src</span>=<span class="string">&quot;item2.cat_icon&quot;</span> <span class="attr">mode</span>=<span class="string">&quot;widthFix&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 二级分类名称 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">text</span>&gt;</span>&#123;&#123;item2.cat_name&#125;&#125;<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">scroll-view</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>美化二级分类详情样式。</li>
</ol>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.cate-right</span> &#123;</span><br><span class="line">    <span class="attribute">background-color</span>: white;</span><br><span class="line">    <span class="selector-class">.cate-right-item</span> &#123;</span><br><span class="line">        <span class="selector-class">.cate-right-item-title</span> &#123;</span><br><span class="line">            <span class="attribute">display</span>: flex;</span><br><span class="line">            <span class="attribute">justify-content</span>: center;</span><br><span class="line">            <span class="attribute">font-weight</span>: bold;</span><br><span class="line">            <span class="attribute">font-size</span>: <span class="number">24</span>rpx;</span><br><span class="line">            <span class="attribute">padding</span>: <span class="number">20</span>rpx <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="selector-class">.cate-right-item-content</span> &#123;</span><br><span class="line">            <span class="attribute">display</span>: flex;</span><br><span class="line">            <span class="attribute">flex-wrap</span>: wrap;</span><br><span class="line">            <span class="selector-class">.cate-right-item-content-box</span> &#123;</span><br><span class="line">                <span class="attribute">display</span>: flex;</span><br><span class="line">                <span class="attribute">flex-direction</span>: column;</span><br><span class="line">                <span class="attribute">justify-content</span>: center;</span><br><span class="line">                <span class="attribute">align-items</span>: center;</span><br><span class="line">                <span class="attribute">width</span>: <span class="number">33.33%</span>;</span><br><span class="line">                <span class="attribute">padding</span>: <span class="number">20</span>rpx;</span><br><span class="line">                <span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">                image &#123;</span><br><span class="line">                    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                text &#123;</span><br><span class="line">                    <span class="attribute">font-size</span>: <span class="number">24</span>rpx;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="重置滚动条位置"><a href="#重置滚动条位置" class="headerlink" title="重置滚动条位置"></a>重置滚动条位置</h2><p>目标：切换一级分类后重置二级分类滚动条的位置。</p>
<ol>
<li>在 data 中定义 滚动条距离顶部的距离。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="comment">// 滚动条距离顶部的距离</span></span><br><span class="line">        <span class="attr">scrollTop</span>: <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>动态为右侧的 <code>&lt;scroll-view&gt;</code> 组件绑定 scroll-top 属性的值。</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 右侧的滚动视图区域 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">scroll-view</span> <span class="attr">class</span>=<span class="string">&quot;cate-right&quot;</span> <span class="attr">scroll-y</span>=<span class="string">&quot;true&quot;</span> <span class="attr">:style</span>=<span class="string">&quot;&#123;height: wh + &#x27;px&#x27;&#125;&quot;</span> <span class="attr">:scroll-top</span>=<span class="string">&quot;scrollTop&quot;</span>&gt;</span> <span class="tag">&lt;/<span class="name">scroll-view</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>切换一级分类时，动态设置 scrollTop 的值。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 改变一级分类索引</span></span><br><span class="line"><span class="function"><span class="title">changeActive</span>(<span class="params">i</span>)</span>&#123;</span><br><span class="line">    <span class="comment">// 更新选中索引</span></span><br><span class="line">    <span class="built_in">this</span>.active = i</span><br><span class="line">    <span class="comment">// 更新二级分类数据</span></span><br><span class="line">    <span class="built_in">this</span>.cateLevel2 = <span class="built_in">this</span>.cateList[i].children</span><br><span class="line">    <span class="comment">// 更新右侧二级分类距离顶部距离</span></span><br><span class="line">    <span class="built_in">this</span>.scrollTop = <span class="built_in">Math</span>.random()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="跳转到商品列表"><a href="#跳转到商品列表" class="headerlink" title="跳转到商品列表"></a>跳转到商品列表</h2><ol>
<li>为二级分类详情的 Item 项绑定点击事件处理函数如下。</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 二级分类每一项内容 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;cate-right-item-content-box&quot;</span> <span class="attr">v-for</span>=<span class="string">&quot;(item2, i2) in item.children&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;i2&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;gotoGoodsList(item2)&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 二级分类图片 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">image</span> <span class="attr">:src</span>=<span class="string">&quot;item2.cat_icon&quot;</span> <span class="attr">mode</span>=<span class="string">&quot;widthFix&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 二级分类名称 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">text</span>&gt;</span>&#123;&#123;item2.cat_name&#125;&#125;<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>定义事件处理函数如下。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 点击二级分类详情跳转到商品列表页</span></span><br><span class="line"><span class="function"><span class="title">gotoGoodsList</span>(<span class="params">goods</span>)</span>&#123;</span><br><span class="line">    uni.navigateTo(&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="string">`/subpkg/goods_list/goods_list?cid=<span class="subst">$&#123;goods.cat_id&#125;</span>`</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="搜索功能"><a href="#搜索功能" class="headerlink" title="搜索功能"></a>搜索功能</h1><h2 id="搜索组件"><a href="#搜索组件" class="headerlink" title="搜索组件"></a>搜索组件</h2><h3 id="自定义-my-search-组件"><a href="#自定义-my-search-组件" class="headerlink" title="自定义 my-search 组件"></a>自定义 my-search 组件</h3><ol>
<li>在项目根目录的 components 目录上，鼠标右键，选择【新建组件】，填写组件信息，最后点击创建按钮。</li>
</ol>
<img src="/resource/images/5-1.25ab714d.png"/>

<ol start="2">
<li>在分类页面 <code>pages/cate/cate.vue</code>，直接以标签的形式使用 my-search 自定义组件。</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 使用自定义的搜索组件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">my-search</span>&gt;</span><span class="tag">&lt;/<span class="name">my-search</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li><a target="_blank" rel="noopener" href="https://ext.dcloud.net.cn/plugin?id=2">uni-icons</a>，定义 my-search 组件的 UI 结构如下。</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 注意，在当前组件中，我们使用 view 组件模拟 input 输入框的效果，并不会在页面上渲染真正的 input 输入框 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;my-search-container&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;my-search-box&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">uni-icons</span> <span class="attr">type</span>=<span class="string">&quot;search&quot;</span> <span class="attr">size</span>=<span class="string">&quot;18&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">uni-icons</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;my-search-text&quot;</span>&gt;</span>搜索<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="4">
<li>美化自定义 search 组件的样式。</li>
</ol>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.my-search-container</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">justify-content</span>: center;</span><br><span class="line">    <span class="attribute">align-items</span>: center;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">50px</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#c00000</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">10px</span>;</span><br><span class="line">    <span class="selector-class">.my-search-box</span> &#123;</span><br><span class="line">        <span class="attribute">display</span>: flex;</span><br><span class="line">        <span class="attribute">justify-content</span>: center;</span><br><span class="line">        <span class="attribute">align-items</span>: center;</span><br><span class="line">        <span class="attribute">height</span>: <span class="number">36px</span>;</span><br><span class="line">        <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">        <span class="attribute">border-radius</span>: <span class="number">18px</span>;</span><br><span class="line">        <span class="attribute">background-color</span>: <span class="number">#ffffff</span>;</span><br><span class="line">        <span class="selector-class">.my-search-text</span> &#123;</span><br><span class="line">            <span class="attribute">margin-left</span>: <span class="number">6px</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>由于自定义的 my-search 组件高度为 50px，因此，需要重新计算分类页面窗口的可用高度。</li>
</ol>
<p><code>pages/cate/cate.vue</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">onLoad</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> sysInfo = uni.getSystemInfoSync()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 可用高度 = 屏幕高度 - navigationBar高度 - tabBar高度 - 自定义的search组件高度</span></span><br><span class="line">    <span class="built_in">this</span>.wh = sysInfo.windowHeight - <span class="number">50</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="6">
<li>自定义组件样式<a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/framework/custom-component/wxml-wxss.html">注意点</a>，组件和引用组件的页面不能使用 id 选择器（#a）、属性选择器（[a]）和标签名选择器，请改用 class 选择器，<a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/community/develop/doc/000caa250fc8301d9658e091359c00">问题案例</a>。</li>
</ol>
<h3 id="通过传值增强组件通用性"><a href="#通过传值增强组件通用性" class="headerlink" title="通过传值增强组件通用性"></a>通过传值增强组件通用性</h3><ol>
<li>支持自定义搜索组件的背景颜色和圆角尺寸，通过 props 接收 bgcolor 和 radius 两个属性，并指定值类型和属性默认值，<code>components/my-search/my-search.vue</code>。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">props: &#123;</span><br><span class="line">    <span class="comment">// 背景颜色</span></span><br><span class="line">    <span class="attr">bgcolor</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="built_in">String</span>,</span><br><span class="line">        <span class="attr">default</span>: <span class="string">&#x27;#C00000&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 圆角尺寸</span></span><br><span class="line">    <span class="attr">radius</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="built_in">Number</span>,</span><br><span class="line">        <span class="comment">// 单位是 px</span></span><br><span class="line">        <span class="attr">default</span>: <span class="number">18</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>通过行内样式为 .my-search-container 盒子和 .my-search-box 盒子动态绑定 style 属性。</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;my-search-container&quot;</span> <span class="attr">:style</span>=<span class="string">&quot;&#123;&#x27;background-color&#x27;: bgcolor&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;my-search-box&quot;</span> <span class="attr">:style</span>=<span class="string">&quot;&#123;&#x27;border-radius&#x27;: radius + &#x27;px&#x27;&#125;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">uni-icons</span> <span class="attr">type</span>=<span class="string">&quot;search&quot;</span> <span class="attr">size</span>=<span class="string">&quot;18&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">uni-icons</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;my-search-text&quot;</span>&gt;</span>搜索<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>移除对应 scss 样式中的背景颜色和圆角尺寸。</li>
</ol>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.my-search-container</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">justify-content</span>: center;</span><br><span class="line">    <span class="attribute">align-items</span>: center;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">50px</span>;</span><br><span class="line">    // 移除背景颜色，改由 props 属性控制</span><br><span class="line">    // <span class="attribute">background-color</span>: <span class="number">#C00000</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">10px</span>;</span><br><span class="line">    <span class="selector-class">.my-search-box</span> &#123;</span><br><span class="line">        <span class="attribute">display</span>: flex;</span><br><span class="line">        <span class="attribute">justify-content</span>: center;</span><br><span class="line">        <span class="attribute">align-items</span>: center;</span><br><span class="line">        <span class="attribute">height</span>: <span class="number">36px</span>;</span><br><span class="line">        <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">        // 移除圆角尺寸，改由 props 属性控制</span><br><span class="line">        // <span class="attribute">border-radius</span>: <span class="number">18px</span>;</span><br><span class="line">        <span class="attribute">background-color</span>: <span class="number">#ffffff</span>;</span><br><span class="line">        <span class="selector-class">.my-search-text</span> &#123;</span><br><span class="line">            <span class="attribute">margin-left</span>: <span class="number">6px</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="支持外界-click-点击事件"><a href="#支持外界-click-点击事件" class="headerlink" title="支持外界 click 点击事件"></a>支持外界 click 点击事件</h3><ol>
<li><p>先创建分包页面 search，为了待会点击时跳转到此页面。</p>
</li>
<li><p>在 my-search 自定义组件内部，给类名为 .my-search-box 的 view 绑定 click 事件处理函数。</p>
</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;my-search-box&quot;</span> <span class="attr">:style</span>=<span class="string">&quot;&#123;&#x27;border-radius&#x27;: radius + &#x27;px&#x27;&#125;&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;searchBoxHandler&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">uni-icons</span> <span class="attr">type</span>=<span class="string">&quot;search&quot;</span> <span class="attr">size</span>=<span class="string">&quot;18&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">uni-icons</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;my-search-text&quot;</span>&gt;</span>搜索<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>在 my-search 自定义组件的 methods 节点中，声明事件处理函数如下。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">methods: &#123;</span><br><span class="line">    <span class="comment">// 子组件输入框事件处理函数</span></span><br><span class="line">    <span class="function"><span class="title">searchBoxHandler</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// 调用父组件绑定的事件处理函数</span></span><br><span class="line">        <span class="built_in">this</span>.$emit(<span class="string">&#x27;click&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>在分类页面中使用 my-search 自定义组件时，即可通过 @click 为其绑定点击事件处理函数。</li>
</ol>
<p><code>pages/cate/cate.vue</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 在父组件绑定自定义组件的click事件处理函数 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">my-search</span> @<span class="attr">click</span>=<span class="string">&quot;gotoSearch&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">my-search</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="5">
<li>同时在分类页面中，定义 gotoSearch 事件处理函数如下。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">methods: &#123;</span><br><span class="line">    <span class="comment">// 跳转到分包中的搜索页面</span></span><br><span class="line">    <span class="function"><span class="title">gotoSearch</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        uni.navigateTo(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">&#x27;/subpkg/search/search&#x27;</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="实现首页搜索的吸顶效果"><a href="#实现首页搜索的吸顶效果" class="headerlink" title="实现首页搜索的吸顶效果"></a>实现首页搜索的吸顶效果</h3><ol>
<li>在首页定义如下的 UI 结构并绑定点击事件。</li>
</ol>
<p><code>pages/home/home.vue</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 使用自定义的搜索组件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;search-box&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">my-search</span> @<span class="attr">click</span>=<span class="string">&quot;gotoSearch&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">my-search</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>定义事件处理函数如下。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">gotoSearch</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    uni.navigateTo(&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="string">&#x27;/subpkg/search/search&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>通过如下的样式实现吸顶的效果。</li>
</ol>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.search-box</span> &#123;</span><br><span class="line">    // 设置定位效果为“吸顶”</span><br><span class="line">    <span class="attribute">position</span>: sticky;</span><br><span class="line">    // 吸顶的“位置”</span><br><span class="line">    <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">    // 提高层级，防止被轮播图覆盖</span><br><span class="line">    <span class="attribute">z-index</span>: <span class="number">9</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="搜索建议"><a href="#搜索建议" class="headerlink" title="搜索建议"></a>搜索建议</h2><h3 id="渲染搜索页面的基本结构"><a href="#渲染搜索页面的基本结构" class="headerlink" title="渲染搜索页面的基本结构"></a>渲染搜索页面的基本结构</h3><ol>
<li>定义如下的 UI 结构，<code>subpkg/search/search.vue</code>。</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 搜索框 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;search-box&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 使用 uni-ui 提供的搜索组件 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">uni-search-bar</span> @<span class="attr">input</span>=<span class="string">&quot;input&quot;</span> <span class="attr">cancelButton</span>=<span class="string">&quot;none&quot;</span> <span class="attr">radius</span>=<span class="string">&quot;20&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">uni-search-bar</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 搜索历史 --&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 搜索列表 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>搜索框 UI 美化和吸顶效果。</li>
</ol>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.search-box</span> &#123;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#c00000</span>;</span><br><span class="line">    <span class="attribute">position</span>: sticky;</span><br><span class="line">    <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">z-index</span>: <span class="number">9</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>定义如下的 input 事件处理函数，<font color=e32d40><strong>真机调试或分离窗口或重启微信开发者工具</strong></font>。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">methods: &#123;</span><br><span class="line">    <span class="function"><span class="title">input</span>(<span class="params">value</span>)</span> &#123;</span><br><span class="line">        <span class="comment">// value 是用户最新的输入内容</span></span><br><span class="line">        <span class="built_in">console</span>.log(value)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>组件参考：<a target="_blank" rel="noopener" href="https://ext.dcloud.net.cn/plugin?id=866">uni-search-bar</a>。</li>
</ol>
<h3 id="实现搜索框自动获取焦点"><a href="#实现搜索框自动获取焦点" class="headerlink" title="实现搜索框自动获取焦点"></a>实现搜索框自动获取焦点</h3><p>为 <code>&lt;uni-search-bar&gt;</code> 添加 <code>:focus=&quot;true&quot;</code> 属性即可。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 搜索框 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;search-box&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 使用 uni-ui 提供的搜索组件 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">uni-search-bar</span> @<span class="attr">input</span>=<span class="string">&quot;input&quot;</span> <span class="attr">cancelButton</span>=<span class="string">&quot;none&quot;</span> <span class="attr">radius</span>=<span class="string">&quot;20&quot;</span> <span class="attr">:focus</span>=<span class="string">&quot;true&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">uni-search-bar</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>使用手机扫码预览，在真机上可查看到“光标闪烁”效果。</p>
<h3 id="实现输入内容的防抖处理"><a href="#实现输入内容的防抖处理" class="headerlink" title="实现输入内容的防抖处理"></a>实现输入内容的防抖处理</h3><ol>
<li>在 data 中定义防抖的延时器 timerId 如下。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="comment">// 延时器的 timerId</span></span><br><span class="line">        <span class="attr">timerId</span>: <span class="literal">null</span>,</span><br><span class="line">        <span class="comment">// 搜索关键词</span></span><br><span class="line">        <span class="attr">kw</span>: <span class="string">&#x27;&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>修改 input 事件处理函数如下。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">input</span>(<span class="params">value</span>)</span> &#123;</span><br><span class="line">    <span class="comment">// 用户每次输入，清除上次输入启动的延时器</span></span><br><span class="line">    <span class="built_in">clearTimeout</span>(<span class="built_in">this</span>.timerId)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 每次输入，在清除了上次延时器后，再重新启动一个 500 毫秒的延时器</span></span><br><span class="line">    <span class="comment">// 如果 500 毫秒内容用户没有再次输入，则执行搜索</span></span><br><span class="line">    <span class="comment">// 如果 500 毫秒内用户再次输入了，取消上次的延时器，再重新启动一个 500 毫秒的延时器</span></span><br><span class="line">    <span class="built_in">this</span>.timerId = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 如果 500 毫秒内，没有触发新的输入事件，则为搜索关键词赋值</span></span><br><span class="line">        <span class="built_in">this</span>.kw = value</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="built_in">this</span>.kw)</span><br><span class="line">    &#125;, <span class="number">500</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="根据关键词查询搜索建议"><a href="#根据关键词查询搜索建议" class="headerlink" title="根据关键词查询搜索建议"></a>根据关键词查询搜索建议</h3><ol>
<li>在 data 中定义如下的数据节点，用来存放搜索建议的列表数据。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="comment">// 搜索结果列表</span></span><br><span class="line">        <span class="attr">searchResults</span>: []</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>在防抖的 setTimeout 中，调用 getSearchList 方法获取搜索建议列表。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">this</span>.timerId = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.kw = value</span><br><span class="line">    <span class="comment">// 根据关键词，查询搜索建议列表</span></span><br><span class="line">    <span class="built_in">this</span>.getSearchResults()</span><br><span class="line">&#125;, <span class="number">500</span>)</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>在 methods 中定义 getSearchList 方法如下。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 根据搜索关键词，搜索商品建议列表</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="title">getSearchResults</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="comment">// 判断关键词是否为空</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.kw.trim().length === <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">this</span>.searchResults = []</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 发起请求，获取搜索建议列表</span></span><br><span class="line">    <span class="keyword">const</span> &#123; <span class="attr">data</span>: res &#125; = <span class="keyword">await</span> uni.$http.get(<span class="string">&#x27;/goods/qsearch&#x27;</span>, &#123; <span class="attr">query</span>: <span class="built_in">this</span>.kw &#125;)</span><br><span class="line">    <span class="keyword">if</span> (res.meta.status !== <span class="number">200</span>) <span class="keyword">return</span> uni.$showMsg()</span><br><span class="line">    <span class="built_in">this</span>.searchResults = res.message</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="渲染后端返回的搜索建议"><a href="#渲染后端返回的搜索建议" class="headerlink" title="渲染后端返回的搜索建议"></a>渲染后端返回的搜索建议</h3><ol>
<li>定义如下的 UI 结构。</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 搜索结果列表 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;search-results-list&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;search-results-item&quot;</span> <span class="attr">v-for</span>=<span class="string">&quot;(item, i) in searchResults&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;i&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;gotoDetail(item.goods_id)&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;search-results-item-name&quot;</span>&gt;</span> &#123;&#123;item.goods_name&#125;&#125; <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">uni-icons</span> <span class="attr">type</span>=<span class="string">&quot;arrowright&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">uni-icons</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>美化搜索建议列表。</li>
</ol>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.search-results-list</span> &#123;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">20</span>rpx;</span><br><span class="line">    <span class="selector-class">.search-results-item</span> &#123;</span><br><span class="line">        <span class="attribute">display</span>: flex;</span><br><span class="line">        <span class="attribute">justify-content</span>: space-between;</span><br><span class="line">        <span class="attribute">align-items</span>: center;</span><br><span class="line">        <span class="attribute">border-bottom</span>: <span class="number">1</span>rpx solid <span class="number">#efefef</span>;</span><br><span class="line">        <span class="attribute">height</span>: <span class="number">90</span>rpx;</span><br><span class="line">        <span class="selector-class">.search-results-item-name</span> &#123;</span><br><span class="line">            <span class="attribute">font-size</span>: <span class="number">24</span>rpx;</span><br><span class="line">            // 文字不允许换行（单行文本）</span><br><span class="line">            <span class="attribute">white-space</span>: nowrap;</span><br><span class="line">            // 溢出部分隐藏</span><br><span class="line">            <span class="attribute">overflow</span>: hidden;</span><br><span class="line">            // 文本溢出后，使用 ... 代替</span><br><span class="line">            <span class="attribute">text-overflow</span>: ellipsis;</span><br><span class="line">            <span class="attribute">margin-right</span>: <span class="number">3px</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>点击搜索建议的 Item 项，跳转到商品详情页面。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">gotoDetail</span>(<span class="params">goods_id</span>)</span> &#123;</span><br><span class="line">    uni.navigateTo(&#123;</span><br><span class="line">        <span class="comment">// 指定详情页面的 URL 地址，并传递 goods_id 参数</span></span><br><span class="line">        <span class="attr">url</span>: <span class="string">&#x27;/subpkg/goods_detail/goods_detail?goods_id=&#x27;</span> + goods_id</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="搜索历史"><a href="#搜索历史" class="headerlink" title="搜索历史"></a>搜索历史</h2><h3 id="基本结构"><a href="#基本结构" class="headerlink" title="基本结构"></a>基本结构</h3><ol>
<li>在 data 中定义搜索历史的假数据。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="comment">// 搜索关键词的历史记录</span></span><br><span class="line">        <span class="attr">historyKeywords</span>: [<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;app&#x27;</span>, <span class="string">&#x27;apple&#x27;</span>]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>渲染搜索历史区域的 UI 结构。</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 搜索历史 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;history-container&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 搜索title --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;history-title&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">text</span>&gt;</span>搜索历史<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">uni-icons</span> <span class="attr">type</span>=<span class="string">&quot;trash&quot;</span> <span class="attr">size</span>=<span class="string">&quot;18&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">uni-icons</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 历史搜索关键词 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;history-keywords&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">uni-tag</span> <span class="attr">:text</span>=<span class="string">&quot;item&quot;</span> <span class="attr">v-for</span>=<span class="string">&quot;(item, i) in historyKeywords&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;i&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">uni-tag</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>美化搜索历史区域的样式。</li>
</ol>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.history-container</span> &#123;</span><br><span class="line">    <span class="selector-class">.history-title</span> &#123;</span><br><span class="line">        <span class="attribute">display</span>: flex;</span><br><span class="line">        <span class="attribute">height</span>: <span class="number">80</span>rpx;</span><br><span class="line">        <span class="attribute">justify-content</span>: space-between;</span><br><span class="line">        <span class="attribute">align-items</span>: center;</span><br><span class="line">        <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">20</span>rpx;</span><br><span class="line">        <span class="attribute">border-bottom</span>: <span class="number">1</span>rpx solid <span class="number">#efefef</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="selector-class">.history-keywords</span> &#123;</span><br><span class="line">        <span class="attribute">display</span>: flex;</span><br><span class="line">        <span class="attribute">flex-wrap</span>: wrap;</span><br><span class="line">        <span class="selector-class">.uni-tag</span> &#123;</span><br><span class="line">            <span class="attribute">margin</span>: <span class="number">10</span>rpx;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="按需展示"><a href="#按需展示" class="headerlink" title="按需展示"></a>按需展示</h3><p>🤔 实现搜索建议和搜索历史的按需展示。</p>
<ol>
<li><p>当搜索结果的长度等于 0 的时候（searchResults.length === 0），需要展示搜索历史区域，隐藏搜索建议区域。</p>
</li>
<li><p>否则，需要展示搜索建议区域，隐藏搜索历史区域。</p>
</li>
<li><p>使用 v-if 和 v-else 控制这两个区域的显示和隐藏，示例代码如下。</p>
</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 搜索历史 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;history-container&quot;</span> <span class="attr">v-if</span>=<span class="string">&quot;searchResults.length === 0&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 省略其它代码... --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 搜索列表 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;search-results-list&quot;</span> <span class="attr">v-else</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 省略其它代码... --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="记录关键词"><a href="#记录关键词" class="headerlink" title="记录关键词"></a>记录关键词</h3><p>将搜索关键词追加到 historyKeywords 数组头部。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">methods: &#123;</span><br><span class="line">    <span class="comment">// 根据搜索关键词，搜索商品建议列表</span></span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="title">getSearchResults</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// 省略其它不必要的代码...</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1. 查询到搜索建议之后，调用 saveSearchHistory() 方法保存搜索关键词</span></span><br><span class="line">        <span class="built_in">this</span>.saveSearchHistory()</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 2. 把搜索关键词追加到 historyKeywords 数组头部</span></span><br><span class="line">    <span class="function"><span class="title">saveSearchHistory</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.historyKeywords = [<span class="built_in">this</span>.kw, ...this.historyKeywords]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="解决关键词重复的问题"><a href="#解决关键词重复的问题" class="headerlink" title="解决关键词重复的问题"></a>解决关键词重复的问题</h3><p>修改 saveSearchHistory 方法如下。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">saveSearchHistory</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">// 判断关键词是否存在</span></span><br><span class="line">    <span class="keyword">const</span> index = <span class="built_in">this</span>.historyKeywords.indexOf(<span class="built_in">this</span>.kw)</span><br><span class="line">    <span class="keyword">if</span>(index &lt; <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="comment">// 关键词不存在,直接放到开头</span></span><br><span class="line">        <span class="built_in">this</span>.historyKeywords = [<span class="built_in">this</span>.kw, ...this.historyKeywords]</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="comment">// 关键词存在，先删除存在元素</span></span><br><span class="line">        <span class="built_in">this</span>.historyKeywords.splice(index, <span class="number">1</span>)</span><br><span class="line">        <span class="comment">// 再将新记录放到首位</span></span><br><span class="line">        <span class="built_in">this</span>.historyKeywords = [<span class="built_in">this</span>.kw, ...this.historyKeywords]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// index &lt; 0 没找到</span></span><br><span class="line"><span class="comment">// index &gt; -1 找到了</span></span><br></pre></td></tr></table></figure>

<p>第二种方法，修改 saveSearchHistory 方法如下。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 保存搜索关键词为历史记录</span></span><br><span class="line"><span class="function"><span class="title">saveSearchHistory</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="comment">// 1. 将 Array 数组转化为 Set 对象</span></span><br><span class="line">    <span class="keyword">const</span> set = <span class="keyword">new</span> <span class="built_in">Set</span>(<span class="built_in">this</span>.historyKeywords)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. 调用 Set 对象的 delete 方法，移除对应的元素</span></span><br><span class="line">    set.delete(<span class="built_in">this</span>.kw)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. 调用 Set 对象的 add 方法，向 Set 中添加元素</span></span><br><span class="line">    set.add(<span class="built_in">this</span>.kw)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4. 将 Set 对象转化为 Array 数组</span></span><br><span class="line">    <span class="built_in">this</span>.historyKeywords = <span class="built_in">Array</span>.from(set)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="将搜索历史记录持久化"><a href="#将搜索历史记录持久化" class="headerlink" title="将搜索历史记录持久化"></a>将搜索历史记录持久化</h3><ol>
<li>修改 saveSearchHistory 方法如下。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 保存搜索关键词为历史记录</span></span><br><span class="line"><span class="function"><span class="title">saveSearchHistory</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="comment">// ...省略部分代码</span></span><br><span class="line">    <span class="comment">// 调用 uni.setStorageSync(key, value) 将搜索历史记录持久化存储到本地</span></span><br><span class="line">    uni.setStorageSync(<span class="string">&#x27;kw&#x27;</span>, <span class="built_in">JSON</span>.stringify(<span class="built_in">this</span>.historyKeywords))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>在 onLoad 生命周期函数中，加载本地存储的搜索历史记录。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">onLoad</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.historyKeywords = <span class="built_in">JSON</span>.parse(uni.getStorageSync(<span class="string">&#x27;kw&#x27;</span>) || <span class="string">&#x27;[]&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="清空搜索历史记录功能"><a href="#清空搜索历史记录功能" class="headerlink" title="清空搜索历史记录功能"></a>清空搜索历史记录功能</h3><ol>
<li>为清空的图标按钮绑定 click 事件。</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">uni-icons</span> <span class="attr">type</span>=<span class="string">&quot;trash&quot;</span> <span class="attr">size</span>=<span class="string">&quot;18&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;cleanHistory&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">uni-icons</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>在 methods 中定义 cleanHistory 处理函数。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 清空搜索历史记录</span></span><br><span class="line"><span class="function"><span class="title">cleanHistory</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="comment">// 清空 data 中保存的搜索历史</span></span><br><span class="line">    <span class="built_in">this</span>.historyKeywords = []</span><br><span class="line">    <span class="comment">// 清空本地存储中记录的搜索历史</span></span><br><span class="line">    uni.setStorageSync(<span class="string">&#x27;kw&#x27;</span>, <span class="string">&#x27;[]&#x27;</span>)</span><br><span class="line">    <span class="comment">// 或者</span></span><br><span class="line">    <span class="comment">// uni.removeStorageSync(&#x27;kw&#x27;)</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="点击历史跳转到列表页"><a href="#点击历史跳转到列表页" class="headerlink" title="点击历史跳转到列表页"></a>点击历史跳转到列表页</h3><ol>
<li>为搜索历史的 Item 项绑定 click 事件处理函数。</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">uni-tag</span> <span class="attr">:text</span>=<span class="string">&quot;item&quot;</span> <span class="attr">v-for</span>=<span class="string">&quot;(item, i) in historyKeywords&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;i&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;gotoGoodsList(item)&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">uni-tag</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>在 methods 中定义 gotoGoodsList 处理函数。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 点击跳转到商品列表页面</span></span><br><span class="line"><span class="function"><span class="title">gotoGoodsList</span>(<span class="params">kw</span>)</span> &#123;</span><br><span class="line">    uni.navigateTo(&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="string">&#x27;/subpkg/goods_list/goods_list?query=&#x27;</span> + kw</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="商品列表"><a href="#商品列表" class="headerlink" title="商品列表"></a>商品列表</h1><p>😀 从首页各楼层可以跳转到商品列表，传递的是 query；从分类页也可以跳转到商品列表，传递的是 cid。</p>
<h2 id="需求分析总结"><a href="#需求分析总结" class="headerlink" title="需求分析总结"></a>需求分析总结</h2><ul>
<li><p>  不同页面进入，对应着不同的查询参数。</p>
</li>
<li><p>  上拉加载更多，节流控制以及判断数据是否加载完毕。</p>
</li>
<li><p>  下拉刷新。</p>
</li>
<li><p>  点击商品 item 跳转到商品详情页。</p>
</li>
</ul>
<h2 id="开发前准备工作"><a href="#开发前准备工作" class="headerlink" title="开发前准备工作"></a>开发前准备工作</h2><h3 id="设置列表页的编译模式"><a href="#设置列表页的编译模式" class="headerlink" title="设置列表页的编译模式"></a>设置列表页的编译模式</h3><img src="/resource/images/image (11).png"/>

<h3 id="页面整体结构分析搭建"><a href="#页面整体结构分析搭建" class="headerlink" title="页面整体结构分析搭建"></a>页面整体结构分析搭建</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;goods-list&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;goods-item&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 商品左侧图片区域 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;goods-item-left&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">image</span> <span class="attr">class</span>=<span class="string">&quot;goods-image&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 商品右侧信息区域 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;goods-item-right&quot;</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 商品标题 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;goods-name&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 商品价格 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;goods-price&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="定义请求参数对象"><a href="#定义请求参数对象" class="headerlink" title="定义请求参数对象"></a>定义请求参数对象</h2><p>为了方便发起请求获取商品列表的数据，我们要根据接口的要求，事先定义一个请求参数对象。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="comment">// 请求参数对象</span></span><br><span class="line">        <span class="attr">queryObj</span>: &#123;</span><br><span class="line">            <span class="comment">// 查询关键词</span></span><br><span class="line">            <span class="attr">query</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="comment">// 商品分类Id</span></span><br><span class="line">            <span class="attr">cid</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="comment">// 页码值</span></span><br><span class="line">            <span class="attr">pagenum</span>: <span class="number">1</span>,</span><br><span class="line">            <span class="comment">// 每页显示多少条数据</span></span><br><span class="line">            <span class="attr">pagesize</span>: <span class="number">10</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>将页面跳转时携带的参数，转存到 queryObj 对象中。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">onLoad</span>(<span class="params">options</span>)</span> &#123;</span><br><span class="line">    <span class="comment">// 将页面参数保存到 this.queryObj 对象中</span></span><br><span class="line">    <span class="built_in">this</span>.queryObj.query = options.query || <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="built_in">this</span>.queryObj.cid = options.cid || <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 空值合并运算符写法</span></span><br><span class="line">    <span class="comment">// this.queryObj.query = options.query ?? &#x27;&#x27;</span></span><br><span class="line">    <span class="comment">// this.queryObj.cid = options.cid ?? &#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 空值合并运算符小坑</span></span><br><span class="line">    <span class="comment">// 0 ?? &#x27;abc&#x27; // 返回值：0</span></span><br><span class="line">    <span class="comment">// 0 || &#x27;abc&#x27; // 返回值：&#x27;abc&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="获取商品列表数据"><a href="#获取商品列表数据" class="headerlink" title="获取商品列表数据"></a>获取商品列表数据</h2><ol>
<li>在 data 中新增如下的数据节点。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="comment">// 商品列表的数据</span></span><br><span class="line">        <span class="attr">goodsList</span>: [],</span><br><span class="line">        <span class="comment">// 总数量，用来判断数据是否请求完毕</span></span><br><span class="line">        <span class="attr">total</span>: <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>在 onLoad 生命周期函数中，调用 getGoodsList 方法获取商品列表数据。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">onLoad</span>(<span class="params">options</span>)</span> &#123;</span><br><span class="line">    <span class="comment">// 调用获取商品列表数据的方法</span></span><br><span class="line">    <span class="built_in">this</span>.getGoodsList()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>在 methods 节点中，声明 getGoodsList 方法如下。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">methods: &#123;</span><br><span class="line">    <span class="comment">// 获取商品列表数据的方法</span></span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="title">getGoodsList</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// 发起请求</span></span><br><span class="line">        <span class="keyword">const</span> &#123; <span class="attr">data</span>: res &#125; = <span class="keyword">await</span> uni.$http.get(<span class="string">&#x27;/goods/search&#x27;</span>, <span class="built_in">this</span>.queryObj)</span><br><span class="line">        <span class="keyword">if</span> (res.meta.status !== <span class="number">200</span>) <span class="keyword">return</span> uni.$showMsg()</span><br><span class="line">        <span class="comment">// 为数据赋值</span></span><br><span class="line">        <span class="built_in">this</span>.goodsList = res.message.goods</span><br><span class="line">        <span class="built_in">this</span>.total = res.message.total</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="渲染商品列表结构"><a href="#渲染商品列表结构" class="headerlink" title="渲染商品列表结构"></a>渲染商品列表结构</h2><ol>
<li>在页面中，通过 v-for 指令，循环渲染出商品的 UI 结构。</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;goods-list&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;goods-item&quot;</span> <span class="attr">v-for</span>=<span class="string">&quot;(item, i) in goodsList&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;i&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 商品左侧图片区域 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;goods-item-left&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">image</span> <span class="attr">class</span>=<span class="string">&quot;goods-image&quot;</span> <span class="attr">:src</span>=<span class="string">&quot;item.goods_small_logo || defaultPic&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 商品右侧信息区域 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;goods-item-right&quot;</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 商品标题 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;goods-name&quot;</span>&gt;</span>&#123;&#123;item.goods_name&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 商品价格 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;goods-price&quot;</span>&gt;</span>&#123;&#123;item.goods_price&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>为了防止某些商品的图片不存在，需要在 data 中定义一个默认的图片。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="comment">// 默认的空图片</span></span><br><span class="line">        <span class="attr">defaultPic</span>: <span class="string">&#x27;https://img3.doubanio.com/f/movie/8dd0c794499fe925ae2ae89ee30cd225750457b4/pics/movie/celebrity-default-medium.png&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>并在页面渲染时按需使用。</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">image</span> <span class="attr">:src</span>=<span class="string">&quot;goods.goods_small_logo || defaultPic&quot;</span> <span class="attr">class</span>=<span class="string">&quot;goods-image&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="4">
<li>美化商品列表的 UI 结构。</li>
</ol>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.goods-list</span> &#123;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">1</span>rpx solid <span class="number">#efefef</span>;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span> <span class="number">8</span>rpx;</span><br><span class="line">    <span class="selector-class">.goods-item</span> &#123;</span><br><span class="line">        <span class="attribute">display</span>: flex;</span><br><span class="line">        <span class="attribute">border-bottom</span>: <span class="number">1px</span> solid <span class="number">#efefef</span>;</span><br><span class="line">        <span class="attribute">padding</span>: <span class="number">8</span>rpx;</span><br><span class="line">        <span class="selector-class">.goods-item-left</span> &#123;</span><br><span class="line">            <span class="selector-class">.goods-image</span> &#123;</span><br><span class="line">                <span class="attribute">width</span>: <span class="number">200</span>rpx;</span><br><span class="line">                <span class="attribute">height</span>: <span class="number">200</span>rpx;</span><br><span class="line">                <span class="attribute">vertical-align</span>: middle;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="selector-class">.goods-item-right</span> &#123;</span><br><span class="line">            <span class="attribute">display</span>: flex;</span><br><span class="line">            <span class="attribute">flex-direction</span>: column;</span><br><span class="line">            <span class="attribute">justify-content</span>: space-between;</span><br><span class="line">            <span class="selector-class">.goods-name</span> &#123;</span><br><span class="line">                <span class="attribute">font-size</span>: <span class="number">24</span>rpx;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="selector-class">.goods-price</span> &#123;</span><br><span class="line">                <span class="attribute">font-size</span>: <span class="number">32</span>rpx;</span><br><span class="line">                <span class="attribute">color</span>: <span class="number">#c00000</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="封装商品-item-组件"><a href="#封装商品-item-组件" class="headerlink" title="封装商品 item 组件"></a>封装商品 item 组件</h2><ol>
<li>在 components 目录上鼠标右键，选择 新建组件。</li>
</ol>
<img src="/resource/images/6-2.6a66124f.png"/>

<ol start="2">
<li>将 goods_list 页面中，关于商品 item 项相关的 UI 结构、样式、data 数据，迁移到 my-goods 组件中。</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;goods-item&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 商品左侧图片区域 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;goods-item-left&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">image</span> <span class="attr">class</span>=<span class="string">&quot;goods-image&quot;</span> <span class="attr">:src</span>=<span class="string">&quot;goods.goods_small_logo || defaultPic&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 商品右侧信息区域 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;goods-item-right&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 商品标题 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;goods-name&quot;</span>&gt;</span>&#123;&#123;goods.goods_name&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 商品价格 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;goods-price&quot;</span>&gt;</span>&#123;&#123;goods.goods_price&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="attr">name</span>: <span class="string">&#x27;my-goods&#x27;</span>,</span></span><br><span class="line"><span class="javascript">        <span class="comment">// 定义 props 属性，用来接收外界传递到当前组件的数据</span></span></span><br><span class="line"><span class="javascript">        <span class="attr">props</span>: &#123;</span></span><br><span class="line"><span class="javascript">            <span class="comment">// 商品的信息对象</span></span></span><br><span class="line"><span class="javascript">            <span class="attr">goods</span>: &#123;</span></span><br><span class="line"><span class="javascript">                <span class="attr">type</span>: <span class="built_in">Object</span>,</span></span><br><span class="line"><span class="javascript">                <span class="attr">defaul</span>: &#123;&#125;,</span></span><br><span class="line"><span class="javascript">            &#125;,</span></span><br><span class="line"><span class="javascript">        &#125;,</span></span><br><span class="line"><span class="javascript">        <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">                <span class="comment">// 默认的空图片</span></span></span><br><span class="line"><span class="javascript">                <span class="attr">defaultPic</span>: <span class="string">&#x27;https://img3.doubanio.com/f/movie/8dd0c794499fe925ae2ae89ee30cd225750457b4/pics/movie/celebrity-default-medium.png&#x27;</span>,</span></span><br><span class="line"><span class="javascript">            &#125;</span></span><br><span class="line"><span class="javascript">        &#125;,</span></span><br><span class="line"><span class="javascript">    &#125;</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">lang</span>=<span class="string">&quot;scss&quot;</span>&gt;</span><span class="css"></span></span><br><span class="line"><span class="css">    <span class="selector-class">.goods-item</span> &#123;</span></span><br><span class="line"><span class="css">        <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="css">        <span class="attribute">border-bottom</span>: <span class="number">1px</span> solid <span class="number">#efefef</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">padding</span>: <span class="number">8</span>rpx;</span></span><br><span class="line"><span class="css">        <span class="selector-class">.goods-item-left</span> &#123;</span></span><br><span class="line"><span class="css">            <span class="selector-class">.goods-image</span> &#123;</span></span><br><span class="line"><span class="css">                <span class="attribute">width</span>: <span class="number">200</span>rpx;</span></span><br><span class="line"><span class="css">                <span class="attribute">height</span>: <span class="number">200</span>rpx;</span></span><br><span class="line"><span class="css">                <span class="attribute">vertical-align</span>: middle;</span></span><br><span class="line"><span class="css">            &#125;</span></span><br><span class="line"><span class="css">        &#125;</span></span><br><span class="line"><span class="css">        <span class="selector-class">.goods-item-right</span> &#123;</span></span><br><span class="line"><span class="css">            <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="css">            <span class="attribute">flex-direction</span>: column;</span></span><br><span class="line"><span class="css">            <span class="attribute">justify-content</span>: space-between;</span></span><br><span class="line"><span class="css">            <span class="selector-class">.goods-title</span> &#123;</span></span><br><span class="line"><span class="css">                <span class="attribute">font-size</span>: <span class="number">24</span>rpx;</span></span><br><span class="line"><span class="css">            &#125;</span></span><br><span class="line"><span class="css">            <span class="selector-class">.goods-price</span> &#123;</span></span><br><span class="line"><span class="css">                <span class="attribute">font-size</span>: <span class="number">32</span>rpx;</span></span><br><span class="line"><span class="css">                <span class="attribute">color</span>: <span class="number">#c00000</span>;</span></span><br><span class="line"><span class="css">            &#125;</span></span><br><span class="line"><span class="css">        &#125;</span></span><br><span class="line"><span class="css">    &#125;</span></span><br><span class="line"><span class="css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>在 goods_list 组件中，循环渲染 my-goods 组件即可。</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;goods-list&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 为 my-goods 组件动态绑定 goods 属性的值 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">my-goods</span> <span class="attr">:goods</span>=<span class="string">&quot;item&quot;</span> <span class="attr">v-for</span>=<span class="string">&quot;(item, i) in goodsList&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;i&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">my-goods</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><font color=e32d40><strong>4. 使用组件如果没反应的话，尝试重新编译 HBuilder 或重启微信开发者工具。</strong></font></p>
<h2 id="使用过滤器处理价格"><a href="#使用过滤器处理价格" class="headerlink" title="使用过滤器处理价格"></a>使用过滤器处理价格</h2><ol>
<li>在 my-goods 组件中，和 data 字段平级，声明 filters 过滤器节点如下。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">filters: &#123;</span><br><span class="line">    <span class="comment">// 把数字处理为带两位小数点的数字</span></span><br><span class="line">    <span class="function"><span class="title">tofixed</span>(<span class="params">num</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Number</span>(num).toFixed(<span class="number">2</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>在渲染商品价格的时候，通过管道符 | 调用过滤器。</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 商品价格 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;goods-price&quot;</span>&gt;</span>￥&#123;&#123;goods.goods_price | tofixed&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>Vue3 中已经移除了过滤器，推荐使用 methods 或计算属性。</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">1、直接在页面中的插值表达式中使用 Number 方法：&#123;&#123;Number(goods.goods_price).toFixed(2)&#125;</span><br><span class="line"></span><br><span class="line">2、在methods对象中定义方法，在插值表达式中调用</span><br><span class="line">methods: &#123;</span><br><span class="line">    tofixed(num) &#123;</span><br><span class="line">        <span class="built_in">return</span> Number(num).toFixed(2)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#123;&#123;tofixed(goods.goods_price)&#125;&#125;</span><br><span class="line"></span><br><span class="line">3、使用 computed 计算属性</span><br><span class="line">computed:&#123;</span><br><span class="line">    <span class="function"><span class="title">tofixed</span></span>()&#123;</span><br><span class="line">        <span class="built_in">return</span> Number(this.goods.goods_price).toFixed(2)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#123;&#123;tofixed&#125;&#125;</span><br></pre></td></tr></table></figure>

<h2 id="上拉加载更多的效果"><a href="#上拉加载更多的效果" class="headerlink" title="上拉加载更多的效果"></a>上拉加载更多的效果</h2><h3 id="初步实现上拉加载更多"><a href="#初步实现上拉加载更多" class="headerlink" title="初步实现上拉加载更多"></a>初步实现上拉加载更多</h3><ol>
<li>打开项目根目录中的 pages.json 配置文件，为 subPackages 分包中的 goods_list 页面配置上拉触底的距离。</li>
</ol>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;subPackages&quot;</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">&quot;root&quot;</span>: <span class="string">&quot;subpkg&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;pages&quot;</span>: [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">&quot;path&quot;</span>: <span class="string">&quot;goods_detail/goods_detail&quot;</span>,</span><br><span class="line">                    <span class="attr">&quot;style&quot;</span>: &#123;&#125;</span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">&quot;path&quot;</span>: <span class="string">&quot;goods_list/goods_list&quot;</span>,</span><br><span class="line">                    <span class="attr">&quot;style&quot;</span>: &#123;</span><br><span class="line">                        <span class="attr">&quot;onReachBottomDistance&quot;</span>: <span class="number">150</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">&quot;path&quot;</span>: <span class="string">&quot;search/search&quot;</span>,</span><br><span class="line">                    <span class="attr">&quot;style&quot;</span>: &#123;&#125;</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>在 goods_list 页面中，和 methods 平级，声明 onReachBottom 事件处理函数，用来监听页面的上拉触底行为。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 触底的事件</span></span><br><span class="line"><span class="function"><span class="title">onReachBottom</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="comment">// 让页码值自增 +1</span></span><br><span class="line">    <span class="built_in">this</span>.queryObj.pagenum += <span class="number">1</span></span><br><span class="line">    <span class="comment">// 获取列表数据</span></span><br><span class="line">    <span class="built_in">this</span>.getGoodsList()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>改造 methods 中的 getGoodsList 函数，当列表数据请求成功之后，进行新旧数据的拼接处理。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取商品列表数据的方法</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="title">getGoodsList</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="comment">// 发起请求</span></span><br><span class="line">    <span class="keyword">const</span> &#123; <span class="attr">data</span>: res &#125; = <span class="keyword">await</span> uni.$http.get(<span class="string">&#x27;/goods/search&#x27;</span>, <span class="built_in">this</span>.queryObj)</span><br><span class="line">    <span class="keyword">if</span> (res.meta.status !== <span class="number">200</span>) <span class="keyword">return</span> uni.$showMsg()</span><br><span class="line">    <span class="comment">// 为数据赋值：通过展开运算符的形式，进行新旧数据的拼接</span></span><br><span class="line">    <span class="built_in">this</span>.goodsList = [...this.goodsList, ...res.message.goods]</span><br><span class="line">    <span class="built_in">this</span>.total = res.message.total</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="通过节流阀控制请求"><a href="#通过节流阀控制请求" class="headerlink" title="通过节流阀控制请求"></a>通过节流阀控制请求</h3><ol>
<li>在 data 中定义 isloading 节流阀如下。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="comment">// #1 是否正在请求数据</span></span><br><span class="line">        <span class="attr">isloading</span>: <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>修改 getGoodsList 方法，在请求数据前后，分别打开和关闭节流阀。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取商品列表数据的方法</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="title">getGoodsList</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="comment">// #2 打开节流阀</span></span><br><span class="line">    <span class="built_in">this</span>.isloading = <span class="literal">true</span></span><br><span class="line">    <span class="comment">// 发起请求</span></span><br><span class="line">    <span class="keyword">const</span> &#123; <span class="attr">data</span>: res &#125; = <span class="keyword">await</span> uni.$http.get(<span class="string">&#x27;/goods/search&#x27;</span>, <span class="built_in">this</span>.queryObj)</span><br><span class="line">    <span class="comment">// #3 关闭节流阀</span></span><br><span class="line">    <span class="built_in">this</span>.isloading = <span class="literal">false</span></span><br><span class="line">    <span class="comment">// 省略其它代码...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>在 onReachBottom 触底事件处理函数中，根据节流阀的状态，来决定是否发起请求。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 触底的事件</span></span><br><span class="line"><span class="function"><span class="title">onReachBottom</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="comment">// #4 判断是否正在请求其它数据，如果是，则不发起额外的请求</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.isloading) <span class="keyword">return</span></span><br><span class="line">    <span class="comment">// 让页码值自增 +1</span></span><br><span class="line">    <span class="built_in">this</span>.queryObj.pagenum += <span class="number">1</span></span><br><span class="line">    <span class="comment">// 获取列表数据</span></span><br><span class="line">    <span class="built_in">this</span>.getGoodsList()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="判断数据是否加载完毕"><a href="#判断数据是否加载完毕" class="headerlink" title="判断数据是否加载完毕"></a>判断数据是否加载完毕</h3><ol>
<li>如果下面的公式成立，则证明没有下一页数据了。</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">当前的页码值 * 每页显示多少条数据 &gt;= 总数条数</span><br><span class="line">pagenum * pagesize &gt;= total</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>修改 onReachBottom 事件处理函数如下。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 触底的事件</span></span><br><span class="line"><span class="function"><span class="title">onReachBottom</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="comment">// 判断是否还有下一页数据</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.queryObj.pagenum * <span class="built_in">this</span>.queryObj.pagesize &gt;= <span class="built_in">this</span>.total) <span class="keyword">return</span> uni.$showMsg(<span class="string">&#x27;数据加载完毕！&#x27;</span>)</span><br><span class="line">    <span class="comment">// 判断是否正在请求其它数据，如果是，则不发起额外的请求</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.isloading) <span class="keyword">return</span></span><br><span class="line">    <span class="comment">// 让页码值自增 +1</span></span><br><span class="line">    <span class="built_in">this</span>.queryObj.pagenum += <span class="number">1</span></span><br><span class="line">    <span class="comment">// 获取列表数据</span></span><br><span class="line">    <span class="built_in">this</span>.getGoodsList()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="商品列表的下拉刷新"><a href="#商品列表的下拉刷新" class="headerlink" title="商品列表的下拉刷新"></a>商品列表的下拉刷新</h2><ol>
<li>在 <code>pages.json</code> 配置文件中，为当前的 goods_list 页面单独开启下拉刷新效果。</li>
</ol>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;subPackages&quot;</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">&quot;root&quot;</span>: <span class="string">&quot;subpkg&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;pages&quot;</span>: [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">&quot;path&quot;</span>: <span class="string">&quot;goods_detail/goods_detail&quot;</span>,</span><br><span class="line">                    <span class="attr">&quot;style&quot;</span>: &#123;&#125;</span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">&quot;path&quot;</span>: <span class="string">&quot;goods_list/goods_list&quot;</span>,</span><br><span class="line">                    <span class="attr">&quot;style&quot;</span>: &#123;</span><br><span class="line">                        <span class="attr">&quot;onReachBottomDistance&quot;</span>: <span class="number">150</span>,</span><br><span class="line">                        <span class="attr">&quot;enablePullDownRefresh&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">                        <span class="attr">&quot;backgroundColor&quot;</span>: <span class="string">&quot;#F8F8F8&quot;</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">&quot;path&quot;</span>: <span class="string">&quot;search/search&quot;</span>,</span><br><span class="line">                    <span class="attr">&quot;style&quot;</span>: &#123;&#125;</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>监听页面的 onPullDownRefresh 事件处理函数。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 下拉刷新的事件</span></span><br><span class="line"><span class="function"><span class="title">onPullDownRefresh</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="comment">// 1. 重置关键数据</span></span><br><span class="line">    <span class="built_in">this</span>.queryObj.pagenum = <span class="number">1</span></span><br><span class="line">    <span class="built_in">this</span>.total = <span class="number">0</span></span><br><span class="line">    <span class="built_in">this</span>.isloading = <span class="literal">false</span></span><br><span class="line">    <span class="built_in">this</span>.goodsList = []</span><br><span class="line">    <span class="comment">// 2. 重新发起请求</span></span><br><span class="line">    <span class="built_in">this</span>.getGoodsList(<span class="function">() =&gt;</span> uni.stopPullDownRefresh())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>修改 getGoodsList 函数，接收 cb 回调函数并按需进行调用。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取商品列表数据的方法</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="title">getGoodsList</span>(<span class="params">cb</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.isloading = <span class="literal">true</span></span><br><span class="line">    <span class="keyword">const</span> &#123; <span class="attr">data</span>: res &#125; = <span class="keyword">await</span> uni.$http.get(<span class="string">&#x27;/goods/search&#x27;</span>, <span class="built_in">this</span>.queryObj)</span><br><span class="line">    <span class="built_in">this</span>.isloading = <span class="literal">false</span></span><br><span class="line">    <span class="comment">// 只要数据请求完毕，就立即按需调用 cb 回调函数</span></span><br><span class="line">    cb &amp;&amp; cb()</span><br><span class="line">    <span class="keyword">if</span> (res.meta.status !== <span class="number">200</span>) <span class="keyword">return</span> uni.$showMsg()</span><br><span class="line">    <span class="built_in">this</span>.goodsList = [...this.goodsList, ...res.message.goods]</span><br><span class="line">    <span class="built_in">this</span>.total = res.message.total</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="点击列表项跳转详情"><a href="#点击列表项跳转详情" class="headerlink" title="点击列表项跳转详情"></a>点击列表项跳转详情</h2><ol>
<li>在 goods_list 组件中为 <code>&lt;my-goods/&gt;</code> 组件包裹一层修 view 组件，并绑定 click 点击事件处理函数。</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;goods-list&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">v-for</span>=<span class="string">&quot;(item, i) in goodsList&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;i&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;gotoDetail(item)&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 为 my-goods 组件动态绑定 goods 属性的值 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">my-goods</span> <span class="attr">:goods</span>=<span class="string">&quot;item&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">my-goods</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>在 methods 字段中，定义 gotoDetail 事件处理函数。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 点击跳转到商品详情页面</span></span><br><span class="line"><span class="function"><span class="title">gotoDetail</span>(<span class="params">goods</span>)</span> &#123;</span><br><span class="line">    uni.navigateTo(&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="string">&#x27;/subpkg/goods_detail/goods_detail?goods_id=&#x27;</span> + goods.goods_id</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="商品详情"><a href="#商品详情" class="headerlink" title="商品详情"></a>商品详情</h1><h2 id="商品需求分析"><a href="#商品需求分析" class="headerlink" title="商品需求分析"></a>商品需求分析</h2><ol>
<li><p>页面传入的参数是商品 id。</p>
</li>
<li><p>轮播图组件 <code>&lt;swiper/&gt;</code>（小程序原生）。</p>
</li>
<li><p>商品详情渲染使用的是 <code>&lt;rich-text/&gt;</code> 组件（小程序原生）。</p>
</li>
<li><p>商品导航组件 <code>&lt;uni-goods-nav/&gt;</code>（uni-ui）。</p>
</li>
</ol>
<h2 id="开发准备工作"><a href="#开发准备工作" class="headerlink" title="开发准备工作"></a>开发准备工作</h2><p>添加商品详情页的编译模式，在微信开发者工具中，点击工具栏上的编译模式下拉菜单，选择添加编译模式选项。</p>
<img src="/resource/images/image (12).png"/>

<p>勾选 启动页面 的路径，并填写了 启动参数 之后，点击 确定 按钮，添加详情页面的编译模式。</p>
<img src="/resource/images/7-2.82dd8e0f.png"/>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 商品图片轮播图 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">swiper</span>&gt;</span> <span class="tag">&lt;/<span class="name">swiper</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 商品信息 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span>&gt;</span> 商品信息 <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 商品详细介绍 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rich-text</span>&gt;</span><span class="tag">&lt;/<span class="name">rich-text</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 商品导航 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span>&gt;</span> 使用uni-ui组件库 <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="获取商品详情"><a href="#获取商品详情" class="headerlink" title="获取商品详情"></a>获取商品详情</h2><p>在 data 中定义商品详情的数据节点，<code>subpkg/goods_detail/goods_detail.vue</code>。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="comment">// 商品详情对象</span></span><br><span class="line">        <span class="attr">goodsDetail</span>: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在 onLoad 中获取商品的 Id，并调用请求商品详情的方法：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">onLoad</span>(<span class="params">options</span>)</span> &#123;</span><br><span class="line">    <span class="comment">// 获取商品 Id</span></span><br><span class="line">    <span class="keyword">const</span> goods_id = options.goods_id</span><br><span class="line">    <span class="comment">// 调用请求商品详情数据的方法</span></span><br><span class="line">    <span class="built_in">this</span>.getGoodsDetail(goods_id)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在 methods 中声明 getGoodsDetail 方法：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">methods: &#123;</span><br><span class="line">    <span class="comment">// 定义请求商品详情数据的方法</span></span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="title">getGoodsDetail</span>(<span class="params">goods_id</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; <span class="attr">data</span>: res &#125; = <span class="keyword">await</span> uni.$http.get(<span class="string">&#x27;/goods/detail&#x27;</span>, &#123; goods_id &#125;)</span><br><span class="line">        <span class="keyword">if</span> (res.meta.status !== <span class="number">200</span>) <span class="keyword">return</span> uni.$showMsg()</span><br><span class="line">        <span class="comment">// 为 data 中的数据赋值</span></span><br><span class="line">        <span class="built_in">this</span>.goodsDetail = res.message</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="渲染商品详情"><a href="#渲染商品详情" class="headerlink" title="渲染商品详情"></a>渲染商品详情</h2><h3 id="渲染轮播图区域"><a href="#渲染轮播图区域" class="headerlink" title="渲染轮播图区域"></a>渲染轮播图区域</h3><ol>
<li>使用 v-for 指令，循环渲染如下的轮播图 UI 结构。</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 轮播图区域 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">swiper</span> <span class="attr">:indicator-dots</span>=<span class="string">&quot;true&quot;</span> <span class="attr">:autoplay</span>=<span class="string">&quot;true&quot;</span> <span class="attr">:interval</span>=<span class="string">&quot;3000&quot;</span> <span class="attr">:duration</span>=<span class="string">&quot;1000&quot;</span> <span class="attr">:circular</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">swiper-item</span> <span class="attr">v-for</span>=<span class="string">&quot;(item, i) in goodsDetail.pics&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;i&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">image</span> <span class="attr">:src</span>=<span class="string">&quot;item.pics_big&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">swiper-item</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">swiper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>美化轮播图的样式。</li>
</ol>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">swiper &#123;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">750</span>rpx;</span><br><span class="line">    image &#123;</span><br><span class="line">        <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">        <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="实现轮播图预览"><a href="#实现轮播图预览" class="headerlink" title="实现轮播图预览"></a>实现轮播图预览</h3><p><a target="_blank" rel="noopener" href="https://uniapp.dcloud.net.cn/api/media/image.html#unipreviewimageobject">uni.previewImage(OBJECT)</a></p>
<p><a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/api/media/image/wx.previewImage.html">wx.previewImage(Object object)</a></p>
<ol>
<li>为轮播图中的 image 图片绑定 click 事件处理函数。</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">swiper-item</span> <span class="attr">v-for</span>=<span class="string">&quot;(item, i) in goodsDetail.pics&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;i&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 把当前点击的图片的索引，传递到 preview() 处理函数中 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">image</span> <span class="attr">:src</span>=<span class="string">&quot;item.pics_big&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;preview(i)&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">swiper-item</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>在 methods 中定义 preview 事件处理函数。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 实现轮播图的预览效果</span></span><br><span class="line"><span class="function"><span class="title">preview</span>(<span class="params">i</span>)</span> &#123;</span><br><span class="line">    <span class="comment">// 调用 uni.previewImage() 方法预览图片</span></span><br><span class="line">    uni.previewImage(&#123;</span><br><span class="line">        <span class="comment">// 预览时，默认显示图片的索引</span></span><br><span class="line">        <span class="attr">current</span>: i,</span><br><span class="line">        <span class="comment">// 所有图片 url 地址的数组</span></span><br><span class="line">        <span class="attr">urls</span>: <span class="built_in">this</span>.goodsDetail.pics.map(<span class="function"><span class="params">x</span> =&gt;</span> x.pics_big)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="渲染商品的信息"><a href="#渲染商品的信息" class="headerlink" title="渲染商品的信息"></a>渲染商品的信息</h3><ol>
<li>定义商品信息区域的 UI 结构如下。</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 商品信息区域 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;goods-info-box&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 商品价格 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;price&quot;</span>&gt;</span>￥&#123;&#123;goodsDetail.goods_price&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 信息主体区域 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;goods-info-body&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 商品名称 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;goods-name&quot;</span>&gt;</span>&#123;&#123;goodsDetail.goods_name&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 收藏 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;favi&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">uni-icons</span> <span class="attr">type</span>=<span class="string">&quot;star&quot;</span> <span class="attr">size</span>=<span class="string">&quot;18&quot;</span> <span class="attr">color</span>=<span class="string">&quot;gray&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">uni-icons</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">text</span>&gt;</span>收藏<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 运费 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;yf&quot;</span>&gt;</span>快递：免运费<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>美化商品信息区域的样式。</li>
</ol>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">// 商品信息区域的样式</span><br><span class="line"><span class="selector-class">.goods-info-box</span> &#123;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">10px</span>;</span><br><span class="line">    <span class="attribute">padding-right</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="selector-class">.price</span> &#123;</span><br><span class="line">        <span class="attribute">color</span>: <span class="number">#c00000</span>;</span><br><span class="line">        <span class="attribute">font-size</span>: <span class="number">18px</span>;</span><br><span class="line">        <span class="attribute">margin</span>: <span class="number">10px</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="selector-class">.goods-info-body</span> &#123;</span><br><span class="line">        <span class="attribute">display</span>: flex;</span><br><span class="line">        <span class="attribute">justify-content</span>: space-between;</span><br><span class="line">        <span class="selector-class">.goods-name</span> &#123;</span><br><span class="line">            <span class="attribute">font-size</span>: <span class="number">13px</span>;</span><br><span class="line">            <span class="attribute">padding-right</span>: <span class="number">10px</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        // 收藏区域</span><br><span class="line">        <span class="selector-class">.favi</span> &#123;</span><br><span class="line">            <span class="attribute">width</span>: <span class="number">120px</span>;</span><br><span class="line">            <span class="attribute">font-size</span>: <span class="number">12px</span>;</span><br><span class="line">            <span class="attribute">display</span>: flex;</span><br><span class="line">            <span class="attribute">flex-direction</span>: column;</span><br><span class="line">            <span class="attribute">justify-content</span>: center;</span><br><span class="line">            <span class="attribute">align-items</span>: center;</span><br><span class="line">            <span class="attribute">border-left</span>: <span class="number">1px</span> solid <span class="number">#efefef</span>;</span><br><span class="line">            <span class="attribute">color</span>: gray;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    // 运费</span><br><span class="line">    <span class="selector-class">.yf</span> &#123;</span><br><span class="line">        <span class="attribute">margin</span>: <span class="number">10px</span> <span class="number">0</span>;</span><br><span class="line">        <span class="attribute">font-size</span>: <span class="number">12px</span>;</span><br><span class="line">        <span class="attribute">color</span>: gray;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="渲染商品的详情"><a href="#渲染商品的详情" class="headerlink" title="渲染商品的详情"></a>渲染商品的详情</h3><ol>
<li>在页面结构中，使用 rich-text 组件，将带有 HTML 标签的内容，渲染为小程序的页面结构。</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 商品详情信息 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">rich-text</span> <span class="attr">:nodes</span>=<span class="string">&quot;goodsDetail.goods_introduce&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">rich-text</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>修改 getGoodsDetail 方法，从而解决图片底部 空白间隙 的问题。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义请求商品详情数据的方法</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="title">getGoodsDetail</span>(<span class="params">goods_id</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; <span class="attr">data</span>: res &#125; = <span class="keyword">await</span> uni.$http.get(<span class="string">&#x27;/goods/detail&#x27;</span>, &#123; goods_id &#125;)</span><br><span class="line">    <span class="keyword">if</span> (res.meta.status !== <span class="number">200</span>) <span class="keyword">return</span> uni.$showMsg()</span><br><span class="line">    <span class="comment">// 使用字符串的 replace() 方法，为 img 标签添加行内的 style 样式，从而解决图片底部空白间隙的问题</span></span><br><span class="line">    res.message.goods_introduce = res.message.goods_introduce.replace(<span class="regexp">/&lt;img /g</span>, <span class="string">&#x27;&lt;img style=&quot;display:block;&quot; &#x27;</span>)</span><br><span class="line">    <span class="comment">// 或者</span></span><br><span class="line">    <span class="comment">// res.message.goods_introduce = res.message.goods_introduce.replace(/&lt;img /g, &#x27;&lt;img style=&quot;vertical-align: middle;&quot;&#x27;)</span></span><br><span class="line">    <span class="built_in">this</span>.goodsDetail = res.message</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>解决 .webp 格式图片在 ios 设备上无法正常显示的问题。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义请求商品详情数据的方法</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="title">getGoodsDetail</span>(<span class="params">goods_id</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; <span class="attr">data</span>: res &#125; = <span class="keyword">await</span> uni.$http.get(<span class="string">&#x27;/goods/detail&#x27;</span>, &#123; goods_id &#125;)</span><br><span class="line">    <span class="keyword">if</span> (res.meta.status !== <span class="number">200</span>) <span class="keyword">return</span> uni.$showMsg()</span><br><span class="line">    <span class="comment">// 使用字符串的 replace() 方法，将 webp 的后缀名替换为 jpg 的后缀名</span></span><br><span class="line">    res.message.goods_introduce = res.message.goods_introduce.replace(<span class="regexp">/&lt;img /g</span>, <span class="string">&#x27;&lt;img style=&quot;display:block;&quot; &#x27;</span>).replace(<span class="regexp">/webp/g</span>, <span class="string">&#x27;jpg&#x27;</span>)</span><br><span class="line">    <span class="built_in">this</span>.goodsDetail = res.message</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="解决价格的闪烁"><a href="#解决价格的闪烁" class="headerlink" title="解决价格的闪烁"></a>解决价格的闪烁</h3><ol>
<li><p>导致问题的原因：在商品详情数据请求回来之前，data 中 goodsDetail 的值为 {}，因此初次渲染页面时，会导致 商品价格、商品名称 等闪烁的问题。</p>
</li>
<li><p>解决方案：判断 goodsDetail.goods_name 属性的值是否存在，从而使用 v-if 指令控制页面的显示与隐藏。</p>
</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">v-if</span>=<span class="string">&quot;goodsDetail.goods_name&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 省略其它代码 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="渲染商品导航"><a href="#渲染商品导航" class="headerlink" title="渲染商品导航"></a>渲染商品导航</h2><img src="/resource/images/gwx_bottom.png"/>

<h3 id="准备-UI-结构"><a href="#准备-UI-结构" class="headerlink" title="准备 UI 结构"></a>准备 UI 结构</h3><p>基于 uni-ui 提供的 GoodsNav 组件来实现商品导航区域的效果，在 data 中，通过 options 和 buttonGroup 两个数组，来声明商品导航组件的按钮配置对象。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="comment">// 商品详情对象</span></span><br><span class="line">        <span class="attr">goodsDetail</span>: &#123;&#125;,</span><br><span class="line">        <span class="comment">// 左侧按钮组的配置对象</span></span><br><span class="line">        <span class="attr">options</span>: [&#123;</span><br><span class="line">            <span class="attr">icon</span>: <span class="string">&#x27;shop&#x27;</span>,</span><br><span class="line">            <span class="attr">text</span>: <span class="string">&#x27;店铺&#x27;</span></span><br><span class="line">        &#125;, &#123;</span><br><span class="line">            <span class="attr">icon</span>: <span class="string">&#x27;cart&#x27;</span>,</span><br><span class="line">            <span class="attr">text</span>: <span class="string">&#x27;购物车&#x27;</span>,</span><br><span class="line">            <span class="attr">info</span>: <span class="number">2</span></span><br><span class="line">        &#125;],</span><br><span class="line">        <span class="comment">// 右侧按钮组的配置对象</span></span><br><span class="line">        <span class="attr">buttonGroup</span>: [&#123;</span><br><span class="line">            <span class="attr">text</span>: <span class="string">&#x27;加入购物车&#x27;</span>,</span><br><span class="line">            <span class="attr">backgroundColor</span>: <span class="string">&#x27;#ff0000&#x27;</span>,</span><br><span class="line">            <span class="attr">color</span>: <span class="string">&#x27;#fff&#x27;</span></span><br><span class="line">        &#125;, &#123;</span><br><span class="line">            <span class="attr">text</span>: <span class="string">&#x27;立即购买&#x27;</span>,</span><br><span class="line">            <span class="attr">backgroundColor</span>: <span class="string">&#x27;#ffa200&#x27;</span>,</span><br><span class="line">            <span class="attr">color</span>: <span class="string">&#x27;#fff&#x27;</span></span><br><span class="line">        &#125;]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在页面中使用 uni-goods-nav 商品导航组件。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 商品导航组件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;goods-nav&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- fill 控制右侧按钮的样式 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- options 左侧按钮的配置项 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- buttonGroup 右侧按钮的配置项 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- click 左侧按钮的点击事件处理函数 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- buttonClick 右侧按钮的点击事件处理函数 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">uni-goods-nav</span> <span class="attr">:fill</span>=<span class="string">&quot;true&quot;</span> <span class="attr">:options</span>=<span class="string">&quot;options&quot;</span> <span class="attr">:buttonGroup</span>=<span class="string">&quot;buttonGroup&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;onClick&quot;</span> @<span class="attr">buttonClick</span>=<span class="string">&quot;buttonClick&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>美化商品导航组件，使之固定在页面最底部。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">// 商品导航</span><br><span class="line"><span class="selector-class">.goods-nav</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: sticky;</span><br><span class="line">    <span class="attribute">bottom</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">z-index</span>: <span class="number">99</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 第二种实现方式</span><br><span class="line"><span class="selector-class">.goods-detail-container</span> &#123;</span><br><span class="line">    // 给页面外层的容器，添加 <span class="number">50px</span> 的内<span class="attribute">padding</span>，</span><br><span class="line">    // 防止页面内容被底部的商品导航组件遮盖</span><br><span class="line">    <span class="attribute">padding-bottom</span>: <span class="number">50px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.goods-nav</span> &#123;</span><br><span class="line">    // 为商品导航组件添加固定定位</span><br><span class="line">    <span class="attribute">position</span>: fixed;</span><br><span class="line">    <span class="attribute">bottom</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="跳转到购物车"><a href="#跳转到购物车" class="headerlink" title="跳转到购物车"></a>跳转到购物车</h3><p>点击商品导航组件左侧的按钮，会触发 uni-goods-nav 的 @click 事件处理函数，事件对象 e 中会包含当前点击的按钮相关的信息。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 左侧按钮的点击事件处理函数</span></span><br><span class="line"><span class="function"><span class="title">onClick</span>(<span class="params">e</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(e)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>打印的按钮信息对象如下。</p>
<img src="/resource/images/image (13).png"/>

<p>根据 e.content.text 的值，来决定进一步的操作。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 左侧按钮的点击事件处理函数</span></span><br><span class="line"><span class="function"><span class="title">onClick</span>(<span class="params">e</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (e.content.text === <span class="string">&#x27;购物车&#x27;</span>) &#123;</span><br><span class="line">        <span class="comment">// 切换到购物车页面</span></span><br><span class="line">        uni.switchTab(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">&#x27;/pages/cart/cart&#x27;</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="加入购物车"><a href="#加入购物车" class="headerlink" title="加入购物车"></a>加入购物车</h1><h2 id="配置-Vuex"><a href="#配置-Vuex" class="headerlink" title="配置 Vuex"></a>配置 Vuex</h2><ol>
<li>在项目根目录中创建 store 文件夹，在 store 目录上鼠标右键，选择 新建 -&gt; js 文件，新建 store.js 文件。</li>
</ol>
<img src="/resource/images/image (14).png"/>

<p>在 <code>store.js</code> 中按照如下 4 个步骤初始化 Store 的实例对象。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 导入 Vue 和 Vuex</span></span><br><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Vuex <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"><span class="comment">// 2. 将 Vuex 安装为 Vue 的插件</span></span><br><span class="line">Vue.use(Vuex)</span><br><span class="line"><span class="comment">// 3. 创建 Store 的实例对象</span></span><br><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> Vuex.Store(&#123;</span><br><span class="line">    <span class="comment">// TODO：挂载 store 模块</span></span><br><span class="line">    <span class="attr">modules</span>: &#123;&#125;,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 4. 向外共享 Store 的实例对象</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>在 <code>main.js</code> 中导入 store 实例对象并挂载到 Vue 的实例上。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 导入 store 的实例对象</span></span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;./store/store.js&#x27;</span></span><br><span class="line"><span class="comment">// 省略其它代码...</span></span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    ...App,</span><br><span class="line">    <span class="comment">// 2. 将 store 挂载到 Vue 实例上</span></span><br><span class="line">    store,</span><br><span class="line">&#125;)</span><br><span class="line">app.$mount()</span><br></pre></td></tr></table></figure>

<h2 id="创建购物车模块"><a href="#创建购物车模块" class="headerlink" title="创建购物车模块"></a>创建购物车模块</h2><ol>
<li>在 store 目录上鼠标右键，选择 新建 -&gt; js 文件，创建购物车的 store 模块，命名为 cart.js。</li>
</ol>
<img src="/resource/images/image (15).png"/>

<ol start="2">
<li>在 <code>cart.js</code> 中，初始化如下的 vuex 模块。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="comment">// 为当前模块开启命名空间</span></span><br><span class="line">    <span class="attr">namespaced</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="comment">// 模块的 state 数据</span></span><br><span class="line">    <span class="attr">state</span>: <span class="function">() =&gt;</span> (&#123;</span><br><span class="line">        <span class="comment">// 购物车数组，用来存储购物车中每个商品的信息</span></span><br><span class="line">        <span class="attr">cart</span>: [],</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="comment">// 模块的 mutations 方法</span></span><br><span class="line">    <span class="attr">mutations</span>: &#123;&#125;,</span><br><span class="line">    <span class="comment">// 模块的 getters 属性</span></span><br><span class="line">    <span class="attr">getters</span>: &#123;&#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>在 <code>store/store.js</code> 模块中，导入并挂载购物车的 vuex 模块，示例代码如下。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Vuex <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"><span class="comment">// 1. 导入购物车的 vuex 模块</span></span><br><span class="line"><span class="keyword">import</span> moduleCart <span class="keyword">from</span> <span class="string">&#x27;./cart.js&#x27;</span></span><br><span class="line">Vue.use(Vuex)</span><br><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> Vuex.Store(&#123;</span><br><span class="line">    <span class="comment">// TODO：挂载 store 模块</span></span><br><span class="line">    <span class="attr">modules</span>: &#123;</span><br><span class="line">        <span class="comment">// 2. 挂载购物车的 vuex 模块，模块内成员的访问路径被调整为 m_cart，例如：购物车模块中 cart 数组的访问路径是 m_cart/cart</span></span><br><span class="line">        <span class="attr">m_cart</span>: moduleCart,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store</span><br></pre></td></tr></table></figure>

<h2 id="使用购物车模块"><a href="#使用购物车模块" class="headerlink" title="使用购物车模块"></a>使用购物车模块</h2><ol>
<li>在 <code>subpkg/goods_detail/goods_detail.vue</code>，通过 mapState 导入 vuex 中的数据。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 从 vuex 中按需导出 mapState 辅助方法</span></span><br><span class="line"><span class="keyword">import</span> &#123; mapState &#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="attr">computed</span>: &#123;</span><br><span class="line">        <span class="comment">// 调用 mapState 方法，把 m_cart 模块中的 cart 数组映射到当前页面中，作为计算属性来使用</span></span><br><span class="line">        <span class="comment">// ...mapState(&#x27;模块的名称&#x27;, [&#x27;要映射的数据名称1&#x27;, &#x27;要映射的数据名称2&#x27;])</span></span><br><span class="line">        ...mapState(<span class="string">&#x27;m_cart&#x27;</span>, [<span class="string">&#x27;cart&#x27;</span>]),</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 省略其它代码...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>在页面渲染时，可以直接使用映射过来的数据，例如。</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 运费 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;yf&quot;</span>&gt;</span>快递：免运费 -- &#123;&#123;cart.length&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="加入购物车功能"><a href="#加入购物车功能" class="headerlink" title="加入购物车功能"></a>加入购物车功能</h2><ol>
<li>在 store 目录下的 <code>cart.js</code> 模块中，封装一个将商品信息加入购物车的 mutations 方法，命名为 addToCart，示例代码如下。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="comment">// 为当前模块开启命名空间</span></span><br><span class="line">    <span class="attr">namespaced</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="comment">// 模块的 state 数据</span></span><br><span class="line">    <span class="attr">state</span>: <span class="function">() =&gt;</span> (&#123;</span><br><span class="line">        <span class="comment">// 购物车的数组，用来存储购物车中每个商品的信息对象</span></span><br><span class="line">        <span class="comment">// 每个商品的信息对象，都包含如下 6 个属性：</span></span><br><span class="line">        <span class="comment">// &#123; goods_id, goods_name, goods_price, goods_count, goods_small_logo, goods_state &#125;</span></span><br><span class="line">        <span class="attr">cart</span>: [],</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="comment">// 模块的 mutations 方法</span></span><br><span class="line">    <span class="attr">mutations</span>: &#123;</span><br><span class="line">        <span class="function"><span class="title">addToCart</span>(<span class="params">state, goods</span>)</span> &#123;</span><br><span class="line">            <span class="comment">// 根据提交的商品的Id，查询购物车中是否存在这件商品</span></span><br><span class="line">            <span class="comment">// 如果不存在，则 findResult 为 undefined；否则，为查找到的商品信息对象</span></span><br><span class="line">            <span class="keyword">const</span> result = state.cart.find(<span class="function">(<span class="params">x</span>) =&gt;</span> x.goods_id === goods.goods_id)</span><br><span class="line">            <span class="keyword">if</span> (!result) &#123;</span><br><span class="line">                <span class="comment">// 如果购物车中没有这件商品，则直接 push</span></span><br><span class="line">                state.cart.push(goods)</span><br><span class="line">                <span class="comment">// 如果要添加到首部使用下面的方法</span></span><br><span class="line">                <span class="comment">// state.cart.unshift(goods)</span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// 如果购物车中有这件商品，则只更新数量即可</span></span><br><span class="line">                result.goods_count += <span class="number">1</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 模块的 getters 属性</span></span><br><span class="line">    <span class="attr">getters</span>: &#123;&#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>在商品详情页面中，通过 mapMutations 这个辅助方法，把 vuex 中 m_cart 模块下的 addToCart 方法映射到当前页面。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 按需导入 mapMutations 这个辅助方法</span></span><br><span class="line"><span class="keyword">import</span> &#123; mapMutations &#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="attr">methods</span>: &#123;</span><br><span class="line">        <span class="comment">// 把 m_cart 模块中的 addToCart 方法映射到当前页面使用</span></span><br><span class="line">        ...mapMutations(<span class="string">&#x27;m_cart&#x27;</span>, [<span class="string">&#x27;addToCart&#x27;</span>]),</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>为商品导航组件 uni-goods-nav 绑定 @buttonClick=”buttonClick” 事件处理函数。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 右侧按钮的点击事件处理函数</span></span><br><span class="line"><span class="function"><span class="title">buttonClick</span>(<span class="params">e</span>)</span> &#123;</span><br><span class="line">   <span class="comment">// 1. 判断是否点击了 加入购物车 按钮</span></span><br><span class="line">   <span class="keyword">if</span> (e.content.text === <span class="string">&#x27;加入购物车&#x27;</span>) &#123;</span><br><span class="line">      <span class="comment">// 2. 组织一个商品的信息对象</span></span><br><span class="line">      <span class="keyword">const</span> goods = &#123;</span><br><span class="line">         <span class="attr">goods_id</span>: <span class="built_in">this</span>.goodsDetail.goods_id,       <span class="comment">// 商品的Id</span></span><br><span class="line">         <span class="attr">goods_name</span>: <span class="built_in">this</span>.goodsDetail.goods_name,   <span class="comment">// 商品的名称</span></span><br><span class="line">         <span class="attr">goods_price</span>: <span class="built_in">this</span>.goodsDetail.goods_price, <span class="comment">// 商品的价格</span></span><br><span class="line">         <span class="attr">goods_count</span>: <span class="number">1</span>,                           <span class="comment">// 商品的数量</span></span><br><span class="line">         <span class="attr">goods_small_logo</span>: <span class="built_in">this</span>.goodsDetail.goods_small_logo, <span class="comment">// 商品的图片</span></span><br><span class="line">         <span class="attr">goods_state</span>: <span class="literal">true</span>                         <span class="comment">// 商品的勾选状态</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// 3. 通过 this 调用映射过来的 addToCart 方法，把商品信息对象存储到购物车中</span></span><br><span class="line">      <span class="built_in">this</span>.addToCart(goods)</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="购物车中总数量"><a href="#购物车中总数量" class="headerlink" title="购物车中总数量"></a>购物车中总数量</h2><ol>
<li>动态统计购物车中商品的总数量，在 <code>cart.js</code> 模块中，在 getters 字段下定义一个 total 方法，用来统计购物车中商品的总数量。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 模块的 getters 属性</span></span><br><span class="line"><span class="attr">getters</span>: &#123;</span><br><span class="line">    <span class="comment">// 统计购物车中商品的总数量</span></span><br><span class="line">    <span class="function"><span class="title">total</span>(<span class="params">state</span>)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> state.cart.reduce( <span class="function">(<span class="params">acc, curr</span>)=&gt;</span> acc+curr.goods_count, <span class="number">0</span> )</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 或者使用老办法</span></span><br><span class="line">        <span class="comment">// let c = 0</span></span><br><span class="line">        <span class="comment">// 循环统计商品的数量，累加到变量 c 中</span></span><br><span class="line">        <span class="comment">// state.cart.forEach(goods =&gt; c += goods.goods_count)</span></span><br><span class="line">        <span class="comment">// return c</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>在商品详情页，通过 mapGetters 拿到 vuex 中的 total。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 按需导入 mapGetters 这个辅助方法</span></span><br><span class="line"><span class="keyword">import</span> &#123; mapGetters &#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="attr">computed</span>: &#123;</span><br><span class="line">        <span class="comment">// 把 m_cart 模块中名称为 total 的 getter 映射到当前页面中使用</span></span><br><span class="line">        ...mapGetters(<span class="string">&#x27;m_cart&#x27;</span>, [<span class="string">&#x27;total&#x27;</span>]),</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>通过 watch 监听 total 值的变化，<font color=e32d40><strong>从而动态为购物车按钮的徽标赋值</strong></font>。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">watch: &#123;</span><br><span class="line">    <span class="comment">// 定义 total 侦听器，指向一个配置对象</span></span><br><span class="line">    <span class="attr">total</span>: &#123;</span><br><span class="line">        <span class="comment">// handler 属性用来定义侦听器的 function 处理函数</span></span><br><span class="line">        <span class="function"><span class="title">handler</span>(<span class="params">newTotal</span>)</span> &#123;</span><br><span class="line">            <span class="comment">// 为购物车按钮的 info 属性赋值</span></span><br><span class="line">            <span class="comment">// 如果不用 immediate，在 onLoad 中再进行一次下面一行操作也行</span></span><br><span class="line">            <span class="built_in">this</span>.options[<span class="number">1</span>].info = newTotal</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">// immediate 属性用来声明此侦听器，是否在页面初次加载完毕后立即调用</span></span><br><span class="line">        <span class="attr">immediate</span>: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<h2 id="持久化存储购物车中商品"><a href="#持久化存储购物车中商品" class="headerlink" title="持久化存储购物车中商品"></a>持久化存储购物车中商品</h2><ol>
<li>在 <code>store/cart.js</code> 模块中，声明一个叫做 saveToStorage 的 mutations 方法，此方法负责将购物车中的数据持久化存储到本地。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 将购物车中的数据持久化存储到本地</span></span><br><span class="line"><span class="function"><span class="title">saveToStorage</span>(<span class="params">state</span>)</span> &#123;</span><br><span class="line">    uni.setStorageSync(<span class="string">&#x27;cart&#x27;</span>, <span class="built_in">JSON</span>.stringify(state.cart))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>修改 mutations 节点中的 addToCart 方法，在处理完商品信息后，调用步骤 1 中定义的 saveToStorage 方法。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">addToCart</span>(<span class="params">state, goods</span>)</span> &#123;</span><br><span class="line">    <span class="comment">// 根据提交的商品的Id，查询购物车中是否存在这件商品</span></span><br><span class="line">    <span class="comment">// 如果不存在，则 findResult 为 undefined；否则，为查找到的商品信息对象</span></span><br><span class="line">    <span class="keyword">const</span> result = state.cart.find(<span class="function"><span class="params">x</span> =&gt;</span> x.goods_id === goods.goods_id)</span><br><span class="line">    <span class="keyword">if</span> (!result) &#123;</span><br><span class="line">        <span class="comment">// 如果购物车中没有这件商品，则直接 push</span></span><br><span class="line">        state.cart.push(goods)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 如果购物车中有这件商品，则只更新数量即可</span></span><br><span class="line">        result.goods_count += <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 通过 commit 方法，调用 m_cart 命名空间下的 saveToStorage 方法</span></span><br><span class="line">    <span class="built_in">this</span>.commit(<span class="string">&#x27;m_cart/saveToStorage&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>修改 <code>cart.js</code> 模块中的 state 函数，读取本地存储的购物车数据，对 cart 数组进行初始化。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 模块的 state 数据</span></span><br><span class="line"><span class="attr">state</span>: <span class="function">() =&gt;</span> (&#123;</span><br><span class="line">    <span class="comment">// 购物车的数组，用来存储购物车中每个商品的信息对象</span></span><br><span class="line">    <span class="comment">// 每个商品的信息对象，都包含如下 6 个属性：</span></span><br><span class="line">    <span class="comment">// &#123; goods_id, goods_name, goods_price, goods_count, goods_small_logo, goods_state &#125;</span></span><br><span class="line">    <span class="attr">cart</span>: <span class="built_in">JSON</span>.parse(uni.getStorageSync(<span class="string">&#x27;cart&#x27;</span>) || <span class="string">&#x27;[]&#x27;</span>)</span><br><span class="line">    <span class="comment">// 此处不可以用空值合并运算符，因为key不匹配的话，返回 &#x27;&#x27;</span></span><br><span class="line">    <span class="comment">// cart: JSON.parse(uni.getStorageSync(&#x27;cart&#x27;) ?? &#x27;[]&#x27;)</span></span><br><span class="line">&#125;),</span><br></pre></td></tr></table></figure>

<h2 id="动态为-TabBar-设置徽标"><a href="#动态为-TabBar-设置徽标" class="headerlink" title="动态为 TabBar 设置徽标"></a>动态为 TabBar 设置徽标</h2><p>需求：从商品详情页跳转到购物车页面之后，需要为 tabBar 中的购物车栏动态设置数字徽标。</p>
<ol>
<li>把 Store 中的 total 映射到 <code>pages/cart/cart.vue</code>，操作如下。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 按需导入 mapGetters 这个辅助方法</span></span><br><span class="line"><span class="keyword">import</span> &#123; mapGetters &#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;&#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">computed</span>: &#123;</span><br><span class="line">        <span class="comment">// 将 m_cart 模块中的 total 映射为当前页面的计算属性</span></span><br><span class="line">        ...mapGetters(<span class="string">&#x27;m_cart&#x27;</span>, [<span class="string">&#x27;total&#x27;</span>]),</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>在页面 onShow 生命周期方法中调用 setBadge 方法，为 tabBar 设置数字徽标。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">onShow</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">   <span class="comment">// 在页面刚展示的时候，设置数字徽标</span></span><br><span class="line">   <span class="built_in">this</span>.setBadge()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>在 methods 中声明 setBadge 方法，通过 uni.setTabBarBadge() 为 tabBar 设置数字徽标。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">methods: &#123;</span><br><span class="line">    <span class="function"><span class="title">setBadge</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// 调用 uni.setTabBarBadge() 方法，设置购物车右上角徽标</span></span><br><span class="line">        uni.setTabBarBadge(&#123;</span><br><span class="line">            <span class="attr">index</span>: <span class="number">2</span>, <span class="comment">// tabBar 页面索引</span></span><br><span class="line">            <span class="attr">text</span>: <span class="built_in">this</span>.total + <span class="string">&#x27;&#x27;</span> <span class="comment">// 注意：text 的值必须是字符串，不能是数字</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="优化上面的代码"><a href="#优化上面的代码" class="headerlink" title="优化上面的代码"></a>优化上面的代码</h2><p>除了要在 <code>cart.vue</code> 页面中设置购物车的数字徽标，还需要在其它 3 个 tabBar 页面中，为购物车设置数字徽标。此时可以使用 Vue 提供的 mixins 特性，将设置 tabBar 徽标的代码进行抽离，提高代码的可维护性。</p>
<ol>
<li>新建 <code>mixins/tabbar-badge.js</code>。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; mapGetters &#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"><span class="comment">// 导出一个 mixin 对象</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="attr">computed</span>: &#123;</span><br><span class="line">        ...mapGetters(<span class="string">&#x27;m_cart&#x27;</span>, [<span class="string">&#x27;total&#x27;</span>]),</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="title">onShow</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// 在页面刚展示的时候，设置数字徽标</span></span><br><span class="line">        <span class="built_in">this</span>.setBadge()</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">methods</span>: &#123;</span><br><span class="line">        <span class="function"><span class="title">setBadge</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">            <span class="comment">// 调用 uni.setTabBarBadge() 方法，设置购物车右上角徽标</span></span><br><span class="line">            uni.setTabBarBadge(&#123;</span><br><span class="line">                <span class="attr">index</span>: <span class="number">2</span>,</span><br><span class="line">                <span class="attr">text</span>: <span class="built_in">this</span>.total + <span class="string">&#x27;&#x27;</span>, <span class="comment">// 注意：text 的值必须是字符串，不能是数字</span></span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>修改 <code>home.vue</code>，<code>cate.vue</code>，<code>cart.vue</code>，<code>my.vue</code> 这 4 个 tabBar 页面的源代码，分别导入 <code>@/mixins/tabbar-badge.js</code> 模块并进行使用。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入自己封装的 mixin 模块</span></span><br><span class="line"><span class="keyword">import</span> badgeMix <span class="keyword">from</span> <span class="string">&#x27;@/mixins/tabbar-badge.js&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="comment">// 将 badgeMix 混入到当前的页面中进行使用</span></span><br><span class="line">    <span class="attr">mixins</span>: [badgeMix],</span><br><span class="line">    <span class="comment">// 省略其它代码...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="购物车页面"><a href="#购物车页面" class="headerlink" title="购物车页面"></a>购物车页面</h1><h2 id="需求分析总结-1"><a href="#需求分析总结-1" class="headerlink" title="需求分析总结"></a>需求分析总结</h2><ol>
<li><p>收获地址数据是调用微信 API 获取。</p>
</li>
<li><p>购物车数据是从 vuex 中获取。</p>
</li>
<li><p>商品数量渲染使用的是 <code>&lt;uni-number-box/&gt;</code> 组件（uni-ui）。</p>
</li>
<li><p>选中渲染使用的是 <code>&lt;radio/&gt;</code> 组件（小程序原生）。</p>
</li>
<li><p>购物车商品列表渲染使用的是基于 <code>&lt;my-goods/&gt;</code> 组件进行的二次改造。</p>
</li>
</ol>
<h2 id="开发准备工作-1"><a href="#开发准备工作-1" class="headerlink" title="开发准备工作"></a>开发准备工作</h2><p>添加购物车页面的编译模式；页面整体结构如下，<code>pages/cart/cart.vue</code>。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 收获地址 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span>&gt;</span>收获地址<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 购物车标题区域 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span>&gt;</span>购物车标题区域<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 购物车列表 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span>&gt;</span>购物车列表<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 结算栏 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span>&gt;</span>结算栏<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 空白购物车区域 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span>&gt;</span>购物车空白区<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="收货地址组件"><a href="#收货地址组件" class="headerlink" title="收货地址组件"></a>收货地址组件</h2><ol>
<li>在 components 目录上鼠标右键，选择【新建组件】，并填写组件相关的信息。</li>
</ol>
<img src="/resource/images/9-3.d168684c.png"/>

<ol start="2">
<li>渲染收货地址组件的基本结构。</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 选择收货地址的盒子 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;address-choose-box&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> <span class="attr">size</span>=<span class="string">&quot;mini&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btnChooseAddress&quot;</span>&gt;</span>请选择收货地址+<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 渲染收货信息的盒子 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;address-info-box&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;row1&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;row1-left&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;username&quot;</span>&gt;</span>收货人：<span class="tag">&lt;<span class="name">text</span>&gt;</span>ifer<span class="tag">&lt;/<span class="name">text</span>&gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;row1-right&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;phone&quot;</span>&gt;</span>电话：<span class="tag">&lt;<span class="name">text</span>&gt;</span>185XXXX8888<span class="tag">&lt;/<span class="name">text</span>&gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">uni-icons</span> <span class="attr">type</span>=<span class="string">&quot;arrowright&quot;</span> <span class="attr">size</span>=<span class="string">&quot;16&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">uni-icons</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;row2&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;row2-left&quot;</span>&gt;</span>收货地址：<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;row2-right&quot;</span>&gt;</span>河南省周口市淮阳区xxx 河南省周口市淮阳区xxx 河南省周口市淮阳区xxx 河南省周口市淮阳区xxx <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 底部的边框线 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">image</span> <span class="attr">src</span>=<span class="string">&quot;/static/cart_border@2x.png&quot;</span> <span class="attr">class</span>=<span class="string">&quot;address-border&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>美化收货地址组件的样式如下。</li>
</ol>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">// 底部边框线的样式</span><br><span class="line"><span class="selector-class">.address-border</span> &#123;</span><br><span class="line">    // <span class="attribute">display</span>: block;</span><br><span class="line">    <span class="attribute">vertical-align</span>: middle;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">5px</span>;</span><br><span class="line">&#125;</span><br><span class="line">// 选择收货地址的盒子</span><br><span class="line"><span class="selector-class">.address-choose-box</span> &#123;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">90px</span>;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">align-items</span>: center;</span><br><span class="line">    <span class="attribute">justify-content</span>: center;</span><br><span class="line">&#125;</span><br><span class="line">// 渲染收货信息的盒子</span><br><span class="line"><span class="selector-class">.address-info-box</span> &#123;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">12px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">90px</span>;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">flex-direction</span>: column;</span><br><span class="line">    <span class="attribute">justify-content</span>: center;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">5px</span>;</span><br><span class="line">    // 第一行</span><br><span class="line">    <span class="selector-class">.row1</span> &#123;</span><br><span class="line">        <span class="attribute">display</span>: flex;</span><br><span class="line">        <span class="attribute">justify-content</span>: space-between;</span><br><span class="line">        <span class="selector-class">.row1-right</span> &#123;</span><br><span class="line">            <span class="attribute">display</span>: flex;</span><br><span class="line">            <span class="attribute">align-items</span>: center;</span><br><span class="line">            <span class="selector-class">.phone</span> &#123;</span><br><span class="line">                <span class="attribute">margin-right</span>: <span class="number">5px</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    // 第二行</span><br><span class="line">    <span class="selector-class">.row2</span> &#123;</span><br><span class="line">        <span class="attribute">display</span>: flex;</span><br><span class="line">        <span class="attribute">align-items</span>: center;</span><br><span class="line">        <span class="attribute">margin-top</span>: <span class="number">10px</span>;</span><br><span class="line">        <span class="selector-class">.row2-left</span> &#123;</span><br><span class="line">            <span class="attribute">white-space</span>: nowrap;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>在 data 中定义收货地址的信息对象。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="comment">// 收货地址</span></span><br><span class="line">            <span class="attr">address</span>: &#123;&#125;,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>使用 v-if 和 v-else 实现【请选择收获地址】和【收货地址信息】的条件渲染。</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 选择收货地址的盒子 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;address-choose-box&quot;</span> <span class="attr">v-if</span>=<span class="string">&quot;JSON.stringify(address) === &#x27;&#123;&#125;&#x27;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> <span class="attr">size</span>=<span class="string">&quot;mini&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btnChooseAddress&quot;</span>&gt;</span>请选择收货地址+<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 渲染收货信息的盒子 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;address-info-box&quot;</span> <span class="attr">v-else</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- ...省略其它代码 --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="获取收货地址"><a href="#获取收货地址" class="headerlink" title="获取收货地址"></a>获取收货地址</h2><ol>
<li>为 请选择收货地址+ button 按钮绑定点击事件处理函数。</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 选择收货地址的盒子 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;address-choose-box&quot;</span> <span class="attr">v-if</span>=<span class="string">&quot;JSON.stringify(address) === &#x27;&#123;&#125;&#x27;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> <span class="attr">size</span>=<span class="string">&quot;mini&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btnChooseAddress&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;chooseAddress&quot;</span>&gt;</span>请选择收货地址+<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>定义 chooseAddress 事件处理函数，调用小程序提供的 chooseAddress() API 实现选择收货地址功能。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">methods: &#123;</span><br><span class="line">    <span class="comment">// 选择收货地址</span></span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="title">chooseAddress</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// 1. 调用小程序提供的 chooseAddress() 方法，即可使用选择收货地址的功能</span></span><br><span class="line">        <span class="comment">//    返回值是一个数组：第 1 项为错误对象；第 2 项为成功之后的收货地址对象</span></span><br><span class="line">        <span class="keyword">const</span> [err, succ] = <span class="keyword">await</span> uni.chooseAddress()</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 注意：点击弹框中的取消/确认后才会走到这儿</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2. 用户成功的选择了收货地址</span></span><br><span class="line">        <span class="keyword">if</span> (err === <span class="literal">null</span> &amp;&amp; succ.errMsg === <span class="string">&#x27;chooseAddress:ok&#x27;</span>) &#123;</span><br><span class="line">            <span class="comment">// 为 data 里面的收货地址对象赋值</span></span><br><span class="line">            <span class="built_in">this</span>.address = succ</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>manifest.json</code></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;mp-weixin&quot;</span>: &#123;</span><br><span class="line">        <span class="comment">/* 小程序特有相关 */</span></span><br><span class="line">        <span class="attr">&quot;appid&quot;</span>: <span class="string">&quot;wxfb52f2d7b2f6123a&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;requiredPrivateInfos&quot;</span>: [<span class="string">&quot;chooseAddress&quot;</span>]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>定义详细收货地址的计算属性。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">computed: &#123;</span><br><span class="line">    <span class="comment">// 收货详细地址的计算属性</span></span><br><span class="line">    <span class="function"><span class="title">addstr</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// 判断address是否已经获取</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">JSON</span>.stringify(<span class="built_in">this</span>.address) ===<span class="string">&#x27;&#123;&#125;&#x27;</span>) <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 拼接 省，市，区，详细地址 的字符串并返回给用户</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.address.provinceName + <span class="built_in">this</span>.address.cityName + <span class="built_in">this</span>.address.countyName + <span class="built_in">this</span>.address.detailInfo</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>渲染收货地址区域的数据。</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 渲染收货信息的盒子 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;address-info-box&quot;</span> <span class="attr">v-else</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;row1&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;row1-left&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;username&quot;</span>&gt;</span>收货人：<span class="tag">&lt;<span class="name">text</span>&gt;</span>&#123;&#123;address.userName&#125;&#125;<span class="tag">&lt;/<span class="name">text</span>&gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;row1-right&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;phone&quot;</span>&gt;</span>电话：<span class="tag">&lt;<span class="name">text</span>&gt;</span>&#123;&#123;address.telNumber&#125;&#125;<span class="tag">&lt;/<span class="name">text</span>&gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">uni-icons</span> <span class="attr">type</span>=<span class="string">&quot;arrowright&quot;</span> <span class="attr">size</span>=<span class="string">&quot;16&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">uni-icons</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;row2&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;row2-left&quot;</span>&gt;</span>收货地址：<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;row2-right&quot;</span>&gt;</span>&#123;&#123;addstr&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="存储-address-到-Vuex"><a href="#存储-address-到-Vuex" class="headerlink" title="存储 address 到 Vuex"></a>存储 address 到 Vuex</h2><h3 id="将-address-信息存储到-vuex-中"><a href="#将-address-信息存储到-vuex-中" class="headerlink" title="将 address 信息存储到 vuex 中"></a>将 address 信息存储到 vuex 中</h3><ol>
<li>在 store 目录中，创建用户相关的 vuex 模块，命名为 <code>user.js</code>。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="comment">// 开启命名空间</span></span><br><span class="line">    <span class="attr">namespaced</span>: <span class="literal">true</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// state 数据</span></span><br><span class="line">    <span class="attr">state</span>: <span class="function">() =&gt;</span> (&#123;</span><br><span class="line">        <span class="comment">// 收货地址</span></span><br><span class="line">        <span class="attr">address</span>: &#123;&#125;,</span><br><span class="line">    &#125;),</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 方法</span></span><br><span class="line">    <span class="attr">mutations</span>: &#123;</span><br><span class="line">        <span class="comment">// 更新收货地址</span></span><br><span class="line">        <span class="function"><span class="title">updateAddress</span>(<span class="params">state, address</span>)</span> &#123;</span><br><span class="line">            state.address = address</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 数据包装器</span></span><br><span class="line">    <span class="attr">getters</span>: &#123;&#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>在 <code>store/store.js</code> 模块中，导入并挂载 <code>user.js</code> 模块。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 导入 Vue 和 Vuex</span></span><br><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Vuex <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"><span class="comment">// 导入购物车的 vuex 模块</span></span><br><span class="line"><span class="keyword">import</span> moduleCart <span class="keyword">from</span> <span class="string">&#x27;./cart.js&#x27;</span></span><br><span class="line"><span class="comment">// 导入用户的 vuex 模块</span></span><br><span class="line"><span class="keyword">import</span> moduleUser <span class="keyword">from</span> <span class="string">&#x27;./user.js&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 将 Vuex 安装为 Vue 的插件</span></span><br><span class="line">Vue.use(Vuex)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 创建 Store 的实例对象</span></span><br><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> Vuex.Store(&#123;</span><br><span class="line">    <span class="comment">// TODO：挂载 store 模块</span></span><br><span class="line">    <span class="attr">modules</span>: &#123;</span><br><span class="line">        <span class="comment">// 挂载购物车的 vuex 模块，模块内成员的访问路径被调整为 m_cart，例如：</span></span><br><span class="line">        <span class="comment">// 购物车模块中 cart 数组的访问路径是 m_cart/cart</span></span><br><span class="line">        <span class="attr">m_cart</span>: moduleCart,</span><br><span class="line">        <span class="comment">// 挂载用户的 vuex 模块，访问路径为 m_user</span></span><br><span class="line">        <span class="attr">m_user</span>: moduleUser,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. 向外共享 Store 的实例对象</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>改造 <code>my-address.vue</code> 组件中的代码，使用 vuex 提供的 address 计算属性替代 data 中定义的本地 address 对象。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// #1 按需导入 mapState 和 mapMutations 这两个辅助函数</span></span><br><span class="line"><span class="keyword">import</span> &#123; mapState, mapMutations &#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="comment">// #2 注释掉下面的 address 对象，使用 2.2 中的代码替代之</span></span><br><span class="line">            <span class="comment">// address: &#123;&#125;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">computed</span>: &#123;</span><br><span class="line">        <span class="comment">// #3 把 m_user 模块中的 address 对象映射当前组件中使用，代替 data 中 address 对象</span></span><br><span class="line">        ...mapState(<span class="string">&#x27;m_user&#x27;</span>, [<span class="string">&#x27;address&#x27;</span>]),</span><br><span class="line">        <span class="comment">// 详细收货地址的计算属性</span></span><br><span class="line">        <span class="function"><span class="title">addstr</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (!<span class="built_in">this</span>.address.provinceName) <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line">            <span class="comment">// 拼接 省，市，区，详细地址 的字符串并返回给用户</span></span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>.address.provinceName + <span class="built_in">this</span>.address.cityName + <span class="built_in">this</span>.address.countyName + <span class="built_in">this</span>.address.detailInfo</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">methods</span>: &#123;</span><br><span class="line">        <span class="comment">// #4 把 m_user 模块中的 updateAddress 函数映射到当前组件</span></span><br><span class="line">        ...mapMutations(<span class="string">&#x27;m_user&#x27;</span>, [<span class="string">&#x27;updateAddress&#x27;</span>]),</span><br><span class="line">        <span class="comment">// 选择收货地址</span></span><br><span class="line">        <span class="keyword">async</span> <span class="function"><span class="title">chooseAddress</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> [err, succ] = <span class="keyword">await</span> uni.chooseAddress().catch(<span class="function">(<span class="params">err</span>) =&gt;</span> err)</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 用户成功的选择了收货地址</span></span><br><span class="line">            <span class="keyword">if</span> (err === <span class="literal">null</span> &amp;&amp; succ.errMsg === <span class="string">&#x27;chooseAddress:ok&#x27;</span>) &#123;</span><br><span class="line">                <span class="comment">// #5 把下面这行代码注释掉，使用 3.3 中的代码替代之</span></span><br><span class="line">                <span class="comment">// this.address = succ</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">// #6 调用 Store 中提供的 updateAddress 方法，将 address 保存到 Store 里面</span></span><br><span class="line">                <span class="built_in">this</span>.updateAddress(succ)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="将-Store-中的-address-持久化存储到本地"><a href="#将-Store-中的-address-持久化存储到本地" class="headerlink" title="将 Store 中的 address 持久化存储到本地"></a>将 Store 中的 address 持久化存储到本地</h3><p><code>store/user.js</code> 模块中的代码如下。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="comment">// 开启命名空间</span></span><br><span class="line">    <span class="attr">namespaced</span>: <span class="literal">true</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// state 数据</span></span><br><span class="line">    <span class="attr">state</span>: <span class="function">() =&gt;</span> (&#123;</span><br><span class="line">        <span class="comment">// #3 读取本地的收货地址数据，初始化 address 对象</span></span><br><span class="line">        <span class="attr">address</span>: <span class="built_in">JSON</span>.parse(uni.getStorageSync(<span class="string">&#x27;address&#x27;</span>) || <span class="string">&#x27;&#123;&#125;&#x27;</span>),</span><br><span class="line">    &#125;),</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 方法</span></span><br><span class="line">    <span class="attr">mutations</span>: &#123;</span><br><span class="line">        <span class="comment">// 更新收货地址</span></span><br><span class="line">        <span class="function"><span class="title">updateAddress</span>(<span class="params">state, address</span>)</span> &#123;</span><br><span class="line">            state.address = address</span><br><span class="line"></span><br><span class="line">            <span class="comment">// #2 通过 this.commit() 方法，调用 m_user 模块的 saveAddressToStorage 方法将 address 对象持久化存储到本地</span></span><br><span class="line">            <span class="built_in">this</span>.commit(<span class="string">&#x27;m_user/saveAddressToStorage&#x27;</span>)</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">// #1 定义将 address 持久化存储到本地 mutations 方法</span></span><br><span class="line">        <span class="function"><span class="title">saveAddressToStorage</span>(<span class="params">state</span>)</span> &#123;</span><br><span class="line">            uni.setStorageSync(<span class="string">&#x27;address&#x27;</span>, <span class="built_in">JSON</span>.stringify(state.address))</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 数据包装器</span></span><br><span class="line">    <span class="attr">getters</span>: &#123;&#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="将-addstr-抽离为-getters"><a href="#将-addstr-抽离为-getters" class="headerlink" title="将 addstr 抽离为 getters"></a>将 addstr 抽离为 getters</h3><p>目的：为了提高代码的复用性，可以把收货的详细地址抽离为 getters，方便在多个页面和组件之间实现复用。</p>
<ol>
<li>剪切 <code>my-address.vue</code> 组件中 addstr 计算属性代码，粘贴到 user.js 模块中，作为一个 getters 节点。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 数据包装器</span></span><br><span class="line"><span class="attr">getters</span>: &#123;</span><br><span class="line">    <span class="comment">// 收货详细地址的计算属性</span></span><br><span class="line">    <span class="function"><span class="title">addstr</span>(<span class="params">state</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!state.address.provinceName) <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line">        <span class="comment">// if(JSON.stringify(address) === &#x27;&#123;&#125;&#x27;) return &#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 拼接 省，市，区，详细地址 的字符串并返回给用户</span></span><br><span class="line">        <span class="keyword">return</span> state.address.provinceName + state.address.cityName + state.address.countyName + state.address.detailInfo</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>改造 <code>my-address.vue</code> 组件中的代码，通过 mapGetters 辅助函数，将 m_user 模块中的 addstr 映射到当前组件中使用。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 按需导入 mapGetters 辅助函数</span></span><br><span class="line"><span class="keyword">import</span> &#123; mapState, mapMutations, mapGetters &#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="comment">// 省略其它代码</span></span><br><span class="line">    <span class="attr">computed</span>: &#123;</span><br><span class="line">        ...mapState(<span class="string">&#x27;m_user&#x27;</span>, [<span class="string">&#x27;address&#x27;</span>]),</span><br><span class="line">        <span class="comment">// 将 m_user 模块中的 addstr 映射到当前组件中使用</span></span><br><span class="line">        ...mapGetters(<span class="string">&#x27;m_user&#x27;</span>, [<span class="string">&#x27;addstr&#x27;</span>]),</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="重新选择收货地址"><a href="#重新选择收货地址" class="headerlink" title="重新选择收货地址"></a>重新选择收货地址</h3><p>为 class 类名为 address-info-box 的盒子绑定 click 事件处理函数如下。</p>
<p><code>components/my-address/my-address.vue</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 渲染收货信息的盒子 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;address-info-box&quot;</span> <span class="attr">v-else</span> @<span class="attr">click</span>=<span class="string">&quot;chooseAddress&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- ...省略其它代码 --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="购物车列表区域"><a href="#购物车列表区域" class="headerlink" title="购物车列表区域"></a>购物车列表区域</h2><h3 id="渲染购物车商品列表的标题区域"><a href="#渲染购物车商品列表的标题区域" class="headerlink" title="渲染购物车商品列表的标题区域"></a>渲染购物车商品列表的标题区域</h3><ol>
<li>定义如下的 UI 结构，<code>pages/cart/cart.vue</code>。</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 购物车商品列表的标题区域 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;cart-title&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 左侧的图标 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">uni-icons</span> <span class="attr">type</span>=<span class="string">&quot;shop&quot;</span> <span class="attr">size</span>=<span class="string">&quot;18&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">uni-icons</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 描述文本 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;cart-title-text&quot;</span>&gt;</span>购物车<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>美化样式如下。</li>
</ol>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.cart-title</span> &#123;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">80</span>rpx;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">align-items</span>: center;</span><br><span class="line">    <span class="attribute">padding-left</span>: <span class="number">12</span>rpx;</span><br><span class="line">    <span class="attribute">border-bottom</span>: <span class="number">1px</span> solid <span class="number">#efefef</span>;</span><br><span class="line"></span><br><span class="line">    <span class="selector-class">.cart-title-text</span> &#123;</span><br><span class="line">        <span class="attribute">margin-left</span>: <span class="number">20</span>rpx;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="渲染商品列表区域的基本结构"><a href="#渲染商品列表区域的基本结构" class="headerlink" title="渲染商品列表区域的基本结构"></a>渲染商品列表区域的基本结构</h3><ol>
<li>通过 mapState 辅助函数，将 Store 中的 cart 数组映射到当前页面中使用。</li>
</ol>
<p><code>pages/cart/cart.vue</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> badgeMix <span class="keyword">from</span> <span class="string">&#x27;@/mixins/tabbar-badge.js&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// #1 按需导入 mapState 这个辅助函数</span></span><br><span class="line"><span class="keyword">import</span> &#123; mapState &#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="attr">mixins</span>: [badgeMix],</span><br><span class="line">    <span class="attr">computed</span>: &#123;</span><br><span class="line">        <span class="comment">// #2 将 m_cart 模块中的 cart 数组映射到当前页面中使用</span></span><br><span class="line">        ...mapState(<span class="string">&#x27;m_cart&#x27;</span>, [<span class="string">&#x27;cart&#x27;</span>]),</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;&#125;</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>在 UI 结构中，通过 v-for 指令循环渲染自定义的 my-goods 组件。</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 商品列表区域 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">block</span> <span class="attr">v-for</span>=<span class="string">&quot;(goods, i) in cart&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;i&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">my-goods</span> <span class="attr">:goods</span>=<span class="string">&quot;goods&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">my-goods</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">block</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="为-my-goods-组件封装-radio-勾选状态"><a href="#为-my-goods-组件封装-radio-勾选状态" class="headerlink" title="为 my-goods 组件封装 radio 勾选状态"></a>为 my-goods 组件封装 radio 勾选状态</h3><ol>
<li>打开 <code>components/my-goods/my-goods.vue</code> 组件的代码，为商品的左侧图片区域添加 radio 组件。</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 商品左侧图片区域 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;goods-item-left&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">radio</span> <span class="attr">checked</span> <span class="attr">color</span>=<span class="string">&quot;#C00000&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">radio</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">image</span> <span class="attr">:src</span>=<span class="string">&quot;goods.goods_small_logo || defaultPic&quot;</span> <span class="attr">class</span>=<span class="string">&quot;goods-pic&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>给类名为 goods-item-left 的 view 组件添加样式，实现 radio 组件和 image 组件的左右布局。</li>
</ol>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.goods-item-left</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">justify-content</span>: space-between;</span><br><span class="line">    <span class="attribute">align-items</span>: center;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* ... */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="通过-props-属性控制-radio-的显示"><a href="#通过-props-属性控制-radio-的显示" class="headerlink" title="通过 props 属性控制 radio 的显示"></a>通过 props 属性控制 radio 的显示</h3><ol>
<li>封装名称为 showRadio 的 props 属性，来控制当前组件中是否显示 radio 组件。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="comment">// 定义 props 属性，用来接收外界传递到当前组件的数据</span></span><br><span class="line">    <span class="attr">props</span>: &#123;</span><br><span class="line">        <span class="comment">// 商品的信息对象</span></span><br><span class="line">        <span class="attr">goods</span>: &#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="built_in">Object</span>,</span><br><span class="line">            <span class="attr">default</span>: &#123;&#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">// 是否展示图片左侧的 radio</span></span><br><span class="line">        <span class="attr">showRadio</span>: &#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="built_in">Boolean</span>,</span><br><span class="line">            <span class="comment">// 如果外界没有指定 show-radio 属性的值，则默认不展示 radio 组件</span></span><br><span class="line">            <span class="attr">default</span>: <span class="literal">false</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>使用 v-if 指令控制 radio 组件的按需展示。</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 商品左侧图片区域 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;goods-item-left&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 使用 v-if 指令控制 radio 组件的显示与隐藏 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">radio</span> <span class="attr">checked</span> <span class="attr">color</span>=<span class="string">&quot;#C00000&quot;</span> <span class="attr">v-if</span>=<span class="string">&quot;showRadio&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">radio</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">image</span> <span class="attr">:src</span>=<span class="string">&quot;goods.goods_small_logo || defaultPic&quot;</span> <span class="attr">class</span>=<span class="string">&quot;goods-pic&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>在 <code>cart.vue</code> 页面中的商品列表区域，指定 <code>:showRadio=&quot;true&quot;</code> 属性，从而显示 radio 组件。</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 商品列表区域 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">block</span> <span class="attr">v-for</span>=<span class="string">&quot;(goods, i) in cart&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;i&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">my-goods</span> <span class="attr">:goods</span>=<span class="string">&quot;goods&quot;</span> <span class="attr">:showRadio</span>=<span class="string">&quot;true&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">my-goods</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">block</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="动态绑定-radio-组件的值"><a href="#动态绑定-radio-组件的值" class="headerlink" title="动态绑定 radio 组件的值"></a>动态绑定 radio 组件的值</h3><p>修改 <code>my-goods.vue</code> 组件，动态为 radio 绑定选中状态。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 商品左侧图片区域 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;goods-item-left&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 存储在购物车中的商品，包含 goods_state 属性，表示商品的勾选状态 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">radio</span> <span class="attr">:checked</span>=<span class="string">&quot;goods.goods_state&quot;</span> <span class="attr">color</span>=<span class="string">&quot;#C00000&quot;</span> <span class="attr">v-if</span>=<span class="string">&quot;showRadio&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">radio</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">image</span> <span class="attr">:src</span>=<span class="string">&quot;goods.goods_small_logo || defaultPic&quot;</span> <span class="attr">class</span>=<span class="string">&quot;goods-pic&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="为-my-goods-自定义组件封装-radio-change-事件"><a href="#为-my-goods-自定义组件封装-radio-change-事件" class="headerlink" title="为 my-goods 自定义组件封装 radio-change 事件"></a>为 my-goods 自定义组件封装 radio-change 事件</h3><p>📝 需求：当用户点击 radio 组件，我们要修改当前商品的勾选状态。</p>
<ol>
<li>在父组件 <code>cart.vue</code> 中绑定 <code>@radio-change</code> 事件，在事件的回调中可以拿到子组件传递过来的信息（需要 goods_id 和 goods_state）。</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 商品列表区域 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">block</span> <span class="attr">v-for</span>=<span class="string">&quot;(goods, i) in cart&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;i&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 在 radioChangeHandler 事件处理函数中，通过事件对象 e，得到商品的 goods_id 和 goods_state --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">my-goods</span> <span class="attr">:goods</span>=<span class="string">&quot;goods&quot;</span> <span class="attr">:showRadio</span>=<span class="string">&quot;true&quot;</span> @<span class="attr">radio-change</span>=<span class="string">&quot;radioChangeHandler&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">my-goods</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">block</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">methods: &#123;</span><br><span class="line">    <span class="comment">// 商品的勾选状态发生了变化</span></span><br><span class="line">    <span class="function"><span class="title">radioChangeHandler</span>(<span class="params">e</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(e) <span class="comment">// 输出得到的数据 -&gt; &#123;goods_id: 395, goods_state: false&#125;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>在 <code>my-goods.vue</code> 自定义组件中，为 radio 组件绑定 @click 事件处理函数如下。</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 商品左侧图片区域 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;goods-item-left&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">radio</span> <span class="attr">:checked</span>=<span class="string">&quot;goods.goods_state&quot;</span> <span class="attr">color</span>=<span class="string">&quot;#C00000&quot;</span> <span class="attr">v-if</span>=<span class="string">&quot;showRadio&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;radioClickHandler&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">radio</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">image</span> <span class="attr">:src</span>=<span class="string">&quot;goods.goods_small_logo || defaultPic&quot;</span> <span class="attr">class</span>=<span class="string">&quot;goods-pic&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>处理函数回调中通过 this.$emit 触发父亲的自定义事件。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">methods: &#123;</span><br><span class="line">    <span class="comment">// radio 组件的点击事件处理函数</span></span><br><span class="line">    <span class="function"><span class="title">radioClickHandler</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// 通过 this.$emit() 触发外界通过 @ 绑定的 radio-change 事件，</span></span><br><span class="line">        <span class="comment">// 同时把商品的 Id 和 勾选状态 作为参数传递给 radio-change 事件处理函数</span></span><br><span class="line">        <span class="built_in">this</span>.$emit(<span class="string">&#x27;radio-change&#x27;</span>, &#123;</span><br><span class="line">            <span class="comment">// 商品的 Id</span></span><br><span class="line">            <span class="attr">goods_id</span>: <span class="built_in">this</span>.goods.goods_id,</span><br><span class="line">            <span class="comment">// 商品最新的勾选状态</span></span><br><span class="line">            <span class="attr">goods_state</span>: !<span class="built_in">this</span>.goods.goods_state</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="修改购物车中商品的勾选状态"><a href="#修改购物车中商品的勾选状态" class="headerlink" title="修改购物车中商品的勾选状态"></a>修改购物车中商品的勾选状态</h3><ol>
<li>在 <code>store/cart.js</code> 模块中，声明如下的 mutations 方法，用来修改对应商品的勾选状态。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 更新购物车中商品的勾选状态</span></span><br><span class="line"><span class="function"><span class="title">updateGoodsState</span>(<span class="params">state, goods</span>)</span> &#123;</span><br><span class="line">    <span class="comment">// 根据 goods_id 查询购物车中对应商品的信息对象</span></span><br><span class="line">    <span class="keyword">const</span> result = state.cart.find(<span class="function"><span class="params">item</span> =&gt;</span> item.goods_id === goods.goods_id)</span><br><span class="line">    <span class="comment">// 有对应的商品信息对象</span></span><br><span class="line">    <span class="keyword">if</span> (result) &#123;</span><br><span class="line">        <span class="comment">// 更新对应商品的勾选状态</span></span><br><span class="line">        result.goods_state = goods.goods_state</span><br><span class="line">        <span class="comment">// 持久化存储到本地</span></span><br><span class="line">        <span class="built_in">this</span>.commit(<span class="string">&#x27;m_cart/saveToStorage&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>在 <code>cart.vue</code> 页面中，导入 mapMutations 这个辅助函数，将需要的 mutations 方法映射到当前页面中。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; mapMutations &#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="attr">methods</span>: &#123;</span><br><span class="line">        ...mapMutations(<span class="string">&#x27;m_cart&#x27;</span>, [<span class="string">&#x27;updateGoodsState&#x27;</span>]),</span><br><span class="line">        <span class="comment">// 商品的勾选状态发生了变化</span></span><br><span class="line">        <span class="function"><span class="title">radioChangeHandler</span>(<span class="params">e</span>)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.updateGoodsState(e)</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="为-my-goods-组件封装-NumberBox"><a href="#为-my-goods-组件封装-NumberBox" class="headerlink" title="为 my-goods 组件封装 NumberBox"></a>为 my-goods 组件封装 NumberBox</h3><p><a target="_blank" rel="noopener" href="https://ext.dcloud.net.cn/plugin?id=31">NumberBox</a> 组件是 uni-ui 提供的。</p>
<ol>
<li>修改 <code>components/my-goods/my-goods.vue</code> 组件，在类名为 goods-item-right 的 view 组件内部渲染 NumberBox 组件的基本结构。</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;goods-info-box&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 商品价格 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;goods-price&quot;</span>&gt;</span>￥&#123;&#123;goods.goods_price | tofixed&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 商品数量 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">uni-number-box</span> <span class="attr">:min</span>=<span class="string">&quot;1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">uni-number-box</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>美化页面的结构。</li>
</ol>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.goods-item-right</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">flex</span>: <span class="number">1</span>;</span><br><span class="line">    <span class="attribute">flex-direction</span>: column;</span><br><span class="line">    <span class="attribute">justify-content</span>: space-between;</span><br><span class="line">    <span class="selector-class">.goods-name</span> &#123;</span><br><span class="line">        <span class="attribute">font-size</span>: <span class="number">13px</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="selector-class">.goods-info-box</span> &#123;</span><br><span class="line">        <span class="attribute">display</span>: flex;</span><br><span class="line">        <span class="attribute">align-items</span>: center;</span><br><span class="line">        <span class="attribute">justify-content</span>: space-between;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="selector-class">.goods-price</span> &#123;</span><br><span class="line">        <span class="attribute">font-size</span>: <span class="number">16px</span>;</span><br><span class="line">        <span class="attribute">color</span>: <span class="number">#c00000</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>在 <code>my-goods.vue</code> 组件中，动态为 NumberBox 组件绑定商品的数量值。</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;goods-info-box&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 商品价格 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;goods-price&quot;</span>&gt;</span>￥&#123;&#123;goods.goods_price | tofixed&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 商品数量 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">uni-number-box</span> <span class="attr">:min</span>=<span class="string">&quot;1&quot;</span> <span class="attr">:value</span>=<span class="string">&quot;goods.goods_count&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">uni-number-box</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="4">
<li>在 <code>my-goods.vue</code> 组件中，封装名称为 showNum 的 props 属性，来控制当前组件中是否显示 NumberBox 组件。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="comment">// 定义 props 属性，用来接收外界传递到当前组件的数据</span></span><br><span class="line">    <span class="attr">props</span>: &#123;</span><br><span class="line">        <span class="comment">// 商品的信息对象</span></span><br><span class="line">        <span class="attr">goods</span>: &#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="built_in">Object</span>,</span><br><span class="line">            <span class="attr">defaul</span>: &#123;&#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">// 是否展示图片左侧的 radio</span></span><br><span class="line">        <span class="attr">showRadio</span>: &#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="built_in">Boolean</span>,</span><br><span class="line">            <span class="comment">// 如果外界没有指定 show-radio 属性的值，则默认不展示 radio 组件</span></span><br><span class="line">            <span class="attr">default</span>: <span class="literal">false</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">// 是否展示价格右侧的 NumberBox 组件</span></span><br><span class="line">        <span class="attr">showNum</span>: &#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="built_in">Boolean</span>,</span><br><span class="line">            <span class="attr">default</span>: <span class="literal">false</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>在 <code>my-goods.vue</code> 组件中，使用 v-if 指令控制 NumberBox 组件的按需展示。</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;goods-info-box&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 商品价格 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;goods-price&quot;</span>&gt;</span>￥&#123;&#123;goods.goods_price | tofixed&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 商品数量 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">uni-number-box</span> <span class="attr">:min</span>=<span class="string">&quot;1&quot;</span> <span class="attr">:value</span>=<span class="string">&quot;goods.goods_count&quot;</span> <span class="attr">v-if</span>=<span class="string">&quot;showNum&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">uni-number-box</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="6">
<li>在 <code>cart.vue</code> 页面中的商品列表区域，指定 <code>:show-num=&quot;true&quot;</code> 属性，从而显示 NumberBox 组件。</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 商品列表区域 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">block</span> <span class="attr">v-for</span>=<span class="string">&quot;(goods, i) in cart&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;i&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">my-goods</span> <span class="attr">:goods</span>=<span class="string">&quot;goods&quot;</span> <span class="attr">:showRadio</span>=<span class="string">&quot;true&quot;</span> <span class="attr">:showNum</span>=<span class="string">&quot;true&quot;</span> @<span class="attr">radio-change</span>=<span class="string">&quot;radioChangeHandler&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">my-goods</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">block</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="为-my-goods-组件封装-num-change-事件"><a href="#为-my-goods-组件封装-num-change-事件" class="headerlink" title="为 my-goods 组件封装 num-change 事件"></a>为 my-goods 组件封装 num-change 事件</h3><p>📝 需求：当用户修改了 NumberBox 的值以后，希望将最新的商品数量更新到购物车中。</p>
<ol>
<li>此时我们在父组件 <code>cart.vue</code> 中为 my-goods 组件绑定 @num-change 事件，在事件回调中获取商品的 goods_id 和 goods_count。</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 商品列表区域 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">block</span> <span class="attr">v-for</span>=<span class="string">&quot;(goods, i) in cart&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;i&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">my-goods</span> @<span class="attr">num-change</span>=<span class="string">&quot;numberChangeHandler&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">my-goods</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">block</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 商品的数量发生了变化</span></span><br><span class="line"><span class="function"><span class="title">numberChangeHandler</span>(<span class="params">e</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(e)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>在 <code>components/my-goods/my-goods.vue</code> 组件中，为 uni-number-box 组件绑定 @change 事件处理函数如下。</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;goods-info-box&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 商品价格 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;goods-price&quot;</span>&gt;</span>￥&#123;&#123;goods.goods_price | tofixed&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 商品数量 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">uni-number-box</span> <span class="attr">:min</span>=<span class="string">&quot;1&quot;</span> <span class="attr">:value</span>=<span class="string">&quot;goods.goods_count&quot;</span> @<span class="attr">change</span>=<span class="string">&quot;numChangeHandler&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">uni-number-box</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>定义 numChangeHandler 事件处理函数。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">methods: &#123;</span><br><span class="line">    <span class="comment">// NumberBox 组件的 change 事件处理函数</span></span><br><span class="line">    <span class="function"><span class="title">numChangeHandler</span>(<span class="params">val</span>)</span> &#123;</span><br><span class="line">        <span class="comment">// 通过 this.$emit() 触发外界通过 @ 绑定的 num-change 事件</span></span><br><span class="line">        <span class="built_in">this</span>.$emit(<span class="string">&#x27;num-change&#x27;</span>, &#123;</span><br><span class="line">            <span class="comment">// 商品的 Id</span></span><br><span class="line">            <span class="attr">goods_id</span>: <span class="built_in">this</span>.goods.goods_id,</span><br><span class="line">            <span class="comment">// 商品的最新数量</span></span><br><span class="line">            <span class="attr">goods_count</span>: +val</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="修改购物车中商品的数量"><a href="#修改购物车中商品的数量" class="headerlink" title="修改购物车中商品的数量"></a>修改购物车中商品的数量</h3><ol>
<li>在 <code>store/cart.js</code> 模块中，声明如下的 mutations 方法，用来修改对应商品的数量。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 更新购物车中商品的数量</span></span><br><span class="line"><span class="function"><span class="title">updateGoodsCount</span>(<span class="params">state, goods</span>)</span> &#123;</span><br><span class="line">    <span class="comment">// 根据 goods_id 查询购物车中对应商品的信息对象</span></span><br><span class="line">    <span class="keyword">const</span> result = state.cart.find(<span class="function"><span class="params">item</span> =&gt;</span> item.goods_id === goods.goods_id)</span><br><span class="line">    <span class="keyword">if</span>(result) &#123;</span><br><span class="line">        <span class="comment">// 更新对应商品的数量</span></span><br><span class="line">        result.goods_count = goods.goods_count</span><br><span class="line">        <span class="comment">// 持久化存储到本地</span></span><br><span class="line">        <span class="built_in">this</span>.commit(<span class="string">&#x27;m_cart/saveToStorage&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>在 <code>cart.vue</code> 页面中，通过 mapMutations 这个辅助函数，将需要的 mutations 方法映射到当前页面中使用。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> badgeMix <span class="keyword">from</span> <span class="string">&#x27;@/mixins/tabbar-badge.js&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; mapState, mapMutations &#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="attr">mixins</span>: [badgeMix],</span><br><span class="line">    <span class="attr">computed</span>: &#123;</span><br><span class="line">        ...mapState(<span class="string">&#x27;m_cart&#x27;</span>, [<span class="string">&#x27;cart&#x27;</span>]),</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;&#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">methods</span>: &#123;</span><br><span class="line">        ...mapMutations(<span class="string">&#x27;m_cart&#x27;</span>, [<span class="string">&#x27;updateGoodsState&#x27;</span>, <span class="string">&#x27;updateGoodsCount&#x27;</span>]),</span><br><span class="line">        <span class="comment">// 商品的勾选状态发生了变化</span></span><br><span class="line">        <span class="function"><span class="title">radioChangeHandler</span>(<span class="params">e</span>)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.updateGoodsState(e)</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">// 商品的数量发生了变化</span></span><br><span class="line">        <span class="function"><span class="title">numberChangeHandler</span>(<span class="params">e</span>)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.updateGoodsCount(e)</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 可以解决：对购物车数量进行加减时购物车徽标不更新的问题</span></span><br><span class="line">            <span class="comment">// this.setBadge()</span></span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="动态计算购物车徽标的数值"><a href="#动态计算购物车徽标的数值" class="headerlink" title="动态计算购物车徽标的数值"></a>动态计算购物车徽标的数值</h3><ol>
<li><p>问题：当修改购物车中商品的数量之后，tabBar 上的数字徽标不会自动更新。</p>
</li>
<li><p>解决：改造 <code>mixins/tabbar-badge.js</code> 中的代码，使用 watch 侦听器，监听 total 总数量的变化，从而动态为 tabBar 的徽标赋值。</p>
</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; mapGetters &#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 导出一个 mixin 对象</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="attr">computed</span>: &#123;</span><br><span class="line">        ...mapGetters(<span class="string">&#x27;m_cart&#x27;</span>, [<span class="string">&#x27;total&#x27;</span>]),</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">watch</span>: &#123;</span><br><span class="line">        <span class="comment">// 监听 total 值的变化</span></span><br><span class="line">        <span class="function"><span class="title">total</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">            <span class="comment">// 调用 methods 中的 setBadge 方法，重新为 tabBar 的数字徽章赋值</span></span><br><span class="line">            <span class="built_in">this</span>.setBadge()</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="title">onShow</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// 在页面刚展示的时候，设置数字徽标</span></span><br><span class="line">        <span class="built_in">this</span>.setBadge()</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">methods</span>: &#123;</span><br><span class="line">        <span class="function"><span class="title">setBadge</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">            <span class="comment">// 调用 uni.setTabBarBadge() 方法，为购物车设置右上角的徽标</span></span><br><span class="line">            uni.setTabBarBadge(&#123;</span><br><span class="line">                <span class="attr">index</span>: <span class="number">2</span>,</span><br><span class="line">                <span class="attr">text</span>: <span class="built_in">this</span>.total + <span class="string">&#x27;&#x27;</span>, <span class="comment">// 注意：text 的值必须是字符串，不能是数字</span></span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="渲染滑动删除的-UI-效果"><a href="#渲染滑动删除的-UI-效果" class="headerlink" title="渲染滑动删除的 UI 效果"></a>渲染滑动删除的 UI 效果</h3><p>😀 滑动删除需要用到 uni-ui 的 uni-swipe-action 组件和 uni-swipe-action-item，<a target="_blank" rel="noopener" href="https://ext.dcloud.net.cn/plugin?id=181">详情地址</a>。</p>
<ol>
<li>改造 <code>cart.vue</code> 页面的 UI 结构，将商品列表区域的结构修改如下（可以使用 uSwipeAction 代码块快速生成基本的 UI 结构）。</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 商品列表区域 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- uni-swipe-action 是最外层包裹性质的容器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">uni-swipe-action</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">block</span> <span class="attr">v-for</span>=<span class="string">&quot;(goods, i) in cart&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;i&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- uni-swipe-action-item 可以为其子节点提供滑动操作的效果。需要通过 options 属性来指定操作按钮的配置信息 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">uni-swipe-action-item</span> <span class="attr">:rightOptions</span>=<span class="string">&quot;rightOptions&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;swipeActionClickHandler(goods)&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">my-goods</span> <span class="attr">:goods</span>=<span class="string">&quot;goods&quot;</span> <span class="attr">:show-radio</span>=<span class="string">&quot;true&quot;</span> <span class="attr">:show-num</span>=<span class="string">&quot;true&quot;</span> @<span class="attr">radio-change</span>=<span class="string">&quot;radioChangeHandler&quot;</span> @<span class="attr">num-change</span>=<span class="string">&quot;numberChangeHandler&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">my-goods</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">uni-swipe-action-item</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">block</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">uni-swipe-action</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>在 data 节点中声明 options 数组，用来定义操作按钮的配置信息。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">rightOptions</span>: [&#123;</span><br><span class="line">            <span class="attr">text</span>: <span class="string">&#x27;删除&#x27;</span>, <span class="comment">// 显示的文本内容</span></span><br><span class="line">            <span class="attr">style</span>: &#123;</span><br><span class="line">                <span class="attr">backgroundColor</span>: <span class="string">&#x27;#C00000&#x27;</span> <span class="comment">// 按钮的背景颜色</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>在 methods 中声明 uni-swipe-action-item 组件的 @click 事件处理函数。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 点击了滑动操作按钮</span></span><br><span class="line"><span class="function"><span class="title">swipeActionClickHandler</span>(<span class="params">goods</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(goods)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>美化 <code>my-goods.vue</code> 组件的样式。</li>
</ol>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.goods-item</span> &#123;</span><br><span class="line">    // 让 goods-item 项占满整个屏幕的宽度</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">750</span>rpx;</span><br><span class="line">    // 设置盒模型为 <span class="attribute">border</span>-box</span><br><span class="line">    <span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">10px</span> <span class="number">5px</span>;</span><br><span class="line">    <span class="attribute">border-bottom</span>: <span class="number">1px</span> solid <span class="number">#f0f0f0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>🤔 注意：如果不能出现滑动效果，重新启动小程序模拟器尝试。</p>
<h3 id="实现滑动删除的功能"><a href="#实现滑动删除的功能" class="headerlink" title="实现滑动删除的功能"></a>实现滑动删除的功能</h3><ol>
<li>在 <code>store/cart.js</code> 模块的 mutations 节点中声明如下的方法，从而根据商品的 Id 从购物车中移除对应的商品。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 根据 Id 从购物车中删除对应的商品信息</span></span><br><span class="line"><span class="function"><span class="title">removeGoodsById</span>(<span class="params">state, goods_id</span>)</span> &#123;</span><br><span class="line">    <span class="comment">// 调用数组的 filter 方法进行过滤</span></span><br><span class="line">    state.cart = state.cart.filter(<span class="function"><span class="params">x</span> =&gt;</span> x.goods_id !== goods_id)</span><br><span class="line">    <span class="comment">// 持久化存储到本地</span></span><br><span class="line">    <span class="built_in">this</span>.commit(<span class="string">&#x27;m_cart/saveToStorage&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>在 <code>cart.vue</code> 页面中，使用 mapMutations 辅助函数，把需要的方法映射到当前页面中使用。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">methods: &#123;</span><br><span class="line">    ...mapMutations(<span class="string">&#x27;m_cart&#x27;</span>, [<span class="string">&#x27;updateGoodsState&#x27;</span>, <span class="string">&#x27;updateGoodsCount&#x27;</span>, <span class="string">&#x27;removeGoodsById&#x27;</span>]),</span><br><span class="line">    <span class="comment">// 商品的勾选状态发生了变化</span></span><br><span class="line">    <span class="function"><span class="title">radioChangeHandler</span>(<span class="params">e</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.updateGoodsState(e)</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 商品的数量发生了变化</span></span><br><span class="line">    <span class="function"><span class="title">numberChangeHandler</span>(<span class="params">e</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.updateGoodsCount(e)</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 点击了滑动操作按钮</span></span><br><span class="line">    <span class="function"><span class="title">swipeActionClickHandler</span>(<span class="params">goods</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.removeGoodsById(goods.goods_id)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="结算区域"><a href="#结算区域" class="headerlink" title="结算区域"></a>结算区域</h2><h3 id="把结算区域封装为组件"><a href="#把结算区域封装为组件" class="headerlink" title="把结算区域封装为组件"></a>把结算区域封装为组件</h3><ol>
<li>在 components 目录中，新建 my-settle 结算组件。</li>
</ol>
<img src="/resource/images/9-4.1739d570.png"/>

<ol start="2">
<li>初始化 my-settle 组件的基本结构和样式。</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 最外层的容器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;my-settle-container&quot;</span>&gt;</span> 结算组件 <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">return</span> &#123;&#125;</span></span><br><span class="line"><span class="javascript">        &#125;,</span></span><br><span class="line"><span class="javascript">    &#125;</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">lang</span>=<span class="string">&quot;scss&quot;</span>&gt;</span><span class="css"></span></span><br><span class="line"><span class="css">    <span class="selector-class">.my-settle-container</span> &#123;</span></span><br><span class="line"><span class="css">        <span class="comment">/* 底部固定定位 */</span></span></span><br><span class="line"><span class="css">        <span class="attribute">position</span>: fixed;</span></span><br><span class="line"><span class="css">        <span class="attribute">bottom</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">left</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="css">        <span class="comment">/* 设置宽高和背景色 */</span></span></span><br><span class="line"><span class="css">        <span class="attribute">width</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">height</span>: <span class="number">50px</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">background-color</span>: cyan;</span></span><br><span class="line"><span class="css">    &#125;</span></span><br><span class="line"><span class="css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>在 <code>cart.vue</code> 页面中使用自定义的 my-settle 组件，并美化页面样式，防止页面底部被覆盖。</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;cart-container&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 使用自定义的 address 组件 --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 购物车商品列表的标题区域 --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 商品列表区域 --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 结算区域 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">my-settle</span>&gt;</span><span class="tag">&lt;/<span class="name">my-settle</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">lang</span>=<span class="string">&quot;scss&quot;</span>&gt;</span><span class="css"></span></span><br><span class="line"><span class="css">    page &#123;</span></span><br><span class="line"><span class="css">        <span class="attribute">height</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="css">    &#125;</span></span><br><span class="line"><span class="css"></span></span><br><span class="line"><span class="css">    <span class="selector-class">.cart-container</span> &#123;</span></span><br><span class="line"><span class="css">        <span class="attribute">background-color</span>: white;</span></span><br><span class="line"><span class="css">        <span class="attribute">height</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">padding-bottom</span>: <span class="number">50px</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">box-sizing</span>: border-box;</span></span><br><span class="line"><span class="css">    &#125;</span></span><br><span class="line"><span class="css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="渲染结算区域的结构和样式"><a href="#渲染结算区域的结构和样式" class="headerlink" title="渲染结算区域的结构和样式"></a>渲染结算区域的结构和样式</h3><ol>
<li>定义如下的 UI 结构，<code>components/my-settle/my-settle.vue</code>。</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 最外层的容器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;my-settle-container&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 全选区域 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">&quot;radio&quot;</span>&gt;</span> <span class="tag">&lt;<span class="name">radio</span> <span class="attr">color</span>=<span class="string">&quot;#C00000&quot;</span> <span class="attr">:checked</span>=<span class="string">&quot;true&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">text</span>&gt;</span>全选<span class="tag">&lt;/<span class="name">text</span>&gt;</span> <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 合计区域 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;amount-box&quot;</span>&gt;</span> 合计:<span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;amount&quot;</span>&gt;</span>￥1234.00<span class="tag">&lt;/<span class="name">text</span>&gt;</span> <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 结算区域 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;btn-settle&quot;</span>&gt;</span>结算(0)<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>美化样式如下。</li>
</ol>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.my-settle-container</span> &#123;</span><br><span class="line">    <span class="comment">/* 底部固定定位 */</span></span><br><span class="line">    <span class="attribute">position</span>: fixed;</span><br><span class="line">    <span class="attribute">bottom</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="comment">/* 设置宽高和背景色 */</span></span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">50px</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: white; // 将背景色从 cyan 改为 white</span><br><span class="line"></span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">justify-content</span>: space-between;</span><br><span class="line">    <span class="attribute">align-items</span>: center;</span><br><span class="line">    <span class="attribute">padding-left</span>: <span class="number">5px</span>;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">14px</span>;</span><br><span class="line"></span><br><span class="line">    <span class="selector-class">.radio</span> &#123;</span><br><span class="line">        <span class="attribute">display</span>: flex;</span><br><span class="line">        <span class="attribute">align-items</span>: center;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="selector-class">.amount-box</span> &#123;</span><br><span class="line">        <span class="selector-class">.amount</span> &#123;</span><br><span class="line">            <span class="attribute">color</span>: <span class="number">#c00000</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="selector-class">.btn-settle</span> &#123;</span><br><span class="line">        <span class="attribute">height</span>: <span class="number">50px</span>;</span><br><span class="line">        <span class="attribute">min-width</span>: <span class="number">100px</span>;</span><br><span class="line">        <span class="attribute">background-color</span>: <span class="number">#c00000</span>;</span><br><span class="line">        <span class="attribute">color</span>: white;</span><br><span class="line">        <span class="attribute">line-height</span>: <span class="number">50px</span>;</span><br><span class="line">        <span class="attribute">text-align</span>: center;</span><br><span class="line">        <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">10px</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="动态渲染已勾选商品的总数量"><a href="#动态渲染已勾选商品的总数量" class="headerlink" title="动态渲染已勾选商品的总数量"></a>动态渲染已勾选商品的总数量</h3><ol>
<li>在 <code>store/cart.js</code> 模块中，定义一个名称为 checkedCount 的 getters，用来统计已勾选商品的总数量。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 勾选的商品的总数量</span></span><br><span class="line"><span class="function"><span class="title">checkedCount</span>(<span class="params">state</span>)</span> &#123;</span><br><span class="line">    <span class="comment">// 先使用 filter 方法，从购物车中过滤出已勾选的商品</span></span><br><span class="line">    <span class="comment">// 再使用 reduce 方法，将已勾选的商品总数量进行累加</span></span><br><span class="line">    <span class="comment">// reduce() 的返回值就是已勾选的商品的总数量</span></span><br><span class="line">    <span class="keyword">return</span> state.cart.filter(<span class="function"><span class="params">item</span> =&gt;</span> item.goods_state)</span><br><span class="line">        .reduce(<span class="function">(<span class="params">total, item</span>) =&gt;</span> total += item.goods_count, <span class="number">0</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>在 my-settle 组件中，通过 mapGetters 辅助函数，将需要的 getters 映射到当前组件中使用。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; mapGetters &#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="attr">computed</span>: &#123;</span><br><span class="line">        ...mapGetters(<span class="string">&#x27;m_cart&#x27;</span>, [<span class="string">&#x27;checkedCount&#x27;</span>]),</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;&#125;</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>将 checkedCount 的值渲染到页面中。</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 结算按钮 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;btn-settle&quot;</span>&gt;</span>结算(&#123;&#123;checkedCount&#125;&#125;)<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="动态渲染全选按钮的选中状态"><a href="#动态渲染全选按钮的选中状态" class="headerlink" title="动态渲染全选按钮的选中状态"></a>动态渲染全选按钮的选中状态</h3><ol>
<li>使用 mapGetters 辅助函数，将商品的总数量映射到当前组件中使用，并定义一个叫做 isFullCheck 的计算属性。</li>
</ol>
<p><code>components/my-settle/my-settle.vue</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; mapGetters &#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="attr">computed</span>: &#123;</span><br><span class="line">        <span class="comment">// 1. 将 total 映射到当前组件中</span></span><br><span class="line">        ...mapGetters(<span class="string">&#x27;m_cart&#x27;</span>, [<span class="string">&#x27;checkedCount&#x27;</span>, <span class="string">&#x27;total&#x27;</span>]),</span><br><span class="line">        <span class="comment">// 2. 是否全选</span></span><br><span class="line">        <span class="function"><span class="title">isFullCheck</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>.total === <span class="built_in">this</span>.checkedCount</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;&#125;</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>为 radio 组件动态绑定 checked 属性的值。</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 全选区域 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">&quot;radio&quot;</span>&gt;</span> <span class="tag">&lt;<span class="name">radio</span> <span class="attr">color</span>=<span class="string">&quot;#C00000&quot;</span> <span class="attr">:checked</span>=<span class="string">&quot;isFullCheck&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">text</span>&gt;</span>全选<span class="tag">&lt;/<span class="name">text</span>&gt;</span> <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="实现商品的全选-反选功能"><a href="#实现商品的全选-反选功能" class="headerlink" title="实现商品的全选/反选功能"></a>实现商品的全选/反选功能</h3><ol>
<li>在 <code>store/cart.js</code> 模块中，定义一个叫做 updateAllGoodsState 的 mutations 方法，用来修改所有商品的勾选状态。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 更新所有商品的勾选状态</span></span><br><span class="line"><span class="function"><span class="title">updateAllGoodsState</span>(<span class="params">state, newState</span>)</span> &#123;</span><br><span class="line">    <span class="comment">// 循环更新购物车中每件商品的勾选状态</span></span><br><span class="line">    state.cart.forEach(<span class="function"><span class="params">item</span> =&gt;</span> item.goods_state = newState)</span><br><span class="line">    <span class="comment">// 持久化存储到本地</span></span><br><span class="line">    <span class="built_in">this</span>.commit(<span class="string">&#x27;m_cart/saveToStorage&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>在 my-settle 组件中，通过 mapMutations 辅助函数，将需要的 mutations 方法映射到当前组件中使用。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 按需导入 mapMutations 辅助函数</span></span><br><span class="line"><span class="keyword">import</span> &#123; mapGetters, mapMutations &#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="comment">// 省略其它代码</span></span><br><span class="line">    <span class="attr">methods</span>: &#123;</span><br><span class="line">        <span class="comment">// 2. 使用 mapMutations 辅助函数，把 m_cart 模块提供的 updateAllGoodsState 方法映射到当前组件中使用</span></span><br><span class="line">        ...mapMutations(<span class="string">&#x27;m_cart&#x27;</span>, [<span class="string">&#x27;updateAllGoodsState&#x27;</span>]),</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>为 UI 中的 label 组件绑定 click 事件处理函数。</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 全选区域 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">&quot;radio&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;changeAllState&quot;</span>&gt;</span> <span class="tag">&lt;<span class="name">radio</span> <span class="attr">color</span>=<span class="string">&quot;#C00000&quot;</span> <span class="attr">:checked</span>=<span class="string">&quot;isFullCheck&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">text</span>&gt;</span>全选<span class="tag">&lt;/<span class="name">text</span>&gt;</span> <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="4">
<li>在 my-settle 组件的 methods 节点中，声明 changeAllState 事件处理函数。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">methods: &#123;</span><br><span class="line">    ...mapMutations(<span class="string">&#x27;m_cart&#x27;</span>, [<span class="string">&#x27;updateAllGoodsState&#x27;</span>]),</span><br><span class="line">    <span class="comment">// label 的点击事件处理函数</span></span><br><span class="line">    <span class="function"><span class="title">changeAllState</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// 修改购物车中所有商品的选中状态</span></span><br><span class="line">        <span class="comment">// !this.isFullCheck 表示：当前全选按钮的状态取反之后，就是最新的勾选状态</span></span><br><span class="line">        <span class="built_in">this</span>.updateAllGoodsState(!<span class="built_in">this</span>.isFullCheck)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="动态渲染已勾选商品的总价格"><a href="#动态渲染已勾选商品的总价格" class="headerlink" title="动态渲染已勾选商品的总价格"></a>动态渲染已勾选商品的总价格</h3><ol>
<li>在 <code>store/cart.js</code> 模块中，定义一个叫做 checkedGoodsAmount 的 getters，用来统计已勾选商品的总价格。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 已勾选的商品的总价</span></span><br><span class="line"><span class="function"><span class="title">checkedGoodsAmount</span>(<span class="params">state</span>)</span> &#123;</span><br><span class="line">    <span class="comment">// 先使用 filter 方法，从购物车中过滤器已勾选的商品</span></span><br><span class="line">    <span class="comment">// 再使用 reduce 方法，将已勾选的商品数量 * 单价之后，进行累加</span></span><br><span class="line">    <span class="comment">// reduce() 的返回值就是已勾选的商品的总价</span></span><br><span class="line">    <span class="comment">// 最后调用 toFixed(2) 方法，保留两位小数</span></span><br><span class="line">    <span class="keyword">return</span> state.cart.filter(<span class="function"><span class="params">x</span> =&gt;</span> x.goods_state)</span><br><span class="line">        .reduce(<span class="function">(<span class="params">total, item</span>) =&gt;</span> total += item.goods_count * item.goods_price, <span class="number">0</span>)</span><br><span class="line">        .toFixed(<span class="number">2</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>在 my-settle 组件中，使用 mapGetters 辅助函数，把需要的 checkedGoodsAmount 映射到当前组件中使用。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">...mapGetters(<span class="string">&#x27;m_cart&#x27;</span>, [<span class="string">&#x27;total&#x27;</span>, <span class="string">&#x27;checkedCount&#x27;</span>, <span class="string">&#x27;checkedGoodsAmount&#x27;</span>])</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>在组件的 UI 结构中，渲染已勾选的商品的总价。</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 合计区域 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;amount-box&quot;</span>&gt;</span> 合计:<span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;amount&quot;</span>&gt;</span>￥&#123;&#123;checkedGoodsAmount&#125;&#125;<span class="tag">&lt;/<span class="name">text</span>&gt;</span> <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="渲染购物车为空时的页面结构"><a href="#渲染购物车为空时的页面结构" class="headerlink" title="渲染购物车为空时的页面结构"></a>渲染购物车为空时的页面结构</h3><ol>
<li><p>将资料中的 <a href="mailto:&#99;&#97;&#x72;&#116;&#x5f;&#x65;&#x6d;&#x70;&#116;&#x79;&#64;&#50;&#x78;&#x2e;&#112;&#x6e;&#103;">&#99;&#97;&#x72;&#116;&#x5f;&#x65;&#x6d;&#x70;&#116;&#x79;&#64;&#50;&#x78;&#x2e;&#112;&#x6e;&#103;</a> 图片复制到项目的 /static/ 目录中。</p>
</li>
<li><p>改造 cart.vue 页面的 UI 结构，使用 v-if 和 v-else 控制购物车区域和空白购物车区域的按需展示。</p>
</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;cart-container&quot;</span> <span class="attr">v-if</span>=<span class="string">&quot;cart.length !== 0&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 使用自定义的 address 组件 --&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 购物车商品列表的标题区域 --&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 商品列表区域 --&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 结算区域 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 空白购物车区域 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;empty-cart&quot;</span> <span class="attr">v-else</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">image</span> <span class="attr">src</span>=<span class="string">&quot;/static/cart_empty@2x.png&quot;</span> <span class="attr">class</span>=<span class="string">&quot;empty-img&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;tip-text&quot;</span>&gt;</span>空空如也~<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>美化空白购物车区域的样式如下。</li>
</ol>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.empty-cart</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">flex-direction</span>: column;</span><br><span class="line">    <span class="attribute">align-items</span>: center;</span><br><span class="line">    <span class="attribute">padding-top</span>: <span class="number">150px</span>;</span><br><span class="line"></span><br><span class="line">    <span class="selector-class">.empty-img</span> &#123;</span><br><span class="line">        <span class="attribute">width</span>: <span class="number">90px</span>;</span><br><span class="line">        <span class="attribute">height</span>: <span class="number">90px</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="selector-class">.tip-text</span> &#123;</span><br><span class="line">        <span class="attribute">font-size</span>: <span class="number">12px</span>;</span><br><span class="line">        <span class="attribute">color</span>: gray;</span><br><span class="line">        <span class="attribute">margin-top</span>: <span class="number">15px</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="登录和支付"><a href="#登录和支付" class="headerlink" title="登录和支付"></a>登录和支付</h1><h2 id="登录支付演示"><a href="#登录支付演示" class="headerlink" title="登录支付演示"></a>登录支付演示</h2><h2 id="需求分析总结-2"><a href="#需求分析总结-2" class="headerlink" title="需求分析总结"></a>需求分析总结</h2><ol>
<li><p>结算条件判断。</p>
</li>
<li><p>未登录状态下点击结算弹出 3 秒倒计时跳转登录页提示。</p>
</li>
<li><p>登录页面登录成功后自动跳转回购物车结算页面。</p>
</li>
<li><p>获取微信用户信息、微信登录、微信支付 API 的调用。</p>
</li>
<li><p>黑马优购登录、创建订单、预支付等 API 的调用。</p>
</li>
</ol>
<h2 id="点击结算按钮功能实现"><a href="#点击结算按钮功能实现" class="headerlink" title="点击结算按钮功能实现"></a>点击结算按钮功能实现</h2><p>🤔 结算条件如下。</p>
<ul>
<li><p>  是否勾选了至少一件要结算的商品。</p>
</li>
<li><p>  是否选择了收货地址。</p>
</li>
<li><p>  是否登录。</p>
</li>
<li><p>  当前组件内缺少的判断数据：收获地址、是否登录（token）。</p>
</li>
</ul>
<ol>
<li>在 <code>my-settle.vue</code> 组件中，使用 mapGetters 辅助函数，从 m_user 模块中将 addstr 属性映射到当前组件。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="attr">computed</span>: &#123;</span><br><span class="line">        ...mapGetters(<span class="string">&#x27;m_cart&#x27;</span>, [<span class="string">&#x27;total&#x27;</span>, <span class="string">&#x27;checkedCount&#x27;</span>, <span class="string">&#x27;checkedGoodsAmount&#x27;</span>]),</span><br><span class="line">        <span class="comment">// #mark addstr 是详细的收货地址</span></span><br><span class="line">        ...mapGetters(<span class="string">&#x27;m_user&#x27;</span>, [<span class="string">&#x27;addstr&#x27;</span>]),</span><br><span class="line">        <span class="function"><span class="title">isFullCheck</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>.total === <span class="built_in">this</span>.checkedCount</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>在 <code>store/user.js</code> 模块的 state 节点中，声明表示用户是否登录的 token 字符串。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="comment">// 开启命名空间</span></span><br><span class="line">    <span class="attr">namespaced</span>: <span class="literal">true</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// state 数据</span></span><br><span class="line">    <span class="attr">state</span>: <span class="function">() =&gt;</span> (&#123;</span><br><span class="line">        <span class="comment">// 收货地址</span></span><br><span class="line">        <span class="attr">address</span>: <span class="built_in">JSON</span>.parse(uni.getStorageSync(<span class="string">&#x27;address&#x27;</span>) || <span class="string">&#x27;&#123;&#125;&#x27;</span>),</span><br><span class="line">        <span class="comment">// 登录成功之后的 token 字符串</span></span><br><span class="line">        <span class="attr">token</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    &#125;),</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...省略其它代码</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>在 <code>my-settle.vue</code> 组件中，使用 mapState 辅助函数，从 m_user 模块中将 token 映射到当前组件中使用。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 按需从 vuex 中导入 mapState 辅助函数</span></span><br><span class="line"><span class="keyword">import</span> &#123; mapGetters, mapMutations, mapState &#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="attr">computed</span>: &#123;</span><br><span class="line">        ...mapGetters(<span class="string">&#x27;m_cart&#x27;</span>, [<span class="string">&#x27;total&#x27;</span>, <span class="string">&#x27;checkedCount&#x27;</span>, <span class="string">&#x27;checkedGoodsAmount&#x27;</span>]),</span><br><span class="line">        ...mapGetters(<span class="string">&#x27;m_user&#x27;</span>, [<span class="string">&#x27;addstr&#x27;</span>]),</span><br><span class="line">        <span class="comment">// token 是用户登录成功之后的 token 字符串</span></span><br><span class="line">        ...mapState(<span class="string">&#x27;m_user&#x27;</span>, [<span class="string">&#x27;token&#x27;</span>]),</span><br><span class="line">        <span class="function"><span class="title">isFullCheck</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>.total === <span class="built_in">this</span>.checkedCount</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>在 <code>my-settle.vue</code> 组件中，为结算按钮绑定点击事件处理函数。</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 结算按钮 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;btn-settle&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;settlement&quot;</span>&gt;</span>结算(&#123;&#123;checkedCount&#125;&#125;)<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 点击了结算按钮</span></span><br><span class="line"><span class="function"><span class="title">settlement</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="comment">// #1 先判断是否勾选了要结算的商品</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.checkedCount === <span class="number">0</span>) <span class="keyword">return</span> uni.$showMsg(<span class="string">&#x27;请选择要结算的商品！&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// #2 再判断用户是否选择了收货地址</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">this</span>.addstr) <span class="keyword">return</span> uni.$showMsg(<span class="string">&#x27;请选择收货地址！&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// #3 最后判断用户是否登录了</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">this</span>.token) <span class="keyword">return</span> uni.$showMsg(<span class="string">&#x27;请先登录！&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="创建登录和个人信息自定义组件"><a href="#创建登录和个人信息自定义组件" class="headerlink" title="创建登录和个人信息自定义组件"></a>创建登录和个人信息自定义组件</h2><h3 id="定义-my-页面的编译模式"><a href="#定义-my-页面的编译模式" class="headerlink" title="定义 my 页面的编译模式"></a>定义 my 页面的编译模式</h3><h3 id="创建登录和用户信息组件，并实现根据是否登录的条件渲染"><a href="#创建登录和用户信息组件，并实现根据是否登录的条件渲染" class="headerlink" title="创建登录和用户信息组件，并实现根据是否登录的条件渲染"></a>创建登录和用户信息组件，并实现根据是否登录的条件渲染</h3><ol>
<li>在 components 目录中新建登录组件。</li>
</ol>
<img src="/resource/images/10-1.46e30c32.png"/>

<ol start="2">
<li>在 components 目录中新建用户信息组件。</li>
</ol>
<img src="/resource/images/10-2.ace63114.png"/>

<ol start="3">
<li>在 <code>my.vue</code> 页面中，通过 mapState 辅助函数，导入 user 模块中的 token 字符串。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> badgeMix <span class="keyword">from</span> <span class="string">&#x27;@/mixins/tabbar-badge.js&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// #1 从 vuex 中按需导入 mapState 辅助函数</span></span><br><span class="line"><span class="keyword">import</span> &#123; mapState &#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="attr">mixins</span>: [badgeMix],</span><br><span class="line">    <span class="attr">computed</span>: &#123;</span><br><span class="line">        <span class="comment">// #2 从 m_user 模块中导入需要的 token 字符串</span></span><br><span class="line">        ...mapState(<span class="string">&#x27;m_user&#x27;</span>, [<span class="string">&#x27;token&#x27;</span>]),</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;&#125;</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>根据 token，按需展示【登录组件】和【用户信息组件】。</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 用户未登录时，显示登录组件 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">my-login</span> <span class="attr">v-if</span>=<span class="string">&quot;!token&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">my-login</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 用户登录后，显示用户信息组件 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">my-userinfo</span> <span class="attr">v-else</span>&gt;</span><span class="tag">&lt;/<span class="name">my-userinfo</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="登录组件布局"><a href="#登录组件布局" class="headerlink" title="登录组件布局"></a>登录组件布局</h2><ol>
<li>为 <code>my-login.vue</code> 组件定义如下的 UI 结构。</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;login-container&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 提示登录的图标 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">uni-icons</span> <span class="attr">type</span>=<span class="string">&quot;contact-filled&quot;</span> <span class="attr">size</span>=<span class="string">&quot;100&quot;</span> <span class="attr">color</span>=<span class="string">&quot;#AFAFAF&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">uni-icons</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 登录按钮 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn-login&quot;</span>&gt;</span>一键登录<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 登录提示 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;login-tips&quot;</span>&gt;</span>登录后尽享更多权益<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>美化登录组件的样式如下。</li>
</ol>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.login-container</span> &#123;</span><br><span class="line">    // 登录盒子的样式</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">750</span>rpx;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">flex-direction</span>: column;</span><br><span class="line">    <span class="attribute">align-items</span>: center;</span><br><span class="line">    <span class="attribute">justify-content</span>: center;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#f8f8f8</span>;</span><br><span class="line">    <span class="attribute">position</span>: relative;</span><br><span class="line">    <span class="attribute">overflow</span>: hidden;</span><br><span class="line"></span><br><span class="line">    // 绘制登录盒子底部的半椭圆造型</span><br><span class="line">    &amp;<span class="selector-pseudo">::after</span> &#123;</span><br><span class="line">        <span class="attribute">content</span>: <span class="string">&#x27; &#x27;</span>;</span><br><span class="line">        <span class="attribute">display</span>: block;</span><br><span class="line">        <span class="attribute">position</span>: absolute;</span><br><span class="line">        <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">        <span class="attribute">height</span>: <span class="number">40px</span>;</span><br><span class="line">        <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">        <span class="attribute">bottom</span>: <span class="number">0</span>;</span><br><span class="line">        <span class="attribute">background-color</span>: white;</span><br><span class="line">        <span class="attribute">border-radius</span>: <span class="number">100%</span>;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translateY</span>(<span class="number">50%</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 登录按钮的样式</span><br><span class="line">    <span class="selector-class">.btn-login</span> &#123;</span><br><span class="line">        <span class="attribute">width</span>: <span class="number">90%</span>;</span><br><span class="line">        <span class="attribute">border-radius</span>: <span class="number">100px</span>;</span><br><span class="line">        <span class="attribute">margin</span>: <span class="number">15px</span> <span class="number">0</span>;</span><br><span class="line">        <span class="attribute">background-color</span>: <span class="number">#c00000</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 按钮下方提示消息的样式</span><br><span class="line">    <span class="selector-class">.login-tips</span> &#123;</span><br><span class="line">        <span class="attribute">font-size</span>: <span class="number">12px</span>;</span><br><span class="line">        <span class="attribute">color</span>: gray;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="登录功能实现"><a href="#登录功能实现" class="headerlink" title="登录功能实现"></a>登录功能实现</h2><p><a target="_blank" rel="noopener" href="https://www.showdoc.com.cn/128719739414963/2612400282844951">https://www.showdoc.com.cn/128719739414963/2612400282844951</a></p>
<h3 id="点击登录按钮获取微信用户的基本信息"><a href="#点击登录按钮获取微信用户的基本信息" class="headerlink" title="点击登录按钮获取微信用户的基本信息"></a>点击登录按钮获取微信用户的基本信息</h3><p>📝 需求：需要获取微信用户的头像、昵称等基本信息。</p>
<ol>
<li>为登录的 button 按钮绑定点击事件，<code>components/my-login/my-login.vue</code>。</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 登录按钮 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn-login&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;getUserProfile&quot;</span>&gt;</span>一键登录<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>在 methods 节点中声明 <a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/api/open-api/user-info/wx.getUserProfile.html">getUserProfile</a> 事件处理函数如下。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">methods: &#123;</span><br><span class="line">    <span class="keyword">async</span> getUserProfile () &#123;</span><br><span class="line">        <span class="comment">// desc 为必填字段，用于声明获取用户个人信息后的用途，不超过30个字符</span></span><br><span class="line">        <span class="keyword">const</span> [err, res] = <span class="keyword">await</span> uni.getUserProfile(&#123;<span class="attr">desc</span>: <span class="string">&#x27;完善个人资料&#x27;</span>&#125;)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 用户拒绝授权</span></span><br><span class="line">        <span class="keyword">if</span> (err) <span class="keyword">return</span> uni.$showMsg(<span class="string">&#x27;您拒绝授权！&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 用户同意授权，保存用户信息</span></span><br><span class="line">        <span class="built_in">console</span>.log(res)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="保存微信用户的基本信息到-vuex-中"><a href="#保存微信用户的基本信息到-vuex-中" class="headerlink" title="保存微信用户的基本信息到 vuex 中"></a>保存微信用户的基本信息到 vuex 中</h3><ol>
<li>在 <code>store/user.js</code> 模块的 mutations 节点中，声明如下的两个方法。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 方法</span></span><br><span class="line"><span class="attr">mutations</span>: &#123;</span><br><span class="line">    <span class="comment">// 省略其它代码...</span></span><br><span class="line">    <span class="comment">// 更新用户的基本信息</span></span><br><span class="line">    <span class="function"><span class="title">saveUserInfo</span>(<span class="params">state, userinfo</span>)</span> &#123;</span><br><span class="line">        state.userinfo = userinfo</span><br><span class="line">        <span class="comment">// 通过 this.commit() 方法，调用 m_user 模块下的 saveUserInfoToStorage 方法，将 userinfo 对象持久化存储到本地</span></span><br><span class="line">        <span class="built_in">this</span>.commit(<span class="string">&#x27;m_user/saveUserInfoToStorage&#x27;</span>)</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将 userinfo 持久化存储到本地</span></span><br><span class="line">    <span class="function"><span class="title">saveUserInfoToStorage</span>(<span class="params">state</span>)</span> &#123;</span><br><span class="line">        uni.setStorageSync(<span class="string">&#x27;userinfo&#x27;</span>, <span class="built_in">JSON</span>.stringify(state.userinfo))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>在 <code>store/user.js</code> 模块的 state 节点中，声明 userinfo 的信息对象如下。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// state 数据</span></span><br><span class="line"><span class="attr">state</span>: <span class="function">() =&gt;</span> (&#123;</span><br><span class="line">    <span class="comment">// 收货地址</span></span><br><span class="line">    <span class="comment">// address: &#123;&#125;</span></span><br><span class="line">    <span class="attr">address</span>: <span class="built_in">JSON</span>.parse(uni.getStorageSync(<span class="string">&#x27;address&#x27;</span>) || <span class="string">&#x27;&#123;&#125;&#x27;</span>),</span><br><span class="line">    <span class="comment">// 登录成功之后的 token 字符串</span></span><br><span class="line">    <span class="attr">token</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    <span class="comment">// 用户的基本信息</span></span><br><span class="line">    <span class="attr">userinfo</span>: <span class="built_in">JSON</span>.parse(uni.getStorageSync(<span class="string">&#x27;userinfo&#x27;</span>) || <span class="string">&#x27;&#123;&#125;&#x27;</span>)</span><br><span class="line">&#125;),</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>使用 mapMutations 辅助函数，将需要的方法映射到 <code>my-login.vue</code> 组件中使用。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// #1 按需导入 mapMutations 辅助函数</span></span><br><span class="line"><span class="keyword">import</span> &#123; mapMutations &#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;&#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">methods</span>: &#123;</span><br><span class="line">        <span class="comment">// #2 调用 mapMutations 辅助方法，把 m_user 模块中的 saveUserInfo 映射到当前组件中使用</span></span><br><span class="line">        ...mapMutations(<span class="string">&#x27;m_user&#x27;</span>, [<span class="string">&#x27;saveUserInfo&#x27;</span>]),</span><br><span class="line">        <span class="comment">// 获取微信用户的基本信息</span></span><br><span class="line">        <span class="keyword">async</span> <span class="function"><span class="title">getUserProfile</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">            <span class="comment">// desc 为必填字段，用于声明获取用户个人信息后的用途，不超过30个字符</span></span><br><span class="line">            <span class="keyword">const</span> [err, res] = <span class="keyword">await</span> uni.getUserProfile(&#123; <span class="attr">desc</span>: <span class="string">&#x27;完善个人信息&#x27;</span> &#125;)</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 用户拒绝授权</span></span><br><span class="line">            <span class="keyword">if</span> (err) <span class="keyword">return</span> uni.$showMsg(<span class="string">&#x27;您拒绝授权！&#x27;</span>)</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 用户同意授权，保存用户信息到 vuex 中</span></span><br><span class="line">            <span class="built_in">console</span>.log(res)</span><br><span class="line">            <span class="built_in">this</span>.saveUserInfo(res.userInfo)</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="获取-Token-字符串"><a href="#获取-Token-字符串" class="headerlink" title="获取 Token 字符串"></a>获取 Token 字符串</h2><p>📝 需求：当获取到了微信用户的基本信息之后。</p>
<ol>
<li><p>调用微信登录接口 <a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/api/open-api/login/wx.login.html">wx.login</a>，获取登录凭证（code）。</p>
</li>
<li><p>调用黑马优购登录接口，获取 Token 字符串。</p>
</li>
</ol>
<p>在 getUserProfile 方法中，预调用 <code>this.getToken()</code> 方法，同时把获取到的用户信息传递进去。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取微信用户的基本信息</span></span><br><span class="line"><span class="keyword">async</span> getUserProfile () &#123;</span><br><span class="line">    <span class="comment">// desc 为必填字段，用于声明获取用户个人信息后的用途，不超过 30 个字符</span></span><br><span class="line">    <span class="keyword">const</span> [err, res] = <span class="keyword">await</span> uni.getUserProfile(&#123;<span class="attr">desc</span>: <span class="string">&#x27;完善用户信息&#x27;</span>&#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 用户拒绝授权</span></span><br><span class="line">    <span class="keyword">if</span> (err) <span class="keyword">return</span> uni.$showMsg(<span class="string">&#x27;您拒绝授权！&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 用户同意授权，保存用户信息到 vuex 中</span></span><br><span class="line">    <span class="built_in">console</span>.log(res)</span><br><span class="line">    <span class="built_in">this</span>.saveUserInfo(res.userInfo)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取登录成功后的 Token 字符串</span></span><br><span class="line">    <span class="built_in">this</span>.getToken(res)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在 methods 中定义 getToken 方法，调用登录相关的 API，实现登录的功能。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 调用登录接口，换取永久的 token</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="title">getToken</span>(<span class="params">info</span>)</span> &#123;</span><br><span class="line">    <span class="comment">// 调用微信登录接口</span></span><br><span class="line">    <span class="keyword">const</span> [err, res] = <span class="keyword">await</span> uni.login()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 判断微信登录 uni.login() 是否调用失败</span></span><br><span class="line">    <span class="keyword">if</span> (err) <span class="keyword">return</span> uni.$showMsg(<span class="string">&#x27;微信登录失败！&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 准备参数对象</span></span><br><span class="line">    <span class="keyword">const</span> data = &#123;</span><br><span class="line">        <span class="attr">code</span>: res.code, <span class="comment">// 微信登录返回的 code</span></span><br><span class="line">        <span class="attr">encryptedData</span>: info.encryptedData, <span class="comment">// 包括敏感数据在内的完整用户信息的加密数据</span></span><br><span class="line">        <span class="attr">iv</span>: info.iv, <span class="comment">// 加密算法的初始向量</span></span><br><span class="line">        <span class="attr">rawData</span>: info.rawData, <span class="comment">// 不包括敏感信息的原始数据字符串</span></span><br><span class="line">        <span class="attr">signature</span>: info.signature <span class="comment">// 用于校验用户信息</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// wxfb52f2d7b2f6123a</span></span><br><span class="line">    <span class="comment">// 由于同学们不是小程序开发者，可以写死一个假值进行下面流程的测试</span></span><br><span class="line">    <span class="keyword">const</span> &#123; <span class="attr">data</span>: loginResult &#125; = <span class="keyword">await</span> uni.$http.post(<span class="string">&#x27;/users/wxlogin&#x27;</span>, data)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 登录（黑马优购）是否成功判断</span></span><br><span class="line">    <span class="keyword">if</span> (loginResult.meta.status !== <span class="number">200</span>) <span class="keyword">return</span> uni.$showMsg(<span class="string">&#x27;黑马优购登录失败！&#x27;</span>)</span><br><span class="line">    uni.$showMsg(<span class="string">&#x27;黑马优购登录成功！&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="保存-Token-字符串到-vuex-中"><a href="#保存-Token-字符串到-vuex-中" class="headerlink" title="保存 Token 字符串到 vuex 中"></a>保存 Token 字符串到 vuex 中</h2><ol>
<li>在 <code>store/user.js</code> 模块的 mutations 节点中，声明如下的两个方法。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">mutations: &#123;</span><br><span class="line">    <span class="comment">// ...省略其它代码</span></span><br><span class="line">    <span class="comment">// 更新 token 字符串</span></span><br><span class="line">    <span class="function"><span class="title">updateToken</span>(<span class="params">state, token</span>)</span> &#123;</span><br><span class="line">        state.token = token</span><br><span class="line">        <span class="comment">// 通过 this.commit() 方法，调用 m_user 模块下的 saveTokenToStorage 方法，将 token 字符串持久化存储到本地</span></span><br><span class="line">        <span class="built_in">this</span>.commit(<span class="string">&#x27;m_user/saveTokenToStorage&#x27;</span>)</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将 token 字符串持久化存储到本地</span></span><br><span class="line">    <span class="function"><span class="title">saveTokenToStorage</span>(<span class="params">state</span>)</span> &#123;</span><br><span class="line">        uni.setStorageSync(<span class="string">&#x27;token&#x27;</span>, state.token)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>修改 <code>store/user.js</code> 模块的 state 节点如下。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// state 数据</span></span><br><span class="line"><span class="attr">state</span>: <span class="function">() =&gt;</span> (&#123;</span><br><span class="line">    <span class="comment">// 收货地址</span></span><br><span class="line">    <span class="attr">address</span>: <span class="built_in">JSON</span>.parse(uni.getStorageSync(<span class="string">&#x27;address&#x27;</span>) || <span class="string">&#x27;&#123;&#125;&#x27;</span>),</span><br><span class="line">    <span class="comment">// 用户的基本信息</span></span><br><span class="line">    <span class="attr">userinfo</span>: <span class="built_in">JSON</span>.parse(uni.getStorageSync(<span class="string">&#x27;userinfo&#x27;</span>) || <span class="string">&#x27;&#123;&#125;&#x27;</span>)</span><br><span class="line">    <span class="comment">// #mark 登录成功之后的 token 字符串</span></span><br><span class="line">    <span class="attr">token</span>: uni.getStorageSync(<span class="string">&#x27;token&#x27;</span>) || <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">&#125;),</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>在 <code>my-login.vue</code> 组件中，把 vuex 中的 updateToken 方法映射到当前组件中使用。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">methods: &#123;</span><br><span class="line">    <span class="comment">// #1 使用 mapMutations 辅助方法，把 m_user 模块中的 updateToken 方法映射到当前组件中使用</span></span><br><span class="line">    ...mapMutations(<span class="string">&#x27;m_user&#x27;</span>, [<span class="string">&#x27;saveUserInfo&#x27;</span>, <span class="string">&#x27;updateToken&#x27;</span>])</span><br><span class="line">    <span class="comment">// ...省略其它代码</span></span><br><span class="line">    <span class="comment">// 调用登录接口，换取永久的 token</span></span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="title">getToken</span>(<span class="params">info</span>)</span> &#123;</span><br><span class="line">        <span class="comment">// 调用微信登录接口</span></span><br><span class="line">        <span class="keyword">const</span> [err, res] = <span class="keyword">await</span> uni.login()</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 判断微信登录uni.login()是否调用失败</span></span><br><span class="line">        <span class="keyword">if</span> (err || res.errMsg !== <span class="string">&#x27;login:ok&#x27;</span>) <span class="keyword">return</span> uni.$showMsg(<span class="string">&#x27;微信登录失败！&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 准备参数对象</span></span><br><span class="line">        <span class="keyword">const</span> query = &#123;</span><br><span class="line">            <span class="attr">code</span>: res.code, <span class="comment">// 微信登录返回的code</span></span><br><span class="line">            <span class="attr">encryptedData</span>: info.encryptedData,</span><br><span class="line">            <span class="attr">iv</span>: info.iv,</span><br><span class="line">            <span class="attr">rawData</span>: info.rawData,</span><br><span class="line">            <span class="attr">signature</span>: info.signature</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> &#123; <span class="attr">data</span>: loginResult &#125; = <span class="keyword">await</span> uni.$http.post(<span class="string">&#x27;/users/wxlogin&#x27;</span>, query)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 登录（黑马优购）是否成功判断</span></span><br><span class="line">        <span class="keyword">if</span> (loginResult.meta.status !== <span class="number">200</span>) <span class="keyword">return</span> uni.$showMsg(<span class="string">&#x27;黑马优购登录失败！&#x27;</span>)</span><br><span class="line">        uni.$showMsg(<span class="string">&#x27;黑马优购登录成功！&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// #2 更新 vuex 中的 token</span></span><br><span class="line">        <span class="built_in">this</span>.updateToken(loginResult.message.token)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="用户信息组件-头像昵称区域布局和数据渲染"><a href="#用户信息组件-头像昵称区域布局和数据渲染" class="headerlink" title="用户信息组件-头像昵称区域布局和数据渲染"></a>用户信息组件-头像昵称区域布局和数据渲染</h2><h3 id="实现用户头像昵称区域的基本布局"><a href="#实现用户头像昵称区域的基本布局" class="headerlink" title="实现用户头像昵称区域的基本布局"></a>实现用户头像昵称区域的基本布局</h3><ol>
<li>在 <code>my-userinfo.vue</code> 组件中，定义如下的 UI 结构。</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;my-userinfo-container&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 头像昵称区域 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;top-box&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">image</span> <span class="attr">src</span>=<span class="string">&quot;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;avatar&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;nickname&quot;</span>&gt;</span>xxx<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>美化当前组件的样式如下。</li>
</ol>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.my-userinfo-container</span> &#123;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">    // 为整个组件的结构添加浅灰色的背景，要想完全撑开需要将父容器高度设置为<span class="number">100%</span>，参照下面的第<span class="number">3</span>步</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#efefef</span>;</span><br><span class="line"></span><br><span class="line">    <span class="selector-class">.top-box</span> &#123;</span><br><span class="line">        <span class="attribute">height</span>: <span class="number">400</span>rpx;</span><br><span class="line">        <span class="attribute">background-color</span>: <span class="number">#c00000</span>;</span><br><span class="line">        <span class="attribute">display</span>: flex;</span><br><span class="line">        <span class="attribute">flex-direction</span>: column;</span><br><span class="line">        <span class="attribute">align-items</span>: center;</span><br><span class="line">        <span class="attribute">justify-content</span>: center;</span><br><span class="line"></span><br><span class="line">        <span class="selector-class">.avatar</span> &#123;</span><br><span class="line">            <span class="attribute">display</span>: block;</span><br><span class="line">            <span class="attribute">width</span>: <span class="number">180</span>rpx;</span><br><span class="line">            <span class="attribute">height</span>: <span class="number">180</span>rpx;</span><br><span class="line">            <span class="attribute">border-radius</span>: <span class="number">90</span>rpx;</span><br><span class="line">            <span class="attribute">border</span>: <span class="number">4</span>rpx solid white;</span><br><span class="line">            <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">2</span>rpx <span class="number">10</span>rpx black;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="selector-class">.nickname</span> &#123;</span><br><span class="line">            <span class="attribute">color</span>: white;</span><br><span class="line">            <span class="attribute">font-weight</span>: bold;</span><br><span class="line">            <span class="attribute">font-size</span>: <span class="number">32</span>rpx;</span><br><span class="line">            <span class="attribute">margin-top</span>: <span class="number">20</span>rpx;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>在 <code>my.vue</code> 页面中，为最外层包裹性质的 view 容器，添加 <code>class=&quot;my-container&quot;</code> 的类名，并美化样式如下。</li>
</ol>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">page,</span><br><span class="line"><span class="selector-class">.my-container</span> &#123;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="渲染用户的头像和昵称"><a href="#渲染用户的头像和昵称" class="headerlink" title="渲染用户的头像和昵称"></a>渲染用户的头像和昵称</h3><ol>
<li>在 my-userinfo 组件中，通过 mapState 辅助函数，将需要的成员映射到当前组件中使用。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 按需导入 mapState 辅助函数</span></span><br><span class="line"><span class="keyword">import</span> &#123; mapState &#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="attr">computed</span>: &#123;</span><br><span class="line">        <span class="comment">// 将 m_user 模块中的 userinfo 映射到当前页面中使用</span></span><br><span class="line">        ...mapState(<span class="string">&#x27;m_user&#x27;</span>, [<span class="string">&#x27;userinfo&#x27;</span>]),</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;&#125;</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>将用户的头像和昵称渲染到页面中。</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 头像昵称区域 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;top-box&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">image</span> <span class="attr">:src</span>=<span class="string">&quot;userinfo.avatarUrl&quot;</span> <span class="attr">class</span>=<span class="string">&quot;avatar&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;nickname&quot;</span>&gt;</span>&#123;&#123;userinfo.nickName&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="用户信息组件-功能面板区域布局"><a href="#用户信息组件-功能面板区域布局" class="headerlink" title="用户信息组件-功能面板区域布局"></a>用户信息组件-功能面板区域布局</h2><h3 id="渲染第一个面板区域"><a href="#渲染第一个面板区域" class="headerlink" title="渲染第一个面板区域"></a>渲染第一个面板区域</h3><ol>
<li>在 my-userinfo 组件中，定义如下的 UI 结构。</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 面板的列表区域 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;panel-list&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 第一个面板 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;panel&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- panel 的主体区域 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;panel-body&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- panel 的 item 项 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;panel-item&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">text</span>&gt;</span>8<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">text</span>&gt;</span>收藏的店铺<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;panel-item&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">text</span>&gt;</span>14<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">text</span>&gt;</span>收藏的商品<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;panel-item&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">text</span>&gt;</span>18<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">text</span>&gt;</span>关注的商品<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;panel-item&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">text</span>&gt;</span>84<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">text</span>&gt;</span>足迹<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 第二个面板 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 第三个面板 --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>美化第一个面板的样式如下。</li>
</ol>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.panel-list</span> &#123;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">20</span>rpx;</span><br><span class="line">    <span class="attribute">position</span>: relative;</span><br><span class="line">    <span class="attribute">top</span>: -<span class="number">20</span>rpx;</span><br><span class="line">    <span class="selector-class">.panel</span> &#123;</span><br><span class="line">        <span class="attribute">background-color</span>: white;</span><br><span class="line">        <span class="attribute">border-radius</span>: <span class="number">6</span>rpx;</span><br><span class="line">        <span class="attribute">margin-bottom</span>: <span class="number">16</span>rpx;</span><br><span class="line"></span><br><span class="line">        <span class="selector-class">.panel-body</span> &#123;</span><br><span class="line">            <span class="attribute">display</span>: flex;</span><br><span class="line">            <span class="attribute">justify-content</span>: space-around;</span><br><span class="line"></span><br><span class="line">            <span class="selector-class">.panel-item</span> &#123;</span><br><span class="line">                <span class="attribute">display</span>: flex;</span><br><span class="line">                <span class="attribute">flex-direction</span>: column;</span><br><span class="line">                <span class="attribute">align-items</span>: center;</span><br><span class="line">                <span class="attribute">justify-content</span>: space-around;</span><br><span class="line">                <span class="attribute">font-size</span>: <span class="number">24</span>rpx;</span><br><span class="line">                <span class="attribute">padding</span>: <span class="number">20</span>rpx <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="渲染第二个面板区域"><a href="#渲染第二个面板区域" class="headerlink" title="渲染第二个面板区域"></a>渲染第二个面板区域</h3><ol>
<li>定义第二个面板区域的 UI 结构。</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 第二个面板 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;panel&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 面板的标题 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;panel-title&quot;</span>&gt;</span>我的订单<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 面板的主体 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;panel-body&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 面板主体中的 item 项 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;panel-item&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">image</span> <span class="attr">src</span>=<span class="string">&quot;/static/my-icons/icon1.png&quot;</span> <span class="attr">class</span>=<span class="string">&quot;icon&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">text</span>&gt;</span>待付款<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;panel-item&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">image</span> <span class="attr">src</span>=<span class="string">&quot;/static/my-icons/icon2.png&quot;</span> <span class="attr">class</span>=<span class="string">&quot;icon&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">text</span>&gt;</span>待收货<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;panel-item&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">image</span> <span class="attr">src</span>=<span class="string">&quot;/static/my-icons/icon3.png&quot;</span> <span class="attr">class</span>=<span class="string">&quot;icon&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">text</span>&gt;</span>退款/退货<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;panel-item&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">image</span> <span class="attr">src</span>=<span class="string">&quot;/static/my-icons/icon4.png&quot;</span> <span class="attr">class</span>=<span class="string">&quot;icon&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">text</span>&gt;</span>全部订单<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>对之前的 SCSS 样式进行改造，从而美化第二个面板的样式。</li>
</ol>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.panel-list</span> &#123;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">20</span>rpx;</span><br><span class="line">    <span class="attribute">position</span>: relative;</span><br><span class="line">    <span class="attribute">top</span>: -<span class="number">20</span>rpx;</span><br><span class="line">    <span class="selector-class">.panel</span> &#123;</span><br><span class="line">        <span class="attribute">background-color</span>: white;</span><br><span class="line">        <span class="attribute">border-radius</span>: <span class="number">6</span>rpx;</span><br><span class="line">        <span class="attribute">margin-bottom</span>: <span class="number">16</span>rpx;</span><br><span class="line">        <span class="selector-class">.panel-title</span> &#123;</span><br><span class="line">            <span class="attribute">line-height</span>: <span class="number">90</span>rpx;</span><br><span class="line">            <span class="attribute">padding-left</span>: <span class="number">20</span>rpx;</span><br><span class="line">            <span class="attribute">font-size</span>: <span class="number">30</span>rpx;</span><br><span class="line">            <span class="attribute">border-bottom</span>: <span class="number">2px</span> solid <span class="number">#f4f4f4</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="selector-class">.panel-body</span> &#123;</span><br><span class="line">            <span class="attribute">display</span>: flex;</span><br><span class="line">            <span class="attribute">justify-content</span>: space-around;</span><br><span class="line">            <span class="selector-class">.panel-item</span> &#123;</span><br><span class="line">                <span class="attribute">display</span>: flex;</span><br><span class="line">                <span class="attribute">flex-direction</span>: column;</span><br><span class="line">                <span class="attribute">align-items</span>: center;</span><br><span class="line">                <span class="attribute">justify-content</span>: space-around;</span><br><span class="line">                <span class="attribute">font-size</span>: <span class="number">26</span>rpx;</span><br><span class="line">                <span class="attribute">padding</span>: <span class="number">20</span>rpx <span class="number">0</span>;</span><br><span class="line">                <span class="selector-class">.icon</span> &#123;</span><br><span class="line">                    <span class="attribute">width</span>: <span class="number">70</span>rpx;</span><br><span class="line">                    <span class="attribute">height</span>: <span class="number">70</span>rpx;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="渲染第三个面板区域"><a href="#渲染第三个面板区域" class="headerlink" title="渲染第三个面板区域"></a>渲染第三个面板区域</h3><ol>
<li>定义第三个面板区域的 UI 结构。</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 第三个面板 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;panel&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;panel-list-item&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">text</span>&gt;</span>收货地址<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">uni-icons</span> <span class="attr">type</span>=<span class="string">&quot;arrowright&quot;</span> <span class="attr">size</span>=<span class="string">&quot;15&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">uni-icons</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;panel-list-item&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">text</span>&gt;</span>联系客服<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">uni-icons</span> <span class="attr">type</span>=<span class="string">&quot;arrowright&quot;</span> <span class="attr">size</span>=<span class="string">&quot;15&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">uni-icons</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;panel-list-item&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">text</span>&gt;</span>退出登录<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">uni-icons</span> <span class="attr">type</span>=<span class="string">&quot;arrowright&quot;</span> <span class="attr">size</span>=<span class="string">&quot;15&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">uni-icons</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>美化第三个面板区域的样式。</li>
</ol>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.panel-list-item</span> &#123;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">90</span>rpx;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">justify-content</span>: space-between;</span><br><span class="line">    <span class="attribute">align-items</span>: center;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">30</span>rpx;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">20</span>rpx;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="退出登录功能实现"><a href="#退出登录功能实现" class="headerlink" title="退出登录功能实现"></a>退出登录功能实现</h2><p><code>components/my-userinfo/my-userinfo.vue</code></p>
<ol>
<li>使用 mapMutations 辅助方法，将需要用到的 mutations 方法映射到当前组件中。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 按需导入辅助函数</span></span><br><span class="line"><span class="keyword">import</span> &#123; mapState, mapMutations &#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="attr">methods</span>: &#123;</span><br><span class="line">        ...mapMutations(<span class="string">&#x27;m_user&#x27;</span>, [<span class="string">&#x27;saveUserInfo&#x27;</span>, <span class="string">&#x27;updateToken&#x27;</span>, <span class="string">&#x27;updateAddress&#x27;</span>]),</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>为第三个面板区域中的 退出登录 项绑定 click 点击事件处理函数。</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;panel-list-item&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;logout&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">text</span>&gt;</span>退出登录<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">uni-icons</span> <span class="attr">type</span>=<span class="string">&quot;arrowright&quot;</span> <span class="attr">size</span>=<span class="string">&quot;15&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">uni-icons</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>在 my-userinfo 组件的 methods 节点中定义 logout 事件处理函数。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 退出登录</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="title">logout</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="comment">// 询问用户是否退出登录</span></span><br><span class="line">    <span class="keyword">const</span> [err, succ] = <span class="keyword">await</span> uni.showModal(&#123;</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&#x27;提示&#x27;</span>,</span><br><span class="line">        <span class="attr">content</span>: <span class="string">&#x27;确认退出登录吗？&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">if</span> (succ &amp;&amp; succ.confirm) &#123;</span><br><span class="line">        <span class="comment">// 用户确认了退出登录的操作</span></span><br><span class="line">        <span class="comment">// 需要清空 vuex 中的 userinfo、token 和 address</span></span><br><span class="line">        <span class="built_in">this</span>.saveUserInfo(&#123;&#125;)</span><br><span class="line">        <span class="built_in">this</span>.updateToken(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        <span class="built_in">this</span>.updateAddress(&#123;&#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="三秒后自动跳转到登录页面"><a href="#三秒后自动跳转到登录页面" class="headerlink" title="三秒后自动跳转到登录页面"></a>三秒后自动跳转到登录页面</h2><p>📝 需求：在购物车页面，当用户点击 “结算” 按钮时，如果用户没有登录，则 3 秒后自动跳转到登录页面。</p>
<ol>
<li>在 data 节点中声明倒计时的秒数，<code>components/my-settle/my-settle.vue</code>。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="comment">// 倒计时的秒数</span></span><br><span class="line">        <span class="attr">seconds</span>: <span class="number">3</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>改造 结算 按钮的 click 事件处理函数，如果用户没有登录，则预调用一个叫做 delayNavigate 的方法，进行倒计时的导航跳转。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 点击了结算按钮</span></span><br><span class="line"><span class="function"><span class="title">settlement</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="comment">// 1. 先判断是否勾选了要结算的商品</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">this</span>.checkedCount) <span class="keyword">return</span> uni.$showMsg(<span class="string">&#x27;请选择要结算的商品！&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. 再判断用户是否选择了收货地址</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">this</span>.addstr) <span class="keyword">return</span> uni.$showMsg(<span class="string">&#x27;请选择收货地址！&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. 最后判断用户是否登录了，如果没有登录，则调用 delayNavigate() 进行倒计时的导航跳转</span></span><br><span class="line">    <span class="comment">// if (!this.token) return uni.$showMsg(&#x27;请先登录！&#x27;)</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">this</span>.token) <span class="keyword">return</span> <span class="built_in">this</span>.delayNavigate()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>在 methods 对象中，定义 delayNavigate 方法，实现倒计时的提示功能。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">delayNavigate</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="comment">// 向事件循环队列中添加显示倒计时提示框代码</span></span><br><span class="line">    <span class="built_in">clearInterval</span>(<span class="built_in">this</span>.timer)</span><br><span class="line">    <span class="built_in">this</span>.timer = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.seconds === <span class="number">0</span>) &#123;</span><br><span class="line">            uni.switchTab(&#123;</span><br><span class="line">                <span class="attr">url</span>: <span class="string">&#x27;/pages/my/my&#x27;</span></span><br><span class="line">            &#125;)</span><br><span class="line">            <span class="built_in">this</span>.seconds = <span class="number">3</span></span><br><span class="line">            <span class="built_in">clearInterval</span>(<span class="built_in">this</span>.timer)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            uni.showToast(&#123;</span><br><span class="line">                <span class="attr">title</span>: <span class="string">`未登录，将在<span class="subst">$&#123;<span class="built_in">this</span>.seconds--&#125;</span>秒后跳转到登录页面`</span>,</span><br><span class="line">                <span class="attr">duration</span>: <span class="number">1000</span>,</span><br><span class="line">                <span class="attr">mask</span>: <span class="literal">true</span>,</span><br><span class="line">                <span class="attr">icon</span>: <span class="string">&#x27;none&#x27;</span></span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, <span class="number">1000</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="登录成功之后自动返回之前的页面"><a href="#登录成功之后自动返回之前的页面" class="headerlink" title="登录成功之后自动返回之前的页面"></a>登录成功之后自动返回之前的页面</h2><p>🤔 思路：在跳转到登录页完成之后，把<font color=e32d40><strong>返回页面（当前页面）</strong></font>的信息存储到 vuex 中，登录成功之后，从 vuex 取返回页面信息，根据返回页面的信息重新跳转回去。</p>
<p>🤔 设计：返回页面的信息对象，主要包含 openType 和 from 两个属性，其中 openType 表示以哪种方式导航回之前的页面；from 表示之前页面的 url 地址。</p>
<ol>
<li>在 <code>store/user.js</code> 模块的 state 节点中声明 redirectInfo 的初始值为 null。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// state 数据</span></span><br><span class="line"><span class="attr">state</span>: <span class="function">() =&gt;</span> (&#123;</span><br><span class="line">    <span class="comment">// 收货地址</span></span><br><span class="line">    <span class="attr">address</span>: <span class="built_in">JSON</span>.parse(uni.getStorageSync(<span class="string">&#x27;address&#x27;</span>) || <span class="string">&#x27;&#123;&#125;&#x27;</span>),</span><br><span class="line">    <span class="comment">// 登录成功之后的 token 字符串</span></span><br><span class="line">    <span class="attr">token</span>: uni.getStorageSync(<span class="string">&#x27;token&#x27;</span>) || <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    <span class="comment">// 用户的基本信息</span></span><br><span class="line">    <span class="attr">userinfo</span>: <span class="built_in">JSON</span>.parse(uni.getStorageSync(<span class="string">&#x27;userinfo&#x27;</span>) || <span class="string">&#x27;&#123;&#125;&#x27;</span>),</span><br><span class="line">    <span class="comment">// 重定向的 object 对象 &#123; openType, from &#125;</span></span><br><span class="line">    <span class="attr">redirectInfo</span>: <span class="literal">null</span></span><br><span class="line">&#125;),</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>声明一个叫做 updateRedirectInfo 的 mutation 方法，用于更新 redirectInfo。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mutations: &#123;</span><br><span class="line">    <span class="comment">// 更新重定向的信息对象</span></span><br><span class="line">    <span class="function"><span class="title">updateRedirectInfo</span>(<span class="params">state, info</span>)</span> &#123;</span><br><span class="line">        state.redirectInfo = info</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>在 <code>my-settle.vue</code> 组件中，通过 mapMutations 辅助方法，把 <font color=e32d40><strong>m_user 模块</strong></font>中的 updateRedirectInfo 方法映射到当前页面中使用。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">methods: &#123;</span><br><span class="line">    <span class="comment">// 把 m_user 模块中的 updateRedirectInfo 方法映射到当前页面中使用</span></span><br><span class="line">    ...mapMutations(<span class="string">&#x27;m_user&#x27;</span>, [<span class="string">&#x27;updateRedirectInfo&#x27;</span>]),</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>改造 <code>my-settle.vue</code> 组件 methods 节点中的 delayNavigate 方法，在 switchTab 的回调中将重定向的信息对象存储到 vuex 中。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">delayNavigate</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="comment">// 向事件循环队列中添加显示倒计时提示框代码</span></span><br><span class="line">    <span class="built_in">clearInterval</span>(<span class="built_in">this</span>.timer)</span><br><span class="line">    <span class="built_in">this</span>.timer = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.seconds === <span class="number">0</span>) &#123;</span><br><span class="line">            uni.switchTab(&#123;</span><br><span class="line">                <span class="attr">url</span>: <span class="string">&#x27;/pages/my/my&#x27;</span>,</span><br><span class="line">                <span class="attr">success</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">                    <span class="comment">// 调用 vuex 的 updateRedirectInfo 方法，把跳转信息存储到 Store 中</span></span><br><span class="line">                    <span class="built_in">this</span>.updateRedirectInfo(&#123;</span><br><span class="line">                        <span class="comment">// 跳转的方式</span></span><br><span class="line">                        <span class="attr">openType</span>: <span class="string">&#x27;switchTab&#x27;</span>,</span><br><span class="line">                        <span class="comment">// 从哪个页面跳转过去的</span></span><br><span class="line">                        <span class="attr">from</span>: <span class="string">&#x27;/pages/cart/cart&#x27;</span></span><br><span class="line">                    &#125;)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">            <span class="built_in">this</span>.seconds = <span class="number">3</span></span><br><span class="line">            <span class="built_in">clearInterval</span>(<span class="built_in">this</span>.timer)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            uni.showToast(&#123;</span><br><span class="line">                <span class="attr">title</span>: <span class="string">`未登录，将在<span class="subst">$&#123;<span class="built_in">this</span>.seconds--&#125;</span>秒后跳转到登录页面`</span>,</span><br><span class="line">                <span class="attr">duration</span>: <span class="number">1000</span>,</span><br><span class="line">                <span class="attr">mask</span>: <span class="literal">true</span>,</span><br><span class="line">                <span class="attr">icon</span>: <span class="string">&#x27;none&#x27;</span></span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, <span class="number">1000</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>在 <code>my-login.vue</code> 组件中，通过 mapState 和 mapMutations 辅助方法，将 vuex 中需要的数据和方法，映射到当前页面中使用。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 按需导入辅助函数</span></span><br><span class="line"><span class="keyword">import</span> &#123; mapMutations, mapState &#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="attr">computed</span>: &#123;</span><br><span class="line">        <span class="comment">// 调用 mapState 辅助方法，把 m_user 模块中的数据映射到当前用组件中使用</span></span><br><span class="line">        ...mapState(<span class="string">&#x27;m_user&#x27;</span>, [<span class="string">&#x27;redirectInfo&#x27;</span>]),</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">methods</span>: &#123;</span><br><span class="line">        <span class="comment">// 调用 mapMutations 辅助方法，把 m_user 模块中的方法映射到当前组件中使用</span></span><br><span class="line">        ...mapMutations(<span class="string">&#x27;m_user&#x27;</span>, [<span class="string">&#x27;saveUserInfo&#x27;</span>, <span class="string">&#x27;updateToken&#x27;</span>, <span class="string">&#x27;updateRedirectInfo&#x27;</span>]),</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="6">
<li>改造 my-login 组件中的 getToken 方法，当登录成功之后，调用 this.navigateBack() 方法返回登录之前的页面。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 调用登录接口，换取永久的 token</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="title">getToken</span>(<span class="params">info</span>)</span> &#123;</span><br><span class="line">    <span class="comment">// ...省略其它代码</span></span><br><span class="line">    <span class="comment">// 判断 vuex 中的 redirectInfo 是否为 null</span></span><br><span class="line">    <span class="comment">// 如果不为 null，则登录成功之后，需要重新导航到对应的页面</span></span><br><span class="line">    <span class="built_in">this</span>.navigateBack()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>navigateBack 方法如下。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 返回登录之前的页面</span></span><br><span class="line"><span class="function"><span class="title">navigateBack</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="comment">// redirectInfo 不为 null，并且导航方式为 switchTab</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.redirectInfo &amp;&amp; <span class="built_in">this</span>.redirectInfo.openType === <span class="string">&#x27;switchTab&#x27;</span>) &#123;</span><br><span class="line">        <span class="comment">// 调用小程序提供的 uni.switchTab() API 进行页面的导航</span></span><br><span class="line">        uni.switchTab(&#123;</span><br><span class="line">            <span class="comment">// 要导航到的页面地址</span></span><br><span class="line">            <span class="attr">url</span>: <span class="built_in">this</span>.redirectInfo.from,</span><br><span class="line">            <span class="comment">// 导航成功之后，把 vuex 中的 redirectInfo 对象重置为 null</span></span><br><span class="line">            <span class="attr">complete</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">                <span class="built_in">this</span>.updateRedirectInfo(<span class="literal">null</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="调用支付准备工作"><a href="#调用支付准备工作" class="headerlink" title="调用支付准备工作"></a>调用支付准备工作</h2><h3 id="在请求头中添加-Token-身份认证的字段"><a href="#在请求头中添加-Token-身份认证的字段" class="headerlink" title="在请求头中添加 Token 身份认证的字段"></a>在请求头中添加 Token 身份认证的字段</h3><ol>
<li><p>准备：只有在登录之后才允许调用支付相关的接口，所以必须为有权限的接口添加身份认证的请求头字段。</p>
</li>
<li><p>打开项目根目录下的 <code>common/request.js</code>，改造 $http.beforeRequest 请求拦截器中的代码如下。</p>
</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;../store/store&#x27;</span></span><br><span class="line"><span class="comment">// 请求开始之前做一些事情</span></span><br><span class="line">$http.beforeRequest = <span class="function"><span class="keyword">function</span> (<span class="params">options</span>) </span>&#123;</span><br><span class="line">    uni.showLoading(&#123;</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&#x27;数据加载中...&#x27;</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">// 判断请求的是否为有权限的 API 接口</span></span><br><span class="line">    <span class="keyword">if</span> (options.url.indexOf(<span class="string">&#x27;/my/&#x27;</span>) !== -<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="comment">// 为请求头添加身份认证字段</span></span><br><span class="line">        options.header = &#123;</span><br><span class="line">            <span class="comment">// 字段的值可以直接从 vuex 中进行获取</span></span><br><span class="line">            <span class="attr">Authorization</span>: store.state.m_user.token,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="微信支付的流程"><a href="#微信支付的流程" class="headerlink" title="微信支付的流程"></a>微信支付的流程</h3><ol>
<li><p>创建订单。</p>
<p> ○ 请求创建订单的 API 接口：把（订单金额、收货地址、订单中包含的商品信息）发送到服务器。</p>
<p> ○ 服务器响应的结果：<font color=e32d40><strong>订单编号</strong></font>。</p>
</li>
<li><p>订单预支付。</p>
<p> ○ 请求订单预支付的 API 接口：把（订单编号）发送到服务器。</p>
<p> ○ 服务器响应的结果：<font color=e32d40><strong>订单预支付对象</strong></font>，里面包含了订单支付相关的必要参数。</p>
</li>
<li><p>发起微信支付。</p>
<p> ○ 调用 <code>uni.requestPayment()</code> 这个 API，并传递订单预支付对象，发起微信支付。</p>
<p> ○ 监听 <code>uni.requestPayment()</code> 这个 API 的 success，fail，complete 回调函数。</p>
</li>
</ol>
<h2 id="创建订单"><a href="#创建订单" class="headerlink" title="创建订单"></a>创建订单</h2><ol>
<li>改造 <code>my-settle.vue</code> 组件中的 settlement 方法，当前三个判断条件通过之后，调用实现微信支付的方法。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 点击了结算按钮</span></span><br><span class="line"><span class="function"><span class="title">settlement</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="comment">// #1 先判断是否勾选了要结算的商品</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">this</span>.checkedCount) <span class="keyword">return</span> uni.$showMsg(<span class="string">&#x27;请选择要结算的商品！&#x27;</span>)</span><br><span class="line">    <span class="comment">// #2 再判断用户是否选择了收货地址</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">this</span>.addstr) <span class="keyword">return</span> uni.$showMsg(<span class="string">&#x27;请选择收货地址！&#x27;</span>)</span><br><span class="line">    <span class="comment">// #3 最后判断用户是否登录了</span></span><br><span class="line">    <span class="comment">// if (!this.token) return uni.$showMsg(&#x27;请先登录！&#x27;)</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">this</span>.token) <span class="keyword">return</span> <span class="built_in">this</span>.delayNavigate()</span><br><span class="line">    <span class="comment">// #4 实现微信支付功能</span></span><br><span class="line">    <span class="built_in">this</span>.payOrder()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>在 <code>my-settle.vue</code> 组件中定义 payOrder 方法如下，先实现创建订单的功能。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">computed: &#123;</span><br><span class="line">    ...mapState(<span class="string">&#x27;m_cart&#x27;</span>, [<span class="string">&#x27;cart&#x27;</span>]),</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="title">payOrder</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="comment">// 1. 创建订单</span></span><br><span class="line">    <span class="comment">// 1.1 组织订单的信息对象</span></span><br><span class="line">    <span class="keyword">const</span> orderInfo = &#123;</span><br><span class="line">        <span class="comment">// 开发期间，注释掉真实的订单价格</span></span><br><span class="line">        <span class="comment">// order_price: this.checkedGoodsAmount,</span></span><br><span class="line">        <span class="comment">// 写死订单总价为 1 分钱</span></span><br><span class="line">        <span class="attr">order_price</span>: <span class="number">0.01</span>,</span><br><span class="line">        <span class="attr">consignee_addr</span>: <span class="built_in">this</span>.addstr,</span><br><span class="line">        <span class="attr">goods</span>: <span class="built_in">this</span>.cart.filter(<span class="function"><span class="params">x</span> =&gt;</span> x.goods_state)</span><br><span class="line">        .map(<span class="function"><span class="params">x</span> =&gt;</span> (&#123;</span><br><span class="line">            <span class="attr">goods_id</span>: x.goods_id,</span><br><span class="line">            <span class="attr">goods_number</span>: x.goods_count,</span><br><span class="line">            <span class="attr">goods_price</span>: x.goods_price</span><br><span class="line">        &#125;))</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1.2 发起请求创建订单</span></span><br><span class="line">    <span class="keyword">const</span> &#123;</span><br><span class="line">        <span class="attr">data</span>: res</span><br><span class="line">    &#125; = <span class="keyword">await</span> uni.$http.post(<span class="string">&#x27;/my/orders/create&#x27;</span>, orderInfo)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (res.meta.status !== <span class="number">200</span>) <span class="keyword">return</span> uni.$showMsg(<span class="string">&#x27;创建订单失败！&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1.3 得到服务器响应的“订单编号”</span></span><br><span class="line">    <span class="keyword">const</span> orderNumber = res.message.order_number</span><br><span class="line">    <span class="comment">// 2. 订单预支付</span></span><br><span class="line">    <span class="comment">// 3. 发起微信支付</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="订单预支付"><a href="#订单预支付" class="headerlink" title="订单预支付"></a>订单预支付</h2><p>改造 <code>my-settle.vue</code> 组件的 payOrder 方法，实现订单预支付功能。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 微信支付</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="title">payOrder</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="comment">// 1. 创建订单</span></span><br><span class="line">    <span class="comment">// 1.1 组织订单的信息对象</span></span><br><span class="line">    <span class="keyword">const</span> orderInfo = &#123;</span><br><span class="line">        <span class="comment">// 开发期间，注释掉真实的订单价格，</span></span><br><span class="line">        <span class="comment">// order_price: this.checkedGoodsAmount,</span></span><br><span class="line">        <span class="comment">// 写死订单总价为 1 分钱</span></span><br><span class="line">        <span class="attr">order_price</span>: <span class="number">0.01</span>,</span><br><span class="line">        <span class="attr">consignee_addr</span>: <span class="built_in">this</span>.addstr,</span><br><span class="line">        <span class="attr">goods</span>: <span class="built_in">this</span>.cart.filter(<span class="function"><span class="params">x</span> =&gt;</span> x.goods_state).map(<span class="function"><span class="params">x</span> =&gt;</span> (</span><br><span class="line">            &#123; <span class="attr">goods_id</span>: x.goods_id, <span class="attr">goods_number</span>: x.goods_count, <span class="attr">goods_price</span>: x.goods_price &#125;</span><br><span class="line">        ))</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1.2 发起请求创建订单</span></span><br><span class="line">    <span class="keyword">const</span> &#123; <span class="attr">data</span>: res &#125; = <span class="keyword">await</span> uni.$http.post(<span class="string">&#x27;/my/orders/create&#x27;</span>, orderInfo)</span><br><span class="line">    <span class="keyword">if</span> (res.meta.status !== <span class="number">200</span>) <span class="keyword">return</span> uni.$showMsg(<span class="string">&#x27;创建订单失败！&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1.3 得到服务器响应的“订单编号”</span></span><br><span class="line">    <span class="keyword">const</span> orderNumber = res.message.order_number</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. 订单预支付</span></span><br><span class="line">    <span class="comment">// 2.1 发起请求获取订单的支付信息</span></span><br><span class="line">    <span class="keyword">const</span> &#123; <span class="attr">data</span>: res2 &#125; = <span class="keyword">await</span> uni.$http.post(<span class="string">&#x27;/my/orders/req_unifiedorder&#x27;</span>, &#123; <span class="attr">order_number</span>: orderNumber &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.2 预付订单生成失败</span></span><br><span class="line">    <span class="keyword">if</span> (res2.meta.status !== <span class="number">200</span>) <span class="keyword">return</span> uni.$showMsg(<span class="string">&#x27;预付订单生成失败！&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.3 得到订单支付相关的必要参数</span></span><br><span class="line">    <span class="keyword">const</span> payInfo = res2.message.pay</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. 发起微信支付</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="发起微信支付"><a href="#发起微信支付" class="headerlink" title="发起微信支付"></a>发起微信支付</h2><ol>
<li>改造 my-settle 组件的 payOrder 方法，实现微信支付的功能。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 微信支付</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="title">payOrder</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="comment">// 1. 创建订单</span></span><br><span class="line">    <span class="comment">// 1.1 组织订单的信息对象</span></span><br><span class="line">    <span class="keyword">const</span> orderInfo = &#123;</span><br><span class="line">        <span class="comment">// 开发期间，注释掉真实的订单价格，</span></span><br><span class="line">        <span class="comment">// order_price: this.checkedGoodsAmount,</span></span><br><span class="line">        <span class="comment">// 写死订单总价为 1 分钱</span></span><br><span class="line">        <span class="attr">order_price</span>: <span class="number">0.01</span>,</span><br><span class="line">        <span class="attr">consignee_addr</span>: <span class="built_in">this</span>.addstr,</span><br><span class="line">        <span class="attr">goods</span>: <span class="built_in">this</span>.cart.filter(<span class="function"><span class="params">x</span> =&gt;</span> x.goods_state).map(<span class="function"><span class="params">x</span> =&gt;</span> (</span><br><span class="line">            &#123; <span class="attr">goods_id</span>: x.goods_id, <span class="attr">goods_number</span>: x.goods_count, <span class="attr">goods_price</span>: x.goods_price &#125;</span><br><span class="line">        ))</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 1.2 发起请求创建订单</span></span><br><span class="line">    <span class="keyword">const</span> &#123; <span class="attr">data</span>: res &#125; = <span class="keyword">await</span> uni.$http.post(<span class="string">&#x27;/orders/create&#x27;</span>, orderInfo)</span><br><span class="line">    <span class="keyword">if</span> (res.meta.status !== <span class="number">200</span>) <span class="keyword">return</span> uni.$showMsg(<span class="string">&#x27;创建订单失败！&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1.3 得到服务器响应的“订单编号”</span></span><br><span class="line">    <span class="keyword">const</span> orderNumber = res.message.order_number</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. 订单预支付</span></span><br><span class="line">    <span class="comment">// 2.1 发起请求获取订单的支付信息</span></span><br><span class="line">    <span class="keyword">const</span> &#123; <span class="attr">data</span>: res2 &#125; = <span class="keyword">await</span> uni.$http.post(<span class="string">&#x27;/my/orders/req_unifiedorder&#x27;</span>, &#123; <span class="attr">order_number</span>: orderNumber &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.2 预付订单生成失败</span></span><br><span class="line">    <span class="keyword">if</span> (res2.meta.status !== <span class="number">200</span>) <span class="keyword">return</span> uni.$showMsg(<span class="string">&#x27;预付订单生成失败！&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.3 得到订单支付相关的必要参数</span></span><br><span class="line">    <span class="keyword">const</span> payInfo = res2.message.pay</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. 发起微信支付</span></span><br><span class="line">    <span class="comment">// 3.1 调用 uni.requestPayment() 发起微信支付</span></span><br><span class="line">    <span class="keyword">const</span> [err, succ] = <span class="keyword">await</span> uni.requestPayment(payInfo)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3.2 未完成支付</span></span><br><span class="line">    <span class="keyword">if</span> (err) <span class="keyword">return</span> uni.$showMsg(<span class="string">&#x27;订单未支付！&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3.3 完成了支付，进一步查询支付的结果</span></span><br><span class="line">    <span class="keyword">const</span> &#123; <span class="attr">data</span>: res3 &#125; = <span class="keyword">await</span> uni.$http.post(<span class="string">&#x27;/my/orders/chkOrder&#x27;</span>, &#123; <span class="attr">order_number</span>: orderNumber &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3.4 检测到订单未支付</span></span><br><span class="line">    <span class="keyword">if</span> (res3.meta.status !== <span class="number">200</span>) <span class="keyword">return</span> uni.$showMsg(<span class="string">&#x27;订单未支付！&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3.5 检测到订单支付完成</span></span><br><span class="line">    uni.showToast(&#123;</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&#x27;支付完成！&#x27;</span>,</span><br><span class="line">        <span class="attr">icon</span>: <span class="string">&#x27;success&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>小程序<a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/api/open-api/login/wx.login.html">登录</a>、用户信息相关接口调整<a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/community/develop/doc/000cacfa20ce88df04cb468bc52801?blockType=1">说明</a>、<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/wQQBi9jrszjOYZa0tRU8Sw">微信生态内的账户体系</a>。</li>
</ol>
<h1 id="发布小程序"><a href="#发布小程序" class="headerlink" title="发布小程序"></a>发布小程序</h1><p>点击 HBuilderX 菜单栏上的 发行 -&gt; 小程序 -&gt; 微信（仅适用于 uni-app）。</p>
<img src="/resource/images/11-1.9cdf19c7.png"/>

<p>在弹出框中填写要发布的小程序的名称和 AppId 之后，点击发行按钮。</p>
<img src="/resource/images/image (18).png"/>

<p>在 HBuilderX 的控制台中查看小程序发布编译的进度。</p>
<img src="/resource/images/11-3.567c1979.png"/>

<p>发布编译完成之后，会自动打开一个新的微信开发者工具界面，此时，点击工具栏上的上传按钮。</p>
<img src="/resource/images/11-4.9c24f0ee.png"/>

<p>填写版本号和项目备注之后，点击上传按钮。</p>
<img src="/resource/images/image (19).png"/>

<p>上传完成之后，会出现如下的提示消息，直接点击确定按钮即可。</p>
<img src="/resource/images/11-6.d5c408c3.png"/>

<p>通过微信开发者工具上传的代码，默认处于版本管理的开发版本列表中，如图所示。</p>
<img src="/resource/images/11-7.ec9045bc.png"/>

<p>将 开发版本提交审核 -&gt; 再将 审核通过的版本发布上线，即可实现小程序的发布和上线。</p>
<img src="/resource/images/11-8.a251f8b8.png"/>

    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2023/02/21/xcx-course03/" rel="prev" title="03_小程序享+项目">
      <i class="fa fa-chevron-left"></i> 03_小程序享+项目
    </a></div>
      <div class="post-nav-item">
    <a href="/2023/03/23/rz-base-new-course01/" rel="next" title="01_人资后台">
      01_人资后台 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%A1%B9%E7%9B%AE%E7%9B%AE%E6%A0%87"><span class="nav-number">1.</span> <span class="nav-text">项目目标</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%A1%B9%E7%9B%AE%E6%A6%82%E8%BF%B0"><span class="nav-number">2.</span> <span class="nav-text">项目概述</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%A1%B9%E7%9B%AE%E6%A6%82%E8%BF%B0-1"><span class="nav-number">2.1.</span> <span class="nav-text">项目概述</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%A1%B9%E7%9B%AE%E6%A6%82%E8%A7%88"><span class="nav-number">2.2.</span> <span class="nav-text">项目概览</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8A%80%E6%9C%AF%E6%A0%88"><span class="nav-number">2.2.1.</span> <span class="nav-text">技术栈</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%A1%B9%E7%9B%AE%E8%B5%B7%E6%AD%A5"><span class="nav-number">3.</span> <span class="nav-text">项目起步</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#uni-app-%E7%AE%80%E4%BB%8B"><span class="nav-number">3.1.</span> <span class="nav-text">uni-app 简介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7%E4%B8%8B%E8%BD%BD"><span class="nav-number">3.2.</span> <span class="nav-text">开发工具下载</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%8B%E8%BD%BD-HBuilder"><span class="nav-number">3.3.</span> <span class="nav-text">下载 HBuilder</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%89%E8%A3%85-HBuilder"><span class="nav-number">3.4.</span> <span class="nav-text">安装 HBuilder</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BC%80%E5%8F%91%E8%80%85%E5%B7%A5%E5%85%B7%E7%9A%84%E9%85%8D%E7%BD%AE"><span class="nav-number">3.5.</span> <span class="nav-text">开发者工具的配置</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E8%A3%85-Sass"><span class="nav-number">3.5.1.</span> <span class="nav-text">安装 Sass</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BF%AB%E6%8D%B7%E9%94%AE%E6%96%B9%E6%A1%88%E5%88%87%E6%8D%A2"><span class="nav-number">3.5.2.</span> <span class="nav-text">快捷键方案切换</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9%E7%BC%96%E8%BE%91%E5%99%A8%E8%AE%BE%E7%BD%AE"><span class="nav-number">3.5.3.</span> <span class="nav-text">修改编辑器设置</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%96%B0%E5%BB%BA-uni-app-%E9%A1%B9%E7%9B%AE"><span class="nav-number">3.6.</span> <span class="nav-text">新建 uni-app 项目</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE"><span class="nav-number">3.6.1.</span> <span class="nav-text">创建项目</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A1%AB%E5%86%99%E4%BF%A1%E6%81%AF"><span class="nav-number">3.6.2.</span> <span class="nav-text">填写信息</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E6%88%90%E5%8A%9F"><span class="nav-number">3.6.3.</span> <span class="nav-text">创建成功</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#uni-app-%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84"><span class="nav-number">3.7.</span> <span class="nav-text">uni-app 目录结构</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BE%AE%E4%BF%A1%E5%B7%A5%E5%85%B7%E9%A2%84%E8%A7%88%E9%A1%B9%E7%9B%AE"><span class="nav-number">3.8.</span> <span class="nav-text">微信工具预览项目</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A1%AB%E5%86%99-AppID"><span class="nav-number">3.8.1.</span> <span class="nav-text">填写 AppID</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E5%B7%A5%E5%85%B7%E8%B7%AF%E5%BE%84"><span class="nav-number">3.8.2.</span> <span class="nav-text">配置工具路径</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BC%80%E5%90%AF%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%8F%A3"><span class="nav-number">3.8.3.</span> <span class="nav-text">开启服务端口</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%90%AF%E5%8A%A8%E9%A2%84%E8%A7%88%E9%A1%B9%E7%9B%AE"><span class="nav-number">3.8.4.</span> <span class="nav-text">启动预览项目</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%90%E8%A1%8C%E6%88%90%E5%8A%9F%E6%95%88%E6%9E%9C"><span class="nav-number">3.8.5.</span> <span class="nav-text">运行成功效果</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-Git-%E7%AE%A1%E7%90%86%E9%A1%B9%E7%9B%AE"><span class="nav-number">3.9.</span> <span class="nav-text">使用 Git 管理项目</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA-gitignore"><span class="nav-number">3.9.1.</span> <span class="nav-text">创建 .gitignore</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9D%E5%A7%8B%E5%8C%96%E6%9C%AC%E5%9C%B0-Git-%E4%BB%93%E5%BA%93"><span class="nav-number">3.9.2.</span> <span class="nav-text">初始化本地 Git 仓库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B7%BB%E5%8A%A0%E5%88%B0%E6%9A%82%E5%AD%98%E5%8C%BA"><span class="nav-number">3.9.3.</span> <span class="nav-text">添加到暂存区</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9C%AC%E5%9C%B0%E6%8F%90%E4%BA%A4%E9%A1%B9%E7%9B%AE"><span class="nav-number">3.9.4.</span> <span class="nav-text">本地提交项目</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%A1%B9%E7%9B%AE%E6%89%98%E7%AE%A1%E7%A0%81%E4%BA%91"><span class="nav-number">3.9.5.</span> <span class="nav-text">项目托管码云</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#TabBar"><span class="nav-number">4.</span> <span class="nav-text">TabBar</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA-TabBar-%E5%AF%B9%E5%BA%94%E9%A1%B5%E9%9D%A2"><span class="nav-number">4.1.</span> <span class="nav-text">创建 TabBar 对应页面</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%A0%E9%99%A4%E9%BB%98%E8%AE%A4%E7%9A%84-index-%E9%A6%96%E9%A1%B5"><span class="nav-number">4.2.</span> <span class="nav-text">删除默认的 index 首页</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE-TabBar-%E5%AF%B9%E5%BA%94%E4%BF%A1%E6%81%AF"><span class="nav-number">4.3.</span> <span class="nav-text">配置 TabBar 对应信息</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9%E5%AF%BC%E8%88%AA%E6%9D%A1%E7%9A%84%E6%A0%B7%E5%BC%8F%E6%95%88%E6%9E%9C"><span class="nav-number">4.4.</span> <span class="nav-text">修改导航条的样式效果</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%A1%B9%E7%9B%AE%E9%A6%96%E9%A1%B5"><span class="nav-number">5.</span> <span class="nav-text">项目首页</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82"><span class="nav-number">5.1.</span> <span class="nav-text">配置网络请求</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%A6%96%E9%A1%B5%E8%BD%AE%E6%92%AD%E5%8C%BA%E5%9F%9F"><span class="nav-number">5.2.</span> <span class="nav-text">首页轮播区域</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AF%B7%E6%B1%82%E8%BD%AE%E6%92%AD%E5%9B%BE%E7%9A%84%E6%95%B0%E6%8D%AE"><span class="nav-number">5.2.1.</span> <span class="nav-text">请求轮播图的数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B8%B2%E6%9F%93%E8%BD%AE%E6%92%AD%E5%9B%BE%E7%9A%84%E7%BB%93%E6%9E%84"><span class="nav-number">5.2.2.</span> <span class="nav-text">渲染轮播图的结构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E5%B0%8F%E7%A8%8B%E5%BA%8F%E7%9A%84%E5%88%86%E5%8C%85"><span class="nav-number">5.2.3.</span> <span class="nav-text">配置小程序的分包</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%82%B9%E5%87%BB%E8%BD%AE%E6%92%AD%E8%B7%B3%E8%BD%AC%E8%AF%A6%E6%83%85"><span class="nav-number">5.2.4.</span> <span class="nav-text">点击轮播跳转详情</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B0%81%E8%A3%85-uni-showMsg"><span class="nav-number">5.2.5.</span> <span class="nav-text">封装 uni.$showMsg()</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%86%E7%B1%BB%E5%AF%BC%E8%88%AA%E5%8C%BA%E5%9F%9F"><span class="nav-number">5.3.</span> <span class="nav-text">分类导航区域</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E5%88%86%E7%B1%BB%E5%AF%BC%E8%88%AA%E7%9A%84%E6%95%B0%E6%8D%AE"><span class="nav-number">5.3.1.</span> <span class="nav-text">获取分类导航的数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B8%B2%E6%9F%93%E5%88%86%E7%B1%BB%E5%AF%BC%E8%88%AA%E7%9A%84%E7%BB%93%E6%9E%84"><span class="nav-number">5.3.2.</span> <span class="nav-text">渲染分类导航的结构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%82%B9%E5%87%BB%E7%AC%AC%E4%B8%80%E9%A1%B9%E5%88%B0%E5%88%86%E7%B1%BB%E9%A1%B5"><span class="nav-number">5.3.3.</span> <span class="nav-text">点击第一项到分类页</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%A6%96%E9%A1%B5%E6%A5%BC%E5%B1%82%E5%8C%BA%E5%9F%9F"><span class="nav-number">5.4.</span> <span class="nav-text">首页楼层区域</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E6%A5%BC%E5%B1%82%E6%95%B0%E6%8D%AE"><span class="nav-number">5.4.1.</span> <span class="nav-text">获取楼层数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B8%B2%E6%9F%93%E6%A5%BC%E5%B1%82%E6%A0%87%E9%A2%98"><span class="nav-number">5.4.2.</span> <span class="nav-text">渲染楼层标题</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B8%B2%E6%9F%93%E6%A5%BC%E5%B1%82%E5%86%85%E5%AE%B9"><span class="nav-number">5.4.3.</span> <span class="nav-text">渲染楼层内容</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%82%B9%E5%87%BB%E6%A5%BC%E5%B1%82%E8%B7%B3%E8%BD%AC"><span class="nav-number">5.4.4.</span> <span class="nav-text">点击楼层跳转</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%88%86%E7%B1%BB%E9%A1%B5%E9%9D%A2"><span class="nav-number">6.</span> <span class="nav-text">分类页面</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E7%BB%93%E6%9E%84%E5%92%8C%E6%A0%B7%E5%BC%8F"><span class="nav-number">6.1.</span> <span class="nav-text">基本结构和样式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E5%88%86%E7%B1%BB%E7%9A%84%E6%95%B0%E6%8D%AE"><span class="nav-number">6.2.</span> <span class="nav-text">获取分类的数据</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B7%A6%E4%BE%A7%E7%9A%84%E4%B8%80%E7%BA%A7%E5%88%86%E7%B1%BB"><span class="nav-number">6.3.</span> <span class="nav-text">左侧的一级分类</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8C%E7%BA%A7%E5%88%86%E7%B1%BB%E7%9A%84%E6%A0%87%E9%A2%98"><span class="nav-number">6.4.</span> <span class="nav-text">二级分类的标题</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8C%E7%BA%A7%E5%88%86%E7%B1%BB%E7%9A%84%E5%86%85%E5%AE%B9"><span class="nav-number">6.5.</span> <span class="nav-text">二级分类的内容</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%87%8D%E7%BD%AE%E6%BB%9A%E5%8A%A8%E6%9D%A1%E4%BD%8D%E7%BD%AE"><span class="nav-number">6.6.</span> <span class="nav-text">重置滚动条位置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%B7%B3%E8%BD%AC%E5%88%B0%E5%95%86%E5%93%81%E5%88%97%E8%A1%A8"><span class="nav-number">6.7.</span> <span class="nav-text">跳转到商品列表</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%90%9C%E7%B4%A2%E5%8A%9F%E8%83%BD"><span class="nav-number">7.</span> <span class="nav-text">搜索功能</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%90%9C%E7%B4%A2%E7%BB%84%E4%BB%B6"><span class="nav-number">7.1.</span> <span class="nav-text">搜索组件</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89-my-search-%E7%BB%84%E4%BB%B6"><span class="nav-number">7.1.1.</span> <span class="nav-text">自定义 my-search 组件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%80%9A%E8%BF%87%E4%BC%A0%E5%80%BC%E5%A2%9E%E5%BC%BA%E7%BB%84%E4%BB%B6%E9%80%9A%E7%94%A8%E6%80%A7"><span class="nav-number">7.1.2.</span> <span class="nav-text">通过传值增强组件通用性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%94%AF%E6%8C%81%E5%A4%96%E7%95%8C-click-%E7%82%B9%E5%87%BB%E4%BA%8B%E4%BB%B6"><span class="nav-number">7.1.3.</span> <span class="nav-text">支持外界 click 点击事件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0%E9%A6%96%E9%A1%B5%E6%90%9C%E7%B4%A2%E7%9A%84%E5%90%B8%E9%A1%B6%E6%95%88%E6%9E%9C"><span class="nav-number">7.1.4.</span> <span class="nav-text">实现首页搜索的吸顶效果</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%90%9C%E7%B4%A2%E5%BB%BA%E8%AE%AE"><span class="nav-number">7.2.</span> <span class="nav-text">搜索建议</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B8%B2%E6%9F%93%E6%90%9C%E7%B4%A2%E9%A1%B5%E9%9D%A2%E7%9A%84%E5%9F%BA%E6%9C%AC%E7%BB%93%E6%9E%84"><span class="nav-number">7.2.1.</span> <span class="nav-text">渲染搜索页面的基本结构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0%E6%90%9C%E7%B4%A2%E6%A1%86%E8%87%AA%E5%8A%A8%E8%8E%B7%E5%8F%96%E7%84%A6%E7%82%B9"><span class="nav-number">7.2.2.</span> <span class="nav-text">实现搜索框自动获取焦点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0%E8%BE%93%E5%85%A5%E5%86%85%E5%AE%B9%E7%9A%84%E9%98%B2%E6%8A%96%E5%A4%84%E7%90%86"><span class="nav-number">7.2.3.</span> <span class="nav-text">实现输入内容的防抖处理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A0%B9%E6%8D%AE%E5%85%B3%E9%94%AE%E8%AF%8D%E6%9F%A5%E8%AF%A2%E6%90%9C%E7%B4%A2%E5%BB%BA%E8%AE%AE"><span class="nav-number">7.2.4.</span> <span class="nav-text">根据关键词查询搜索建议</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B8%B2%E6%9F%93%E5%90%8E%E7%AB%AF%E8%BF%94%E5%9B%9E%E7%9A%84%E6%90%9C%E7%B4%A2%E5%BB%BA%E8%AE%AE"><span class="nav-number">7.2.5.</span> <span class="nav-text">渲染后端返回的搜索建议</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%90%9C%E7%B4%A2%E5%8E%86%E5%8F%B2"><span class="nav-number">7.3.</span> <span class="nav-text">搜索历史</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E7%BB%93%E6%9E%84"><span class="nav-number">7.3.1.</span> <span class="nav-text">基本结构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8C%89%E9%9C%80%E5%B1%95%E7%A4%BA"><span class="nav-number">7.3.2.</span> <span class="nav-text">按需展示</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AE%B0%E5%BD%95%E5%85%B3%E9%94%AE%E8%AF%8D"><span class="nav-number">7.3.3.</span> <span class="nav-text">记录关键词</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E5%86%B3%E5%85%B3%E9%94%AE%E8%AF%8D%E9%87%8D%E5%A4%8D%E7%9A%84%E9%97%AE%E9%A2%98"><span class="nav-number">7.3.4.</span> <span class="nav-text">解决关键词重复的问题</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B0%86%E6%90%9C%E7%B4%A2%E5%8E%86%E5%8F%B2%E8%AE%B0%E5%BD%95%E6%8C%81%E4%B9%85%E5%8C%96"><span class="nav-number">7.3.5.</span> <span class="nav-text">将搜索历史记录持久化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B8%85%E7%A9%BA%E6%90%9C%E7%B4%A2%E5%8E%86%E5%8F%B2%E8%AE%B0%E5%BD%95%E5%8A%9F%E8%83%BD"><span class="nav-number">7.3.6.</span> <span class="nav-text">清空搜索历史记录功能</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%82%B9%E5%87%BB%E5%8E%86%E5%8F%B2%E8%B7%B3%E8%BD%AC%E5%88%B0%E5%88%97%E8%A1%A8%E9%A1%B5"><span class="nav-number">7.3.7.</span> <span class="nav-text">点击历史跳转到列表页</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%95%86%E5%93%81%E5%88%97%E8%A1%A8"><span class="nav-number">8.</span> <span class="nav-text">商品列表</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90%E6%80%BB%E7%BB%93"><span class="nav-number">8.1.</span> <span class="nav-text">需求分析总结</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BC%80%E5%8F%91%E5%89%8D%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C"><span class="nav-number">8.2.</span> <span class="nav-text">开发前准备工作</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AE%BE%E7%BD%AE%E5%88%97%E8%A1%A8%E9%A1%B5%E7%9A%84%E7%BC%96%E8%AF%91%E6%A8%A1%E5%BC%8F"><span class="nav-number">8.2.1.</span> <span class="nav-text">设置列表页的编译模式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%A1%B5%E9%9D%A2%E6%95%B4%E4%BD%93%E7%BB%93%E6%9E%84%E5%88%86%E6%9E%90%E6%90%AD%E5%BB%BA"><span class="nav-number">8.2.2.</span> <span class="nav-text">页面整体结构分析搭建</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0%E5%AF%B9%E8%B1%A1"><span class="nav-number">8.3.</span> <span class="nav-text">定义请求参数对象</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E5%95%86%E5%93%81%E5%88%97%E8%A1%A8%E6%95%B0%E6%8D%AE"><span class="nav-number">8.4.</span> <span class="nav-text">获取商品列表数据</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B8%B2%E6%9F%93%E5%95%86%E5%93%81%E5%88%97%E8%A1%A8%E7%BB%93%E6%9E%84"><span class="nav-number">8.5.</span> <span class="nav-text">渲染商品列表结构</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B0%81%E8%A3%85%E5%95%86%E5%93%81-item-%E7%BB%84%E4%BB%B6"><span class="nav-number">8.6.</span> <span class="nav-text">封装商品 item 组件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E8%BF%87%E6%BB%A4%E5%99%A8%E5%A4%84%E7%90%86%E4%BB%B7%E6%A0%BC"><span class="nav-number">8.7.</span> <span class="nav-text">使用过滤器处理价格</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%8A%E6%8B%89%E5%8A%A0%E8%BD%BD%E6%9B%B4%E5%A4%9A%E7%9A%84%E6%95%88%E6%9E%9C"><span class="nav-number">8.8.</span> <span class="nav-text">上拉加载更多的效果</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9D%E6%AD%A5%E5%AE%9E%E7%8E%B0%E4%B8%8A%E6%8B%89%E5%8A%A0%E8%BD%BD%E6%9B%B4%E5%A4%9A"><span class="nav-number">8.8.1.</span> <span class="nav-text">初步实现上拉加载更多</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%80%9A%E8%BF%87%E8%8A%82%E6%B5%81%E9%98%80%E6%8E%A7%E5%88%B6%E8%AF%B7%E6%B1%82"><span class="nav-number">8.8.2.</span> <span class="nav-text">通过节流阀控制请求</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%A4%E6%96%AD%E6%95%B0%E6%8D%AE%E6%98%AF%E5%90%A6%E5%8A%A0%E8%BD%BD%E5%AE%8C%E6%AF%95"><span class="nav-number">8.8.3.</span> <span class="nav-text">判断数据是否加载完毕</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%95%86%E5%93%81%E5%88%97%E8%A1%A8%E7%9A%84%E4%B8%8B%E6%8B%89%E5%88%B7%E6%96%B0"><span class="nav-number">8.9.</span> <span class="nav-text">商品列表的下拉刷新</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%82%B9%E5%87%BB%E5%88%97%E8%A1%A8%E9%A1%B9%E8%B7%B3%E8%BD%AC%E8%AF%A6%E6%83%85"><span class="nav-number">8.10.</span> <span class="nav-text">点击列表项跳转详情</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%95%86%E5%93%81%E8%AF%A6%E6%83%85"><span class="nav-number">9.</span> <span class="nav-text">商品详情</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%95%86%E5%93%81%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90"><span class="nav-number">9.1.</span> <span class="nav-text">商品需求分析</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BC%80%E5%8F%91%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C"><span class="nav-number">9.2.</span> <span class="nav-text">开发准备工作</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E5%95%86%E5%93%81%E8%AF%A6%E6%83%85"><span class="nav-number">9.3.</span> <span class="nav-text">获取商品详情</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B8%B2%E6%9F%93%E5%95%86%E5%93%81%E8%AF%A6%E6%83%85"><span class="nav-number">9.4.</span> <span class="nav-text">渲染商品详情</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B8%B2%E6%9F%93%E8%BD%AE%E6%92%AD%E5%9B%BE%E5%8C%BA%E5%9F%9F"><span class="nav-number">9.4.1.</span> <span class="nav-text">渲染轮播图区域</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0%E8%BD%AE%E6%92%AD%E5%9B%BE%E9%A2%84%E8%A7%88"><span class="nav-number">9.4.2.</span> <span class="nav-text">实现轮播图预览</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B8%B2%E6%9F%93%E5%95%86%E5%93%81%E7%9A%84%E4%BF%A1%E6%81%AF"><span class="nav-number">9.4.3.</span> <span class="nav-text">渲染商品的信息</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B8%B2%E6%9F%93%E5%95%86%E5%93%81%E7%9A%84%E8%AF%A6%E6%83%85"><span class="nav-number">9.4.4.</span> <span class="nav-text">渲染商品的详情</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E5%86%B3%E4%BB%B7%E6%A0%BC%E7%9A%84%E9%97%AA%E7%83%81"><span class="nav-number">9.4.5.</span> <span class="nav-text">解决价格的闪烁</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B8%B2%E6%9F%93%E5%95%86%E5%93%81%E5%AF%BC%E8%88%AA"><span class="nav-number">9.5.</span> <span class="nav-text">渲染商品导航</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%87%86%E5%A4%87-UI-%E7%BB%93%E6%9E%84"><span class="nav-number">9.5.1.</span> <span class="nav-text">准备 UI 结构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%B7%B3%E8%BD%AC%E5%88%B0%E8%B4%AD%E7%89%A9%E8%BD%A6"><span class="nav-number">9.5.2.</span> <span class="nav-text">跳转到购物车</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8A%A0%E5%85%A5%E8%B4%AD%E7%89%A9%E8%BD%A6"><span class="nav-number">10.</span> <span class="nav-text">加入购物车</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE-Vuex"><span class="nav-number">10.1.</span> <span class="nav-text">配置 Vuex</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E8%B4%AD%E7%89%A9%E8%BD%A6%E6%A8%A1%E5%9D%97"><span class="nav-number">10.2.</span> <span class="nav-text">创建购物车模块</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E8%B4%AD%E7%89%A9%E8%BD%A6%E6%A8%A1%E5%9D%97"><span class="nav-number">10.3.</span> <span class="nav-text">使用购物车模块</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8A%A0%E5%85%A5%E8%B4%AD%E7%89%A9%E8%BD%A6%E5%8A%9F%E8%83%BD"><span class="nav-number">10.4.</span> <span class="nav-text">加入购物车功能</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%B4%AD%E7%89%A9%E8%BD%A6%E4%B8%AD%E6%80%BB%E6%95%B0%E9%87%8F"><span class="nav-number">10.5.</span> <span class="nav-text">购物车中总数量</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8C%81%E4%B9%85%E5%8C%96%E5%AD%98%E5%82%A8%E8%B4%AD%E7%89%A9%E8%BD%A6%E4%B8%AD%E5%95%86%E5%93%81"><span class="nav-number">10.6.</span> <span class="nav-text">持久化存储购物车中商品</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8A%A8%E6%80%81%E4%B8%BA-TabBar-%E8%AE%BE%E7%BD%AE%E5%BE%BD%E6%A0%87"><span class="nav-number">10.7.</span> <span class="nav-text">动态为 TabBar 设置徽标</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BC%98%E5%8C%96%E4%B8%8A%E9%9D%A2%E7%9A%84%E4%BB%A3%E7%A0%81"><span class="nav-number">10.8.</span> <span class="nav-text">优化上面的代码</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%B4%AD%E7%89%A9%E8%BD%A6%E9%A1%B5%E9%9D%A2"><span class="nav-number">11.</span> <span class="nav-text">购物车页面</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90%E6%80%BB%E7%BB%93-1"><span class="nav-number">11.1.</span> <span class="nav-text">需求分析总结</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BC%80%E5%8F%91%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C-1"><span class="nav-number">11.2.</span> <span class="nav-text">开发准备工作</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%94%B6%E8%B4%A7%E5%9C%B0%E5%9D%80%E7%BB%84%E4%BB%B6"><span class="nav-number">11.3.</span> <span class="nav-text">收货地址组件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E6%94%B6%E8%B4%A7%E5%9C%B0%E5%9D%80"><span class="nav-number">11.4.</span> <span class="nav-text">获取收货地址</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AD%98%E5%82%A8-address-%E5%88%B0-Vuex"><span class="nav-number">11.5.</span> <span class="nav-text">存储 address 到 Vuex</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B0%86-address-%E4%BF%A1%E6%81%AF%E5%AD%98%E5%82%A8%E5%88%B0-vuex-%E4%B8%AD"><span class="nav-number">11.5.1.</span> <span class="nav-text">将 address 信息存储到 vuex 中</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B0%86-Store-%E4%B8%AD%E7%9A%84-address-%E6%8C%81%E4%B9%85%E5%8C%96%E5%AD%98%E5%82%A8%E5%88%B0%E6%9C%AC%E5%9C%B0"><span class="nav-number">11.5.2.</span> <span class="nav-text">将 Store 中的 address 持久化存储到本地</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B0%86-addstr-%E6%8A%BD%E7%A6%BB%E4%B8%BA-getters"><span class="nav-number">11.5.3.</span> <span class="nav-text">将 addstr 抽离为 getters</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%87%8D%E6%96%B0%E9%80%89%E6%8B%A9%E6%94%B6%E8%B4%A7%E5%9C%B0%E5%9D%80"><span class="nav-number">11.5.4.</span> <span class="nav-text">重新选择收货地址</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%B4%AD%E7%89%A9%E8%BD%A6%E5%88%97%E8%A1%A8%E5%8C%BA%E5%9F%9F"><span class="nav-number">11.6.</span> <span class="nav-text">购物车列表区域</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B8%B2%E6%9F%93%E8%B4%AD%E7%89%A9%E8%BD%A6%E5%95%86%E5%93%81%E5%88%97%E8%A1%A8%E7%9A%84%E6%A0%87%E9%A2%98%E5%8C%BA%E5%9F%9F"><span class="nav-number">11.6.1.</span> <span class="nav-text">渲染购物车商品列表的标题区域</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B8%B2%E6%9F%93%E5%95%86%E5%93%81%E5%88%97%E8%A1%A8%E5%8C%BA%E5%9F%9F%E7%9A%84%E5%9F%BA%E6%9C%AC%E7%BB%93%E6%9E%84"><span class="nav-number">11.6.2.</span> <span class="nav-text">渲染商品列表区域的基本结构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%BA-my-goods-%E7%BB%84%E4%BB%B6%E5%B0%81%E8%A3%85-radio-%E5%8B%BE%E9%80%89%E7%8A%B6%E6%80%81"><span class="nav-number">11.6.3.</span> <span class="nav-text">为 my-goods 组件封装 radio 勾选状态</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%80%9A%E8%BF%87-props-%E5%B1%9E%E6%80%A7%E6%8E%A7%E5%88%B6-radio-%E7%9A%84%E6%98%BE%E7%A4%BA"><span class="nav-number">11.6.4.</span> <span class="nav-text">通过 props 属性控制 radio 的显示</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8A%A8%E6%80%81%E7%BB%91%E5%AE%9A-radio-%E7%BB%84%E4%BB%B6%E7%9A%84%E5%80%BC"><span class="nav-number">11.6.5.</span> <span class="nav-text">动态绑定 radio 组件的值</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%BA-my-goods-%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BB%84%E4%BB%B6%E5%B0%81%E8%A3%85-radio-change-%E4%BA%8B%E4%BB%B6"><span class="nav-number">11.6.6.</span> <span class="nav-text">为 my-goods 自定义组件封装 radio-change 事件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9%E8%B4%AD%E7%89%A9%E8%BD%A6%E4%B8%AD%E5%95%86%E5%93%81%E7%9A%84%E5%8B%BE%E9%80%89%E7%8A%B6%E6%80%81"><span class="nav-number">11.6.7.</span> <span class="nav-text">修改购物车中商品的勾选状态</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%BA-my-goods-%E7%BB%84%E4%BB%B6%E5%B0%81%E8%A3%85-NumberBox"><span class="nav-number">11.6.8.</span> <span class="nav-text">为 my-goods 组件封装 NumberBox</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%BA-my-goods-%E7%BB%84%E4%BB%B6%E5%B0%81%E8%A3%85-num-change-%E4%BA%8B%E4%BB%B6"><span class="nav-number">11.6.9.</span> <span class="nav-text">为 my-goods 组件封装 num-change 事件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9%E8%B4%AD%E7%89%A9%E8%BD%A6%E4%B8%AD%E5%95%86%E5%93%81%E7%9A%84%E6%95%B0%E9%87%8F"><span class="nav-number">11.6.10.</span> <span class="nav-text">修改购物车中商品的数量</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8A%A8%E6%80%81%E8%AE%A1%E7%AE%97%E8%B4%AD%E7%89%A9%E8%BD%A6%E5%BE%BD%E6%A0%87%E7%9A%84%E6%95%B0%E5%80%BC"><span class="nav-number">11.6.11.</span> <span class="nav-text">动态计算购物车徽标的数值</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B8%B2%E6%9F%93%E6%BB%91%E5%8A%A8%E5%88%A0%E9%99%A4%E7%9A%84-UI-%E6%95%88%E6%9E%9C"><span class="nav-number">11.6.12.</span> <span class="nav-text">渲染滑动删除的 UI 效果</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0%E6%BB%91%E5%8A%A8%E5%88%A0%E9%99%A4%E7%9A%84%E5%8A%9F%E8%83%BD"><span class="nav-number">11.6.13.</span> <span class="nav-text">实现滑动删除的功能</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BB%93%E7%AE%97%E5%8C%BA%E5%9F%9F"><span class="nav-number">11.7.</span> <span class="nav-text">结算区域</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8A%8A%E7%BB%93%E7%AE%97%E5%8C%BA%E5%9F%9F%E5%B0%81%E8%A3%85%E4%B8%BA%E7%BB%84%E4%BB%B6"><span class="nav-number">11.7.1.</span> <span class="nav-text">把结算区域封装为组件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B8%B2%E6%9F%93%E7%BB%93%E7%AE%97%E5%8C%BA%E5%9F%9F%E7%9A%84%E7%BB%93%E6%9E%84%E5%92%8C%E6%A0%B7%E5%BC%8F"><span class="nav-number">11.7.2.</span> <span class="nav-text">渲染结算区域的结构和样式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8A%A8%E6%80%81%E6%B8%B2%E6%9F%93%E5%B7%B2%E5%8B%BE%E9%80%89%E5%95%86%E5%93%81%E7%9A%84%E6%80%BB%E6%95%B0%E9%87%8F"><span class="nav-number">11.7.3.</span> <span class="nav-text">动态渲染已勾选商品的总数量</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8A%A8%E6%80%81%E6%B8%B2%E6%9F%93%E5%85%A8%E9%80%89%E6%8C%89%E9%92%AE%E7%9A%84%E9%80%89%E4%B8%AD%E7%8A%B6%E6%80%81"><span class="nav-number">11.7.4.</span> <span class="nav-text">动态渲染全选按钮的选中状态</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0%E5%95%86%E5%93%81%E7%9A%84%E5%85%A8%E9%80%89-%E5%8F%8D%E9%80%89%E5%8A%9F%E8%83%BD"><span class="nav-number">11.7.5.</span> <span class="nav-text">实现商品的全选&#x2F;反选功能</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8A%A8%E6%80%81%E6%B8%B2%E6%9F%93%E5%B7%B2%E5%8B%BE%E9%80%89%E5%95%86%E5%93%81%E7%9A%84%E6%80%BB%E4%BB%B7%E6%A0%BC"><span class="nav-number">11.7.6.</span> <span class="nav-text">动态渲染已勾选商品的总价格</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B8%B2%E6%9F%93%E8%B4%AD%E7%89%A9%E8%BD%A6%E4%B8%BA%E7%A9%BA%E6%97%B6%E7%9A%84%E9%A1%B5%E9%9D%A2%E7%BB%93%E6%9E%84"><span class="nav-number">11.7.7.</span> <span class="nav-text">渲染购物车为空时的页面结构</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%99%BB%E5%BD%95%E5%92%8C%E6%94%AF%E4%BB%98"><span class="nav-number">12.</span> <span class="nav-text">登录和支付</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%99%BB%E5%BD%95%E6%94%AF%E4%BB%98%E6%BC%94%E7%A4%BA"><span class="nav-number">12.1.</span> <span class="nav-text">登录支付演示</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90%E6%80%BB%E7%BB%93-2"><span class="nav-number">12.2.</span> <span class="nav-text">需求分析总结</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%82%B9%E5%87%BB%E7%BB%93%E7%AE%97%E6%8C%89%E9%92%AE%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0"><span class="nav-number">12.3.</span> <span class="nav-text">点击结算按钮功能实现</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E7%99%BB%E5%BD%95%E5%92%8C%E4%B8%AA%E4%BA%BA%E4%BF%A1%E6%81%AF%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BB%84%E4%BB%B6"><span class="nav-number">12.4.</span> <span class="nav-text">创建登录和个人信息自定义组件</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89-my-%E9%A1%B5%E9%9D%A2%E7%9A%84%E7%BC%96%E8%AF%91%E6%A8%A1%E5%BC%8F"><span class="nav-number">12.4.1.</span> <span class="nav-text">定义 my 页面的编译模式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E7%99%BB%E5%BD%95%E5%92%8C%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF%E7%BB%84%E4%BB%B6%EF%BC%8C%E5%B9%B6%E5%AE%9E%E7%8E%B0%E6%A0%B9%E6%8D%AE%E6%98%AF%E5%90%A6%E7%99%BB%E5%BD%95%E7%9A%84%E6%9D%A1%E4%BB%B6%E6%B8%B2%E6%9F%93"><span class="nav-number">12.4.2.</span> <span class="nav-text">创建登录和用户信息组件，并实现根据是否登录的条件渲染</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%99%BB%E5%BD%95%E7%BB%84%E4%BB%B6%E5%B8%83%E5%B1%80"><span class="nav-number">12.5.</span> <span class="nav-text">登录组件布局</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%99%BB%E5%BD%95%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0"><span class="nav-number">12.6.</span> <span class="nav-text">登录功能实现</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%82%B9%E5%87%BB%E7%99%BB%E5%BD%95%E6%8C%89%E9%92%AE%E8%8E%B7%E5%8F%96%E5%BE%AE%E4%BF%A1%E7%94%A8%E6%88%B7%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BF%A1%E6%81%AF"><span class="nav-number">12.6.1.</span> <span class="nav-text">点击登录按钮获取微信用户的基本信息</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BF%9D%E5%AD%98%E5%BE%AE%E4%BF%A1%E7%94%A8%E6%88%B7%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BF%A1%E6%81%AF%E5%88%B0-vuex-%E4%B8%AD"><span class="nav-number">12.6.2.</span> <span class="nav-text">保存微信用户的基本信息到 vuex 中</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96-Token-%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="nav-number">12.7.</span> <span class="nav-text">获取 Token 字符串</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BF%9D%E5%AD%98-Token-%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%88%B0-vuex-%E4%B8%AD"><span class="nav-number">12.8.</span> <span class="nav-text">保存 Token 字符串到 vuex 中</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF%E7%BB%84%E4%BB%B6-%E5%A4%B4%E5%83%8F%E6%98%B5%E7%A7%B0%E5%8C%BA%E5%9F%9F%E5%B8%83%E5%B1%80%E5%92%8C%E6%95%B0%E6%8D%AE%E6%B8%B2%E6%9F%93"><span class="nav-number">12.9.</span> <span class="nav-text">用户信息组件-头像昵称区域布局和数据渲染</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0%E7%94%A8%E6%88%B7%E5%A4%B4%E5%83%8F%E6%98%B5%E7%A7%B0%E5%8C%BA%E5%9F%9F%E7%9A%84%E5%9F%BA%E6%9C%AC%E5%B8%83%E5%B1%80"><span class="nav-number">12.9.1.</span> <span class="nav-text">实现用户头像昵称区域的基本布局</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B8%B2%E6%9F%93%E7%94%A8%E6%88%B7%E7%9A%84%E5%A4%B4%E5%83%8F%E5%92%8C%E6%98%B5%E7%A7%B0"><span class="nav-number">12.9.2.</span> <span class="nav-text">渲染用户的头像和昵称</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF%E7%BB%84%E4%BB%B6-%E5%8A%9F%E8%83%BD%E9%9D%A2%E6%9D%BF%E5%8C%BA%E5%9F%9F%E5%B8%83%E5%B1%80"><span class="nav-number">12.10.</span> <span class="nav-text">用户信息组件-功能面板区域布局</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B8%B2%E6%9F%93%E7%AC%AC%E4%B8%80%E4%B8%AA%E9%9D%A2%E6%9D%BF%E5%8C%BA%E5%9F%9F"><span class="nav-number">12.10.1.</span> <span class="nav-text">渲染第一个面板区域</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B8%B2%E6%9F%93%E7%AC%AC%E4%BA%8C%E4%B8%AA%E9%9D%A2%E6%9D%BF%E5%8C%BA%E5%9F%9F"><span class="nav-number">12.10.2.</span> <span class="nav-text">渲染第二个面板区域</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B8%B2%E6%9F%93%E7%AC%AC%E4%B8%89%E4%B8%AA%E9%9D%A2%E6%9D%BF%E5%8C%BA%E5%9F%9F"><span class="nav-number">12.10.3.</span> <span class="nav-text">渲染第三个面板区域</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%80%80%E5%87%BA%E7%99%BB%E5%BD%95%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0"><span class="nav-number">12.11.</span> <span class="nav-text">退出登录功能实现</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%89%E7%A7%92%E5%90%8E%E8%87%AA%E5%8A%A8%E8%B7%B3%E8%BD%AC%E5%88%B0%E7%99%BB%E5%BD%95%E9%A1%B5%E9%9D%A2"><span class="nav-number">12.12.</span> <span class="nav-text">三秒后自动跳转到登录页面</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%99%BB%E5%BD%95%E6%88%90%E5%8A%9F%E4%B9%8B%E5%90%8E%E8%87%AA%E5%8A%A8%E8%BF%94%E5%9B%9E%E4%B9%8B%E5%89%8D%E7%9A%84%E9%A1%B5%E9%9D%A2"><span class="nav-number">12.13.</span> <span class="nav-text">登录成功之后自动返回之前的页面</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%B0%83%E7%94%A8%E6%94%AF%E4%BB%98%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C"><span class="nav-number">12.14.</span> <span class="nav-text">调用支付准备工作</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9C%A8%E8%AF%B7%E6%B1%82%E5%A4%B4%E4%B8%AD%E6%B7%BB%E5%8A%A0-Token-%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81%E7%9A%84%E5%AD%97%E6%AE%B5"><span class="nav-number">12.14.1.</span> <span class="nav-text">在请求头中添加 Token 身份认证的字段</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BE%AE%E4%BF%A1%E6%94%AF%E4%BB%98%E7%9A%84%E6%B5%81%E7%A8%8B"><span class="nav-number">12.14.2.</span> <span class="nav-text">微信支付的流程</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E8%AE%A2%E5%8D%95"><span class="nav-number">12.15.</span> <span class="nav-text">创建订单</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AE%A2%E5%8D%95%E9%A2%84%E6%94%AF%E4%BB%98"><span class="nav-number">12.16.</span> <span class="nav-text">订单预支付</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%91%E8%B5%B7%E5%BE%AE%E4%BF%A1%E6%94%AF%E4%BB%98"><span class="nav-number">12.17.</span> <span class="nav-text">发起微信支付</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8F%91%E5%B8%83%E5%B0%8F%E7%A8%8B%E5%BA%8F"><span class="nav-number">13.</span> <span class="nav-text">发布小程序</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Ifer"
      src="/images/49337922.png">
  <p class="site-author-name" itemprop="name">Ifer</p>
  <div class="site-description" itemprop="description">React 全家桶 <span style='position:relative;top:-2px;'>✍</span></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">92</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://www.bilibili.com/video/BV1iW4y1k7Ci?spm_id_from=333.337.search-card.all.click" title="😚 → https:&#x2F;&#x2F;www.bilibili.com&#x2F;video&#x2F;BV1iW4y1k7Ci?spm_id_from&#x3D;333.337.search-card.all.click" rel="noopener" target="_blank"><i class="a fa-fw"></i>😚</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.zhihu.com/people/weixiantx" title="😙 → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;weixiantx" rel="noopener" target="_blank"><i class="a fa-fw"></i>😙</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Ifer</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
